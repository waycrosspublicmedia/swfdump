window.switOnLoad=function(){if(window.SwitEntryPoint.isSupported)if(navigator.cookieEnabled){document.onkeydown=function(a){if(!window.USE_SANBOX)return a.preventDefault(),!1};var a="",b="";"undefined"!==typeof document.hidden?(a="hidden",b="visibilitychange"):"undefined"!==typeof document.mozHidden?(a="mozHidden",b="mozvisibilitychange"):"undefined"!==typeof document.msHidden?(a="msHidden",b="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange");
document.addEventListener(b,function(){Application.instance&&(document[a]?(Application.instance.isHidden=!0,Application.instance.onLostFocus()):(Application.instance.isHidden=!1,Application.instance.onGotFocus()))},!1);Application.strings={};Application.strings=window.switStrings;Application.strings.STR_EMPTY={value:""};Application.strings.STR_LOADER_FONT={value:"."};window.switStrings=null;window.globalAnimations={};window.SwitEntryPoint.infoBrowser.isLowDefinition&&Application.warn("Detecting low definition device");
window.SwitEntryPoint.infoBrowser.useAssetsSD&&Application.warn("Using SD assets");new Application}else{var c=document.createElement("div");c.setAttribute("align","center");document.body.appendChild(c);var d=new Image;d.onload=function(){d.setAttribute("width","100%");d.setAttribute("height","100%");c.appendChild(d)};d.src="media/images/ui_images/cookiesrequired.jpg"}};window.onpagehide=function(){if(Application.instance)Application.instance.onLostFocus()};window.onpageshow=function(){if(Application.instance)Application.instance.onGotFocus()};
window.onblur=function(){if(Application.instance)Application.instance.onLostFocus()};window.onfocus=function(){if(Application.instance)Application.instance.onGotFocus()};window.onresize=function(a){Application.instance&&(Application.instance.onResize(a.target.innerWidth,a.target.innerHeight),Application.instance.hideAddressBar())};window.onorientationchange=function(a){if(Application.instance)Application.instance.onOrientationchange(a)};window.onkeydown=function(a){if(Application.instance)Application.instance.onKeyDown(a)};
window.onkeyup=function(a){if(Application.instance)Application.instance.onKeyUp(a)};window.onerror=function(a,b,c,d){window.SwitEntryPoint.isMobileDevice&&Application.error(a+" File: "+b+" Line: "+c+"  Col: "+d)};
function Application(){Application.instance=this;Application.config=window.config;Application.MAX_DELTA_TIME=Application.config.settings.MAX_DELTA_TIME;Application.SAFE_AREA_WIDTH=Application.config.settings.SAFE_AREA_WIDTH;Application.APP_WIDTH=Application.config.settings.APP_WIDTH;Application.APP_HEIGHT=Application.config.settings.APP_HEIGHT;Application.SOUND_PERCENT=Application.config.settings.SOUND_PERCENT;Application.LOG=Application.config.settings.LOG;Application.ASSETS_PATH=Application.config.settings.ASSETS_PATH;
Application.USE_TILT=Application.config.settings.USE_TILT;Application.USE_CHEATS=Application.config.settings.USE_CHEATS;Application.CHECK_STRINGS=Application.config.settings.CHECK_STRINGS;Application.RENDER_MODE=Application.config.settings.RENDER_MODE;Application.CONSOLE_MODE=Application.config.settings.CONSOLE_MODE;Application.WIDE_SCREEN=Application.config.settings.WIDE_SCREEN;Application.RIGHT_TO_LEFT=Application.config.settings.RIGHT_TO_LEFT;Application.SHOW_SOCIAL_BUTTONS=Application.config.settings.SHOW_SOCIAL_BUTTONS;
Application.USE_ONLY_SOUNDJS=Application.config.settings.USE_ONLY_SOUNDJS;Cheats.enabled=Application.USE_CHEATS;if(Application.CHECK_STRINGS){var a=[];for(e in Application.config.settings)if(-1!==e.indexOf("SIZE_STRINGS_TYPE_")){var b=Application.config.settings[e].split(","),c=parseInt(b[0],10);b=parseInt(b[1],10)/100;a.push([c,b])}a.sort(Application.orderArray);for(var d in Application.strings){var e=Application.strings[d].value;var f=e.length;c=0;b="";if(!(0>=f)){for(var g=0;g<a.length;g++)if(f<=
a[g][0]){c=Math.floor(f*a[g][1]);break}0===c&&(c=Math.floor(f*a[a.length-1][1]));for(f=1;f<=Math.ceil(c/2);f++)b+="#";Application.strings[d].value=b+" "+e+" "+b}}}this.updateable=!0;this.lastHeight=this.lastWidth=0;this.isHidden=!1;this.soundManager=null;this.effectManager=new SEffectManager;this.guiManager=new GuiManager;this.tweenManager=new TweenManager;window.onRequestProfile=this.onDisneyProfileRequest;for(var h in window.SWT_BUNDLES){if(Array.isArray(window.SWT_BUNDLES[h])){if(0<h.indexOf("_rtl"))if(Application.RIGHT_TO_LEFT)window.SWT_BUNDLES[h.replace("_rtl",
"")]=window.SWT_BUNDLES[h];else continue;if(0<h.indexOf("_ltr"))if(Application.RIGHT_TO_LEFT)continue;else window.SWT_BUNDLES[h.replace("_ltr","")]=window.SWT_BUNDLES[h]}"string"===typeof h&&Application.filesQuality(h)}this.isMobileDevice=window.SwitEntryPoint.isMobileDevice;this.m_fpsOldTime=this.m_fpsFrameCounter=this.fps=0;this.stage=new window.PIXI.Container;a={legacy:!1,view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!0,resolution:1};window.USE_SANBOX&&(Cheats.enabled=!0);switch(Application.RENDER_MODE){case 0:this.renderer=
PIXI.autoDetectRenderer(Application.APP_WIDTH,Application.APP_HEIGHT,a);Application.RENDER_MODE=this.renderer.type;break;case Application.RENDER_WEBGL:this.renderer=new PIXI.WebGLRenderer(Application.APP_WIDTH,Application.APP_HEIGHT,a);break;case Application.RENDER_CANVAS:this.renderer=new PIXI.CanvasRenderer(Application.APP_WIDTH,Application.APP_HEIGHT,a)}Application.log("Application.RENDER_MODE: "+Application.RENDER_MODE);Application.RENDER_MODE===Application.RENDER_WEBGL?Application.log("USING WEBGL RENDERER"):
Application.log("USING CANVAS RENDERER");window.USE_SANBOX?document.getElementById("contentGame").appendChild(this.renderer.view):document.body.appendChild(this.renderer.view);window.USE_SANBOX_NANO?(Layout.align=Layout.ALIGN_TOP_LEFT,new window.SandboxNano,Application.WIDE_SCREEN=!1):window.USE_SANBOX&&(new window.SandboxGui,Application.sandbox=new window.SandboxGame);this.renderer.view.setAttribute("id","MainCanvasDraw");this.renderer.view.style.position="absolute";Application.RIGHT_TO_LEFT&&this.renderer.view.setAttribute("dir",
"rtl");this.renderer.plugins.interaction.autoPreventDefault=this.isMobileDevice;this.renderer.plugins.interaction.moveWhenInside=!0;this.canvas=this.addDisplayContainer();this.stage.addChild(this.canvas);(a=document.getElementById("SWT_FONTS_DIV"))&&a.parentElement&&a.parentElement.removeChild(a);this.rotateScreen=null;this.canvasRotateScreen=this.addDisplayContainer();this.stage.addChild(this.canvasRotateScreen);this.rotateScreen=new RotateScreen(this.canvasRotateScreen);this.onOrientationchange(null);
Application.WIDE_SCREEN||(this.canvasEvents=document.createElement("canvas"),this.canvasEvents.width=window.innerWidth,this.canvasEvents.height=window.innerHeight,this.canvasEvents.style.top="0px",this.canvasEvents.style.left="0px",document.body.appendChild(this.canvasEvents),this.canvasEvents.setAttribute("id","MainCanvasEvents"),this.renderer.plugins.interaction.supportsPointerEvents&&(this.canvasEvents.addEventListener("pointerdown",this.renderer.plugins.interaction.onPointerDown,!0),this.canvasEvents.addEventListener("pointerout",
this.renderer.plugins.interaction.onPointerOut,!0),this.canvasEvents.addEventListener("pointerover",this.renderer.plugins.interaction.onPointerOver,!0)),this.renderer.plugins.interaction.supportsTouchEvents&&(this.canvasEvents.addEventListener("touchstart",this.renderer.plugins.interaction.onTouchStart,!0),this.canvasEvents.addEventListener("touchend",this.renderer.plugins.interaction.onTouchEnd,!0),this.canvasEvents.addEventListener("touchmove",this.renderer.plugins.interaction.onTouchMove,!0)),
this.canvasEvents.addEventListener("mousedown",this.renderer.plugins.interaction.onMouseDown,!0),this.canvasEvents.addEventListener("mouseout",this.renderer.plugins.interaction.onMouseOut,!0),this.canvasEvents.addEventListener("mouseover",this.renderer.plugins.interaction.onMouseOver,!0));this.socialShareObject=null;Application.SHOW_SOCIAL_BUTTONS&&window.gameObj&&(this.socialShareObject=window.gameObj);this.activeAgePopUp=!1;this.m_deltaTime=this.m_oldTime=0;Application.instance.update();this.guiManager.gotoScreen(GuiManager.SC_PRELOAD);
window.SwitEntryPoint.infoBrowser.isLowDefinition&&(Application.isLowDevice=!0);Application.RENDER_MODE===Application.RENDER_CANVAS&&(Application.isLowDevice=!0)}Application.MAX_DELTA_TIME=0;Application.SAFE_AREA_WIDTH=0;Application.APP_WIDTH=1024;Application.APP_HEIGHT=768;Application.SOUND_PERCENT=0;Application.LOG=!1;Application.ASSETS_PATH="";Application.USE_TILT=!1;Application.USE_CHEATS=!1;Application.CHECK_STRINGS=!1;Application.RIGHT_TO_LEFT=!1;Application.RENDER_WEBGL=1;
Application.RENDER_CANVAS=2;Application.RENDER_MODE=Application.RENDER_CANVAS;Application.DPI=1;Application.SHOW_SOCIAL_BUTTONS=!1;Application.jsonFiles={};Application.soundGroups={};Application.instance=null;Application.strings=null;Application.config=null;Application.sandbox=null;Application.isLowDevice=!1;Application.disneyProfileName="";Application.subclass=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a};
Application.orderArray=function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0};Application.validateOrientation=function(){return Application.WIDE_SCREEN?window.innerWidth>=window.innerHeight:!0};Application.onOffline=function(){};Application.onWrapperSuspended=function(){Application.log("onWrapperSuspended");Application.instance.onLostFocus()};Application.onWrapperSuspending=function(){Application.log("onWrapperSuspending");Application.instance.onLostFocus()};
Application.onWrapperActivated=function(){Application.log("onWrapperActivated");Application.instance.onGotFocus()};Application.prototype.fullScreen=function(){if(this.isMobileDevice){var a=this.renderer.view,b=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;b&&b.call(a)}};Application.prototype.onTilt=function(a){if(Application.instance.guiManager)Application.instance.guiManager.onTilt(a)};Application.prototype.onKeyDown=function(a){if(this.guiManager)this.guiManager.onKeyDown(a.keyCode)};
Application.prototype.onKeyUp=function(a){if(this.guiManager)this.guiManager.onKeyUp(a.keyCode)};Application.prototype.onLoadingError=function(a){Application.error("onLoadingError: "+a)};Application.prototype.onSoundsLoaded=function(){Application.info("onSoundsLoaded");SndManager.instance.callbackBug&&Application.instance.guiManager.gotoScreen(GuiManager.SC_MAIN_MENU)};
Application.prototype.onErrorSndManagerIE=function(){Application.info("onErrorSndManagerIE");var a=Application.instance.soundManager.soundsToLoad;Application.instance.soundManager=new SndManagerWeb(Application.instance.onSoundsLoaded);a&&Application.instance.soundManager.loadSounds(a)};
Application.prototype.onLoaderReady=function(){Application.info("onLoaderReady");window.USE_SANBOX_NANO?Application.instance.guiManager.gotoScreen(GuiManager.SC_SANDBOX_NANO_VIEW):(Application.instance.onResize(window.innerWidth,window.innerHeight),Application.instance.soundManager=window.SwitEntryPoint.infoBrowser.isIE&&!Application.USE_ONLY_SOUNDJS?new SndManagerIE(Application.instance.onSoundsLoaded):new SndManagerWeb(Application.instance.onSoundsLoaded),Application.instance.guiManager.gotoScreen(GuiManager.SC_MAIN_MENU))};
Application.prototype.onResize=function(a,b){this.lastWidth=a;this.lastHeight=b;Layout.onResize(a,b);if(this.rotateScreen)this.rotateScreen.onResize();this.onOrientationchange(null)};
Application.prototype.onOrientationchange=function(a){if(window.SwitEntryPoint.isMobileDevice)if(Application.WIDE_SCREEN&&window.innerHeight>window.innerWidth)Application.instance.socialShareObject&&(Application.instance.activeAgePopUp="block"==window.$("#endgameHUD").css("display"),Application.instance.socialShareObject.badRotation()),this.rotateScreen&&this.rotateScreen.show(),this.onLostFocus();else{if(Application.instance.socialShareObject){Application.instance.socialShareObject.goodRotation();
try{Application.instance.activeAgePopUp?window.$("#endgameHUD").css("display","block"):window.$("#endgameHUD").css("display","none")}catch(b){}}this.rotateScreen&&this.rotateScreen.hide();this.onGotFocus()}};Application.prototype.onLostFocus=function(){Application.info("-- ON LOST FOCUS --");this.updateable=!1;try{this.soundManager&&!this.soundManager.isMuted()&&this.soundManager.pauseAll()}catch(a){Application.error("onLostFocus: "+a)}};
Application.prototype.onGotFocus=function(){if(Application.validateOrientation())if(this.isHidden)Application.info("ON GOT FOCUS - The window is hidden.. Do not get focus.");else{Application.info("-- ON GOT FOCUS --");this.updateable=!0;try{this.soundManager&&!this.soundManager.isMuted()&&this.soundManager.resumeAll()}catch(a){Application.error("onGotFocus: "+a)}}else Application.info("ON GOT FOCUS - Invalid orientation.. Do not get focus.")};
Application.prototype.update=function(){window.requestAnimationFrame(Application.instance.update);var a=Application.instance,b=Date.now();a.m_deltaTime=b-a.m_oldTime;a.m_oldTime=b;a.updateable?(a.m_deltaTime>Application.MAX_DELTA_TIME&&(a.m_deltaTime=Application.MAX_DELTA_TIME),Tween2.tick(a.m_deltaTime,!1),a.guiManager.update(a.m_deltaTime),a.effectManager.update(a.m_deltaTime),a.tweenManager.update()):a.rotateScreen&&a.rotateScreen.animate&&a.tweenManager.update();a.m_fpsFrameCounter++;1E3<=b-a.m_fpsOldTime&&
(a.fps=~~(a.m_fpsFrameCounter/(b-a.m_fpsOldTime)*1E3),a.m_fpsOldTime=b,a.m_fpsFrameCounter=0);a.renderer.render(a.stage);Application.WIDE_SCREEN?Application.RENDER_MODE===Application.RENDER_CANVAS&&a.getContext().setTransform(Layout.scale*Global.baseScale,0,0,Layout.scale*Global.baseScale,Global.offsetZoomX*Layout.scale,Global.offsetZoomY*Layout.scale):Application.RENDER_MODE===Application.RENDER_CANVAS&&a.getContext().setTransform(Global.baseScale,0,0,Global.baseScale,Global.offsetZoomX,Global.offsetZoomY);
if(window.innerWidth!==a.lastWidth||window.innerHeight!==a.lastHeight)a.onResize(window.innerWidth,window.innerHeight),a.hideAddressBar()};Application.prototype.hideAddressBar=function(){Application.instance.isMobileDevice&&(setTimeout(function(){window.scrollTo(0,1)},20),setTimeout(function(){window.scrollTo(0,0)},50))};Application.prototype.getCanvas=function(){return this.renderer.view};
Application.prototype.getContext=function(){return Application.RENDER_MODE===Application.RENDER_CANVAS?this.renderer.context:this.renderer.gl};Application.prototype.captureScreen=function(){return Application.instance.getCanvas().toDataURL()};Application.prototype.addDisplayContainer=function(){return new SDisplayObjectContainer};Application.prototype.getSprite=function(a){if(null!=window.PIXI.utils.TextureCache[a])return new SSprite(a);Application.warn("getSprite: ["+a+"] no found");return this.getErrorSprite()};
Application.prototype.getAnimation=function(a){return 0===a.length?null:new Animation(a)};Application.prototype.existsAnimation=function(a){return"undefined"!==typeof window.globalAnimations[a]&&null!==window.globalAnimations[a]};
Application.prototype.getClip=function(a){window.PIXI.utils.TextureCache[a]&&window.globalAnimations[a]&&Application.warn("::: NAME CONFLICT ::: ["+a+"] is used in Animations and Sprites");if(window.PIXI.utils.TextureCache[a])return window.globalAnimations[a]&&Application.warn("An animation with the same name exists. Sprite name: "+a),new SSprite(a);if(window.globalAnimations[a])return new Animation(a);Application.warn("getClip :: clip or sprite with name ["+a+"] no found");return this.getErrorSprite()};
Application.prototype.getSpriteFromUrl=function(a){return PIXI.Sprite.fromImage(a,!1,PIXI.settings.DEFAULT)};Application.prototype.getLocalizedImage=function(a){if(window.SwitEntryPoint.debug){var b=window.SWT_BUNDLES.localized;if(b){for(var c=window.SWT_BUNDLES.LOCALIZED_PATH,d=0;d<b.length;d++)if(b[d]===c+a)return new SSprite(b[d],!1,PIXI.settings.SCALE_MODE);return null}Application.fatal("Unregistered localized image: "+a)}return new SSprite(window.SWT_BUNDLES.LOCALIZED_PATH+a,!1,PIXI.settings.SCALE_MODE)};
Application.filesQuality=function(a){if(window.SwitEntryPoint.infoBrowser.useAssetsSD)for(var b=0;b<window.SWT_BUNDLES[a].length;b++)window.Assets.FILES_SD[window.SWT_BUNDLES[a][b]]&&(Application.DPI=2,window.SWT_BUNDLES[a][b]=window.Assets.FILES_SD[window.SWT_BUNDLES[a][b]],Application.log("FILES SD :: "+window.SWT_BUNDLES[a][b]))};Application.prototype.onDisneyProfileRequest=function(a,b,c){Application.disneyProfileName=a};
Application.prototype.getSoundGroup=function(a){var b=Application.config.sounds.filter(function(b){return Common.sparseInt(b.group,0)===a});return 0<b.length?{group:a,sounds:b}:null};Application.prototype.unloadSoundGroup=function(a){if(Application.soundGroups[a]){var b=Application.config.sounds.filter(function(b){return Common.sparseInt(b.group,0)===a});this.soundManager.removeSounds(b);delete Application.soundGroups[a]}};
Application.prototype.unloadSoundsFromList=function(a){if(null!=a&&0<a.length)for(var b=a.length-1;0<=b;--b)this.unloadSoundGroup(a[b])};Application.prototype.playSound=function(a){this.soundManager.play(a)};Application.prototype.stopSound=function(a){this.soundManager.stop(a)};Application.prototype.stopAllSounds=function(){this.isSoundOn()&&this.soundManager.stopAllSounds()};Application.prototype.stopAllMusics=function(){this.soundManager.stopAllMusics()};Application.prototype.toggleMute=function(){this.soundManager.toggleMute()};
Application.prototype.isPlayingSound=function(a){return this.soundManager.isPlayingSound(a)};Application.prototype.setVolumeById=function(a,b){this.soundManager.setVolumeById(a,b)};Application.prototype.setVolumeFactor=function(a,b){this.soundManager.setVolumeFactor(a,b)};Application.prototype.isSoundOn=function(){return!this.soundManager.isMuted()};Application.prototype.resumeSound=function(a){this.soundManager.resumeSound(a)};Application.prototype.pauseAllSounds=function(){this.soundManager.pauseAll()};
Application.prototype.resumeAllSounds=function(){this.soundManager.resumeAll()};Application.log=function(a){Application.LOG&&(window.console&&window.console.log&&window.console.log("[LOG] "+a),window.Debug&&window.Debug.writeln("[LOG] "+a))};Application.info=function(a){window.console&&window.console.info&&window.console.info("[INFO] "+a);window.Debug&&window.Debug.writeln("[INFO] "+a)};
Application.warn=function(a){window.console&&window.console.warn&&window.console.warn("[WARN] "+a);window.Debug&&window.Debug.writeln("[WARN] "+a)};Application.error=function(a){window.console&&window.console.error&&window.console.error("[ERROR] "+a);window.Debug&&window.Debug.writeln("[ERROR] "+a)};Application.errorIf=function(a,b){a&&Application.error(b)};Application.fatal=function(a){Application.error("[FATAL] "+a)};Application.assert=function(a,b){a||Application.fatal(b)};
Application.prototype.getEmptySprite=function(){return this.getSpriteFromUrl("media/images/ui_images/common/empty_img.png")};Application.prototype.getErrorSprite=function(){return this.getSpriteFromUrl("media/images/ui_images/common/error_img.png")};
Application.externalTrack=function(a,b){"undefined"!==typeof b?Application.warn("TRACK "+window.config.settings.GAME_NAME_TRACKING+" : ["+a+"] ("+b+")"):Application.warn("TRACK "+window.config.settings.GAME_NAME_TRACKING+" : ["+a+"]");if(window.Uatu)try{"undefined"!==typeof b?window.Uatu.warn(a,{game_name:window.config.settings.GAME_NAME_TRACKING}):window.Uatu.warn(a,{game_name:window.config.settings.GAME_NAME_TRACKING,game_level:b})}catch(c){Application.error("Uatu: "+c)}};
Application.trackGameStart=function(){Application.externalTrack("game_start")};Application.trackGameComplete=function(){Application.externalTrack("game_complete")};Application.trackGameContinue=function(a){Application.externalTrack("game_continue",a)};Application.trackGameFailure=function(a){Application.externalTrack("game_failure",a)};function DebugGame(){DebugGame.instance=this}DebugGame.instance=null;DebugGame.prototype.free=function(){DebugGame.instance=null};DebugGame.prototype.onDebugInit=function(){};
DebugGame.prototype.onDebugCreateObject=function(a,b,c){};DebugGame.prototype.onDebugRemoveObject=function(a){};DebugGame.prototype.onDebugKeyDown=function(a){};DebugGame.prototype.onDebugKeyUp=function(a){};
DebugGame.prototype.onDebugPointerPress=function(a){if(Application.sandbox.addObjectEnable&&Application.sandbox.objectToCreate){var b="[SANDBOX] [ADD OBJECT] ",c;for(c in Application.sandbox.objectToCreate)b+=c+":"+Application.sandbox.objectToCreate[c]+", ";Application.log(b.substring(0,b.length-2));this.onDebugCreateObject(a.data.global.x,a.data.global.y,Application.sandbox.objectToCreate)}};DebugGame.prototype.onDebugUpdate=function(a){};DebugGame.prototype.onDebugPointerRelease=function(a){};
DebugGame.prototype.onDebugPointerPressAndRelease=function(a){};DebugGame.prototype.onDebugPointerOver=function(a){};DebugGame.prototype.onDebugPointerMove=function(a){};DebugGame.prototype.onDebugGetSandboxConfig=function(){return[]};DebugGame.prototype.onDebugSandboxLoadConfig=function(){};function DebugObject(){this.onDebugInit()}DebugObject.prototype.free=function(){};DebugObject.prototype.onDebugInit=function(){};DebugObject.prototype.onDebugDelete=function(){};
DebugObject.prototype.onDebugUpdate=function(a){(a=Application.sandbox)&&a.objectSelected&&a.objectViewPropertiesRealTime&&a.objectSelected===this&&a.setObjectViewProperties(this)};DebugObject.prototype.onDebugPointerPress=function(a){};DebugObject.prototype.onDebugChangeProperties=function(a){Application.info("SANDBOX OBJECT PROPERTY :: Change ["+a.property+"] by ["+a.value+"]")};DebugObject.prototype.onDebugSelectObject=function(){Application.sandbox&&Application.sandbox.setObjectViewProperties(this)};
DebugObject.prototype.onDebugGetProperties=function(){return[]};function Circle(a,b,c){this.x="undefined"===typeof a?0:a;this.y="undefined"===typeof b?0:b;this.r="undefined"===typeof c?0:c}Circle.prototype.hitTest=function(a,b){return 0===this.r?!1:(this.x-a)*(this.x-a)+(this.y-b)*(this.y-b)<=this.r*this.r};Circle.prototype.isEmpty=function(){return 0===this.r};Circle.prototype.toString=function(){return"circle x:"+this.x+" y:"+this.y+" r:"+this.r};
function Path(a){this.m_sections=[];this.m_length=0;for(var b=a.point.length(),c=0;c<b;++c){for(var d=a.point[c].n,e=[],f=0;f<d;++f)e.push(new Vector2D(parseFloat(a.point[c]["x"+f]),parseFloat(a.point[c]["y"+f])));e.push(new Vector2D(parseFloat(a.point[(c+1)%b].x0),parseFloat(a.point[(c+1)%b].y0)));d=new PathSection(e,this.m_length);this.m_length+=d.length();this.m_sections.push(d)}}Path.prototype.free=function(){this.m_sections=null};
Path.prototype.update=function(a,b){this.m_sections[b.pathPosition.section].update(a,b);b.pathPosition.point?b.setPosition(b.pathPosition.point.x,b.pathPosition.point.y):(b.pathPosition.section<this.m_sections.length-1?b.pathPosition.section+=1:(b.pathPosition.section=0,b.pathPosition.distance=0),this.m_sections[b.pathPosition.section].update(a,b),b.pathPosition.point?b.setPosition(b.pathPosition.point.x,b.pathPosition.point.y):Application.info("ERROR"))};
Path.prototype.toString=function(){for(var a="Path:",b=this.m_sections.length,c=0;c<b;++c)a+="\n"+this.m_sections[c];return a};
function PathSection(a,b){this.m_order=a.length-1;this.m_points=a;this.m_initLength=b;this.m_length=0;this.m_oldPos=null;switch(this.m_order){case PathSection.CONIC:case PathSection.CUBIC:case PathSection.LINE:this.m_dir=new Vector2D(this.m_points[this.m_order].x-this.m_points[0].x,this.m_points[this.m_order].y-this.m_points[0].y);this.m_length=this.m_dir.length();this.m_angle=this.m_dir.angle();this.m_dir.normalize();break;default:Application.error("Invalid path section order: "+this.m_order)}}
PathSection.LINE=1;PathSection.CONIC=2;PathSection.CUBIC=3;PathSection.SECTIONS=3;PathSection.prototype.free=function(){this.m_points=null};PathSection.prototype.length=function(){return this.m_length};
PathSection.prototype.update=function(a,b){a=b.pathPosition.distance+a;if(a<=this.m_initLength+this.m_length){switch(this.m_order){case PathSection.LINE:b.pathPosition.point=this.m_dir.clone();b.pathPosition.point.scale(a-this.m_initLength);b.pathPosition.point.add(this.m_points[0]);b.pathPosition.tangent=this.m_angle;break;case PathSection.CONIC:b.pathPosition.point=new Vector2D;var c=(a-this.m_initLength)/this.m_length;b.pathPosition.point.x=(1-c)*(1-c)*this.m_points[0].x+2*(1-c)*c*this.m_points[1].x+
c*c*this.m_points[2].x;b.pathPosition.point.y=(1-c)*(1-c)*this.m_points[0].y+2*(1-c)*c*this.m_points[1].y+c*c*this.m_points[2].y;this.m_oldPos&&(this.m_oldPos.subtract(b.pathPosition.point),this.m_oldPos.scale(-1),b.pathPosition.tangent=this.m_oldPos.angle());this.m_oldPos=b.pathPosition.point;break;case PathSection.CUBIC:b.pathPosition.point=new Vector2D;c=(a-this.m_initLength)/this.m_length;b.pathPosition.point.x=(1-c)*(1-c)*(1-c)*this.m_points[0].x+3*(1-c)*(1-c)*c*this.m_points[1].x+3*(1-c)*c*
c*this.m_points[2].x+c*c*c*this.m_points[3].x;b.pathPosition.point.y=(1-c)*(1-c)*(1-c)*this.m_points[0].y+3*(1-c)*(1-c)*c*this.m_points[1].y+3*(1-c)*c*c*this.m_points[2].y+c*c*c*this.m_points[3].y;this.m_oldPos&&(this.m_oldPos.subtract(b.pathPosition.point),this.m_oldPos.scale(-1),b.pathPosition.tangent=this.m_oldPos.angle());this.m_oldPos=b.pathPosition.point;break;default:Application.error("Invalid path section order: "+this.m_order)}b.pathPosition.distance=a}else this.m_oldPos=b.pathPosition.point=
null};PathSection.prototype.toString=function(){for(var a="section:",b=0;b<this.m_points.length;++b)a+=this.m_points[b]+" ";return a};function SMath(){}SMath.radsFromAtoB=function(a,b,c,d){a=c-a;b=d-b;if(0===a)return 0>b?.5*-Math.PI:.5*Math.PI;for(b=Math.atan2(b,a);b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;return b};SMath.degrees=function(a,b){return Math.atan2(a,b)*SMath.RAD_TO_DEG};SMath.toRadians=function(a){return a*SMath.DEG_TO_RAD};SMath.toDegrees=function(a){return a*SMath.RAD_TO_DEG};
SMath.setRange=function(a,b,c){return a>c?c:a<b?b:a};SMath.abs=function(a){return 0>a?-a:a};SMath.sign=function(a){return 0<a?1:0===a?0:-1};SMath.fastSin=function(a){a%=6.28318531;-3.14159265>a?a+=6.28318531:3.14159265<a&&(a-=6.28318531);return 0>a?1.27323954*a+.405284735*a*a:1.27323954*a-.405284735*a*a};SMath.fastCos=function(a){a=a%6.28318531+1.57079632;-3.14159265>a?a+=6.28318531:3.14159265<a&&(a-=6.28318531);return 0>a?1.27323954*a+.405284735*a*a:1.27323954*a-.405284735*a*a};
SMath.polygonArea=function(a){var b=0,c=0;if(3>a.length)return 0;for(var d=0;d<a.length;d++){if(d!==a.length-1){var e=a[d];var f=a[d+1]}else e=a[d],f=a[0];b+=e.x*f.y;c+=e.y*f.x}return SMath.abs(.5*(b-c))};
SMath.polyContainsPoint=function(a,b,c){if(!b||3>b.length)return!1;for(var d=SMath.polygonArea(b),e=0,f=0;f<b.length;f++){var g=b[f];var h=f!==b.length-1?b[f+1]:b[0];e+=SMath.polygonArea([g,h,a])}if(d===e||1>=SMath.abs(d-e)){if(!c)for(f=0;f<b.length;f++)if(c=f!==b.length-1?[b[f],b[f+1]]:[b[f],b[0]],SMath.lineContainsPoint(a,c))return!1;return!0}return!1};
SMath.lineContainsPoint=function(a,b){if(!b||2>b.length)return!1;var c=(a.x-b[0].x)/(b[1].x-b[0].x);a=(a.y-b[0].y)/(b[1].y-b[0].y);return 0<=c&&1>=c&&0<=a&&1>=a};SMath.rectContainsRect=function(a,b){return b[2].x<=a[2].x&&b[0].x>=a[0].x&&b[2].y<=a[2].y&&b[0].y>=a[0].y};
SMath.lineIntersectLine=function(a,b){var c=(b[1].y-b[0].y)*(a[1].x-a[0].x)-(b[1].x-b[0].x)*(a[1].y-a[0].y);if(0==c)return!1;var d=a[0].y-b[0].y;var e=a[0].x-b[0].x;b=(b[1].x-b[0].x)*d-(b[1].y-b[0].y)*e;a=(a[1].x-a[0].x)*d-(a[1].y-a[0].y)*e;d=b/c;e=a/c;return 0<d&&1>d&&0<e&&1>e};SMath.polyContainsLine=function(a,b){for(var c,d=0;d<b.length;d++)if(c=d!==b.length-1?[b[d],b[d+1]]:[b[d],b[0]],SMath.lineIntersectLine(c,a))return!0;return!1};SMath.lerp=function(a,b,c,d){return d/1E3*c*(b-a)};
SMath.lerpColor=function(a,b,c){var d=parseInt(a.replace(/#/g,""),16);a=d>>16;var e=d>>8&255;d&=255;b=parseInt(b.replace(/#/g,""),16);return"#"+(16777216+(a+c*((b>>16)-a)<<16)+(e+c*((b>>8&255)-e)<<8)+(d+c*((b&255)-d))|0).toString(16).slice(1)};SMath.rotatePointAround=function(a,b,c){var d=SMath.fastCos(c);c=SMath.fastSin(c);var e=a.x-b.x;a=a.y-b.y;return new Vector2D(e*d-a*c+b.x,e*c+a*d+b.y)};SMath.RAD_TO_DEG=57.2957795;SMath.DEG_TO_RAD=.0174533;SMath._180_over_PI=57.2957795;
function ScrollHandler(){this.tweenScroll=null;this.maxIndex=this.index=0;this.duration=2E3;this.displaceY=this.displaceX=this.y=this.x=0;this.m_onStartCaller=this.m_onStart=this.m_onCompleteCaller=this.m_onComplete=this.m_onUpdateCaller=this.m_onUpdate=null}
ScrollHandler.prototype.goto=function(a){this.tweenScroll=(new Tween(this)).to({x:this.displaceX*a,y:this.displaceY*a},this.duration).easing(TweenEasing.BackOut).onUpdate(this.tweenUpdate).onComplete(this.tweenComplete);this.tweenScroll.start();this.index=a;this.m_onStart&&this.m_onStart.call(this.m_onStartCaller,this)};ScrollHandler.prototype.setIndex=function(a){this.index=a;this.x=this.index*this.displaceX;this.y=this.index*this.displaceY};
ScrollHandler.prototype.addStartListener=function(a,b){this.m_onStart=b;this.m_onStartCaller=a};ScrollHandler.prototype.addUpdateListener=function(a,b){this.m_onUpdate=b;this.m_onUpdateCaller=a};ScrollHandler.prototype.addCompleteListener=function(a,b){this.m_onComplete=b;this.m_onCompleteCaller=a};ScrollHandler.prototype.cancel=function(){this.tweenScroll&&(TweenManager.instance.remove(this.tweenScroll),this.tweenScroll=null)};
ScrollHandler.prototype.next=function(){this.tweenScroll||this.index>=this.maxIndex||this.goto(this.index+1)};ScrollHandler.prototype.lastNext=function(){this.tweenScroll||this.goto(this.maxIndex)};ScrollHandler.prototype.lastBack=function(){this.tweenScroll||this.goto(0)};ScrollHandler.prototype.back=function(){this.tweenScroll||0>=this.index||this.goto(this.index-1)};ScrollHandler.prototype.tweenUpdate=function(a){this.m_onUpdate&&this.m_onUpdate.call(this.m_onUpdateCaller,this)};
ScrollHandler.prototype.tweenComplete=function(a){this.m_onComplete&&this.m_onComplete.call(this.m_onCompleteCaller,this);this.tweenScroll=null};function SRandom(a){this.m_seed="undefined"===typeof a?0:a;0>=this.m_seed&&this.srand();this.m_initSeed=this.m_seed;Application.info("SEED: "+this.m_seed);this.random()}SRandom.prototype.reset=function(){this.m_seed=this.m_initSeed;this.random()};SRandom.prototype.random=function(){this.m_seed=16807*this.m_seed%2147483647;return this.m_seed/2147483647};
SRandom.prototype.srand=function(){this.m_seed=1+Math.floor(2147483646*Math.random())};SRandom.prototype.randomInt=function(a,b){return a+Math.floor(this.random()*(b-a+1))};SRandom.prototype.getArrayIndex=function(a,b){"undefined"===typeof b&&(b=-1);if(1<a){var c=this.randomInt(0,a-1);c==b&&(c=(c+1)%a);return c}return 1>a?-1:0};SRandom.prototype.shuffleArray=function(a){for(var b=a.length-1;0<b;){var c=Math.floor(this.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d;--b}};
function TweenManager(){this._tweens=[];TweenManager.instance=this}TweenManager.prototype.getAll=function(){return this._tweens};TweenManager.prototype.removeAll=function(){this._tweens=[]};TweenManager.prototype.add=function(a){this._tweens.push(a)};TweenManager.prototype.remove=function(a){a=this._tweens.indexOf(a);-1!==a&&this._tweens.splice(a,1)};
TweenManager.prototype.update=function(a){if(0===this._tweens.length)return!1;var b=0,c=this._tweens.length;for(a=void 0!==a?a:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();b<c;)this._tweens[b]&&this._tweens[b].update(a)?b++:(this._tweens[b].free(),this._tweens.splice(b,1),c--);return!0};function TweenEasing(){}TweenEasing.LinearNone=function(a){return a};TweenEasing.QuadraticIn=function(a){return a*a};
TweenEasing.QuadraticOut=function(a){return a*(2-a)};TweenEasing.QuadraticInOut=function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)};TweenEasing.CubicIn=function(a){return a*a*a};TweenEasing.CubicOut=function(a){return--a*a*a+1};TweenEasing.CubicInOut=function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)};TweenEasing.QuarticIn=function(a){return a*a*a*a};TweenEasing.QuarticOut=function(a){return 1- --a*a*a*a};TweenEasing.QuarticInOut=function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)};
TweenEasing.QuinticIn=function(a){return a*a*a*a*a};TweenEasing.QuinticOut=function(a){return--a*a*a*a*a+1};TweenEasing.QuinticInOut=function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)};TweenEasing.SinusoidalIn=function(a){return 1-Math.cos(a*Math.PI/2)};TweenEasing.SinusoidalOut=function(a){return Math.sin(a*Math.PI/2)};TweenEasing.SinusoidalInOut=function(a){return.5*(1-Math.cos(Math.PI*a))};TweenEasing.ExponentialIn=function(a){return 0===a?0:Math.pow(1024,a-1)};
TweenEasing.ExponentialOut=function(a){return 1===a?1:1-Math.pow(2,-10*a)};TweenEasing.ExponentialInOut=function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)};TweenEasing.CircularIn=function(a){return 1-Math.sqrt(1-a*a)};TweenEasing.CircularOut=function(a){return Math.sqrt(1- --a*a)};TweenEasing.CircularInOut=function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)};
TweenEasing.ElasticIn=function(a){var b=.1;if(0===a)return 0;if(1===a)return 1;if(!b||1>b){b=1;var c=.1}else c=.4*Math.asin(1/b)/(2*Math.PI);return-(b*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4))};TweenEasing.ElasticOut=function(a){var b=.1;if(0===a)return 0;if(1===a)return 1;if(!b||1>b){b=1;var c=.1}else c=.4*Math.asin(1/b)/(2*Math.PI);return b*Math.pow(2,-10*a)*Math.sin(2*(a-c)*Math.PI/.4)+1};
TweenEasing.ElasticInOut=function(a){var b=.1;if(0===a)return 0;if(1===a)return 1;if(!b||1>b){b=1;var c=.1}else c=.4*Math.asin(1/b)/(2*Math.PI);return 1>(a*=2)?-.5*b*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4):b*Math.pow(2,-10*--a)*Math.sin(2*(a-c)*Math.PI/.4)*.5+1};TweenEasing.BackIn=function(a){return a*a*(2.70158*a-1.70158)};TweenEasing.BackOut=function(a){return--a*a*(2.70158*a+1.70158)+1};
TweenEasing.BackInOut=function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)};TweenEasing.BounceIn=function(a){return 1-TweenEasing.BounceOut(1-a)};TweenEasing.BounceOut=function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375};TweenEasing.BounceInOut=function(a){return.5>a?.5*TweenEasing.BounceIn(2*a):.5*TweenEasing.BounceOut(2*a-1)+.5};
function TweenInterpolation(){}TweenInterpolation.Linear=function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TweenInterpolation.UtilsLinear;return 0>b?f(a[0],a[1],d):1<b?f(a[c],a[c-1],c-d):f(a[e],a[e+1>c?c:e+1],d-e)};TweenInterpolation.Bezier=function(a,b){var c=0,d=a.length-1,e=Math.pow,f=TweenInterpolation.UtilsBernstein,g;for(g=0;g<=d;g++)c+=e(1-b,d-g)*e(b,g)*a[g]*f(d,g);return c};
TweenInterpolation.CatmullRom=function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TweenInterpolation.UtilsCatmullRom;return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),f(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(f(a[0],a[0],a[1],a[1],-d)-a[0]):1<b?a[c]-(f(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):f(a[e?e-1:0],a[e],a[c<e+1?c:e+1],a[c<e+2?c:e+2],d-e)};TweenInterpolation.UtilsLinear=function(a,b,c){return(b-a)*c+a};
TweenInterpolation.UtilsBernstein=function(a,b){var c=TweenInterpolation.UtilsFactorial;return c(a)/c(b)/c(a-b)};TweenInterpolation.UtilsFactorial=function(a){for(var b=1,c=1;c<=a;c++)b*=c;return b};TweenInterpolation.UtilsCatmullRom=function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b};
function Tween(a){this._object=this.target=a;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1E3;this._repeat=0;this._reversed=this._yoyo=!1;this._delayTime=0;this._startTime=null;this._easingFunction=TweenEasing.LinearNone;this._interpolationFunction=TweenInterpolation.Linear;this._chainedTweens=[];this._onStartCallback=null;this._onStartCallbackFired=!1;this._onCompleteCallback=this._onUpdateCallback=null;for(var b in a)this._valuesStart[b]=parseFloat(a[b])}
Tween.prototype.free=function(){this._onCompleteCallback=this._onUpdateCallback=this._onStartCallback=this._chainedTweens=this._interpolationFunction=this._easingFunction=this._valuesStartRepeat=this._valuesEnd=this._valuesStart=this._object=this.target=null};Tween.prototype.to=function(a,b){void 0!==b&&(this._duration=b);this._valuesEnd=a;return this};
Tween.prototype.start=function(a){TweenManager.instance.add(this);this._onStartCallbackFired=!1;this._startTime=void 0!==a?a:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();this._startTime+=this._delayTime;for(var b in this._valuesEnd){if(this._valuesEnd[b]instanceof Array){if(0===this._valuesEnd[b].length)continue;this._valuesEnd[b]=[this._object[b]].concat(this._valuesEnd[b])}this._valuesStart[b]=this._object[b];!1===
this._valuesStart[b]instanceof Array&&(this._valuesStart[b]*=1);this._valuesStartRepeat[b]=this._valuesStart[b]||0}return this};Tween.prototype.stop=function(){TweenManager.instance.remove(this);return this};Tween.prototype.delay=function(a){this._delayTime=a;return this};Tween.prototype.repeat=function(a){this._repeat=a;return this};Tween.prototype.yoyo=function(a){this._yoyo=a;return this};Tween.prototype.easing=function(a){this._easingFunction=a;return this};
Tween.prototype.interpolation=function(a){this._interpolationFunction=a;return this};Tween.prototype.chain=function(){this._chainedTweens=arguments;return this};Tween.prototype.onStart=function(a){this._onStartCallback=a;return this};Tween.prototype.onUpdate=function(a){this._onUpdateCallback=a;return this};Tween.prototype.onComplete=function(a){this._onCompleteCallback=a;return this};
Tween.prototype.update=function(a){if(a<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object,this),this._onStartCallbackFired=!0);var b=(a-this._startTime)/this._duration;b=1<b?1:b;var c=this._easingFunction(b);for(f in this._valuesEnd){var d=this._valuesStart[f]||0,e=this._valuesEnd[f];e instanceof Array?this._object[f]=this._interpolationFunction(e,c):("string"===typeof e&&(e=d+parseFloat(e)),"number"===typeof e&&(this._object[f]=
d+(e-d)*c))}if(1==b){if(0<this._repeat){isFinite(this._repeat)&&this._repeat--;for(f in this._valuesStartRepeat)"string"===typeof this._valuesEnd[f]&&(this._valuesStartRepeat[f]+=parseFloat(this._valuesEnd[f])),this._yoyo&&(b=this._valuesStartRepeat[f],this._valuesStartRepeat[f]=this._valuesEnd[f],this._valuesEnd[f]=b,this._reversed=!this._reversed),this._valuesStart[f]=this._valuesStartRepeat[f];this._startTime=a+this._delayTime;return!0}null!==this._onCompleteCallback&&this._onCompleteCallback.call(this._object,
this);var f=0;for(b=this._chainedTweens.length;f<b;f++)this._chainedTweens[f].start(a);return!1}null!==this._onUpdateCallback&&null!==this._object&&this._onUpdateCallback.call(this._object,this);return!0};
function Tween2(a,b,c){this.loop=this.ignoreGlobalPause=!1;this.duration=0;this.pluginData=c||{};this.target=a;this.position=0;this._paused=this.passive=!1;this._curQueueProps={};this._initQueueProps={};this._steps=[];this._actions=[];this._stepPosition=this._prevPosition=0;this._prevPos=-1;this._target=a;this._registered=!1;this._onCompleteCallback=this._onChangeCallback=null;b&&(this.ignoreGlobalPause=b.ignoreGlobalPause,this.loop=b.loop,this._onChangeCallback=b.onChange,this._onCompleteCallback=
b.onComplete,b.override&&Tween2.removeTweens(a));b&&b.paused?this._paused=!0:Tween2._register(this,!0);b&&null!=b.position&&this.setPosition(b.position,Tween2.NONE)}Tween2.NONE=0;Tween2.LOOP=1;Tween2.REVERSE=2;Tween2.IGNORE={};Tween2._tweens=[];Tween2._plugins={};Tween2.get=function(a,b,c,d){d&&Tween2.removeTweens(a);return new Tween2(a,b,c)};Tween2.tick=function(a,b){for(var c=Tween2._tweens.slice(),d=0;d<c.length;d++){var e=c[d];b&&!e.ignoreGlobalPause||e._paused||e.tick(a)}};
Tween2.removeTweens=function(a){if(a.tweenjs_count){for(var b=Tween2._tweens,c=b.length-1;0<=c;c--){var d=b[c];d._target==a&&(d._paused=!0,b.splice(c,1))}a.tweenjs_count=0}};Tween2.removeAllTweens=function(){for(var a=Tween2._tweens,b=0,c=a.length;b<c;b++){var d=a[b];d._paused=!0;d.target&&(d.target.tweenjs_count=0)}a.length=0};Tween2.hasActiveTweens=function(a){return a?null!=a.tweenjs_count&&!!a.tweenjs_count:Tween2._tweens?Tween2._tweens&&!!Tween2._tweens.length:!1};
Tween2.installPlugin=function(a,b){var c=a.priority;null==c&&(a.priority=c=0);for(var d=0,e=b.length,f=Tween2._plugins;d<e;d++){var g=b[d];if(f[g]){for(var h=f[g],k=0,m=h.length;k<m&&!(c<h[k].priority);k++);f[g].splice(k,0,a)}else f[g]=[a]}};
Tween2._register=function(a,b){var c=a._target,d=Tween2._tweens;if(b&&!a._registered)c&&(c.tweenjs_count=c.tweenjs_count?c.tweenjs_count+1:1),d.push(a);else if(!b&&a._registered)for(c&&c.tweenjs_count--,c=d.length;c--;)if(d[c]==a){d.splice(c,1);break}a._registered=b};Tween2.prototype.wait=function(a,b){if(null==a||0>=a)return this;var c=this._cloneProps(this._curQueueProps);return this._addStep({d:a,p0:c,e:TweenEasing.LinearNone,p1:c,v:b})};
Tween2.prototype.to=function(a,b,c){if(isNaN(b)||0>b)b=0;return this._addStep({d:b||0,p0:this._cloneProps(this._curQueueProps),e:c,p1:this._cloneProps(this._appendQueueProps(a))})};Tween2.prototype.call=function(a,b,c){return this._addAction({f:a,p:b?b:[this],o:c?c:this._target})};Tween2.prototype.set=function(a,b){return this._addAction({f:this._set,o:this,p:[a,b?b:this._target]})};Tween2.prototype.play=function(a){a||(a=this);return this.call(a.setPaused,[!1],a)};
Tween2.prototype.pause=function(a){a||(a=this);return this.call(a.setPaused,[!0],a)};
Tween2.prototype.setPosition=function(a,b){0>a&&(a=0);null==b&&(b=1);var c=a,d=!1;c>=this.duration&&(this.loop?c%=this.duration:(c=this.duration,d=!0));if(c==this._prevPos)return d;var e=this._prevPos;this.position=this._prevPos=c;this._prevPosition=a;if(this._target)if(d)this._updateTargetProps(null,1);else if(0<this._steps.length){a=0;for(var f=this._steps.length;a<f&&!(this._steps[a].t>c);a++);a=this._steps[a-1];this._updateTargetProps(a,(this._stepPosition=c-a.t)/a.d)}0!=b&&0<this._actions.length&&
(1==b&&c<e?(e!=this.duration&&this._runActions(e,this.duration),this._runActions(0,c,!0)):this._runActions(e,c));this._onChangeCallback&&this._onChangeCallback(this);d&&(this.setPaused(!0),this._onCompleteCallback&&this._onCompleteCallback(this));return d};Tween2.prototype.tick=function(a){this._paused||this.setPosition(this._prevPosition+a)};Tween2.prototype.setPaused=function(a){if(this._paused===!!a)return this;this._paused=!!a;Tween2._register(this,!a);return this};Tween2.prototype.w=Tween2.prototype.wait;
Tween2.prototype.t=Tween2.prototype.to;Tween2.prototype.c=Tween2.prototype.call;Tween2.prototype.s=Tween2.prototype.set;Tween2.prototype.tostring=function(){return"[Tween2]"};Tween2.prototype.clone=function(){throw"Tween2 can not be cloned.";};
Tween2.prototype._updateTargetProps=function(a,b){var c,d;if(a||1!=b){if(this.passive=!!a.v)return;a.e&&(b=a.e(b,0,1,1));var e=a.p0;var f=a.p1}else this.passive=!1,e=f=this._curQueueProps;for(var g in this._initQueueProps){null==(c=e[g])&&(e[g]=c=this._initQueueProps[g]);null==(d=f[g])&&(f[g]=d=c);c=c==d||0==b||1==b||"number"!=typeof c?1==b?d:c:c+(d-c)*b;var h=!1;if(d=Tween2._plugins[g])for(var k=0,m=d.length;k<m;k++){var l=d[k].tween(this,g,c,e,f,b,!!a&&e==f,!a);l==Tween2.IGNORE?h=!0:c=l}h||(this._target[g]=
c)}};Tween2.prototype._runActions=function(a,b,c){var d=a,e=b,f=-1,g=this._actions.length,h=1;a>b&&(d=b,e=a,f=g,g=h=-1);for(;(f+=h)!=g;){b=this._actions[f];var k=b.t;(k==e||k>d&&k<e||c&&k==a)&&b.f.apply(b.o,b.p)}};
Tween2.prototype._appendQueueProps=function(a){var b,c,d;for(d in a)if(void 0===this._initQueueProps[d]){var e=this._target[d];if(b=Tween2._plugins[d]){var f=0;for(c=b.length;f<c;f++)e=b[f].init(this,d,e)}this._initQueueProps[d]=this._curQueueProps[d]=void 0===e?null:e}for(d in a){e=this._curQueueProps[d];if(b=Tween2._plugins[d]){var g=g||{};f=0;for(c=b.length;f<c;f++)b[f].step&&b[f].step(this,d,e,a[d],g)}this._curQueueProps[d]=a[d]}g&&this._appendQueueProps(g);return this._curQueueProps};
Tween2.prototype._cloneProps=function(a){var b={},c;for(c in a)b[c]=a[c];return b};Tween2.prototype._addStep=function(a){0<a.d&&(this._steps.push(a),a.t=this.duration,this.duration+=a.d);return this};Tween2.prototype._addAction=function(a){a.t=this.duration;this._actions.push(a);return this};Tween2.prototype._set=function(a,b){for(var c in a)b[c]=a[c]};
function Timeline(a,b,c){this.ignoreGlobalPause=!1;this.duration=0;this.loop=!1;this.position=0;this._paused=!1;this._tweens=[];this._labelList=this._labels=null;this._prevPosition=0;this._prevPos=-1;this._registered=!1;this._onCompleteCallback=this._onChangeCallback=null;c&&(this.loop=c.loop,this.ignoreGlobalPause=c.ignoreGlobalPause,this._onChangeCallback="undefined"!==typeof c.onChange?c.onChange:null,this._onCompleteCallback="undefined"!==typeof c.onEnd?c.onEnd:null);a&&this.addTween.apply(this,
a);this.setLabels(b);c&&c.paused?this._paused=!0:Tween2._register(this,!0);c&&null!=c.position&&this.setPosition(c.position,Tween2.NONE)}Timeline.prototype.addTween=function(a){var b=arguments.length;if(1<b){for(var c=0;c<b;c++)this.addTween(arguments[c]);return arguments[0]}if(0==b)return null;this.removeTween(a);this._tweens.push(a);a.setPaused(!0);a._paused=!1;a.duration>this.duration&&(this.duration=a.duration);0<=this._prevPos&&a.setPosition(this._prevPos,Tween2.NONE);return a};
Timeline.prototype.removeTween=function(a){var b=arguments.length;if(1<b){for(var c=!0,d=0;d<b;d++)c=c&&this.removeTween(arguments[d]);return c}if(0==b)return!1;b=this._tweens;for(d=b.length;d--;)if(b[d]==a)return b.splice(d,1),a.duration>=this.duration&&this.updateDuration(),!0;return!1};Timeline.prototype.addLabel=function(a,b){this._labels[a]=b;var c=this._labelList;if(c){for(var d=0,e=c.length;d<e&&!(b<c[d].position);d++);c.splice(d,0,{label:a,position:b})}};
Timeline.prototype.setLabels=function(a){this._labels=a?a:{}};Timeline.prototype.getLabels=function(){var a=this._labelList;if(!a){a=this._labelList=[];var b=this._labels,c;for(c in b)a.push({label:c,position:b[c]});a.sort(function(a,b){return a.position-b.position})}return a};Timeline.prototype.getCurrentLabel=function(){var a=this.getLabels(),b=this.position,c=a.length;if(c){for(var d=0;d<c&&!(b<a[d].position);d++);return 0==d?null:a[d-1].label}return null};
Timeline.prototype.gotoAndPlay=function(a){this.setPaused(!1);this._goto(a)};Timeline.prototype.gotoAndStop=function(a){this.setPaused(!0);this._goto(a)};
Timeline.prototype.setPosition=function(a,b){0>a&&(a=0);null==b&&(b=1);var c=a,d=!1;c>=this.duration&&(this.loop?c%=this.duration:(c=this.duration,d=!0));if(c==this._prevPos)return d;this._prevPosition=a;this.position=this._prevPos=c;a=0;for(var e=this._tweens.length;a<e;a++)if(this._tweens[a].setPosition(c,b),c!=this._prevPos)return!1;this._onChangeCallback&&this._onChangeCallback(this);d&&(this._onCompleteCallback&&this._onCompleteCallback(this),this.setPaused(!0));return d};
Timeline.prototype.setPaused=function(a){this._paused=!!a;Tween2._register(this,!a)};Timeline.prototype.updateDuration=function(){for(var a=this.duration=0,b=this._tweens.length;a<b;a++){var c=this._tweens[a];c.duration>this.duration&&(this.duration=c.duration)}};Timeline.prototype.tick=function(a){this.setPosition(this._prevPosition+a)};Timeline.prototype.resolve=function(a){var b=Number(a);isNaN(b)&&(b=this._labels[a]);return b};Timeline.prototype.tostring=function(){return"[Timeline]"};
Timeline.prototype.clone=function(){throw"Timeline can not be cloned.";};Timeline.prototype._goto=function(a){a=this.resolve(a);null!=a&&this.setPosition(a)};function Common(){}
Common.saveData=function(a,b){0<b.indexOf(";")&&Application.fatal("Saving invalid string with ';' character"+a);b.length>Common.COOKIE_MAX_LENGTH&&Application.error("Can't save string of size "+b.length);var c=new Date;c.setDate(c.getDate()+Common.COOKIE_EXPIRATION_DAYS);c="; expires="+c.toUTCString();document.cookie=a+"="+b+c+"; path=/"};Common.COOKIE_EXPIRATION_DAYS=540;Common.COOKIE_MAX_LENGTH=4090;
Common.loadData=function(a,b){a+="=";for(var c=document.cookie.split(";"),d=0;d<c.length;++d){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(a)){b=e.substring(a.length,e.length);break}}return b};
Common.rayCast=function(a,b,c,d,e,f,g,h){f="undefined"!==typeof f?f:a.tileWidth();g="undefined"!==typeof g?g:[];var k=0;h="undefined"!==typeof h&&h?1E8:(e-c)*(e-c)+(d-b)*(d-b);for(d=Math.atan2(e-c,d-b);k*k<h;){e=b+SMath.fastCos(d)*k;for(var m=c+SMath.fastSin(d)*k,l=a.getCellInPosition(e,m),n=0;n<g.length;n++)if(g[n]===l)return{distance:k,cell:l,angle:d,x:e,y:m};k+=f}return null};
Common.storageString=function(a,b){b="undefined"!==typeof b?b:"|";for(var c="",d=0;d<a.length;d++)c+=0!==d?b:"",c+=a[d];return c};Common.copyNumericArray=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b};Common.initArray=function(a,b){for(var c=[],d=0;d<b;d++)c.push(a);return c};Common.inArray=function(a,b){return-1!==b.indexOf(a)};Common.random=function(a,b){return Math.random()*(b-a)+a};Common.randomInt=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};
Common.mixer=function(a){a=a.slice(0);for(var b,c=0;c<a.length;c++)b=Math.round(Math.random()*(a.length-1-c))+c,a.splice(c,0,a[b]),a.splice(b+1,1);return a};Common.getRandomArrayIndex=function(a,b){if(1<a){for(var c=Common.randomInt(0,a-1);c==b;)c=(c+1)%a;return c}return 0};
Common.getRandomFromArray=function(a,b){var c=a.length;if(1<c){if("undefined"!==typeof b){for(var d=[],e=0;e<c;++e)a[e]!==b&&d.push(e);if(0<d.length)return a[d[Math.floor(d.length*Math.random())]]}return a[Math.floor(c*Math.random())]}return 1===c?a[0]:null};Common.randomAndSpliceFromArray=function(a){return a.splice(Common.randomInt(0,a.length-1),1)};Common.shuffleArray=function(a){for(var b,c,d=a.length-1;1<=d;--d)b=Math.floor(Math.random()*(d+1)),c=a[b],a[b]=a[d],a[d]=c};
Common.getParams=function(a){var b={};a=a.split(";");for(var c=0;c<a.length;c++)for(var d=a[c].split(":"),e=0;e<d.length;e++)b[String(d[0]).concat()]=d[1];return b};Common.lengthObject=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&++b;return b};Common.parseRect=function(a){a=a.split(";");return 4!==a.length?null:new Rectangle(parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10))};Common.trim=function(a){return String(a).replace(/^\s*(.*?)\s*$/g,"$1")};
Common.sumArray=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b};Common.parseNum=function(a){return 10>a?"0"+a:""+a};Common.circumferenceAngle=function(a,b){a=Math.atan2(b,a);a*=180/Math.PI;return 0>a?360+a:a};Common.tween=function(a,b,c,d,e,f){a=(new Tween(a)).to(b,c).easing("undefined"===typeof f?TweenEasing.BackOut:f).onUpdate(Common.tweenUpdate).onComplete(Common.tweenComplete).delay("undefined"===typeof e?0:e);Common.tweenUpdate(a,!0);d&&a.start();return a};
Common.getIdentifier=function(a){return"undefined"!==typeof a.data.identifier?a.data.identifier:a.data.originalEvent.which};
Common.tweenUpdate=function(a,b){try{var c=a.target.parent,d=a.target.clip;c&&a.target.onUpdate&&!b&&a.target.onUpdate.call(c,a.target);if(d)for(var e in a.target)switch(e){case "alpha":var f=1<a.target.alpha?1:a.target.alpha;f=0>a.target.alpha?0:f;d.alpha=f;break;case "sx":d.scale.x=a.target.sx;break;case "sy":d.scale.y=a.target.sy;break;case "scale":d.scale.x=a.target.scale;d.scale.y=a.target.scale;break;case "x":d.position.x=a.target.x;break;case "y":d.position.y=a.target.y;break;case "rotation":d.rotation=
a.target.rotation}}catch(g){Application.warn(" Tween onUpdate ::"+g)}};
Common.tweenComplete=function(a){try{var b=a.target.parent,c=a.target.clip;b&&a.target.onComplete&&(a.target.onComplete.call(b,a.target),a.target.parent=null,a.target.onComplete=null);if(c)for(var d in a._valuesEnd)switch(d){case "alpha":var e=1<a._valuesEnd.alpha?1:a._valuesEnd.alpha;e=0>a._valuesEnd.alpha?0:e;c.alpha=e;break;case "sx":c.scale.x=a._valuesEnd.sx;break;case "sy":c.scale.y=a._valuesEnd.sy;break;case "scale":c.scale.x=a._valuesEnd.scale;c.scale.y=a._valuesEnd.scale;break;case "x":c.position.x=
a._valuesEnd.x;break;case "y":c.position.y=a._valuesEnd.y;break;case "rotation":c.rotation=a._valuesEnd.rotation}}catch(f){Application.warn(" Tween onComplete ::"+f)}};Common.distance=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))};Common.distanceSquared=function(a,b,c,d){return(c-a)*(c-a)+(d-b)*(d-b)};Common.makeClockTime=function(a){var b={};a=Math.ceil(a/1E3);var c=Math.floor(a/60),d=Math.floor(a%60);b.total=a;b.minutes=c;b.seconds=d;return b};
Common.getDigitsByValue=function(a,b){a=String(a);b-=a.length;for(var c=0;c<b;c++)a="0"+a;return a.split("")};Common.getData=function(a,b,c){if(null==a)Application.error("Common:: data is null");else if("undefined"===typeof b)Application.error("Common:: dataName is undefined: "+b);else{if("undefined"!==typeof a[b])return a[b];Application.error("Property not found: "+b)}return"undefined"!==typeof c?c:null};Common.isValidNumber=function(a){return"number"!==typeof a||isNaN(a)||!isFinite(a)?!1:!0};
Common.sparseInt=function(a,b){a=parseInt(a,10);return isNaN(a)?b:a};Common.sparseFloat=function(a,b){a=parseFloat(a);return isNaN(a)?b:a};Common.ajaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(window.ActiveXObject)for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(c){}else if(window.XMLHttpRequest)return new window.XMLHttpRequest;return null};Common.randomRangeInt=function(a,b){return a-b+Math.floor(Math.random()*(2*b+1))};
Common.randomRangeFloat=function(a,b){return a-b+2*Math.random()*b};Common.trunc=function(a){return 0>a?Math.ceil(a):Math.floor(a)};Common.colorDecimalToHex=function(a){return a%1E3+(Common.trunc(a/1E3)%1E3<<8)+(Common.trunc(a/1E6)%1E3<<16)};Common.getR=function(a){return a>>16&255};Common.getG=function(a){return a>>8&255};Common.getB=function(a){return a&255};Common.getR_float=function(a){return Common.getR(a)/255};Common.getG_float=function(a){return Common.getG(a)/255};
Common.getB_float=function(a){return Common.getB(a)/255};Common.validateRandom=function(a,b){return a<b?Common.trunc(Common.randomInt(a,b)):a==b?a:Common.trunc(Common.randomInt(b,a))};Common.gradToRadian=function(a){return.017453292519943295*a};Common.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))};Common.createArraySize=function(a,b){if(Array.prototype.fill){var c=Array(a);c.fill(b);return c}c=[];for(var d=0;d<a;d++)c.push(b);return c};
Common.createArraySize=function(a,b){if(Array.prototype.fill){var c=Array(a);c.fill(b);return c}c=[];for(var d=0;d<a;d++)c.push(b);return c};Common.KEY_1=49;Common.KEY_2=50;Common.KEY_3=51;Common.KEY_4=52;Common.KEY_5=53;Common.KEY_6=54;Common.KEY_7=55;Common.KEY_8=56;Common.KEY_9=57;Common.KEY_0=48;Common.KEY_A=65;Common.KEY_B=66;Common.KEY_C=67;Common.KEY_D=68;Common.KEY_E=69;Common.KEY_F=70;Common.KEY_G=71;Common.KEY_H=72;Common.KEY_I=73;Common.KEY_J=74;Common.KEY_K=75;Common.KEY_L=76;
Common.KEY_M=77;Common.KEY_N=78;Common.KEY_O=79;Common.KEY_P=80;Common.KEY_Q=81;Common.KEY_R=82;Common.KEY_S=83;Common.KEY_T=84;Common.KEY_U=85;Common.KEY_V=86;Common.KEY_W=87;Common.KEY_X=88;Common.KEY_Z=90;Common.KEY_ESC=27;Common.KEY_SPACE=32;Common.KEY_ENTER=13;Common.KEY_LEFT=37;Common.KEY_RIGHT=39;Common.KEY_DOWN=40;Common.KEY_UP=38;Common.KEY_SHIFT=16;Common.KEY_PLUS=107;Common.KEY_MINUS=109;Common.COLOR_NONE="rgba(0, 0, 0, 0)";Common.COLOR_RED="#FF0000";Common.COLOR_GREEN="#00FF00";
Common.COLOR_BLUE="#0000FF";Common.COLOR_BLACK="#000000";Common.COLOR_WHITE="#FFFFFF";Common.COLOR_ORANGE="#FF9900";Common.COLOR_MAGENTA="#FF00FF";Common.COLOR_PURPLE="#990066";Common.COLOR_PINK="#FF66FF";Common.COLOR_BROWN="#663300";Common.COLOR_YELLOW="#FFFF00";Common.COLOR_GREY="#666666";Common.COLOR_DARK_BLUE="#000066";Common.IDENTIFIER_NONE=-1;function ContextGraphics(){}
ContextGraphics.drawLine=function(a,b,c,d,e,f,g){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.strokeStyle="undefined"===typeof f?Common.COLOR_BLACK:f,a.lineWidth="undefined"===typeof g?1:g,a.moveTo(b,c),a.lineTo(d,e),a.stroke(),a.closePath())};
ContextGraphics.drawRectangle=function(a,b,c,d,e,f,g,h){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.strokeStyle="undefined"===typeof g?Common.COLOR_BLUE:g,a.lineWidth="undefined"===typeof f?1:f,a.fillStyle="undefined"===typeof h?"rgba(0, 0, 0, 0)":h,a.fillRect(b,c,d,e),a.strokeRect(b,c,d,e))};
ContextGraphics.drawRect=function(a,b,c,d){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.strokeStyle="undefined"===typeof c?Common.COLOR_BLUE:c,a.fillStyle="undefined"===typeof d?"rgba(0, 0, 0, 0)":d,a.lineWidth=1,a.fillRect(b.x,b.y,b.w,b.h),a.strokeRect(b.x,b.y,b.w,b.h))};
ContextGraphics.drawCircle=function(a,b,c,d,e,f){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.lineWidth=1,a.strokeStyle="undefined"===typeof e?Common.COLOR_BLUE:e,a.arc(b,c,d,0,2*Math.PI,!0),a.stroke(),a.fillStyle="undefined"===typeof f?"rgba(0, 0, 0, 0)":f,a.fill(),a.closePath())};
ContextGraphics.drawArc=function(a,b,c,d,e,f,g,h){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.strokeStyle="undefined"===typeof g?Common.COLOR_BLUE:g,a.fillStyle="undefined"===typeof h?"rgba(0, 0, 0, 0)":h,a.lineWidth=1,a.arc(b,c,d,e,f,!0),a.closePath(),a.stroke(),a.fill())};
ContextGraphics.drawCross=function(a,b,c,d,e,f){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.strokeStyle="undefined"===typeof e?Common.COLOR_GREEN:e,a.lineWidth="undefined"===typeof f?1:f,a.moveTo(b-d,c-d),a.lineTo(b+d,c+d),a.moveTo(b-d,c+d),a.lineTo(b+d,c-d),a.stroke(),a.closePath())};
ContextGraphics.drawArrow=function(a,b,c,d,e,f,g,h){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.strokeStyle="undefined"===typeof f?Common.COLOR_YELLOW:f,a.lineWidth="undefined"===typeof h?1:h,"undefined"===typeof g&&(g=5),a.moveTo(b,c),a.lineTo(d,e),b=new SVector3(d-b,e-c),b.normalize(),a.lineTo(d-g*(b.x+b.y),e-g*(b.y-b.x)),a.moveTo(d,e),a.lineTo(d-g*(b.x-b.y),e-g*(b.y+b.x)),a.stroke(),a.closePath())};
ContextGraphics.drawPath=function(a,b,c,d){if(Application.RENDER_MODE===Application.RENDER_CANVAS){var e=b.length;if(!(3>e)){a.beginPath();a.moveTo(b[0][0],b[0][1]);for(var f=1;f<e-2;++f)a.quadraticCurveTo(b[f][0],b[f][1],(b[f][0]+b[f+1][0])/2,(b[f][1]+b[f+1][1])/2);a.quadraticCurveTo(b[f][0],b[f][1],b[f+1][0],b[f+1][1]);a.strokeStyle="undefined"===typeof c?Common.COLOR_RED:c;a.lineWidth="undefined"===typeof d?1:d;a.stroke();a.closePath()}}};
ContextGraphics.drawBezier=function(a,b,c,d){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.moveTo(b[0].x,b[0].y),a.quadraticCurveTo(b[1].x,b[1].y,b[2].x,b[2].y),a.strokeStyle="undefined"===typeof c?Common.COLOR_RED:c,a.lineWidth="undefined"===typeof d?1:d,a.stroke(),a.closePath())};
ContextGraphics.drawQuad=function(a,b,c,d,e,f,g){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.strokeStyle="undefined"===typeof f?Common.COLOR_BLUE:f,a.lineWidth="undefined"===typeof g?1:g,a.strokeRect(b,c,d,e))};
function TouchControl(){this.y=this.x=0;this.identifier=TouchControl.NONE;this.direction=this.angle=0;this.onReleaseHoldListener=this.onHoldListener=this.onSwipeListener=this.onDTapListener=this.onTapListener=this.callerObject=null;this.m_minDistance=40;this.m_minTime=600;this.m_timeReset=0;this.m_dTapWait=320;this.swipeY=this.swipeX=this.m_dTapTimer=0;this.hold=!1}TouchControl.NONE=-100;TouchControl.DIR_RIGHT=1;TouchControl.DIR_DOWN=2;TouchControl.DIR_LEFT=3;TouchControl.DIR_UP=4;
TouchControl.prototype.free=function(){this.onHoldListener=this.onSwipeListener=this.onTapListener=this.callerObject=null};TouchControl.prototype.onPointerPress=function(a){this.identifier===TouchControl.NONE&&(this.identifier=this.getIdentifier(a),this.x=a.data.global.x,this.y=a.data.global.y,this.m_timeReset=this.m_minTime)};
TouchControl.prototype.onPointerRelease=function(a){this.identifier===this.getIdentifier(a)&&(this.angle=0,this.identifier=TouchControl.NONE,this.hold?this.callerObject&&this.onReleaseHoldListener&&this.onReleaseHoldListener.call(this.callerObject,this):(0<this.m_dTapTimer?(this.m_dTapTimer=0,this.callerObject&&this.onDTapListener&&this.onDTapListener.call(this.callerObject,this)):this.m_dTapTimer=this.m_dTapWait,this.callerObject&&this.onTapListener&&this.onTapListener.call(this.callerObject,this)),
this.hold=!1)};
TouchControl.prototype.onPointerMove=function(a){if(this.identifier===this.getIdentifier(a)){var b=Math.sqrt((a.data.global.x-this.x)*(a.data.global.x-this.x)+(a.data.global.y-this.y)*(a.data.global.y-this.y));this.angle=Math.atan2(a.data.global.y-this.y,a.data.global.x-this.x);this.angle=180*this.angle/Math.PI;0<this.m_timeReset&&b>this.m_minDistance&&(this.swipeX=a.data.global.x,this.swipeY=a.data.global.y,0<this.angle&&45>=this.angle?this.direction=TouchControl.DIR_RIGHT:45<this.angle&&135>=this.angle?
this.direction=TouchControl.DIR_DOWN:135<this.angle&&180>=this.angle?this.direction=TouchControl.DIR_LEFT:-180<this.angle&&-135>=this.angle?this.direction=TouchControl.DIR_LEFT:-135<this.angle&&-45>=this.angle?this.direction=TouchControl.DIR_UP:-45<this.angle&&0>=this.angle&&(this.direction=TouchControl.DIR_RIGHT),this.identifier=TouchControl.NONE,this.callerObject&&this.onSwipeListener&&this.onSwipeListener.call(this.callerObject,this))}};
TouchControl.prototype.update=function(a){0<this.m_dTapTimer&&(this.m_dTapTimer-=a);this.identifier!==TouchControl.NONE&&(this.m_timeReset-=a,0>=this.m_timeReset&&(this.identifier=TouchControl.NONE,!this.hold&&this.callerObject&&this.onHoldListener&&this.onHoldListener.call(this.callerObject,this),this.hold=!0))};TouchControl.prototype.reset=function(){this.identifier=TouchControl.NONE};
TouchControl.prototype.getIdentifier=function(a){return"undefined"!==typeof a.data.identifier?a.data.identifier:a.data.originalEvent.which};function TintInterval(a,b,c,d){this.m_timeFrecuency=0;this.m_timeFrecuencyElapse=c;this.m_timeDuration=b;this.m_indexColor=this.m_timeElapse=0;this.m_clip=a;this.m_colors="undefined"===typeof d?null:d;this.m_start=!1;this.target=null}
TintInterval.prototype.start=function(a,b){a="undefined"===typeof a?0:a;b="undefined"===typeof b?0:b;0!=a&&(this.m_timeDuration=a);0!=b&&(this.m_timeFrecuency=b);this.m_start=!0;this.m_timeFrecuencyElapse=this.m_timeElapse=0;this.change()};TintInterval.prototype.stop=function(){if(this.m_start){if(this.onFinish&&this.target)this.target[this.onFinish]();this.m_start=!1;this.m_indexColor=0;this.change()}};TintInterval.prototype.setColors=function(a){this.m_colors=a};
TintInterval.prototype.setClip=function(a){this.m_clip=a};TintInterval.prototype.update=function(a){if(this.m_start&&(this.m_timeElapse+=a,this.m_timeFrecuencyElapse+=a,this.m_timeFrecuencyElapse>=this.m_timeFrecuency&&(this.change(),this.m_timeFrecuencyElapse=0),this.m_timeElapse>=this.m_timeDuration&&(this.m_start=!1,this.m_indexColor=0,this.change(),this.onFinish&&this.target)))this.target[this.onFinish]()};
TintInterval.prototype.change=function(){this.m_indexColor++;this.m_indexColor>=this.m_colors.length&&(this.m_indexColor=0)};TintInterval.prototype.free=function(){this.target=this.m_colors=this.m_clip=this.onFinish=null};
function SInterval(a,b,c,d,e,f,g){"undefined"===typeof d&&(d=1);"undefined"===typeof f&&(f=!1);this.m_timeElapsed=0;this.m_timeToTrigger=c;this.m_initLoops=this.m_loop=d;this.m_stopped=f;this.m_isOver=!1;this.m_caller=a;this.m_params=e;this.m_onEndCallback=b;this.m_onLoopCallback=g}SInterval.prototype.reset=function(a){a="undefined"===typeof a?-1:a;0<a&&(this.m_timeToTrigger=a);this.m_timeElapsed=0;this.m_loop=this.m_initLoops;this.m_stopped=this.m_isOver=!1};
SInterval.prototype.stop=function(){this.m_stopped=!0};SInterval.prototype.resume=function(){this.m_stopped=!1};
SInterval.prototype.update=function(a){if(!this.m_stopped&&!this.m_isOver&&(this.m_timeElapsed+=a,this.m_timeElapsed>=this.m_timeToTrigger))if(this.m_timeElapsed=0,--this.m_loop,0>=this.m_loop){if(this.m_isOver=!0,this.m_onEndCallback)if(this.m_params)this.m_caller[this.m_onEndCallback](this.m_params);else this.m_caller[this.m_onEndCallback]()}else if(this.m_onLoopCallback)if(this.m_params)this.m_caller[this.m_onLoopCallback](this.m_params);else this.m_caller[this.m_onLoopCallback]()};
SInterval.prototype.free=function(){this.m_caller=null};function SPoint(a,b){this.x="undefined"===typeof a?0:a;this.y="undefined"===typeof b?0:b}SPoint.prototype.distanceTo=function(a,b){return Math.sqrt((a-this.x)*(a-this.x)+(b-this.y)*(b-this.y))};function SVector3(a,b,c){this.x="undefined"===typeof a?0:a;this.y="undefined"===typeof b?0:b;this.z="undefined"===typeof c?0:c}SVector3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};
SVector3.prototype.normalize=function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;0<a&&(a=Math.sqrt(a),this.x/=a,this.y/=a,this.z/=a);return this};SVector3.prototype.product=function(a){return new SVector3(this.y*a.z-this.z*a.y,-(this.x*a.z-this.z*a.x),this.y*a.x-this.x*a.y)};
function Movement(a,b,c,d,e){this.m_targetY=this.m_targetX=this.m_oldState=0;this.m_x=a;this.m_y=b;this.m_speed=0;this.m_typeMovement=Movement.TYPE_DEFAULT;this.m_isLoop="undefined"===typeof d?!1:d;this.m_isReversible="undefined"===typeof e?!1:e;this.m_isAwaitingDelete=!1;this.m_cycleCallback=this.m_endCallback=this.m_callerActor=null;this.setSpeed(c);this.extraData=null;this.m_state=Movement.ST_INIT}Movement.prototype.free=function(){this.m_callerActor=this.m_cycleCallback=this.m_endCallback=null};
Movement.TYPE_DEFAULT=0;Movement.TYPE_CIRCLE=1;Movement.TYPE_LINEAR=2;Movement.MIN_SPEED=1E-5;Movement.DEFAULT_SPEED=1;Movement.ST_INDEF=-1;Movement.ST_INIT=0;Movement.ST_MOVEMENT=1;Movement.ST_PAUSED=2;Movement.ST_END=3;Movement.prototype.getX=function(){return this.m_x};Movement.prototype.getY=function(){return this.m_y};Movement.prototype.getSpeed=function(){return this.m_speed};
Movement.prototype.setSpeed=function(a){a>Movement.MIN_SPEED?this.m_speed=a:(Application.error("setSpeed: "+a),this.m_speed=Movement.DEFAULT_SPEED)};Movement.prototype.type=function(){return this.m_typeMovement};Movement.prototype.targetX=function(){return this.m_targetX};Movement.prototype.targetY=function(){return this.m_targetY};Movement.prototype.isAwaitingDelete=function(){return this.m_isAwaitingDelete};
Movement.prototype.setAwaitingToDelete=function(a){if(this.m_isAwaitingDelete=a)this.m_state=Movement.ST_INDEF};Movement.prototype.isPaused=function(){return this.m_state==Movement.ST_PAUSED};Movement.prototype.setPause=function(a){a?this.m_state===Movement.ST_MOVEMENT&&(this.m_oldState=this.m_state,this.m_state=Movement.ST_PAUSED):this.m_state=this.m_oldState};Movement.prototype.setCallbacks=function(a,b,c){this.m_callerActor=a;this.m_endCallback=b;this.m_cycleCallback=c};
Movement.prototype.resetPosition=function(a,b){return this.m_state!==Movement.ST_MOVEMENT&&this.m_state!==Movement.ST_PAUSED?(this.m_x=a,this.m_y=b,!0):!1};Movement.prototype.cancelMotion=function(){this.m_state=Movement.ST_END};Movement.prototype.onEndMovement=function(){this.m_state=Movement.ST_END;this.m_callerActor&&this.m_endCallback&&this.m_endCallback.call(this.m_callerActor,this)};
Movement.prototype.onCycleEnd=function(){this.m_callerActor&&this.m_cycleCallback&&this.m_cycleCallback.call(this.m_callerActor,this)};Movement.prototype.update=function(a){};function LinearMovement(a,b,c,d,e){Movement.call(this,a,b,c,d,e);this.m_vy=this.m_vx=this.m_angle=0;this.m_toFront=!0;this.m_initX=this.m_x;this.m_initY=this.m_y;this.m_endPointY=this.m_endPointX=0;this.m_motionLimit=new Rectangle;this.m_typeMovement=Movement.TYPE_LINEAR}Application.subclass(LinearMovement,Movement);
LinearMovement.prototype.free=function(){this.m_motionLimit=null;Movement.prototype.free.call(this)};LinearMovement.prototype.getAngle=function(){return this.m_angle};LinearMovement.prototype.getLinearVelocityX=function(){return this.m_vx};LinearMovement.prototype.getLinearVelocityY=function(){return this.m_vy};LinearMovement.prototype.resetPosition=function(a,b){return Movement.prototype.resetPosition.call(this,a,b)?(this.m_initX=a,this.m_initY=b,!0):!1};
LinearMovement.prototype.settingMotionLimit=function(a,b,c,d){this.m_motionLimit.x=0<=c?a:a+c;this.m_motionLimit.y=0<=d?b:b+d;this.m_motionLimit.w=0<=c?c:-c;this.m_motionLimit.h=0<=d?d:-d};
LinearMovement.prototype.gotoPosition=function(a,b,c){c="undefined"!==typeof c?c:0;this.m_endPointX=this.m_targetX=a;this.m_endPointY=this.m_targetY=b;a-=this.m_x;b-=this.m_y;if(0===a&&0===b)this.onEndMovement();else this.settingMotionLimit(this.m_x,this.m_y,a,b),0<c&&(this.m_speed=c),c=Math.sqrt(a*a+b*b),this.m_vx=a/c*this.m_speed,this.m_vy=b/c*this.m_speed,this.m_angle=Math.atan2(b,a),this.m_state=Movement.ST_MOVEMENT};
LinearMovement.prototype.gotoRadialPoint=function(a,b,c){c="undefined"!==typeof c?c:0;0>a&&(Application.error("LinearMovement::gotoRadialPoint() - distance: "+a),a*=-1);if(0===a)this.onEndMovement();else{this.m_angle=b;b=a*Math.cos(this.m_angle);var d=a*Math.sin(this.m_angle);this.settingMotionLimit(this.m_x,this.m_y,b,d);0<c&&(this.m_speed=c);this.m_vx=b/a*this.m_speed;this.m_vy=d/a*this.m_speed;this.m_endPointX=this.m_targetX=this.m_x+b;this.m_endPointY=this.m_targetY=this.m_y+d;this.m_state=Movement.ST_MOVEMENT}};
LinearMovement.prototype.simulateUpdate=function(a){var b=null;this.m_state===Movement.ST_MOVEMENT&&(b=new Vector2D(this.m_vx*a,this.m_vy*a));return b};LinearMovement.prototype.reverse=function(){this.m_toFront?(this.m_endPointX=this.m_initX,this.m_endPointY=this.m_initY):(this.m_endPointX=this.m_targetX,this.m_endPointY=this.m_targetY);this.m_toFront=!this.m_toFront;this.m_vx*=-1;this.m_vy*=-1};
LinearMovement.prototype.update=function(a){if(this.m_state===Movement.ST_MOVEMENT&&(this.m_x+=this.m_vx*a,this.m_y+=this.m_vy*a,this.m_x<this.m_motionLimit.left()||this.m_x>this.m_motionLimit.right()||this.m_y<this.m_motionLimit.top()||this.m_y>this.m_motionLimit.bottom()))if(this.m_x=this.m_endPointX,this.m_y=this.m_endPointY,this.m_isLoop)this.m_isReversible?this.reverse():(this.m_x=this.m_initX,this.m_y=this.m_initY),this.onCycleEnd();else this.onEndMovement()};
function CircularMovement(a,b,c,d,e){Movement.call(this,a,b,c,"undefined"===typeof d?!1:d,"undefined"===typeof e?!1:e);this.m_currentRadiansDisplaced=this.m_radiansToDisplace=this.m_initRandians=0;this.m_factorDirection=1;this.m_angularSpeed=this.m_radio=this.m_centroidY=this.m_centroidX=0;this.m_typeMovement=Movement.TYPE_CIRCLE;this.m_oldX=this.m_x;this.m_oldY=this.m_y}Application.subclass(CircularMovement,Movement);
CircularMovement.prototype.startMovement=function(a,b,c){this.m_centroidX=a;this.m_centroidY=b;a=this.m_x-this.m_centroidX;b=-this.m_y+this.m_centroidY;this.m_radio=Math.sqrt(a*a+b*b);if(1>=this.m_radio)Application.error("CircularMovement::startMovement() - Radio very small: "+this.m_radio),this.onEndMovement();else if(this.m_factorDirection=0>c?-1:1,0==c)this.onEndMovement();else 0>c&&(c*=-1),this.m_initRandians=Math.atan2(b,a),this.m_radiansToDisplace=c/180*Math.PI,this.m_currentRadiansDisplaced=
0,this.m_angularSpeed=this.m_radiansToDisplace/(c/360*Math.PI*this.m_radio*2/this.m_speed),c=this.m_initRandians+this.m_radiansToDisplace*this.m_factorDirection,this.m_targetX=this.m_centroidX+this.m_radio*Math.cos(c),this.m_targetY=this.m_centroidY-this.m_radio*Math.sin(c),this.m_state=Movement.ST_MOVEMENT};
CircularMovement.prototype.startMovement2=function(a,b,c){this.m_radio=a;if(1>=this.m_radio)Application.error("CircularMovement::startMovement2() - Radio very small: "+this.m_radio),this.onEndMovement();else if(this.m_factorDirection=0>c?-1:1,0==c)this.onEndMovement();else 0>c&&(c*=-1),this.m_radiansToDisplace=c/180*Math.PI,this.m_angularSpeed=this.m_radiansToDisplace/(c/360*Math.PI*this.m_radio*2/this.m_speed),this.m_initRandians=b/180*Math.PI,this.m_currentRadiansDisplaced=0,this.m_centroidX=this.m_x-
this.m_radio*Math.cos(this.m_initRandians),this.m_centroidY=this.m_y+this.m_radio*Math.sin(this.m_initRandians),a=this.m_initRandians+this.m_radiansToDisplace*this.m_factorDirection,this.m_targetX=this.m_centroidX+this.m_radio*Math.cos(a),this.m_targetY=this.m_centroidY-this.m_radio*Math.sin(a),this.m_state=Movement.ST_MOVEMENT};
CircularMovement.prototype.update=function(a){if(this.m_state==Movement.ST_MOVEMENT&&(this.m_currentRadiansDisplaced+=this.m_angularSpeed*a,this.m_currentRadiansDisplaced>this.m_radiansToDisplace&&(this.m_currentRadiansDisplaced=this.m_radiansToDisplace),a=this.m_initRandians+this.m_currentRadiansDisplaced*this.m_factorDirection,this.m_x=this.m_centroidX+this.m_radio*Math.cos(a),this.m_y=this.m_centroidY-this.m_radio*Math.sin(a),this.m_currentRadiansDisplaced==this.m_radiansToDisplace))if(this.m_isLoop)this.m_currentRadiansDisplaced=
0,this.m_isReversible&&(this.m_factorDirection*=-1,this.m_initRandians=a),this.onCycleEnd();else this.onEndMovement()};function MotionController(a,b,c){this.m_currentMovement=null;this.m_currentIndexMovement=0;this.m_advanceFactor=1;this.m_x=a;this.m_y=b;this.m_speed=c.speed;this.m_motionData=c;this.m_isLoop=this.m_motionData.isLoop;this.m_isReversible=this.m_motionData.isReverse;this.m_isStarted=!1;this.m_movements=[]}
MotionController.prototype.free=function(){this.m_motionData.free();this.m_currentMovement=this.m_motionData=null;for(var a=this.m_movements.length-1;0<=a;)this.m_movements[a].free(),this.m_movements[a]=null,--a;this.m_movements=null};MotionController.prototype.isStarted=function(){return this.m_isStarted};MotionController.prototype.startMotion=function(){this.m_isStarted||(this.m_isStarted=!0,this.createMovements(),this.m_currentIndexMovement=-1,this.gotoNextMovement())};
MotionController.CIRCLE_POLAR="cp";MotionController.CIRCLE_CARTESIAN="cc";MotionController.LINEAR_POLAR="lp";MotionController.LINEAR_CARTESIAN="lc";MotionController.RELATIVE_LINEAR_CARTESIAN="rlc";MotionController.prototype.getX=function(){return this.m_x};MotionController.prototype.getY=function(){return this.m_y};
MotionController.prototype.createMovements=function(){var a=null;for(var b=this.m_x,c=this.m_y,d,e=0;e<this.m_motionData.motionParams.length;)d=this.m_motionData.motionParams[e],d[0]==MotionController.CIRCLE_POLAR?(a=new CircularMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.startMovement2(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]))):d[0]==MotionController.CIRCLE_CARTESIAN?(a=new CircularMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.startMovement(parseFloat(d[1]),
parseFloat(d[2]),parseFloat(d[3]))):d[0]==MotionController.LINEAR_POLAR?(a=new LinearMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.gotoRadialPoint(parseFloat(d[1]),parseFloat(d[2]))):d[0]==MotionController.LINEAR_CARTESIAN?(a=new LinearMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.gotoPosition(parseFloat(d[1]),parseFloat(d[2]))):d[0]==MotionController.RELATIVE_LINEAR_CARTESIAN&&(a=new LinearMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.gotoPosition(parseFloat(d[1])+
b,parseFloat(d[2])+c)),a&&(this.m_movements.push(a),a.setPause(!0),a.setCallbacks(this,this.onEndMovement,this.onCycleMovement),b=a.targetX(),c=a.targetY()),++e};
MotionController.prototype.gotoNextMovement=function(){this.m_currentIndexMovement+=this.m_advanceFactor;0<=this.m_currentIndexMovement&&this.m_currentIndexMovement<this.m_movements.length?(this.m_currentMovement=this.m_movements[this.m_currentIndexMovement],this.m_currentMovement.setPause(!1)):this.m_isLoop&&(this.m_isReversible?this.m_advanceFactor*=-1:this.m_currentIndexMovement=-1,this.gotoNextMovement())};MotionController.prototype.movements=function(){return this.m_movements};
MotionController.prototype.update=function(a){this.m_currentMovement&&(this.m_currentMovement.update(a),this.m_x=this.m_currentMovement.getX(),this.m_y=this.m_currentMovement.getY())};MotionController.prototype.onEndMovement=function(a){};MotionController.prototype.onCycleMovement=function(a){this.m_currentMovement!=a?Application.error("MotionController::onCycleMovement()"):(a.setPause(!0),this.gotoNextMovement())};
function PendularMovement(a,b,c,d,e,f,g){this.m_alpha=this.m_angle=0;this.m_x=c;this.m_y=d;this.m_dy=this.m_dx=this.m_len=0;this.m_gravity=f;this.m_time=this.m_w=0;this.m_pivotX=a;this.m_pivotY=b;this.m_longitudeMax=g;this.m_beta=e;this.m_velocity=0;this.init()}PendularMovement.prototype.getX=function(){return this.m_x};PendularMovement.prototype.getY=function(){return this.m_y};PendularMovement.prototype.getAngle=function(){return this.m_angle};PendularMovement.prototype.getVelocity=function(){return this.m_velocity};
PendularMovement.prototype.getMaxLongitude=function(){return this.m_longitudeMax};
PendularMovement.prototype.init=function(){this.m_dx=this.m_x-this.m_pivotX;this.m_dy=this.m_y-this.m_pivotY;this.m_len=Math.sqrt(this.m_dx*this.m_dx+this.m_dy*this.m_dy);this.m_len<PendularMovement.LONGITUDE_MIN&&(this.m_len=PendularMovement.LONGITUDE_MIN);this.m_angle=Math.atan2(this.m_dx,this.m_dy);this.m_alpha=this.m_beta;this.m_w=2*Math.PI/this.period();this.m_time=Math.acos(this.m_angle/this.m_alpha)/this.m_w*180/Math.PI};
PendularMovement.prototype.update=function(a){this.m_len+=PendularMovement.INCREMENT_LONGITUDE;this.m_len>this.m_longitudeMax&&(this.m_len=this.m_longitudeMax);this.m_w=2*Math.PI/this.period();this.m_angle=this.m_alpha*Math.cos(this.m_w*this.m_time*Math.PI/180);this.m_velocity=-this.m_w*this.m_alpha*Math.sin(this.m_w*this.m_time*Math.PI/180);this.m_x=this.m_len*Math.sin(this.m_angle)+this.m_pivotX;this.m_y=this.m_len*Math.cos(this.m_angle)+this.m_pivotY;this.m_time+=PendularMovement.DT};
PendularMovement.prototype.fastPow=function(a,b){return 0==b?1:0==b%2?(a=this.fastPow(a,.5*b),a*a):a*this.fastPow(a,b-1)};PendularMovement.prototype.factorial=function(a){for(var b=1,c=1;c<=a;)b*=c,c++;return b};PendularMovement.prototype.period=function(){for(var a=0,b=0;b<=PendularMovement.N;)a+=this.fastPow(this.factorial(2*b)/this.fastPow(this.fastPow(2,b)*this.factorial(b),2),2)*this.fastPow(Math.sin(this.m_alpha/2),2*b),b++;return 2*Math.PI*Math.sqrt(this.m_len/this.m_gravity)*a};
PendularMovement.DT=4;PendularMovement.N=30;PendularMovement.LONGITUDE_MIN=50;PendularMovement.INCREMENT_LONGITUDE=.9;
function ParametricParabolicMovement(a,b,c,d,e,f){e="undefined"===typeof e?ParametricParabolicMovement.STD_GRAVITY:e;f="undefined"===typeof f?ParametricParabolicMovement.STD_SPEED:f;this.m_initX=a;this.m_initY=b;this.m_finalX=c;this.m_finalY=d;this.m_gravity=e;this.m_currentTime=0;this.m_finish=!1;this.m_endCallback=null;this.m_finalTime=ParametricParabolicMovement.STD_FINAL_TIME;this.m_dx=this.m_finalX-this.m_initX;this.m_dy=this.m_finalY-this.m_initY;this.m_speed=f;this.m_vx=this.m_dx/this.m_finalTime;
this.m_vy=(this.m_dy-this.m_gravity*this.m_finalTime*this.m_finalTime/2)/this.m_finalTime;this.m_rx=this.m_initX;this.m_ry=this.m_initY;this.target=null}ParametricParabolicMovement.STD_GRAVITY=.05;ParametricParabolicMovement.STD_SPEED=.3;ParametricParabolicMovement.STD_FINAL_TIME=100;ParametricParabolicMovement.prototype.free=function(){this.target=this.m_endCallback=null};ParametricParabolicMovement.prototype.getX=function(){return this.m_rx};ParametricParabolicMovement.prototype.getY=function(){return this.m_ry};
ParametricParabolicMovement.prototype.vX=function(){return this.m_vx};ParametricParabolicMovement.prototype.setEndCallback=function(a){this.m_endCallback=a};ParametricParabolicMovement.prototype.getEndCallback=function(){return this.m_endCallback};
ParametricParabolicMovement.prototype.update=function(a){this.m_finish||(this.m_rx=Math.floor(this.m_initX+this.m_currentTime*this.m_vx),this.m_ry=Math.floor(this.m_initY+this.m_currentTime*this.m_vy+this.m_gravity*this.m_currentTime*this.m_currentTime/2));if(this.m_currentTime>=this.m_finalTime){if(this.m_currentTime=this.m_finalTime,this.m_finish=!0,this.m_rx=this.m_finalX,this.m_ry=this.m_finalY,this.m_endCallback)this.target[this.m_endCallback](this)}else this.m_currentTime+=this.m_speed*a*2};
function GeometricUtils(){}GeometricUtils.intersectLines=function(a,b,c,d){var e=b.minus(a),f=b.minus(c),g=b.minus(d);f=e.product(f);e=e.product(g);if(0==f||0==e||0<f*e)return null;g=Math.abs(GeometricUtils.triarea(a,b,c));f=Math.abs(GeometricUtils.triarea(a,b,d));e=(c.x*f+d.x*g)/(g+f);c=(c.y*f+d.y*g)/(g+f);return 0>(a.x-e)*(e-b.x)||0>(a.y-c)*(c-b.y)?null:new Vector2D(e,c)};
GeometricUtils.intersectLinePolygon=function(a,b,c){for(var d=[],e=0;e<c.length;e++){var f=GeometricUtils.intersectLines(a,b,c[e],c[(e+1)%c.length]);f&&d.push(f)}return d};GeometricUtils.intersectLinePolygon2=function(a,b,c){for(var d=[],e=[],f=0;f<c.length;f++){var g=GeometricUtils.intersectLines(a,b,c[f],c[(f+1)%c.length]);g&&(d.push(g),e.push(f))}return{points:d,index:e}};GeometricUtils.trap=function(a,b){return.5*(b.x-a.x)*(b.y+a.y)};
GeometricUtils.triarea=function(a,b,c){return GeometricUtils.trap(a,b)+GeometricUtils.trap(b,c)+GeometricUtils.trap(c,a)};function PathFinding(){this.m_listOpen=[];this.m_listClose=[];this.m_mapOpen=[]}PathFinding.ALLOW_DIAGONAL=!0;PathFinding.ALLOW_DIAGONAL_CORNERING=!1;PathFinding.getPath=function(a,b,c,d,e,f){return(new PathFinding).getPathPrivate(a,b,c,d,e,f)};
PathFinding.prototype.getPathPrivate=function(a,b,c,d,e,f){b=Math.floor(b);c=Math.floor(c);var g=this.getSelectOpen(b,c);this.addOpenList(g);for(var h=a[0].length,k=a.length,m,l,n,p,q,r,t,u;0<this.m_listOpen.length&&!this.isInCloseListById(d,e);){n=g.i-1;q=g.i+2;r=g.j-1;for(t=g.j+2;n<q;n++)for(p=r;p<t;p++)n<k&&-1<n&&p<h&&-1<p&&!this.isInCloseListById(n,p)&&(PathFinding.ALLOW_DIAGONAL||n===g.i||p===g.j)&&(PathFinding.ALLOW_DIAGONAL_CORNERING||n===g.i||p===g.j||a[n][g.j]==f&&a[g.i][p]===f)&&a[n][p]===
f&&(l=this.isInOpenList(n,p),m=n==g.i||p==g.j?10:14,m=g.g+m,null===l?(u=new clsNode(g,n,p),l=10*(Math.abs(n-d)+Math.abs(p-e)),u.g=m,u.h=l,u.f=m+l,this.addOpenList(u)):m<l.g&&(l.g=m,l.f=l.h+l.g,l.parent=g));this.removeOpenList(g);this.addCloseList(g);g=this.getSelectOpen(b,c)}a=null;if(this.isInCloseListById(d,e)){a=[];for(d=this.m_listClose[this.m_listClose.length-1];null!==d;)a.push(d),d=d.parent;a=a.reverse()}return a};
PathFinding.prototype.getSelectOpen=function(a,b){var c=this.m_listOpen.length;if(0<c){a=this.m_listOpen[c-1];for(var d=0;d<c;d++)b=this.m_listOpen[d],b.f<a.f&&(a=b)}else a=new clsNode(null,a,b);return a};PathFinding.prototype.isInCloseListById=function(a,b){return"undefined"!==typeof this.m_mapOpen[a]&&null!==this.m_mapOpen[a]&&"undefined"!==typeof this.m_mapOpen[a][b]&&null!==this.m_mapOpen[a][b]?this.m_mapOpen[a][b].isClose:!1};PathFinding.prototype.isInCloseList=function(a){return a.isClose};
PathFinding.prototype.addCloseList=function(a){a.isClose=!0;this.m_listClose.push(a)};PathFinding.prototype.isInOpenList=function(a,b){return"undefined"!==typeof this.m_mapOpen[a]&&null!==this.m_mapOpen[a]&&"undefined"!==typeof this.m_mapOpen[a][b]&&null!==this.m_mapOpen[a][b]?this.m_mapOpen[a][b]:null};PathFinding.prototype.removeOpenList=function(a){var b=this.m_listOpen.indexOf(a);-1<b&&this.m_listOpen.splice(b,1);a.isOpen=!1};
PathFinding.prototype.addOpenList=function(a){a.isOpen=!0;this.m_listOpen.push(a);this.m_mapOpen[a.i]||(this.m_mapOpen[a.i]=[]);this.m_mapOpen[a.i][a.j]=a};function clsNode(a,b,c){this.f=this.h=this.g=0;this.i=b;this.j=c;this.isClose=this.isOpen=!1;this.parent=a}
function JumpControl(a,b){this.onMaxHeightReachedCallback=this.onCompleteJumpCallback=this.targetCallback=null;this.m_gravity="undefined"!==typeof b?b:9.8;this.m_factorGravity=1;this.m_vo="undefined"!==typeof a?a:-45;this.m_time=this.m_nextZ=this.m_z=0;this.m_isPaused=this.m_isJump=!1;this.m_checkMaxHeight=!0;this.m_initVelocity=this.m_vo;this.m_initPosition=0}JumpControl.prototype.setHeightInit=function(a){this.m_initPosition=a;this.m_time=this.m_vo=0;this.m_isJump=!0};
JumpControl.prototype.cancel=function(){this.m_isJump=!1;this.m_z=this.m_vo=this.m_time=this.m_initPosition=0};JumpControl.prototype.getCurrentHeight=function(){return this.m_z};JumpControl.prototype.getElapseTime=function(){return this.m_time};JumpControl.prototype.getGravity=function(){return this.m_gravity};JumpControl.prototype.setGravity=function(a){this.m_gravity=a};JumpControl.prototype.getIsJump=function(){return this.m_isJump};JumpControl.prototype.getFactorGravity=function(){return this.m_factorGravity};
JumpControl.prototype.setFactorGravity=function(a){this.m_factorGravity=a};JumpControl.prototype.getPaused=function(){return this.m_isPaused};JumpControl.prototype.setPaused=function(a){this.m_isPaused=a};JumpControl.prototype.init=function(a){this.m_nextZ=this.m_z="undefined"!==typeof a?a:0;this.m_time=0;this.m_checkMaxHeight=this.m_isJump=!0};JumpControl.prototype.getInitVelocity=function(){return this.m_vo};JumpControl.prototype.setInitVelocity=function(a){this.m_initVelocity=this.m_vo=a};
JumpControl.prototype.applyForceY=function(a){if(!this.m_isJump)return!1;this.m_initPosition=this.m_nextZ;this.m_vo=a;this.m_time=0;return!0};JumpControl.prototype.applyImpulse=function(a){this.m_initPosition=this.m_z;this.m_vo=a;this.m_time=0;this.m_isJump=!0};JumpControl.prototype.completeJump=function(){this.m_vo=this.m_initVelocity;this.m_z=this.m_initPosition=0;this.m_isJump=!1;if(this.targetCallback&&this.onCompleteJumpCallback)this.targetCallback[this.onCompleteJumpCallback](this)};
JumpControl.prototype.update=function(a){if(!this.m_isPaused&&this.m_isJump)if(this.m_time+=.011*a,this.m_nextZ=this.m_vo*this.m_time+this.m_gravity*this.m_factorGravity*this.m_time*this.m_time*.5+this.m_initPosition,0>=this.m_nextZ){if(this.m_checkMaxHeight&&this.m_nextZ>this.m_z&&(this.m_checkMaxHeight=!1,this.targetCallback&&this.onMaxHeightReachedCallback))this.targetCallback[this.onMaxHeightReachedCallback](this);this.m_z=this.m_nextZ}else this.completeJump()};
JumpControl.prototype.free=function(a){this.onMaxHeightReachedCallback=this.onCompleteJumpCallback=null};
function Displace(a,b){this.position=new Vector2D(a,b);this.positionTarget=new Vector2D(0,0);this.angle=this.speedFactor=this.speedMagnitude=this.accelerationMagnitude=0;this.targetCallback=this.onEndDisplaceCallback=null;this.m_timeElapse=0;this.m_positionStart=this.position.clone();this.m_acceleration=new Vector2D(0,0);this.m_speedInitial=new Vector2D(0,0);this.m_totalDisplacement=0;this.m_onMove=!1}
Displace.prototype.currentSpeed=function(){var a=new Vector2D(0,0);a.x=this.m_speedInitial.x*this.speedFactor+this.m_acceleration.x*this.m_timeElapse;a.y=this.m_speedInitial.y*this.speedFactor+this.m_acceleration.y*this.m_timeElapse;return a.length()};Displace.prototype.toLeft=function(){var a=this.angle;for(a*=180/Math.PI;0>a;)a+=360;a%=360;return 90<a&&270>a};Displace.prototype.getX=function(){return this.position.x};Displace.prototype.getY=function(){return this.position.y};
Displace.prototype.resetPosition=function(a,b){this.position.x=a;this.position.y=b};Displace.prototype.updateSpeed=function(a){this.speedMagnitude=a;this.m_speedInitial.setVector(this.speedMagnitude,this.angle)};
Displace.prototype.updateAcceleration=function(a){this.m_timeElapse=0;this.m_speedInitial.x=this.m_speedInitial.x*this.speedFactor+this.m_acceleration.x*this.m_timeElapse;this.m_speedInitial.y=this.m_speedInitial.y*this.speedFactor+this.m_acceleration.y*this.m_timeElapse;this.m_positionStart=this.position.clone();this.accelerationMagnitude=a;this.m_acceleration.setVector(this.accelerationMagnitude,this.angle)};
Displace.prototype.cancel=function(){this.m_positionStart=this.position.clone();this.m_speedInitial.x=0;this.m_speedInitial.y=0;this.m_acceleration.x=0;this.m_timeElapse=this.m_acceleration.y=0;this.speedFactor=1;this.m_onMove=!1;if(this.onEndDisplaceCallback&&this.targetCallback)this.targetCallback[this.onEndDisplaceCallback]()};
Displace.prototype.gotoPosition=function(a,b,c,d,e){this.accelerationMagnitude="undefined"===typeof d?0:d;this.speedMagnitude="undefined"===typeof c?0:c;this.speedFactor="undefined"===typeof e?1:e;this.m_timeElapse=0;this.m_positionStart=this.position.clone();this.positionTarget.x=a;this.positionTarget.y=b;this.angle=this.positionTarget.minus(this.m_positionStart).angle();this.m_speedInitial.setVector(this.speedMagnitude,this.angle);this.m_acceleration.setVector(this.accelerationMagnitude,this.angle);
this.m_totalDisplacement=this.positionTarget.minus(this.m_positionStart).length();this.m_onMove=!0};
Displace.prototype.gotoDirection=function(a,b,c,d,e){this.accelerationMagnitude="undefined"===typeof d?0:d;this.speedMagnitude="undefined"===typeof c?0:c;this.speedFactor="undefined"===typeof e?1:e;this.angle=b;this.m_timeElapse=0;this.m_positionStart=this.position.clone();this.m_speedInitial.setVector(this.speedMagnitude,this.angle);this.m_acceleration.setVector(this.accelerationMagnitude,this.angle);this.m_totalDisplacement=a;this.m_onMove=!0;this.positionTarget.x=this.m_positionStart.x+a*Math.cos(b);
this.positionTarget.y=this.m_positionStart.y+a*Math.sin(b)};Displace.prototype.estimatePositionAfterTime=function(a){a*=.001;var b=new Point(0,0);b.x=this.position.x+this.m_speedInitial.x*a*this.speedFactor+.5*this.m_acceleration.x*a*a;b.y=this.position.y+this.m_speedInitial.y*a*this.speedFactor+.5*this.m_acceleration.y*a*a;return b};
Displace.prototype.onBounce=function(a){var b=0;a==Displace.DIRECTION_LEFT&&(b=180);this.m_timeElapse=0;this.m_positionStart=this.position.clone();this.angle=(b+Common.random(-Displace.BOUNCE_ANGLE_VAR,Displace.BOUNCE_ANGLE_VAR))*(Math.PI/180);this.m_speedInitial.setVector(this.speedMagnitude*Displace.ENERGY_AFTER_BOUNCE,this.angle);this.m_acceleration.setVector(this.accelerationMagnitude,this.angle)};
Displace.prototype.update=function(a){if(0!=this.m_onMove&&(this.m_timeElapse+=.001*a,this.position.x=this.m_positionStart.x+this.m_speedInitial.x*this.m_timeElapse*this.speedFactor+.5*this.m_acceleration.x*this.m_timeElapse*this.m_timeElapse,this.position.y=this.m_positionStart.y+this.m_speedInitial.y*this.m_timeElapse*this.speedFactor+.5*this.m_acceleration.y*this.m_timeElapse*this.m_timeElapse,a=new Vector2D(0,0),a.x=this.m_speedInitial.x*this.speedFactor+this.m_acceleration.x*this.m_timeElapse,
a.y=this.m_speedInitial.y*this.speedFactor+this.m_acceleration.y*this.m_timeElapse,this.m_positionStart.minus(this.position).length()>=this.m_totalDisplacement||Math.abs(a.x)<Displace.NO_SPEED_VALUE&&Math.abs(a.y)<Displace.NO_SPEED_VALUE)){if(this.onEndDisplaceCallback&&this.targetCallback)this.targetCallback[this.onEndDisplaceCallback]();this.m_onMove=!1}};Displace.prototype.free=function(){this.m_speedInitial=this.m_acceleration=this.m_positionOrigin=this.position=null};
Displace.DIRECTION_RIGHT=1;Displace.DIRECTION_LEFT=-1;Displace.BOUNCE_ANGLE_VAR=15;Displace.ENERGY_AFTER_BOUNCE=.6;Displace.NO_SPEED_VALUE=5;function ValueInterpolation(a,b,c,d){this.isAwaitingDelete=this.stop=!1;this.dataInterpolation=null;this.isDisposed=this.isCreatedByPool=!1;this.m_timeEnd=this.m_timeInit=this.m_currentTime=0;this.m_startCalculation=!1;this.m_finalValue=this.m_initValue=this.m_currentValue=this.m_duration=0;this.m_callback=this.m_caller=null}
ValueInterpolation.prototype.reset=function(a,b,c,d,e,f,g){d="undefined"!==typeof d?d:0;c="undefined"!==typeof c?c:this.m_duration;this.m_initValue=a;this.m_finalValue=b;this.m_duration=c;this.m_timeInit=d;this.m_timeEnd=d+c;this.dataInterpolation=null;this.isAwaitingDelete=this.stop=!1;this.m_currentTime=0;this.m_startCalculation=0>d?!1:!0;this.m_callback=this.m_caller=null;return this};ValueInterpolation.prototype.onEndInterpolation=function(a,b){this.m_caller=a;this.m_callback=b};
ValueInterpolation.prototype.timeInit=function(){return this.m_timeInit};ValueInterpolation.prototype.timeEnd=function(){return this.m_timeEnd};ValueInterpolation.prototype.value=function(){return this.m_currentValue};ValueInterpolation.prototype.calculateValue=function(a){return 0};
ValueInterpolation.prototype.update=function(a){this.stop||(this.m_startCalculation?(this.m_currentTime+=a,this.m_currentValue=this.calculateValue(this.m_currentTime),this.m_currentTime>=this.m_duration&&(this.m_currentValue=this.m_finalValue,this.stop=!0,null!==this.m_caller&&null!==this.m_callback&&this.m_callback.call(this.m_caller,this))):(this.m_currentTime+=a,this.m_currentTime>=this.m_timeInit&&(this.m_startCalculation=!0,this.m_currentTime=0)))};
ValueInterpolation.prototype.free=function(){this.dataInterpolation=this.m_caller=this.m_callback=null};function LinearInterpolation(a,b,c,d){ValueInterpolation.call(this,a,b,c,d);this.m_rateOfChange=0;this.reset(a,b,c,d)}Application.subclass(LinearInterpolation,ValueInterpolation);LinearInterpolation.freeObject=[];LinearInterpolation.lastCreated=null;
LinearInterpolation.create=function(a,b,c,d){0<LinearInterpolation.freeObject.length?(LinearInterpolation.lastCreated=LinearInterpolation.freeObject.pop(),LinearInterpolation.lastCreated.reset(a,b,c,d,0,0,0)):LinearInterpolation.lastCreated=new LinearInterpolation(a,b,c,d);LinearInterpolation.lastCreated.isCreatedByPool=!0;LinearInterpolation.lastCreated.isDisposed=!1;return LinearInterpolation.lastCreated};
LinearInterpolation.disposeObject=function(a){a.isCreatedByPool&&!a.isDisposed&&(LinearInterpolation.freeObject.push(a),a.isDisposed=!0)};LinearInterpolation.clear=function(){LinearInterpolation.freeObject=[]};LinearInterpolation.prototype.reset=function(a,b,c,d,e,f,g){ValueInterpolation.prototype.reset.call(this,a,b,c,d,e,f,g);this.m_rateOfChange=(b-a)/c;return this};LinearInterpolation.prototype.calculateValue=function(a){return this.m_initValue+a*this.m_rateOfChange};
LinearInterpolation.prototype.free=function(){ValueInterpolation.prototype.free.call(this);LinearInterpolation.disposeObject(this)};function ExponentialInterpolation(a,b,c,d,e){ValueInterpolation.call(this,a,b,c,e);this.m_c2=this.m_c1=this.m_alpha=0;this.reset(a,b,c,e,d)}Application.subclass(ExponentialInterpolation,ValueInterpolation);ExponentialInterpolation.freeObject=[];ExponentialInterpolation.lastCreated=null;
ExponentialInterpolation.create=function(a,b,c,d,e){0<ExponentialInterpolation.freeObject.length?(ExponentialInterpolation.lastCreated=ExponentialInterpolation.freeObject.pop(),ExponentialInterpolation.lastCreated.reset(a,b,c,e,d,0,0)):ExponentialInterpolation.lastCreated=new ExponentialInterpolation(a,b,c,d,e);ExponentialInterpolation.lastCreated.isCreatedByPool=!0;ExponentialInterpolation.lastCreated.isDisposed=!1;return ExponentialInterpolation.lastCreated};
ExponentialInterpolation.disposeObject=function(a){a.isCreatedByPool&&!a.isDisposed&&(a.isDisposed=!0,ExponentialInterpolation.freeObject.push(a))};ExponentialInterpolation.clear=function(){ExponentialInterpolation.freeObject=[]};ExponentialInterpolation.prototype.reset=function(a,b,c,d,e,f,g){ValueInterpolation.prototype.reset.call(this,a,b,c,d,e,f,g);this.m_alpha=1E3*e/c;this.m_c1=(b-a)/(Math.exp(this.m_alpha*this.m_duration*.001)-1);this.m_c2=this.m_initValue-this.m_c1;return this};
ExponentialInterpolation.prototype.calculateValue=function(a){return this.m_c1*Math.exp(this.m_alpha*a*.001)+this.m_c2};ExponentialInterpolation.prototype.free=function(){ValueInterpolation.prototype.free.call(this);ExponentialInterpolation.disposeObject(this)};function ElasticInterpolation(a,b,c,d,e,f){ValueInterpolation.call(this,a,b,c,f);this.m_waves=this.m_overshoot=this.m_zetaConst=this.m_c4=this.m_c3=this.m_c2=this.m_c1=0;this.reset(a,b,c,f,0,d,e)}Application.subclass(ElasticInterpolation,ValueInterpolation);
ElasticInterpolation.MAX_OVERSHOOT=.8;ElasticInterpolation.INVERSE_PI=.3183098862;ElasticInterpolation.freeObject=[];ElasticInterpolation.lastCreated=null;
ElasticInterpolation.create=function(a,b,c,d,e,f){0<ElasticInterpolation.freeObject.length?(ElasticInterpolation.lastCreated=ElasticInterpolation.freeObject.pop(),ElasticInterpolation.lastCreated.reset(a,b,c,f,0,d,e)):ElasticInterpolation.lastCreated=new ElasticInterpolation(a,b,c,d,e,f);ElasticInterpolation.lastCreated.isCreatedByPool=!0;ElasticInterpolation.lastCreated.isDisposed=!1;return ElasticInterpolation.lastCreated};
ElasticInterpolation.disposeObject=function(a){a.isCreatedByPool&&!a.isDisposed&&(a.isDisposed=!0,ElasticInterpolation.freeObject.push(a))};ElasticInterpolation.clear=function(){ElasticInterpolation.freeObject=[]};
ElasticInterpolation.prototype.reset=function(a,b,c,d,e,f,g){ValueInterpolation.prototype.reset.call(this,a,b,c,d,e,f,g);f="undefined"!==typeof f?f:0;g="undefined"!==typeof g?g:0;f>ElasticInterpolation.MAX_OVERSHOOT&&(f=ElasticInterpolation.MAX_OVERSHOOT);this.m_overshoot=f;d=Math.log(f)*ElasticInterpolation.INVERSE_PI;this.m_zetaConst=Math.sqrt(1-1/(d*d+1));this.m_waves=g;d=-Math.atan(Math.sqrt(1-this.m_zetaConst*this.m_zetaConst)/this.m_zetaConst);c=2*Math.PI/(c/(g+d*ElasticInterpolation.INVERSE_PI*
.5+(0>d?1:0)));g=c/Math.sqrt(1-this.m_zetaConst*this.m_zetaConst);this.m_c1=b-a;this.m_c2=-this.m_zetaConst*g;this.m_c3=c;this.m_c4=-this.m_c2/c;return this};ElasticInterpolation.prototype.calculateValue=function(a){return this.m_c1*(1-Math.exp(this.m_c2*a)*(SMath.fastCos(this.m_c3*a)+this.m_c4*SMath.fastSin(this.m_c3*a)))+this.m_initValue};ElasticInterpolation.prototype.free=function(){ValueInterpolation.prototype.free.call(this);ElasticInterpolation.disposeObject(this)};
function SATCollisionDetector(){}
SATCollisionDetector.calculatePolyPolyIntersection=function(a,b){for(var c=[],d,e,f=0;f<a.length;f++)if(e=0===f?-(a[0][0]-a[a.length-1][0])/(a[0][1]-a[a.length-1][1]):-(a[f][0]-a[f-1][0])/(a[f][1]-a[f-1][1]),-1===c.indexOf(e)&&(c.push(e),d=SATCollisionDetector.projectPolygonOntoLine(a,e),e=SATCollisionDetector.projectPolygonOntoLine(b,e),d[0]>e[1]||d[1]<e[0]))return!1;for(f=0;f<b.length;f++)if(e=0===f?-(b[0][0]-b[b.length-1][0])/(b[0][1]-b[b.length-1][1]):-(b[f][0]-b[f-1][0])/(b[f][1]-b[f-1][1]),
-1===c.indexOf(e)&&(c.push(e),d=SATCollisionDetector.projectPolygonOntoLine(a,e),e=SATCollisionDetector.projectPolygonOntoLine(b,e),d[0]>e[1]||d[1]<e[0]))return!1;return!0};SATCollisionDetector.calculatePolyCircleIntersection=function(a,b){};
SATCollisionDetector.projectPolygonOntoLine=function(a,b){for(var c,d=[],e,f=0;f<a.length;f++)Infinity===b||Infinity===b?c=a[f][1]:0===b?c=a[f][0]:(c=-1/b,e=a[f][1]-c*a[f][0],c=e/(b-c)),0===d.length?d.push(c):1===d.length?c>=d[0]?d.push(c):d.unshift(c):c>d[1]?d[1]=c:c<d[0]&&(d[0]=c);return d};
function Shaker(a){this.m_canvas=a;this.m_yEnabled=this.m_xEnabled=!0;this.m_shaked=!1;this.m_amp=0;this.m_duration=this.m_frequency=1;this.m_infinite=this.m_updateable=!1;this.m_timer=0;this.m_timerFrequency=1;this.oy=this.ox=0}Shaker.prototype.free=function(){this.m_canvas=null};Shaker.prototype.enableDirection=function(a,b){this.m_xEnabled=a;this.m_yEnabled=b};
Shaker.prototype.shake=function(a,b,c){c="undefined"!==typeof c?c:0;0>c||(this.m_updateable||(this.ox=this.m_canvas.position.x,this.oy=this.m_canvas.position.y),this.stop(),this.m_duration=c,this.m_frequency=b,this.m_amp=a,0==this.m_duration&&(this.m_infinite=!0))};Shaker.prototype.setAmplitude=function(a){this.m_amp=a};Shaker.prototype.start=function(){this.m_updateable=!0};
Shaker.prototype.stop=function(){this.m_canvas.position.x=this.ox;this.m_canvas.position.y=this.oy;this.m_infinite=this.m_updateable=!1;this.m_duration=-1;this.m_timer=this.m_timerFrequency=this.m_frequency=0};Shaker.prototype.isShaking=function(){return this.m_updateable};Shaker.prototype.updateClipPosition=function(){this.m_xEnabled&&(this.m_canvas.position.x=this.ox+this.m_amp*Math.random());this.m_yEnabled&&(this.m_canvas.position.y=this.oy+this.m_amp*Math.random())};
Shaker.prototype.update=function(a){this.m_updateable&&(this.m_timer<this.m_duration||this.m_infinite?(this.m_timer+=a,this.m_timerFrequency+=a,this.m_frequency<this.m_timerFrequency&&(this.m_timerFrequency=0,this.updateClipPosition())):this.stop())};
function Homing2DPath(a,b,c,d,e){this.targetY=this.targetX=0;this.m_followX=a;this.m_followY=b;this.m_speed=d;this.m_turnFactor=c;this.accuracy=35;this.plusFactor=3;this.m_plusTurnFactor=0;this.accuracyForPlusTurnFactor=80;this.m_oldRotations=[];for(c=0;c<e;c++)this.m_oldRotations.push(0);this.m_directionVector=new Vector2D(this.targetX-a,this.targetY-b);this.m_velocityVector=new Vector2D(0,0);this.m_directionVector.normalize2(1);this.m_onArriveFunction=this.m_callerActor=null}
Homing2DPath.prototype.setX=function(a){this.m_followX=a};Homing2DPath.prototype.getX=function(){return this.m_followX};Homing2DPath.prototype.setY=function(a){this.m_followY=a};Homing2DPath.prototype.getY=function(){return this.m_followY};Homing2DPath.prototype.getSpeed=function(){return this.m_speed};Homing2DPath.prototype.getRotation=function(){return this.m_oldRotations[0]};Homing2DPath.prototype.getVelocityVec=function(){return this.m_velocityVector};
Homing2DPath.prototype.setSpeed=function(a){this.m_speed=a};Homing2DPath.prototype.setTurnFactor=function(a){this.m_turnFactor=a};Homing2DPath.prototype.onArrivePointFunction=function(a,b){this.m_callerActor=a;this.m_onArriveFunction=b};Homing2DPath.prototype.addNewRotation=function(a){for(var b=this.m_oldRotations.length,c=0;c<b;c++)this.m_oldRotations[c]=this.m_oldRotations[c+1==b?c:c+1];this.m_oldRotations[b-1]=a};
Homing2DPath.prototype.update=function(a){var b=this.m_directionVector.x=this.targetX-this.m_followX,c=this.m_directionVector.y=this.targetY-this.m_followY;this.m_directionVector.normalize2(this.m_turnFactor+this.m_plusTurnFactor);this.m_velocityVector.add(this.m_directionVector);this.m_velocityVector.normalize2(this.m_speed*a);this.m_followX+=this.m_velocityVector.x;this.m_followY+=this.m_velocityVector.y;this.addNewRotation(Math.atan2(this.m_velocityVector.y,this.m_velocityVector.x));a=Math.sqrt(b*
b+c*c);a<this.accuracy?null!==this.m_callerActor&&null!==this.m_onArriveFunction&&(this.m_plusTurnFactor=0,this.m_onArriveFunction.call(this.m_callerActor,this)):a<this.accuracyForPlusTurnFactor&&(this.m_plusTurnFactor=this.plusFactor)};
function VirtualStick(a,b,c,d){VirtualStick.NONE=-100;this.maxForce="undefined"===typeof b?0:b;this.x="undefined"===typeof c?0:c;this.y="undefined"===typeof d?0:d;this.anchor=0===this.x&&0===this.y?!1:!0;this.identifier=VirtualStick.NONE;this.force=0;this.canvas=a;this.clipBase=Application.instance.getClip("mcUIStickBase");this.clipPointer=Application.instance.getClip("mcUIStickPointer");this.canvas.addChild(this.clipBase);this.canvas.addChild(this.clipPointer);this.clipBase.setPosition(this.x,this.y);
this.clipPointer.setPosition(this.x,this.y);this.anchor||(this.clipBase.visible=!1,this.clipPointer.visible=!1);this.m_callbackChangeFunction=this.m_callbackChangeObject=this.m_callbackReleaseFunction=this.m_callbackReleaseObject=this.m_callbackPressFunction=this.m_callbackPressObject=null}
VirtualStick.prototype.free=function(){this.m_callbackChangeFunction=this.m_callbackChangeObject=this.m_callbackReleaseFunction=this.m_callbackReleaseObject=this.m_callbackPressFunction=this.m_callbackPressObject=null;this.canvas.removeChild(this.clipBase);this.canvas.removeChild(this.clipPointer);this.clipBase.free();this.clipBase=null;this.clipPointer.free();this.canvas=this.clipPointer=null};
VirtualStick.prototype.addPressListener=function(a,b){this.m_callbackPressObject=a;this.m_callbackPressFunction=b};
VirtualStick.prototype.setClips=function(a,b){this.clipBase&&this.canvas.removeChild(this.clipBase);this.clipPointer&&this.canvas.removeChild(this.clipPointer);this.clipBase=Application.instance.getClip(a);this.clipPointer=Application.instance.getClip(b);this.canvas.addChild(this.clipBase);this.canvas.addChild(this.clipPointer);this.clipBase.setPosition(this.x,this.y);this.clipPointer.setPosition(this.x,this.y);this.anchor||(this.clipBase.visible=!1,this.clipPointer.visible=!1)};
VirtualStick.prototype.addReleaseListener=function(a,b){this.m_callbackReleaseObject=a;this.m_callbackReleaseFunction=b};VirtualStick.prototype.addChangeListener=function(a,b){this.m_callbackChangeObject=a;this.m_callbackChangeFunction=b};
VirtualStick.prototype.onPointerPress=function(a){this.identifier===VirtualStick.NONE&&(this.anchor||(this.x=a.data.global.x,this.y=a.data.global.y,this.clipBase.setPosition(this.x,this.y),this.clipPointer.setPosition(this.x,this.y)),this.clipBase.visible=!0,this.clipPointer.visible=!0,this.identifier=this.getIdentifier(a),null!==this.m_callbackPressObject&&null!==this.m_callbackPressFunction&&this.m_callbackPressFunction.call(this.m_callbackPressObject,this))};
VirtualStick.prototype.onPointerRelease=function(a){this.identifier===this.getIdentifier(a)&&(this.anchor||(this.clipBase.visible=!1,this.clipPointer.visible=!1),this.force=0,this.clipPointer.setPosition(this.x,this.y),this.identifier=VirtualStick.NONE,null!==this.m_callbackReleaseObject&&null!==this.m_callbackReleaseFunction&&this.m_callbackReleaseFunction.call(this.m_callbackReleaseObject,this))};
VirtualStick.prototype.reset=function(){this.force=0;this.clipPointer.setPosition(this.x,this.y);this.identifier=VirtualStick.NONE};
VirtualStick.prototype.onPointerMove=function(a){this.identifier===this.getIdentifier(a)&&(this.force=a.data.global.x-this.x,0<this.force&&this.force>this.maxForce?this.force=this.maxForce:0>this.force&&this.force<-this.maxForce&&(this.force=-this.maxForce),this.clipPointer.setPosition(this.x+this.force,this.y),null!==this.m_callbackChangeObject&&null!==this.m_callbackChangeFunction&&this.m_callbackChangeFunction.call(this.m_callbackChangeObject,this))};
VirtualStick.prototype.getIdentifier=function(a){return"undefined"!==typeof a.data.identifier?a.data.identifier:a.data.originalEvent.which};VirtualStick.prototype.setVisible=function(a){this.canvas.visible=a};function KeyControl(){this.keys={}}KeyControl.prototype.bind=function(a,b,c,d,e){var f=new KeyCommand;f.keyCode=a;f.caller=b||null;f.onKeyPress=c||null;f.onKeyRelease=d||null;f.onKeyHold=e||null;return this.keys[a]=f};KeyControl.prototype.onKeyDown=function(a){if(this.keys[a])this.keys[a].onKeyDown()};
KeyControl.prototype.onKeyUp=function(a){if(this.keys[a])this.keys[a].onKeyUp()};KeyControl.prototype.update=function(a){for(var b in this.keys)this.keys[b].update(a)};function KeyCommand(){this.keyCode=0;this.timeHold=250;this.isPressed=!1;this.time=0;this.onKeyHold=this.onKeyRelease=this.onKeyPress=this.caller=null}KeyCommand.prototype.onKeyDown=function(){this.isPressed||(this.onKeyHold?this.time=this.timeHold:this.caller&&this.onKeyPress&&this.onKeyPress.call(this.caller),this.isPressed=!0)};
KeyCommand.prototype.onKeyUp=function(){this.caller&&(this.onKeyHold&&0<this.time&&(this.time=0,this.onKeyPress&&this.onKeyPress.call(this.caller)),this.onKeyRelease&&this.onKeyRelease.call(this.caller));this.isPressed=!1};KeyCommand.prototype.update=function(a){0<this.time&&(this.time-=a,0>=this.time&&this.caller&&this.onKeyHold&&this.onKeyHold.call(this.caller))};
function SLoader(a){this.onLoadCallback=this.onLoadCaller=null;this.jsonLoader=a;if(a=this.jsonLoader.json.animations)for(var b=0;b<a.length;b++)a[b].atlas=this.jsonLoader.json.meta.atlas,"undefined"!==typeof window.globalAnimations[a[b].n]&&Application.warn("Clip ["+a[b].n+"] is duplicated in multiple JSON files : "+this.jsonLoader.url+" || "+window.globalAnimations[a[b].n+"_url"]),window.globalAnimations[a[b].n]=a[b],window.globalAnimations[a[b].n+"_url"]=this.jsonLoader.url}
SLoader.prototype.addLoadListener=function(a,b){this.onLoadCaller=a;this.onLoadCallback=b};SLoader.prototype.load=function(){var a,b=this.jsonLoader.json.meta,c=[];SLoader.JsonTextures[this.jsonLoader.url]=[];for(a=0;a<b.atlas.length;a++){var d=this.jsonLoader.baseUrl+b.atlas[a];c[a]=new PIXI.loaders.Loader;c[a].add(b.atlas[a],d);c[a].parent=this;c[a].metaImage=b.atlas[a];c[a].metaIndex=a;c[a].once("complete",function(){if(this.parent)this.parent.onLoaded(this)});c[a].load()}};
SLoader.prototype.onLoaded=function(a){this.onLoadCaller&&this.onLoadCallback&&this.onLoadCallback.call(this.onLoadCaller);if("undefined"!==typeof this.jsonLoader.json.atlas){Application.info("SLoader::onLoaded: "+a.metaImage);for(var b=a.metaIndex,c=a.resources[a.metaImage].texture.baseTexture,d=this.jsonLoader.json.atlas[b],e,f=0;f<d.length;f++){var g=d[f];e=this.jsonLoader.json.meta.atlas[b]+"_"+f;var h=new window.PIXI.Rectangle(g.x,g.y,g.w,g.h);h.p=g.p;h.q=g.q;h.ax=g.p/g.w;h.ay=g.q/g.h;window.PIXI.utils.TextureCache[e]=
new window.PIXI.Texture(c,h);""!==d[f].n&&(window.PIXI.utils.TextureCache[d[f].n]=new window.PIXI.Texture(c,h))}SLoader.JsonTextures[a.parent.jsonLoader.url].push(c)}};SLoader.JsonTextures={};SLoader.checkTexturesLoaded=function(a){if(!a)return!1;for(var b=0;b<a.length;b++)if("undefined"===typeof SLoader.JsonTextures[a[b]])return!1;return!0};SLoader.showAllTextures=function(){for(var a in SLoader.JsonTextures)Application.info("SLoader >> Textures :: id ["+a+"]")};
SLoader.unloadFromList=function(a){for(var b=0;b<a.length;b++)SLoader.unloadTextureFromJson(a[b])};
SLoader.unloadTextureFromJson=function(a){if(SLoader.JsonTextures[a]){Application.warn("SLoader >> unloadTexture from Json["+a+"]");for(var b=0;b<SLoader.JsonTextures[a].length;b++){Application.warn("SLoader > unload "+SLoader.JsonTextures[a][b].imageUrl);for(var c in window.PIXI.utils.TextureCache)window.PIXI.utils.TextureCache[c]&&window.PIXI.utils.TextureCache[c].baseTexture===SLoader.JsonTextures[a][b]&&(window.PIXI.utils.TextureCache[c]=null);for(var d in window.globalAnimations)window.globalAnimations[d+
"_url"]===a&&(window.globalAnimations[d]=null,delete window.globalAnimations[d],delete window.globalAnimations[d+"_url"]);SLoader.JsonTextures[a][b].destroy()}SLoader.JsonTextures[a]=null;delete SLoader.JsonTextures[a]}else Application.info("SLoader >> unloadTexture, texture ["+a+"] no found")};
SLoader.getCharacterFiles=function(a,b){a="undefined"===typeof a?Global.fightSettings.p1CharId:a;b="undefined"===typeof b?Global.fightSettings.p2CharId:b;var c=[],d=window.SWT_BUNDLES.media_characters;a=DataHero.getMediaId(a);a+=Global.fightSettings.p1Costume;a<d.length&&c.push(d[a]);a=DataHero.getMediaId(b);a+=Global.fightSettings.p2Costume;a<d.length&&(c.push(d[a]),StoryManager.instance&&StoryManager.instance.bossEnabled()&&c.push(d[a+1]));b=window.SWT_BUNDLES["media_world_"+Global.fightSettings.getStageData().name];
return c=c.concat(b)};SLoader.getGameplayFiles=function(){var a=window.SWT_BUNDLES["media_gameplay"+(Application.RIGHT_TO_LEFT?"_rtl":"")].slice();return a=a.concat(SLoader.getCharacterFiles())};SLoader.getTexturesLoaded=function(){var a=SLoader.JsonTextures,b=[],c;for(c in a)b.push(c);return b};SLoader.getFilesWithoutList=function(a,b){a=a.slice();var c,d;for(c=0;c<b.length;c++){var e=b[c];for(d=0;d<a.length;d++)e===a[d]&&a.splice(d,1)}return a};
function SDisplayObjectContainer(){PIXI.Container.call(this);this.name="";this.m_pointerMoveCallback=this.m_pointerMoveCaller=this.m_pointerOverCallback=this.m_pointerOverCaller=this.m_pressAndReleaseCallback=this.m_pressAndReleaseCaller=this.m_releaseCallback=this.m_releaseCaller=this.m_pressCallback=this.m_pressCaller=null;this.collisionsClips=[];this.collisions={};this.showCollision=this.showCollision;this.toggleCollision=this.toggleCollision;this._onPointerPress=this._onPointerPress;this._onPointerRelease=
this._onPointerRelease;this._onPointerPressAndRelease=this._onPointerPressAndRelease;this._onPointerOver=this._onPointerOver;this.onPointerMove=this.onPointerMove}Application.subclass(SDisplayObjectContainer,PIXI.Container);
SDisplayObjectContainer.prototype.free=function(){if(this.collisionsClips){for(;0<this.collisionsClips.length;)this.removeChild(this.collisionsClips[0]),this.collisionsClips[0].free(),this.collisionsClips[0]=null,this.collisionsClips.splice(0,1);this.collisionsClips=null}0<this.children.length&&Application.error(" An animation with children is being deleted! from clip ["+this.name+"]");for(var a in this.collisions)this.collisions[a]=null;this.collisions=null;PIXI.Container.prototype.free.call(this);
this._pressAndReleaseCallback=this._pressAndReleaseCaller=this._releaseCallback=this._releaseCaller=this._pressCallback=this._pressCaller=null};SDisplayObjectContainer.prototype.setPosition=function(a,b){this.position.x=a;this.position.y=b};SDisplayObjectContainer.prototype.setScale=function(a,b){this.scale.x=a;this.scale.y=b||a};
SDisplayObjectContainer.prototype.addChild=function(a){a.collisionView=this.collisionView;a.collisionView&&a.showCollision&&a.showCollision();return PIXI.Container.prototype.addChild.call(this,a)};SDisplayObjectContainer.prototype.removeChild=function(a){return PIXI.Container.prototype.removeChild.call(this,a)};SDisplayObjectContainer.prototype.toggleCollision=function(){PIXI.Container.prototype.toggleCollision.call(this);this.showCollision()};
SDisplayObjectContainer.prototype.showCollision=function(){for(;0<this.collisionsClips.length;)this.removeChild(this.collisionsClips[0]),this.collisionsClips[0].free(),this.collisionsClips[0]=null,this.collisionsClips.splice(0,1);if(this.collisionView)for(var a in this.collisions)if(this.collisions[a]){var b=this.collisions[a],c=new SGraphics;c.drawRectangle(b.x,b.y,b.w,b.h,1,this.collisionColor,"mcCollision"===a?this.collisionColor:255,1,.1);this.collisionsClips.push(c);this.addChild(c)}};
SDisplayObjectContainer.prototype.getCollision=function(a){return this.collisions[a]||null};SDisplayObjectContainer.prototype.addCollision=function(a,b){this.collisions[a]=b};SDisplayObjectContainer.prototype.addPressListener=function(a,b){this.interactive=!0;this.self=this;this.mousedown=this.touchstart=function(a){this.self._onPointerPress(a)};this.m_pressCaller=a;this.m_pressCallback=b};
SDisplayObjectContainer.prototype.addReleaseListener=function(a,b){this.interactive=!0;this.self=this;this.mouseup=this.mouseupoutside=function(a){this.self._onPointerRelease(a)};this.touchend=this.touchendoutside=function(a){this.self._onPointerRelease(a)};this.m_releaseCaller=a;this.m_releaseCallback=b};
SDisplayObjectContainer.prototype.addPressAndReleaseListener=function(a,b){this.interactive=!0;this.self=this;this.click=this.tap=function(a){this.self._onPointerPressAndRelease(a)};this.m_pressAndReleaseCaller=a;this.m_pressAndReleaseCallback=b};SDisplayObjectContainer.prototype.addPointerOverListener=function(a,b){this.interactive=!0;this.self=this;this.mouseover=function(a){this.self._onPointerOver(a)};this.m_pointerOverCaller=a;this.m_pointerOverCallback=b};
SDisplayObjectContainer.prototype.addPointerMoveListener=function(a,b){this.interactive=!0;this.self=this;this.mousemove=this.touchmove=function(a){this.self.onPointerMove(a)};this.m_pointerMoveCaller=a;this.m_pointerMoveCallback=b};SDisplayObjectContainer.prototype._onPointerPress=function(a){null!==this.m_pressCaller&&null!==this.m_pressCallback&&this.m_pressCallback.call(this.m_pressCaller,a)};
SDisplayObjectContainer.prototype._onPointerRelease=function(a){null!==this.m_releaseCaller&&null!==this.m_releaseCallback&&this.m_releaseCallback.call(this.m_releaseCaller,a)};SDisplayObjectContainer.prototype._onPointerPressAndRelease=function(a){null!==this.m_pressAndReleaseCaller&&null!==this.m_pressAndReleaseCallback&&this.m_pressAndReleaseCallback.call(this.m_pressAndReleaseCaller,a)};
SDisplayObjectContainer.prototype._onPointerOver=function(a){null!==this.m_pointerOverCaller&&null!==this.m_pointerOverCallback&&this.m_pointerOverCallback.call(this.m_pointerOverCaller,a)};SDisplayObjectContainer.prototype.onPointerMove=function(a){null!==this.m_pointerMoveCaller&&null!==this.m_pointerMoveCallback&&this.m_pointerMoveCallback.call(this.m_pointerMoveCaller,a)};
SDisplayObjectContainer.prototype.hitTestPoint=function(a,b){var c=this.getCollision("mcCollision");return null!=c?(a=new PIXI.Point(a,b),this.worldTransform.applyInverse(a,a),c.contains(a.x,a.y)):!1};
SDisplayObjectContainer.prototype.hitTest=function(a){var b=this.getCollision("mcCollision"),c=a.getCollision("mcCollision");return b&&c?(1===this.worldTransform.a&&0===this.worldTransform.b&&this.displayObjectUpdateTransform(),1===a.worldTransform.a&&0===a.worldTransform.b&&a.displayObjectUpdateTransform(),SATCollisionDetector.calculatePolyPolyIntersection(SDisplayObjectContainer.getCoordinatesMatrix(this.worldTransform,b.x,b.y,b.w,b.h),SDisplayObjectContainer.getCoordinatesMatrix(a.worldTransform,
c.x,c.y,c.w,c.h))):!1};SDisplayObjectContainer.hitTestByBounds=function(a,b,c,d){return a&&b&&c&&d?(1===a.worldTransform.a&&0===a.worldTransform.b&&a.displayObjectUpdateTransform(),1===c.worldTransform.a&&0===c.worldTransform.b&&c.displayObjectUpdateTransform(),SATCollisionDetector.calculatePolyPolyIntersection(SDisplayObjectContainer.getCoordinatesMatrix(a.worldTransform,b.x,b.y,b.w,b.h),SDisplayObjectContainer.getCoordinatesMatrix(c.worldTransform,d.x,d.y,d.w,d.h))):!1};
SDisplayObjectContainer.getCoordinatesMatrix=function(a,b,c,d,e){var f=[];f.push([b,c]);f.push([b+d,c]);f.push([b+d,c+e]);f.push([b,c+e]);for(d=0;d<f.length;d++)b=f[d][0],c=f[d][1],f[d][0]=a.a*b+a.c*c+a.tx,f[d][1]=a.b*b+a.d*c+a.ty;return f};function SSprite(a,b,c){a=(this.name=a||"")?window.PIXI.Texture.fromImage(a,b,c):window.PIXI.Texture.EMPTY;this.isSprite=!0;PIXI.Sprite.call(this,a);a||this.addChild(Application.instance.getErrorSprite())}Application.subclass(SSprite,PIXI.Sprite);
SSprite.prototype.setPosition=function(a,b){this.position.x=a;this.position.y=b};SSprite.prototype.setScale=function(a,b){this.scale.x=a;this.scale.y=b||a};SSprite.prototype.addChild=function(a){a.collisionView=this.collisionView;a.collisionView&&a.showCollision&&a.showCollision();return PIXI.Sprite.prototype.addChild.call(this,a)};
function SPixiText(a,b){this.collisionsClips=[];this.debugRect=null;PIXI.Text.call(this,a,b);Application.RIGHT_TO_LEFT&&(this.rtl=!0,this.canvas.setAttribute("dir","rtl"),this.canvas.style.top="-1000px",this.canvas.style.left="-1000px",this.canvas.style.position="absolute",this.canvas.style.opacity=0,document.body.appendChild(this.canvas))}Application.subclass(SPixiText,PIXI.Text);SPixiText.prototype.toggleCollision=function(){PIXI.Container.prototype.toggleCollision.call(this);this.showCollision()};
SPixiText.prototype.showCollision=function(){for(;0<this.collisionsClips.length;)this.removeChild(this.collisionsClips[0]),this.collisionsClips[0].free(),this.collisionsClips[0]=null,this.collisionsClips.splice(0,1);if(this.collisionView){var a=new SGraphics;a.drawRectangle(this.debugRect.x-this.position.x,this.debugRect.y-this.position.y,this.debugRect.w,this.debugRect.h,1,16776960,268431616,1,.1);this.collisionsClips.push(a);this.addChild(a)}};
SPixiText.prototype.free=function(){Application.RIGHT_TO_LEFT&&document.body.removeChild(this.canvas);this.context.dispose&&this.context.dispose();this.canvas.dispose&&this.canvas.dispose();this.destroy(!0);this.debugRect=this.collisionsClips=null};function SGraphics(){PIXI.Graphics.call(this)}Application.subclass(SGraphics,PIXI.Graphics);SGraphics.prototype.free=function(){PIXI.Graphics.prototype.destroy.call(this)};
SGraphics.prototype.drawLine=function(a,b,c,d,e,f,g){this.lineStyle("undefined"===typeof f?1:f,"undefined"===typeof e?Common.COLOR_BLACK:e,"undefined"===typeof g?1:g);this.moveTo(a,b);this.lineTo(c,d)};SGraphics.prototype.drawRectangle=function(a,b,c,d,e,f,g,h,k){"undefined"===typeof g?this.fillColor=void 0:this.beginFill(g,"undefined"===typeof k?1:k);this.lineStyle("undefined"===typeof e?1:e,"undefined"===typeof f?Common.COLOR_BLACK:f,"undefined"===typeof h?1:h);this.drawRect(a,b,c,d);this.endFill()};
SGraphics.prototype.drawPoly=function(a,b,c,d,e,f){"undefined"===typeof d?this.fillColor=void 0:this.beginFill(d,"undefined"===typeof f?1:f);this.lineStyle("undefined"===typeof b?1:b,"undefined"===typeof c?Common.COLOR_BLACK:c,"undefined"===typeof e?1:e);this.drawPolygon(a);this.endFill()};
SGraphics.prototype.drawCircle=function(a,b,c,d,e,f,g,h){"undefined"===typeof f?this.fillColor=void 0:this.beginFill(f,"undefined"===typeof h?1:h);this.lineStyle(d,e,g);PIXI.Graphics.prototype.drawCircle.call(this,a,b,c);this.endFill()};
SGraphics.prototype.drawEllipse=function(a,b,c,d,e,f,g,h,k){"undefined"===typeof g?this.fillColor=void 0:this.beginFill(g,"undefined"===typeof k?1:k);this.lineStyle("undefined"===typeof e?1:e,"undefined"===typeof f?Common.COLOR_BLACK:f,"undefined"===typeof h?1:h);PIXI.Graphics.prototype.drawEllipse.call(this,a,b,c,d);this.endFill()};
SGraphics.prototype.drawCross=function(a,b,c,d,e,f){this.lineStyle("undefined"===typeof e?1:e,"undefined"===typeof d?Common.COLOR_BLACK:d,"undefined"===typeof f?1:f);this.moveTo(a-c,b-c);this.lineTo(a+c,b+c);this.moveTo(a-c,b+c);this.lineTo(a+c,b-c)};
SGraphics.prototype.drawArrow=function(a,b,c,d,e,f,g,h,k,m){"undefined"===typeof e&&(e=5);"undefined"===typeof h?this.fillColor=void 0:this.beginFill(h,"undefined"===typeof m?1:m);this.lineStyle("undefined"===typeof f?1:f,"undefined"===typeof g?Common.COLOR_BLACK:g,"undefined"===typeof k?1:k);this.moveTo(a,b);this.lineTo(c,d);a=new SVector3(c-a,d-b);a.normalize();this.lineTo(c-e*(a.x+a.y),d-e*(a.y-a.x));this.moveTo(c,d);this.lineTo(c-e*(a.x-a.y),d-e*(a.y+a.x))};
function Animation(a){SDisplayObjectContainer.call(this);this.m_interpolations=[];this.m_endedInterpolations=[];this.m_layerNames={};this.screenLinked=null;this.screenActionStop=0;this.atlas=[];this.dataLayers=[];this.params=null;this.name=a;this.loop=!0;this.data=null;null!=this.name&&0<this.name.length&&(this.data=window.globalAnimations[this.name]);this.data?(this.params=this.data.params,this.atlas=this.data.atlas,this.dataLayers=this.data.l):(Application.error("Animation :: clip with name ["+
this.name+"] no found, check Asset(Animo Json) is register or loaded"),this.addChild(Application.instance.getErrorSprite()));this.atlas||Application.error("Animation: invalid atlas for "+this.name);this.indexFrames={};this.indexActions={};this.displayLayers=[];this.createLayers();this.totalFrames=this.m_maxdt=this.m_changeTime=this.m_changeTimeCounter=0;this.data&&(this.m_changeTime=1/parseInt(this.data[Animation.FPS],10)*1E3,this.m_maxdt=Math.floor(this.m_changeTime),this.totalFrames=parseInt(this.data[Animation.FRAMES],
10));this.m_endAniFunction=this.m_endAniCaller=null;this.m_stopped=!1;this.m_delay=0;this.dilation=1;this.currentFrame=this.m_currentVisibleFrame=-1;this.setFrame(0)}Application.subclass(Animation,SDisplayObjectContainer);Animation.POS_X="x";Animation.POS_Y="y";Animation.ASSET="a";Animation.ASSET_LIST="i";Animation.ASSET_ID="k";Animation.CENTER_X="u";Animation.CENTER_Y="v";Animation.SCALE_X="w";Animation.SCALE_Y="h";Animation.ANGLE="g";Animation.ALPHA="t";Animation.COLLISION="c";
Animation.INSTANCE_NAME="o";Animation.BLEND_MODE="b";Animation.EMBEDDED_CLIP="e";Animation.NAME="n";Animation.FPS="r";Animation.LAYER="l";Animation.FRAMES="f";Animation.FRAMES_ACTIONS="fa";Animation.ACTIONS="a";Animation.FRAME="n";Animation.STARTING_FRAME="f";Animation.INTERPOLATE="p";Animation.CLIP="clip";Animation.prototype.clearAll=function(){for(var a=0;a<this.displayLayers.length;a++)null!=this.displayLayers[a]&&(this.displayLayers[a].free(),this.displayLayers[a]=null);this.displayLayers=[]};
Animation.prototype.free=function(){this.m_layerNames=null;for(var a=0;a<this.displayLayers.length;a++)null!=this.displayLayers[a]&&(this.displayLayers[a].free(),this.displayLayers[a]=null);this.hitArea=this.data=this.params=this.dataLayers=this.atlas=this.screenLinked=this.m_endAniFunction=this.m_endAniCaller=this.indexActions=this.indexFrames=this.displayLayers=null;if(this.m_interpolations)for(a=this.m_interpolations.length-1;0<=a;--a)this.m_interpolations[a]&&(this.m_interpolations[a].free(),
this.m_interpolations[a]=null);this.m_endedInterpolations=this.m_interpolations=null;SDisplayObjectContainer.prototype.free.call(this)};Animation.prototype.setTint=function(a){this.tint=a;for(var b=0;b<this.displayLayers.length;b++)this.displayLayers[b]&&this.displayLayers[b].setTint(a)};Animation.prototype.getLayer=function(a){return this.m_layerNames[a]||null};Animation.prototype.showLayerName=function(a,b){a=this.getLayer(a);null!=a&&a.setVisible(b)};
Animation.prototype.stop=function(){this.m_stopped=!0};Animation.prototype.resume=function(){this.m_stopped=!1};Animation.prototype.gotoAndStop=function(a){0>=this.totalFrames||(0>=a&&(a=1),a>this.totalFrames&&(a=this.totalFrames),this.m_changeTimeCounter=0,this.setFrameStatic(a-1),this.stop())};Animation.prototype.gotoAndPlay=function(a){0>=this.totalFrames||(0>=a&&(a=1),a>this.totalFrames&&(a=this.totalFrames),this.m_changeTimeCounter=0,this.setFrameStatic(a-1),this.resume())};
Animation.prototype.startDelay=function(a){0<a&&(this.m_delay=a)};Animation.prototype.onEndAnimation=function(a,b){this.m_endAniCaller=a;this.m_endAniFunction=b};
Animation.prototype.update=function(a){if(!(this.m_stopped||1>=this.totalFrames)){if(0<this.m_delay){this.m_delay-=a;if(0<=this.m_delay)return;a=-this.m_delay;this.m_delay=0}a=Math.min(a,this.m_maxdt);a/=this.dilation;for(var b=0;b<this.m_interpolations.length;++b)this.m_interpolations[b]&&this.m_interpolations[b].update(a)&&this.m_endedInterpolations.push(b);if(this.m_endedInterpolations)for(;0<this.m_endedInterpolations.length;)b=this.m_endedInterpolations.pop(),this.m_interpolations[b].free(),
this.m_interpolations[b]=null;for(b=0;b<this.displayLayers.length;b++)null!==this.displayLayers[b]&&this.displayLayers[b].update(a);this.m_changeTimeCounter+=a;this.m_changeTimeCounter>=this.m_changeTime&&(this.m_changeTimeCounter-=this.m_changeTime,this.currentFrame++,this.currentFrame>=this.totalFrames&&(this.currentFrame=0),this.setFrame(this.currentFrame),null!=this.data&&this.currentFrame>=this.totalFrames-1&&(this.loop||(this.m_stopped=!0),null!=this.m_endAniCaller&&null!=this.m_endAniFunction&&
this.m_endAniFunction.call(this.m_endAniCaller,this)))}};
Animation.prototype.setFrame=function(a){this.currentFrame=a;if(this.m_currentVisibleFrame!=this.currentFrame){this.m_currentVisibleFrame=this.currentFrame;var b;for(b=0;b<this.dataLayers.length;b++)"undefined"===typeof this.indexFrames[""+b]||this.m_interpolations[b]||this.setSprite(b,Animation.binarySearch(this.indexFrames[""+b],a));if(this.indexActions["act_"+a]){a=this.indexActions["act_"+a];var c=a.length;for(b=0;b<c;b++)if(AnimationActions.applyAction(this,a[b]),null==this.indexActions){b+1<
c&&Application.error("Animation:: There are still actions to be performed, but the current animation is just deleted.");break}}}};
Animation.prototype.setFrameStatic=function(a){this.currentFrame=a;if(this.m_currentVisibleFrame!=this.currentFrame){this.m_currentVisibleFrame=this.currentFrame;var b;for(b=0;b<this.dataLayers.length;b++)if(this.m_interpolations[b]&&(this.m_interpolations[b].free(),this.m_interpolations[b]=null),"undefined"!==typeof this.indexFrames[""+b]){var c=Animation.binarySearch(this.indexFrames[""+b],a);this.setSprite(b,c);this.m_interpolations[b]&&(this.m_interpolations[b].m_time=1E3*(a-c[Animation.FRAME])/
this.data[Animation.FPS],this.m_interpolations[b].update(0))}if(this.indexActions["act_"+a])for(a=this.indexActions["act_"+a],c=a.length,b=0;b<c;b++)if(AnimationActions.applyAction(this,a[b]),null==this.indexActions){b+1<c&&Application.error("Animation:: There are still actions to be performed, but the current animation is just deleted.");break}}};
Animation.prototype.createLayers=function(){for(var a,b=0;b<this.dataLayers.length;b++)if(this.dataLayers[b][Animation.FRAMES]){this.indexFrames[""+b]=[];for(a=0;a<this.dataLayers[b][Animation.FRAMES].length;a++)this.indexFrames[""+b].push(this.dataLayers[b][Animation.FRAMES][a]);this.displayLayers.push(null);this.m_layerNames[this.dataLayers[b][Animation.NAME]]=null}else if(this.dataLayers[b][Animation.FRAMES_ACTIONS])for(a=0;a<this.dataLayers[b][Animation.FRAMES_ACTIONS].length;a++)this.parseActions(this.dataLayers[b][Animation.FRAMES_ACTIONS][a][Animation.FRAME],
this.dataLayers[b][Animation.FRAMES_ACTIONS][a])};Animation.prototype.parseActions=function(a,b){var c="act_"+a;this.indexActions[c]||(this.indexActions[c]=[]);b=Common.trim(b[Animation.ACTIONS]).split(";");for(var d=0;d<b.length;d++){var e=b[d].split(":"),f=new AnimationActions;f.name=Common.trim(e[0].toLowerCase());1<e.length&&(f.params=Common.trim(e[1]));f.name===AnimationActions.ACT_STOP_GUI&&(this.screenActionStop=a);this.indexActions[c].push(f)}};
Animation.prototype.hasInstance=function(a){return"undefined"!==typeof this[a]};Animation.prototype.getInstance=function(a){return"undefined"===typeof this[a]?(Application.error("Instance ["+a+"] no found in clip ("+this.name+")"),null):this[a]};Animation.prototype.getInstanceNotException=function(a){return"undefined"===typeof this[a]?null:this[a]};
Animation.prototype.setSprite=function(a,b){this.m_interpolations[a]&&(this.m_interpolations[a].free(),this.m_interpolations[a]=null);b[Animation.POS_X]=b[Animation.POS_X]||0;b[Animation.POS_Y]=b[Animation.POS_Y]||0;b[Animation.ANGLE]=b[Animation.ANGLE]||0;b[Animation.CENTER_X]=b[Animation.CENTER_X]||0;b[Animation.CENTER_Y]=b[Animation.CENTER_Y]||0;"undefined"===typeof b[Animation.SCALE_X]&&(b[Animation.SCALE_X]=1);"undefined"===typeof b[Animation.SCALE_Y]&&(b[Animation.SCALE_Y]=1);"undefined"===
typeof b[Animation.ALPHA]&&(b[Animation.ALPHA]=1);if(1===b[Animation.COLLISION]&&b[Animation.INSTANCE_NAME]&&1<b.w&&1<b.h){var c=new Rectangle(b[Animation.POS_X],b[Animation.POS_Y],b[Animation.SCALE_X]/Application.DPI,b[Animation.SCALE_Y]/Application.DPI);this.addCollision(b[Animation.INSTANCE_NAME],c);"mcCollision"===b[Animation.INSTANCE_NAME]&&(null==this.hitArea?this.hitArea=new PIXI.Rectangle(c.x,c.y,c.w,c.h):(this.hitArea.x=c.x,this.hitArea.y=c.y,this.hitArea.width=c.w,this.hitArea.height=c.h))}if(this.dataLayers[a][Animation.EMBEDDED_CLIP]){if(-1===
b[Animation.ASSET_ID]||-1===b[Animation.ASSET_LIST]){null!=this.displayLayers[a]&&this.displayLayers[a].clear();return}Application.assert("undefined"!==typeof b[Animation.CLIP],"Animation "+this.name+" uses clips and textures in the same layer!");c=b[Animation.CLIP];var d=b[Animation.STARTING_FRAME]?b[Animation.STARTING_FRAME]:1;null===this.displayLayers[a]?(this.displayLayers[a]=new AnimationClipLayer(this,c,d),this.displayLayers[a].setBlendMode(this.dataLayers[a][Animation.BLEND_MODE]||0),this.m_layerNames[this.dataLayers[a][Animation.NAME]]=
this.displayLayers[a]):this.displayLayers[a].setClip(c,d)}else null===this.displayLayers[a]&&(this.displayLayers[a]=new AnimationSpriteLayer(this),this.displayLayers[a].setBlendMode(this.dataLayers[a][Animation.BLEND_MODE]||0),this.m_layerNames[this.dataLayers[a][Animation.NAME]]=this.displayLayers[a]),-1===b[Animation.ASSET_ID]||-1===b[Animation.ASSET_LIST]?this.displayLayers[a].clear():(b[Animation.ASSET_LIST]=b[Animation.ASSET_LIST]||0,this.displayLayers[a].setTexture(this.atlas[b[Animation.ASSET_LIST]]+
"_"+b[Animation.ASSET_ID]));this.displayLayers[a].updateParams(b);b[Animation.INTERPOLATE]&&0!==b[Animation.INTERPOLATE]&&(c=Animation.binarySearch(this.indexFrames[""+a],b[Animation.INTERPOLATE]),c[Animation.POS_X]=c[Animation.POS_X]||0,c[Animation.POS_Y]=c[Animation.POS_Y]||0,c[Animation.CENTER_X]=c[Animation.CENTER_X]||0,c[Animation.CENTER_Y]=c[Animation.CENTER_Y]||0,c[Animation.ANGLE]=c[Animation.ANGLE]||0,"undefined"===typeof c[Animation.SCALE_X]&&(c[Animation.SCALE_X]=1),"undefined"===typeof c[Animation.SCALE_Y]&&
(c[Animation.SCALE_Y]=1),"undefined"===typeof c[Animation.ALPHA]&&(c[Animation.ALPHA]=1),this.m_interpolations[a]=new Interpolation(this.displayLayers[a],!0,b,c,1E3*(c[Animation.FRAME]-b[Animation.FRAME])/this.data[Animation.FPS]),this.m_interpolations[a].m_time=this.m_changeTimeCounter);this.displayLayers[a]instanceof AnimationSpriteLayer&&b[Animation.INSTANCE_NAME]&&""!==b[Animation.INSTANCE_NAME]&&(this.displayLayers[a].getSprite().name=b[Animation.INSTANCE_NAME],this[b[Animation.INSTANCE_NAME]]=
this.displayLayers[a].getSprite())};Animation.binarySearch=function(a,b){var c=0,d=a.length-1;if(!d)return a[0];for(var e=d>>>1;;){a[e+1][Animation.FRAME]<=b?c=e+1:d=e;if(c==d)return a[c];e=c+d>>>1}};function AnimationLayer(a){this.m_animation=a;this.m_visible=!0}AnimationLayer.prototype.free=function(){};AnimationLayer.prototype.update=function(a){};AnimationLayer.prototype.clear=function(){};AnimationLayer.prototype.setTint=function(a){};AnimationLayer.prototype.setBlendMode=function(a){};
AnimationLayer.prototype.visible=function(){return this.m_visible};AnimationLayer.prototype.setVisible=function(a){this.m_visible=a};AnimationLayer.prototype.updateParams=function(a){};AnimationLayer.prototype.setParams=function(a,b,c,d,e,f){};function AnimationSpriteLayer(a,b){AnimationLayer.call(this,a);this.m_sprite=new SSprite(b);this.m_animation.addChild(this.m_sprite)}Application.subclass(AnimationSpriteLayer,AnimationLayer);
AnimationSpriteLayer.prototype.free=function(){this.m_animation.removeChild(this.m_sprite);this.m_sprite.free();this.m_sprite=null};AnimationSpriteLayer.prototype.getSprite=function(){return this.m_sprite};AnimationSpriteLayer.prototype.clear=function(){this.m_sprite.texture=PIXI.Texture.EMPTY};AnimationSpriteLayer.prototype.setTint=function(a){this.m_sprite.tint=a};AnimationSpriteLayer.prototype.setVisible=function(a){AnimationLayer.prototype.setVisible.call(this,a);this.m_sprite.visible=a};
AnimationSpriteLayer.prototype.setBlendMode=function(a){this.m_sprite.blendMode=a};AnimationSpriteLayer.prototype.setTexture=function(a){this.m_sprite.texture=PIXI.Texture.fromImage(a,!1,0)};AnimationSpriteLayer.prototype.updateParams=function(a){this.m_sprite.setPosition(a[Animation.POS_X],a[Animation.POS_Y]);this.m_sprite.rotation=a[Animation.ANGLE]*Math.PI/180;this.m_sprite.scale.x=a[Animation.SCALE_X];this.m_sprite.scale.y=a[Animation.SCALE_Y];this.m_sprite.alpha=a[Animation.ALPHA]};
AnimationSpriteLayer.prototype.setParams=function(a,b,c,d,e,f){this.m_sprite.position.x=a;this.m_sprite.position.y=b;this.m_sprite.scale.x=c;this.m_sprite.scale.y=d;this.m_sprite.rotation=.017453292519943295*e;this.m_sprite.alpha=f};
function AnimationClipLayer(a,b,c){AnimationLayer.call(this,a);this.m_clipName=b;this.m_clip=Application.instance.getAnimation(this.m_clipName);this.m_clip.gotoAndPlay(c);this.m_canvas=Application.instance.addDisplayContainer();this.m_canvas.addChild(this.m_clip);this.m_animation.addChild(this.m_canvas)}Application.subclass(AnimationClipLayer,AnimationLayer);AnimationClipLayer.prototype.free=function(){this.m_clip&&(this.m_clip.free(),this.m_clip=null);this.m_canvas.free();this.m_canvas=null};
AnimationClipLayer.prototype.update=function(a){this.m_clip&&this.m_clip.update(a)};AnimationClipLayer.prototype.clear=function(){this.m_clip&&(this.m_clip.free(),this.m_clip=null);this.m_clipName=""};AnimationClipLayer.prototype.setTint=function(a){};AnimationClipLayer.prototype.setBlendMode=function(a){};AnimationClipLayer.prototype.setVisible=function(a){AnimationLayer.prototype.setVisible.call(this,a);this.m_clip&&(this.m_clip.visible=this.m_visible)};
AnimationClipLayer.prototype.setClip=function(a,b){this.m_clipName!==a&&(this.m_clipName=a,this.m_clip&&this.m_clip.free(),this.m_clip=Application.instance.getAnimation(this.m_clipName),this.m_clip.visible=this.m_visible,this.m_clip.gotoAndPlay(b),this.m_canvas.addChild(this.m_clip))};
AnimationClipLayer.prototype.updateParams=function(a){this.m_clip&&(this.m_clip.setPosition(a[Animation.POS_X],a[Animation.POS_Y]),this.m_clip.rotation=a[Animation.ANGLE]*Math.PI/180,this.m_clip.scale.x=a[Animation.SCALE_X]/Application.DPI,this.m_clip.scale.y=a[Animation.SCALE_Y]/Application.DPI,this.m_clip.alpha=a[Animation.ALPHA])};
AnimationClipLayer.prototype.setParams=function(a,b,c,d,e,f){this.m_clip&&(this.m_clip.setPosition(a,b),this.m_clip.setScale(c,d),this.m_clip.rotation=.017453292519943295*e,this.m_clip.alpha=f)};function AnimationActions(){this.params=this.name=""}AnimationActions.ACT_STOP="s";AnimationActions.ACT_STOP_GUI="sg";AnimationActions.ACT_FINISH_GUI="fg";AnimationActions.ACT_PLAY="p";AnimationActions.ACT_PLAY_SOUND="ps";AnimationActions.ACT_GO_TO_AND_PLAY="gp";AnimationActions.ACT_GO_TO_AND_STOP="gs";
AnimationActions.ACT_GO_TO_RANDOM_AND_STOP="rs";AnimationActions.ACT_GO_TO_RANDOM_AND_PLAY="rp";AnimationActions.ACT_CREATE_FX="fx";AnimationActions.ACT_CALL_FUNCTION="f";AnimationActions.ACT_DELAY="d";
AnimationActions.applyAction=function(a,b){switch(b.name){case AnimationActions.ACT_STOP:a.stop();if(a.screenLinked)a.screenLinked.onSimpleStopScreen();break;case AnimationActions.ACT_PLAY:a.resume();break;case AnimationActions.ACT_GO_TO_AND_PLAY:a.gotoAndPlay(parseInt(b.params,10));break;case AnimationActions.ACT_GO_TO_AND_STOP:a.gotoAndStop(parseInt(b.params,10));break;case AnimationActions.ACT_GO_TO_RANDOM_AND_STOP:var c=Common.randomInt(1,a.totalFrames);a.gotoAndStop(c);break;case AnimationActions.ACT_GO_TO_RANDOM_AND_PLAY:c=
b.params.split(",");c=parseInt(Common.getRandomFromArray(c),10);a.gotoAndPlay(c);break;case AnimationActions.ACT_PLAY_SOUND:Application.instance.playSound(Common.trim(b.params));break;case AnimationActions.ACT_CREATE_FX:b.params=b.params.replace(/\s/g,"");var d=b.params.split(",");c=d[0];b=1<d.length?parseInt(d[1],10):0;var e=2<d.length?parseInt(d[2],10):0;a=3<d.length?a.getLayer(d[3]).getSprite():a.screenLinked.canvas;Application.instance.effectManager.createEffect(c,b,e,a);break;case AnimationActions.ACT_CALL_FUNCTION:break;
case AnimationActions.ACT_STOP_GUI:if(a.screenLinked)a.screenLinked.onStopScreen();else a.stop();break;case AnimationActions.ACT_FINISH_GUI:if(a.screenLinked)a.screenLinked.onFinishScreen();else a.stop();break;case AnimationActions.ACT_DELAY:c=b.params.split(",");2==c.length?(b=Common.sparseInt(c[0],0),c=Common.sparseInt(c[1],0),a.startDelay(Common.randomInt(b,c))):Application.error("AnimationActions::applyAction() - ACT_DELAY: invalid format: "+b.params);break;default:Application.warn("Please define Action[ "+
b.name+" ] in animation")}};
function Interpolation(a,b,c,d,e){this.m_sprite=a;this.m_smooth=b;this.m_alpha=c[Animation.ALPHA];this.m_angle=c[Animation.ANGLE];this.m_scaleX=c[Animation.SCALE_X];this.m_scaleY=c[Animation.SCALE_Y];this.m_start=c;this.m_end=d;this.m_totalTime=e;this.m_time=0;this.m_x=c[Animation.POS_X];this.m_y=c[Animation.POS_Y];this.m_startCornerY=this.m_startCornerX=0;this.m_interpolateX=c[Animation.POS_X]!==d[Animation.POS_X];this.m_interpolateY=c[Animation.POS_Y]!==d[Animation.POS_Y];this.m_interpolateScaleX=
c[Animation.SCALE_X]!==d[Animation.SCALE_X];this.m_interpolateScaleY=c[Animation.SCALE_Y]!==d[Animation.SCALE_Y];this.m_interpolateAlpha=c[Animation.ALPHA]!==d[Animation.ALPHA];if(this.m_interpolateAngle=c[Animation.ANGLE]!==d[Animation.ANGLE])this.m_c1=new Vector2D(c[Animation.SCALE_X]*c[Animation.CENTER_X],c[Animation.SCALE_Y]*c[Animation.CENTER_Y]),this.m_c1.rotate(Math.PI*c[Animation.ANGLE]/180),a=new Vector2D(c[Animation.POS_X],c[Animation.POS_Y]),this.m_c1.add(a),this.m_c2=new Vector2D(d[Animation.SCALE_X]*
c[Animation.CENTER_X],d[Animation.SCALE_Y]*c[Animation.CENTER_Y]),this.m_c2.rotate(Math.PI*d[Animation.ANGLE]/180),a=new Vector2D(d[Animation.POS_X],d[Animation.POS_Y]),this.m_c2.add(a),this.m_c=new Vector2D}
Interpolation.prototype.update=function(a){var b=!1;this.m_time+=a;this.m_time>=this.m_totalTime&&(b=!0,this.m_time=this.m_totalTime);this.m_interpolateAlpha&&(this.m_alpha=this.interpolate(this.m_start[Animation.ALPHA],this.m_end[Animation.ALPHA],this.m_time));this.m_interpolateAngle&&(this.m_angle=this.interpolate(this.m_start[Animation.ANGLE],this.m_end[Animation.ANGLE],this.m_time));this.m_interpolateScaleX&&(this.m_scaleX=this.interpolate(this.m_start[Animation.SCALE_X],this.m_end[Animation.SCALE_X],
this.m_time));this.m_interpolateScaleY&&(this.m_scaleY=this.interpolate(this.m_start[Animation.SCALE_Y],this.m_end[Animation.SCALE_Y],this.m_time));if(this.m_interpolateAngle){var c=.017453292519943295*this.m_angle;this.m_c.x=this.interpolate(this.m_c1.x,this.m_c2.x,this.m_time);this.m_c.y=this.interpolate(this.m_c1.y,this.m_c2.y,this.m_time);var d=new Vector2D(this.m_scaleX*this.m_start[Animation.CENTER_X],this.m_scaleY*this.m_start[Animation.CENTER_Y]);d.rotate(c);var e=new Vector2D(this.m_scaleX*
this.m_startCornerX,this.m_scaleY*this.m_startCornerY);e.rotate(c);a=this.m_c.x-d.x-e.x;d=this.m_c.y-d.y-e.y}else{this.m_x=this.m_start[Animation.POS_X];this.m_interpolateX&&(this.m_x=this.interpolate(this.m_start[Animation.POS_X],this.m_end[Animation.POS_X],this.m_time));this.m_y=this.m_start[Animation.POS_Y];this.m_interpolateY&&(this.m_y=this.interpolate(this.m_start[Animation.POS_Y],this.m_end[Animation.POS_Y],this.m_time));var f=this.m_startCornerX,g=this.m_startCornerY;a=this.m_x;d=this.m_y;
0!==this.m_angle?(c=.017453292519943295*this.m_angle,e=Math.cos(c),c=Math.sin(c),1!==this.m_scaleX&&(f*=this.m_scaleX),1!==this.m_scaleY&&(g*=this.m_scaleY),a+=g*c-f*e,d+=-f*c-g*e):(1!==this.m_scaleX&&(f*=this.m_scaleX),1!==this.m_scaleY&&(g*=this.m_scaleY),a-=f,d-=g)}this.m_sprite.setParams(a,d,this.m_scaleX,this.m_scaleY,this.m_angle,this.m_alpha);return b};Interpolation.prototype.interpolate=function(a,b,c){return c*(b-a)/this.m_totalTime+a};
Interpolation.prototype.toString=function(){return"INTERPOLATION:   "+this.m_start+" to "+this.m_end};Interpolation.prototype.free=function(){this.m_sprite=this.m_c2=this.m_c1=this.m_c=this.m_end=this.m_start=null};
function SEffect(a,b,c,d,e,f){this.name=a;this.canvas=d;this.x=b;this.y=c;this.clip=null;this.params=f||{};this.m_isAwaitingDelete=!1;this.type=0;this.loops="undefined"!==typeof e?e:1;this.m_repeat=0;this.deleteAtTheEnd=!0;this.m_isPaused=!1;this.m_endCompleteCallback=this.m_endCompleteCaller=null}SEffect.TYPE_ANIMO=1;SEffect.TYPE_NANO=2;SEffect.TYPE_GUI=3;
SEffect.prototype.free=function(){null!=this.clip&&(this.clip.free(),this.clip=null);this.params=this.m_endCompleteCaller=this.m_endCompleteCallback=this.canvas=null};SEffect.prototype.create=function(){};SEffect.prototype.fix=function(a){null!=this.clip&&(this.clip.position.x=a.x,this.clip.position.y=a.y)};SEffect.prototype.setVisible=function(a){};SEffect.prototype.isPaused=function(){return this.m_isPaused};SEffect.prototype.setPaused=function(a){this.m_isPaused=a};
SEffect.prototype.setAwaitingDelete=function(a){(this.m_isAwaitingDelete=a)&&this.removeChildren()};SEffect.prototype.isAwaitingDelete=function(){return this.m_isAwaitingDelete};SEffect.prototype.removeChildren=function(){null!=this.canvas&&null!=this.clip&&this.canvas.removeChild(this.clip)};SEffect.prototype.onComplete=function(a,b){this.m_endCompleteCaller=a||null;this.m_endCompleteCallback=b||null};
SEffect.prototype.onEndLoop=function(){this.m_repeat++;0!=this.loops&&this.m_repeat>=this.loops&&(null!=this.m_endCompleteCallback&&null!=this.m_endCompleteCaller&&this.m_endCompleteCallback.call(this.m_endCompleteCaller,this),this.deleteAtTheEnd&&(this.m_isAwaitingDelete=!0))};SEffect.prototype.update=function(a){};
function NanoEffect(a,b,c,d,e){SEffect.call(this,a,b,c,d,1,e);this.data=window.nano.effects[a];this.emitters=[];this.emittersIndex={};this.emitterCanvas=[];if(null==this.canvas)this.m_isAwaitingDelete=!0;else for(a=0;a<this.data.length;a++)b=this.data[a].emitter,window.nano.emitters[b]?(c=Application.instance.addDisplayContainer(),this.canvas.addChild(c),this.emitterCanvas.push(c),b=new NanoEmitter(this,window.nano.emitters[b],c),b.ox=this.data[a].pos_x,b.oy=this.data[a].pos_y,b.name=this.data[a].emitter,
this.emittersIndex[this.data[a].emitter]=b,this.emitters.push(b)):Application.warn("Emiiter ["+b+"] no found")}Application.subclass(NanoEffect,SEffect);
NanoEffect.prototype.free=function(){if(this.emittersIndex){for(var a in this.emittersIndex)delete this.emittersIndex[a];this.emittersIndex=null}if(this.emitters){for(a=0;a<this.emitters.length;a++)this.emitters[a].free(),this.emitters[a]=null,this.canvas.removeChild(this.emitterCanvas[a]),this.emitterCanvas[a].free(),this.emitterCanvas[a]=null;this.emitters=null}this.data=this.emitterCanvas=null;SEffect.prototype.free.call(this)};
NanoEffect.prototype.setPaused=function(a){if(this.m_isPaused!=a){SEffect.prototype.setPaused.call(this,a);for(var b=0;b<this.emitters.length;b++)this.emitters[b].pause=a}};NanoEffect.prototype.setPauseEmitter=function(a){for(var b=0;b<this.emitters.length;b++)this.emitters[b].pause=a};NanoEffect.prototype.setStopAndRemove=function(a){for(var b=0;b<this.emitters.length;b++)this.emitters[b].stopAndRemove=a};
NanoEffect.prototype.setVisible=function(a){for(var b=0;b<this.emitterCanvas.length;b++)this.emitters[b].pause=!a,this.emitterCanvas[b].visible=a};NanoEffect.prototype.removeChildren=function(){SEffect.prototype.removeChildren.call(this);if(null!=this.emitterCanvas)for(var a=this.emitterCanvas.length-1;0<=a;--a)this.canvas.removeChild(this.emitterCanvas[a])};
NanoEffect.prototype.update=function(a){for(var b=0;b<this.emitters.length;b++)this.emitters[b]&&(this.emitters[b].update(a),this.emitters[b].isAwaitingDelete&&(delete this.emittersIndex[this.emitters[b].name],this.emitters[b].free(),this.emitters[b]=null,this.emitters.splice(b,1),this.canvas.removeChild(this.emitterCanvas[b]),this.emitterCanvas[b].free(),this.emitterCanvas[b]=null,this.emitterCanvas.splice(b,1),b--));0===this.emitters.length&&(this.m_isAwaitingDelete=!0)};
NanoEffect.random=function(a,b){return Math.random()*(b-a)+a};NanoEffect.randomInt=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};
function NanoEmitter(a,b,c){this.effect=a;this.data=b;this.data[NanoParticle.CLIP_ARRAY]=this.data[NanoParticle.CLIP].split(",");this.data[NanoParticle.TINT_ARRAY]=this.data[NanoParticle.TINT].split(",");this.canvas=c;this.frequency=b[NanoEmitter.FRECUENCY];this.delay=b[NanoEmitter.DELAY];this.particles=[];this.isAwaitingDelete=!1;this.oy=this.ox=this.counter=0;this.name="";this.state=NanoEmitter.ST_INTRO;this.stopAndRemove=this.pause=!1;this.callbackOnCreateParticle=this.callerOnCreateParticle=null}
NanoEmitter.ST_INTRO=1;NanoEmitter.ST_EMISSION=2;NanoEmitter.FRECUENCY="em_frequency";NanoEmitter.QUANTITY_MIN="em_quantity_min";NanoEmitter.QUANTITY_MAX="em_quantity_max";NanoEmitter.MAX_PARTICLES="em_max_particles";NanoEmitter.ANGLE_MIN="em_angle_min";NanoEmitter.ANGLE_MAX="em_angle_max";NanoEmitter.ROTATION_SPEED="em_rotation_speed";NanoEmitter.DISTRIBUTE="em_distribute";NanoEmitter.DELAY="em_delay";NanoEmitter.POS_X="pos_x";NanoEmitter.POS_Y="pos_y";
NanoEmitter.prototype.free=function(){for(var a=0;a<this.particles.length;a++)this.particles[a].free(),this.particles[a]=null;this.data=this.effect=this.canvas=this.particles=null};
NanoEmitter.prototype.createParticles=function(){if(!(this.pause||this.stopAndRemove||0!==this.data[NanoEmitter.MAX_PARTICLES]&&this.counter>=this.data[NanoEmitter.MAX_PARTICLES])){var a=NanoEffect.randomInt(this.data[NanoEmitter.QUANTITY_MIN],this.data[NanoEmitter.QUANTITY_MAX]),b;this.data[NanoEmitter.DISTRIBUTE]&&(b=1<a?(this.data[NanoEmitter.ANGLE_MAX]-this.data[NanoEmitter.ANGLE_MIN])/(a-1):this.data[NanoEmitter.ANGLE_MIN]);for(var c=[],d=0;d<a;d++){var e=this.data[NanoEmitter.DISTRIBUTE]?new NanoParticle(this,
this.data[NanoEmitter.ANGLE_MIN]+d*b):new NanoParticle(this,NanoEffect.random(this.data[NanoEmitter.ANGLE_MIN],this.data[NanoEmitter.ANGLE_MAX]));this.counter++;this.particles.push(e);c.push(e)}null!==this.callerOnCreateParticle&&null!==this.callbackOnCreateParticle&&this.callbackOnCreateParticle.call(this.callerOnCreateParticle,c)}};
NanoEmitter.prototype.update=function(a){switch(this.state){case NanoEmitter.ST_INTRO:0>=this.delay&&(this.createParticles(),this.state=NanoEmitter.ST_EMISSION);this.delay-=a;break;case NanoEmitter.ST_EMISSION:this.frequency-=a;0>=this.frequency&&(this.createParticles(),this.frequency=this.data[NanoEmitter.FRECUENCY]);for(var b=0;b<this.particles.length;b++)this.particles[b].update(a),this.particles[b].isAwaitingDelete&&(this.particles[b].free(),this.particles[b]=null,this.particles.splice(b,1),b--);
0<this.data[NanoEmitter.MAX_PARTICLES]&&this.counter>=this.data[NanoEmitter.MAX_PARTICLES]&&0===this.particles.length&&(this.isAwaitingDelete=!0);this.stopAndRemove&&0===this.particles.length&&(this.isAwaitingDelete=!0)}};
function NanoParticle(a,b){this.canvas=a.canvas;this.data=a.data;this.isAwaitingDelete=!1;this.time=0;this.clip=null;var c=Common.getRandomFromArray(this.data[NanoParticle.CLIP_ARRAY]);this.clip=window.PIXI.utils.TextureCache[c]?Application.instance.getSprite(c):Application.instance.getAnimation(Common.getRandomFromArray(this.data[NanoParticle.CLIP_ARRAY]));this.canvas&&this.canvas.transform?(this.canvas.addChild(this.clip),c=NanoEffect.random(this.data[NanoParticle.SCALE_MIN],this.data[NanoParticle.SCALE_MAX]),
c=this.clip.isSprite?c*Application.DPI:c,this.clip.scale.x=this.clip.scale.y=c,this.clip.position.x=a.effect.x+a.ox+NanoEffect.random(this.data[NanoParticle.X_MIN],this.data[NanoParticle.X_MAX]),this.clip.position.y=a.effect.y+a.oy+NanoEffect.random(this.data[NanoParticle.Y_MIN],this.data[NanoParticle.Y_MAX]),this.clip.rotation=NanoEffect.random(this.data[NanoParticle.ROTATION_MIN],this.data[NanoParticle.ROTATION_MAX]),this.clip.alpha=NanoEffect.random(this.data[NanoParticle.ALPHA_MIN],this.data[NanoParticle.ALPHA_MAX]),
this.timelife=NanoEffect.randomInt(this.data[NanoParticle.TIMELIFE_MIN],this.data[NanoParticle.TIMELIFE_MAX]),this.rotationSpeed=NanoEffect.random(this.data[NanoParticle.ROTATION_SPEED_MIN],this.data[NanoParticle.ROTATION_SPEED_MAX]),a=Common.getRandomFromArray(this.data[NanoParticle.TINT_ARRAY]),0<a&&(this.clip.tint=a),"undefined"!==typeof this.clip.blendMode&&(this.clip.blendMode=window.PIXI.BLEND_MODES[this.data[NanoParticle.BLEND]]),a=NanoEffect.random(this.data[NanoParticle.SPEED_MIN],this.data[NanoParticle.SPEED_MAX]),
this.ox=this.clip.position.x,this.oy=this.clip.position.y,this.vx=a*Math.cos(b),this.vy=a*Math.sin(b),0===this.data[NanoParticle.ROTATION_MIN]&&0===this.data[NanoParticle.ROTATION_MAX]&&(this.clip.rotation=b)):this.isAwaitingDelete=!0}NanoParticle.CLIP="pt_clip";NanoParticle.TINT="pt_tint";NanoParticle.CLIP_ARRAY="pt_clip_array";NanoParticle.TINT_ARRAY="pt_tint_array";NanoParticle.BLEND="pt_blend";NanoParticle.X_MIN="pt_x_min";NanoParticle.X_MAX="pt_x_max";NanoParticle.Y_MIN="pt_y_min";
NanoParticle.Y_MAX="pt_y_max";NanoParticle.SCALE_MIN="pt_scale_min";NanoParticle.SCALE_MAX="pt_scale_max";NanoParticle.SCALE_SPEED="pt_scale_speed";NanoParticle.SPEED_MIN="pt_speed_min";NanoParticle.SPEED_MAX="pt_speed_max";NanoParticle.ACCELERATION_X="pt_acceleration_x";NanoParticle.ACCELERATION_Y="pt_acceleration_y";NanoParticle.TIMELIFE_MIN="pt_timelife_min";NanoParticle.TIMELIFE_MAX="pt_timelife_max";NanoParticle.ROTATION_MIN="pt_rotation_min";NanoParticle.ROTATION_MAX="pt_rotation_max";
NanoParticle.ROTATION_SPEED_MIN="pt_rotation_speed_min";NanoParticle.ROTATION_SPEED_MAX="pt_rotation_speed_max";NanoParticle.ALPHA_MIN="pt_alpha_min";NanoParticle.ALPHA_MAX="pt_alpha_max";NanoParticle.ALPHA_SPEED="pt_alpha_speed";
NanoParticle.prototype.update=function(a){this.time+=a;this.clip.update&&this.clip.update(a);this.clip.position.x=this.ox+this.vx*this.time+5E-4*this.data[NanoParticle.ACCELERATION_X]*this.time*this.time;this.clip.position.y=this.oy+this.vy*this.time+5E-4*this.data[NanoParticle.ACCELERATION_Y]*this.time*this.time;0!==this.rotationSpeed&&(this.clip.rotation+=.01*this.rotationSpeed*a);this.clip.scale.x+=.001*this.data[NanoParticle.SCALE_SPEED]*a;this.clip.scale.y+=.001*this.data[NanoParticle.SCALE_SPEED]*
a;this.clip.alpha+=.001*this.data[NanoParticle.ALPHA_SPEED]*a;1<this.clip.alpha&&(this.clip.alpha=1);0>=this.clip.alpha&&(this.isAwaitingDelete=!0);this.time>=this.timelife&&(this.isAwaitingDelete=!0)};NanoParticle.prototype.free=function(){this.clip&&this.clip.parent&&this.clip.parent.removeChild(this.clip);this.clip.free?this.clip.free():this.clip.destroy();this.data=this.canvas=this.clip=null};
function SJsonLoader(a){this.json=this.ajaxRequest=null;this.url=a;this.baseUrl=a.replace(/[^\/]*$/,"");this.m_errorFunction=this.m_errorCaller=this.m_loadFunction=this.m_loadCaller=null}SJsonLoader.REQ_READYSTATE_LOADING=3;SJsonLoader.REQ_READYSTATE_DONE=4;SJsonLoader.REQ_STATUS_OK=200;SJsonLoader.REQ_STATUS_FORBIDDEN=403;SJsonLoader.REQ_STATUS_NOTFOUND=404;SJsonLoader.prototype.addLoadedListener=function(a,b){this.m_loadCaller=a;this.m_loadFunction=b};
SJsonLoader.prototype.addErrorListener=function(a,b){this.m_errorCaller=a;this.m_errorFunction=b};SJsonLoader.prototype.load=function(){if(this.ajaxRequest=Common.ajaxRequest()){var a=this;this.ajaxRequest.onreadystatechange=function(){a.onJSONLoaded()};this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json");this.ajaxRequest.send(null)}else Application.error("Not found [ AJAX object ] in Browser")};
SJsonLoader.prototype.onJSONLoaded=function(){this.ajaxRequest.readyState===SJsonLoader.REQ_READYSTATE_DONE&&(this.ajaxRequest.status===SJsonLoader.REQ_STATUS_OK||-1===window.location.protocol.indexOf("http")?(this.json=JSON.parse(this.ajaxRequest.responseText),this.m_loadCaller&&this.m_loadFunction&&this.m_loadFunction.call(this.m_loadCaller,this)):this.m_erroCaller&&this.m_errorFunction&&this.m_errorFunction.call(this.m_erroCaller,this))};function SndManager(){this.callbackBug=this.m_muted=!1}
SndManager.instance=null;SndManager.prototype.loadSounds=function(a){};SndManager.prototype.removeSounds=function(a){};SndManager.prototype.isMuted=function(){return this.m_muted};SndManager.prototype.play=function(a){};SndManager.prototype.stop=function(a){};SndManager.prototype.pauseSound=function(a){};SndManager.prototype.pauseAll=function(){};SndManager.prototype.resumeAll=function(){};SndManager.prototype.stopAllSounds=function(){};
SndManager.prototype.toggleMute=function(){this.m_muted=!this.m_muted;Application.info("toggleMute: "+this.m_muted)};SndManager.prototype.stopAllMusics=function(){};SndManager.prototype.isPlayingSound=function(a){};SndManager.prototype.resumeSound=function(a){};SndManager.prototype.setVolumeById=function(a,b){};SndManager.prototype.setVolumeFactor=function(a,b){};
function SndManagerSimple(){SndManager.call(this);SndManager.instance=this;var a=window.config.sounds,b=Application.ASSETS_PATH+"media/sounds/";this.soundList={};this.soundPlaying=[];this.masterVolume=1;for(var c=0;c<a.length;++c){var d={};d.src=b+a[c].file+".ogg";d.id=a[c].id;d.loop=0===parseInt(a[c].loops,10)?!0:!1;d.volume=a[c].vol;this.soundList[a[c].id]=d}}Application.subclass(SndManagerSimple,SndManager);SndManagerSimple.MAX_CHANNELS=6;
SndManagerSimple.prototype.onSoundComplete=function(a){for(var b=a.target,c=0;c<this.soundPlaying.length;c++)if(this.soundPlaying[c]===b){this.soundPlaying.splice(c,1);break}a.target=null};
SndManagerSimple.prototype.play=function(a){if(!this.m_muted)if("undefined"===typeof this.soundList[a])Application.warn("[SndManagerSimple] sound with id ["+a+"] no found");else if(this.soundPlaying.length>=SndManagerSimple.MAX_CHANNELS)Application.warn("[SndManagerSimple] max channels admitted ["+a+"]");else{a=this.soundList[a];if(a.loop)for(var b=0;b<this.soundPlaying.length;b++)if(this.soundPlaying[b].id===a.id)return;b=document.createElement("audio");var c=this;b.addEventListener("ended",function(a){c.onSoundComplete(a)},
!1);b.src=a.src;b.id=a.id;b.preload="auto";b.load();b.volume=a.volume*this.masterVolume;b.loop=a.loop;b.play();this.soundPlaying.push(b)}};SndManagerSimple.prototype.stop=function(a){for(var b=this.soundPlaying.length-1;0<=b;--b)this.soundPlaying[b].id===a&&("undefined"!==typeof this.soundPlaying[b].dispose?this.soundPlaying[b].dispose():this.soundPlaying[b].pause(),this.soundPlaying[b]=null,this.soundPlaying.splice(b,1))};
SndManagerSimple.prototype.isPlayingSound=function(a){for(var b=this.soundPlaying.length-1;0<=b;--b)if(this.soundPlaying[b].id===a)return!0;return!1};SndManagerSimple.prototype.pauseSound=function(a){for(var b=this.soundPlaying.length-1;0<=b;--b)this.soundPlaying[b].id===a&&this.soundPlaying[b].pause()};SndManagerSimple.prototype.resumeSound=function(a){for(var b=this.soundPlaying.length-1;0<=b;--b)this.soundPlaying[b].id===a&&this.soundPlaying[b].play()};
SndManagerSimple.prototype.setMasterVolume=function(a){this.masterVolume=a;for(a=this.soundPlaying.length-1;0<=a;--a){var b=this.soundPlaying[a];b.volume*=this.masterVolume}};SndManagerSimple.prototype.pauseAll=function(){for(var a=this.soundPlaying.length-1;0<=a;--a)this.soundPlaying[a].pause()};SndManagerSimple.prototype.resumeAll=function(){if(!this.m_muted)for(var a=this.soundPlaying.length-1;0<=a;--a)this.soundPlaying[a].play()};
SndManagerSimple.prototype.stopAllSounds=function(){for(var a=this.soundPlaying.length-1;0<=a;a--)"undefined"!==typeof this.soundPlaying[a].dispose?this.soundPlaying[a].dispose():this.soundPlaying[a].pause(),this.soundPlaying[a]=null;this.soundPlaying=[]};
SndManagerSimple.prototype.stopAllMusics=function(){for(var a=this.soundPlaying.length-1;0<=a;a--)this.soundPlaying[a].loop&&("undefined"!==typeof this.soundPlaying[a].dispose?this.soundPlaying[a].dispose():this.soundPlaying[a].pause(),this.soundPlaying[a]=null,this.soundPlaying.splice(a,1))};SndManagerSimple.prototype.toggleMute=function(){SndManager.prototype.toggleMute.call(this);this.m_muted?this.pauseAll():this.resumeAll()};
SndManagerSimple.prototype.free=function(){this.stopAllSounds();for(var a in this.soundList)this.soundList[a]=null;this.soundPlaying=this.soundList=null};SndManagerSimple.prototype.setVolumeById=function(a,b){for(var c=this.soundPlaying.length-1;0<=c;c--)this.soundPlaying[c].id===a&&(this.soundPlaying[c].volume=b)};
SndManagerSimple.prototype.setVolumeFactor=function(a,b){for(var c=this.soundPlaying.length-1;0<=c;c--)this.soundPlaying[c].id===a&&(this.soundPlaying[c].volume=this.soundList[a].volume*b)};
function SndManagerIE(a){SndManager.call(this);SndManager.instance=this;window.SwitEntryPoint.infoBrowser.isIE||Application.error("Using SndManagerIE for no IE browsers");this.soundList={};this.callback=a;this.soundsTotal=this.soundsLoaded=0;this.soundsToLoad=null;window.soundManager.setup({url:"media/swf/",flashVersion:9,useHTML5Audio:!0,preferFlash:!0,useHighPerformance:!0,flashLoadTimeout:2E3,noSWFCache:!1,consoleOnly:!0,wmode:null,debugMode:!1,onready:this.onReady,ontimeout:function(){Application.instance.onErrorSndManagerIE()}})}
Application.subclass(SndManagerIE,SndManager);SndManagerIE.prototype.loadSounds=function(a){Application.info("[SndManagerIE - LOADING SOUNDS...] - "+a.length);var b=window.soundManager;if(b.ok()){this.soundsLoaded=0;this.soundsTotal=a.length;for(var c=Application.ASSETS_PATH+"media/sounds/",d=0;d<a.length;d++)this.soundList[a[d].id]=a[d],b.createSound({id:a[d].id,url:c+a[d].file+".mp3",autoLoad:!0,onload:SndManager.instance.onLoad})}else this.soundsToLoad=a};
SndManagerIE.prototype.removeSounds=function(a){for(var b=window.soundManager,c=0;c<a.length;c++)Application.warn("SndManagerIE > removing sound: "+a[c].id),this.soundList[a[c].id]=null,b.destroySound(a[c].id)};SndManagerIE.prototype.onReady=function(){var a=SndManager.instance;a.soundsToLoad&&(SndManager.instance.loadSounds(a.soundsToLoad),a.soundsToLoad=null)};
SndManagerIE.prototype.onLoad=function(a){var b=SndManager.instance;b.soundsLoaded++;Application.log("SndManagerIE.onLoad: ("+a+") - "+b.soundsLoaded+"/"+b.soundsTotal);if(null!=SLoaderScreen.instance)SLoaderScreen.instance.onFileLoaded()};SndManagerIE.prototype.play=function(a){if(!this.m_muted&&this.soundList[a]){var b=window.soundManager,c=this.soundList[a].loops;1!==c?(0===c&&(c=999999),0===b.sounds[a].instanceCount&&b.play(a,{volume:100*this.soundList[a].vol,loops:c})):b.play(a,{volume:100*this.soundList[a].vol})}};
SndManagerIE.prototype.stop=function(a){window.soundManager.stop(a)};SndManagerIE.prototype.pauseAll=function(){window.soundManager.pauseAll()};SndManagerIE.prototype.resumeAll=function(){this.m_muted||window.soundManager.resumeAll()};SndManagerIE.prototype.stopAllSounds=function(){window.soundManager.stopAll()};SndManagerIE.prototype.toggleMute=function(){SndManager.prototype.toggleMute.call(this);this.m_muted?window.soundManager.pauseAll():window.soundManager.resumeAll()};
SndManagerIE.prototype.stopAllMusics=function(){var a=window.soundManager,b;for(b=a.soundIDs.length-1;0<=b;b--){var c=a.sounds[a.soundIDs[b]];1===c.playState&&(c=c.id,0===this.soundList[c].loops&&window.soundManager.stop(c))}};SndManagerIE.prototype.isPlayingSound=function(a){return(a=window.soundManager.getSoundById(a))?1===a.playState:!1};SndManagerIE.prototype.resumeSound=function(a){(a=window.soundManager.getSoundById(a))&&a.resume()};
SndManagerIE.prototype.setVolumeById=function(a,b){(a=window.soundManager.getSoundById(a))&&1===a.playState&&a.setVolume(100*b)};SndManagerIE.prototype.setVolumeFactor=function(a,b){var c=window.soundManager.getSoundById(a);c&&1===c.playState&&c.setVolume(100*this.soundList[a].vol*b)};
function SndManagerWeb(a){SndManager.call(this);SndManager.instance=this;this.soundjs=window.createjs;this.soundList={};this.callback=a;a=window.SwitEntryPoint.infoBrowser.browserVersion;window.SwitEntryPoint.infoBrowser.isIE&&10>a&&Application.warn("Using SndManagerWeb for IE"+a);window.SwitEntryPoint.infoBrowser.iDevice&&6>window.SwitEntryPoint.infoBrowser.platformVersion&&(Application.warn("IOS < 6"),this.callbackBug=this.soundjs.HTMLAudioPlugin.enableIOS=!0);this.soundsTotal=this.soundsLoaded=
0;this.soundjs.Sound.alternateExtensions=["mp3"];this.soundjs.Sound.addEventListener("fileload",this.soundjs.proxy(this.onFileload,this));this.soundjs.Sound.addEventListener("fileerror",this.soundjs.proxy(this.onFileloadError,this));this.callbackBug&&this.callback()}Application.subclass(SndManagerWeb,SndManager);
SndManagerWeb.prototype.loadSounds=function(a){Application.info("SndManagerWeb::loadSounds() - "+a);Application.info("[SndManagerWeb - LOADING SOUNDS...] - "+a.length);this.soundsLoaded=0;this.soundsTotal=a.length;for(var b=Application.ASSETS_PATH+"media/sounds/",c=0;c<a.length;c++)this.soundList[a[c].id]=a[c],this.soundjs.Sound.registerSound({id:a[c].id,src:b+a[c].file+".ogg",data:a[c].instances})};
SndManagerWeb.prototype.removeSounds=function(a){for(var b=0;b<a.length;b++)Application.warn("SndManagerWeb > removing sound: "+a[b].id),this.soundList[a[b].id]=null,this.soundjs.Sound.removeSound(a[b].id)};SndManagerWeb.prototype.onFileload=function(a){this.soundsLoaded++;Application.info("SndManagerWeb preloading: "+a.id+" "+this.soundsLoaded+"/"+this.soundsTotal);if(!this.callbackBug&&SLoaderScreen.instance)SLoaderScreen.instance.onFileLoaded()};
SndManagerWeb.prototype.onFileloadError=function(a){Application.error("SndManagerWeb preloading error: "+a.id+" "+this.soundsLoaded+"/"+this.soundsTotal);Application.warn("SndManagerWeb::onFileloadError() - Forcing to continue the loader...");this.onFileload(a)};SndManagerWeb.prototype.onPlayComplete=function(a){this.play(a.target.switId)};
SndManagerWeb.prototype.play=function(a){if(!this.m_muted)if(!this.soundList[a])Application.warn("SndManagerWeb: sound with id ["+a+"] not found");else if(!this.soundjs.HTMLAudioPlugin.enableIOS||0!=this.soundList[a].ios){if(this.soundjs.HTMLAudioPlugin.enableIOS){var b=this.soundjs.Sound.play(a);b.addEventListener("complete",this.soundjs.proxy(this.onPlayComplete,this))}else b=this.soundjs.Sound.play(a,null,0,0,0===this.soundList[a].loops?999999:this.soundList[a].loops-1,this.soundList[a].vol);b.switId=
a}};SndManagerWeb.prototype.stop=function(a){for(var b=this.soundjs.Sound._instances,c=0;c<b.length;++c)b[c].switId===a&&b[c].stop()};SndManagerWeb.prototype.pauseSound=function(a){for(var b=this.soundjs.Sound._instances,c=0;c<b.length;++c)b[c].switId===a&&(b[c].paused=!0)};SndManagerWeb.prototype.resumeSound=function(a){for(var b=this.soundjs.Sound._instances,c=0;c<b.length;++c)b[c].switId===a&&(b[c].paused=!1)};
SndManagerWeb.prototype.setMasterVolume=function(a){try{this.soundjs.Sound.setVolume(a)}catch(b){Application.error("SndManagerWeb: "+b)}};SndManagerWeb.prototype.pauseAll=function(){for(var a=this.soundjs.Sound._instances,b=0;b<a.length;++b)a[b].paused=!0};SndManagerWeb.prototype.resumeAll=function(){if(!this.m_muted)for(var a=this.soundjs.Sound._instances,b=0;b<a.length;++b)a[b].paused=!1};SndManagerWeb.prototype.stopAllSounds=function(){this.soundjs.Sound.stop()};
SndManagerWeb.prototype.removeAllSounds=function(){this.soundjs.Sound.removeAllSounds();this.soundjs.Sound=null};SndManagerWeb.prototype.toggleMute=function(){SndManager.prototype.toggleMute.call(this);this.m_muted?this.soundjs.Sound.setMute(!0):this.soundjs.Sound.setMute(!1)};SndManagerWeb.prototype.stopAllMusics=function(){for(var a,b=this.soundjs.Sound._instances,c=0;c<b.length;++c)a=b[c].switId,0===this.soundList[a].loops&&b[c].stop(a)};
SndManagerWeb.prototype.isPlayingSound=function(a){for(var b=this.soundjs.Sound._instances,c=0;c<b.length;++c)if(b[c].switId===a)return b[c].playState===this.soundjs.Sound.PLAY_SUCCEEDED;return!1};SndManagerWeb.prototype.setVolumeById=function(a,b){for(var c=this.soundjs.Sound._instances,d=0;d<c.length;++d)c[d].switId===a&&c[d].playState===this.soundjs.Sound.PLAY_SUCCEEDED&&c[d].setVolume(b)};
SndManagerWeb.prototype.setVolumeFactor=function(a,b){for(var c=this.soundjs.Sound._instances,d=0;d<c.length;++d)c[d].switId===a&&c[d].playState===this.soundjs.Sound.PLAY_SUCCEEDED&&c[d].setVolume(this.soundList[a].vol*b)};function Actor(a,b,c){this.m_x="undefined"!==typeof b?b:0;this.m_y="undefined"!==typeof c?c:0;this.clip=Application.instance.getAnimation(a);this.clip.setPosition(this.m_x,this.m_y);DebugObject.call(this)}Application.subclass(Actor,DebugObject);
Actor.prototype.free=function(){this.clip.free();this.clip=null};Actor.prototype.setX=function(a){this.m_x=this.clip.x=a};Actor.prototype.setY=function(a){this.m_y=this.clip.y=a};Actor.prototype.setPosition=function(a,b){this.clip.x=a;this.clip.y=b;this.m_x=a;this.m_y=b};Actor.prototype.getX=function(){return this.m_x};Actor.prototype.getY=function(){return this.m_y};Actor.prototype.setScale=function(a){this.clip.scale.x=a;this.clip.scale.y=a};
Actor.prototype.setScaleX=function(a){this.clip.scale.x=a};Actor.prototype.setScaleY=function(a){this.clip.scale.y=a};Actor.prototype.setRotation=function(a){this.clip.rotation=a};Actor.prototype.onEndAnimation=function(a,b){if(null!=this.clip)this.clip.onEndAnimation(a,b)};Actor.prototype.onDebugDraw=function(a){};Actor.prototype.setClip=function(a){null!=this.clip&&this.clip.free();this.clip=Application.instance.getAnimation(a);this.clip.x=this.m_x;this.clip.y=this.m_y};
Actor.prototype.update=function(a){null!=this.clip&&(this.clip.x=this.m_x,this.clip.y=this.m_y,this.clip.update(a))};function Character(a,b,c){this.canvas=c;this.m_x=a||0;this.m_y=b||0;this.clip=null;this.states={};this.state=this.animation="";this.m_endAniFunction=this.m_endAniCaller=null;this.lastFrame=-1;this.functions={}}
Character.prototype.free=function(){this.clip&&(this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free(),this.clip=null);this.functions=this.m_endAniFunction=this.m_endAniCaller=this.states=this.canvas=null};Character.prototype.setX=function(a){this.m_x=a;this.clip&&(this.clip.position.x=this.m_x)};Character.prototype.setY=function(a){this.m_y=a;this.clip&&(this.clip.position.y=this.m_y)};Character.prototype.getX=function(){return this.m_x};Character.prototype.getY=function(){return this.m_y};
Character.prototype.onEndAnimation=function(a,b){this.m_endAniCaller=a;this.m_endAniFunction=b};Character.prototype._endAnimation=function(a){null!=this.m_endAniCaller&&null!=this.m_endAniFunction&&this.m_endAniFunction.call(this.m_endAniCaller,this.state)};Character.prototype.setPosition=function(a,b){this.m_x=a;this.m_y=b;this.clip&&(this.clip.position.x=this.m_x,this.clip.position.y=this.m_y)};
Character.prototype.addState=function(a,b,c){this.states[a]=b;c="undefined"!==typeof c?c:[];for(var d in this.functions)-1!=d.indexOf(a+"_")&&delete this.functions[d];for(b=0;b<c.length;b++)this.functions[a+"_"+c[b].frame]=c[b]};
Character.prototype.gotoState=function(a,b){b="undefined"!==typeof b?b:!0;this.states[a]?(this.state=a,null!=this.clip&&(null!=this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free()),this.clip=Application.instance.getAnimation(this.states[a]),this.clip.position.x=this.m_x,this.clip.position.y=this.m_y,this.clip.onEndAnimation(this,this._endAnimation),this.clip.loop=b,this.animation=this.states[a],this.canvas.addChild(this.clip),this.lastFrame=-1):Application.error("Character::gotoState() - State: ["+
a+"] is not registered")};Character.prototype.update=function(a){null!=this.clip&&(this.clip.update(a),this.lastFrame!==this.clip.currentFrame&&(this.lastFrame=this.clip.currentFrame,this.functions[this.state+"_"+this.clip.currentFrame]&&(a=this.functions[this.state+"_"+this.clip.currentFrame],a.callback.call(a.caller))))};function Layout(){}Layout.ALIGN_TOP_LEFT=0;Layout.ALIGN_TOP_CENTER=1;Layout.ALIGN_CENTER=2;Layout.scale=1;Layout.dpi=1;Layout.align=Layout.ALIGN_CENTER;Layout.resizeEnable=!0;
Layout.offsetX=0;Layout.offsetY=0;Layout.top=0;Layout.left=0;Layout.width=0;Layout.height=0;Layout.minAspectRatio=Application.APP_WIDTH/Application.APP_HEIGHT;Layout.maxAspectRatio=16/9;Layout.aspectRatio=Layout.minAspectRatio;Layout.supports3dTransform=window.WebKitCSSMatrix||window.MSCSSMatrix;
Layout.onResize=function(a,b){Layout.width=Math.floor(a);Layout.height=Math.floor(b);Layout.dpi=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI||1;Layout.scale=1;Layout.top=0;Layout.left=0;Layout.offsetX=0;Layout.offsetY=0;var c=a/Application.APP_WIDTH,d=b/Application.APP_HEIGHT;d<c?(Layout.scale=d,Layout.left=Math.floor((a-Application.APP_WIDTH*Layout.scale)/2)):d>c&&(Layout.scale=c,Layout.top=Math.floor((b-Application.APP_HEIGHT*Layout.scale)/2));Layout.aspectRatio=Math.min(Layout.maxAspectRatio,
Math.max(Layout.minAspectRatio,Layout.width/Layout.height));Application.WIDE_SCREEN?(d<c?(Layout.offsetX=Layout.left,Application.instance.renderer.resize(Math.ceil(a/Layout.scale),Application.APP_HEIGHT),Application.instance.canvas.position.x=Layout.offsetX/Layout.scale,Application.instance.canvas.position.y=0):(Layout.offsetY=Layout.top,Application.instance.renderer.resize(Application.APP_WIDTH,Math.ceil(b/Layout.scale)),Application.instance.canvas.position.x=0,Application.instance.canvas.position.y=
Layout.offsetY/Layout.scale),Application.log("posX: "+Application.instance.canvas.position.x),Application.log("posY: "+Application.instance.canvas.position.y),Application.instance.renderer.view.style.top="0px",Application.instance.renderer.view.style.left="0px",Application.instance.renderer.view.style["transform-origin"]="0px 0px",Application.instance.renderer.view.style.transform="scale("+Layout.scale+", "+Layout.scale+")",Layout.transform(Application.instance.renderer.view)):(Application.instance.canvas.scale.x=
Layout.scale,Application.instance.canvas.scale.y=Layout.scale,Application.instance.canvas.position.x=Layout.left,Application.instance.canvas.position.y=Layout.top,Application.log("Layout.left: "+Layout.left),Application.log("Layout.top: "+Layout.top),0!==Layout.left?Application.instance.renderer.resize(a-Layout.left,Layout.scale*Application.APP_HEIGHT):Application.instance.renderer.resize(Layout.scale*Application.APP_WIDTH,b-Layout.top));GuiGame.instance&&GuiGame.instance.fixGameScale()};
Layout.fixInteractionEvent=function(a){if(Application.WIDE_SCREEN){var b={data:{}};b.data.identifier="undefined"!==typeof a.data.identifier?a.data.identifier:0;b.data.originalEvent=a.data.originalEvent;b.data.target=a.data.target;b.data.global={};b.data.global.x=Math.floor(a.data.global.x-Application.instance.canvas.position.x);b.data.global.y=Math.floor(a.data.global.y-Application.instance.canvas.position.y);b.target=a.target;return b}return a};
Layout.position=function(a,b,c){if(a=document.getElementById(a))a.style.top=b+"px",a.style.left=c+"px"};
Layout.transform=function(a){a&&(a.style.transformOrigin="0 0",a.style.transform="scale("+Layout.scale+", "+Layout.scale+")",a.style.webkitTransformOrigin="0 0",a.style.webkitTransform="scale("+Layout.scale+", "+Layout.scale+")",a.style.OTransformOrigin="0 0",a.style.OTransform="scale("+Layout.scale+", "+Layout.scale+")",window.SwitEntryPoint.infoBrowser.isIE&&(a.style.msTransformOrigin=window.config.settings.RIGHT_TO_LEFT?"100% 0%":"0 0",a.style.msTransform="scale("+Layout.scale+", "+Layout.scale+
")"))};function Point(a,b){this.x="undefined"===typeof a?0:a;this.y="undefined"===typeof b?0:b}Point.prototype.distanceTo=function(a,b){return Math.sqrt((a-this.x)*(a-this.x)+(b-this.y)*(b-this.y))};function Rectangle(a,b,c,d){this.x="undefined"!==typeof a?a:0;this.y="undefined"!==typeof b?b:0;this.w="undefined"!==typeof c?c:0;this.h="undefined"!==typeof d?d:0}Rectangle.prototype.left=function(){return this.x};Rectangle.prototype.setLeft=function(a){this.x=a};
Rectangle.prototype.right=function(){return this.x+this.w};Rectangle.prototype.setRight=function(a){a<this.x||(this.w=a-this.x)};Rectangle.prototype.top=function(){return this.y};Rectangle.prototype.setTop=function(a){this.y=a};Rectangle.prototype.bottom=function(){return this.y+this.h};Rectangle.prototype.setBottom=function(a){a<this.y||(this.h=a-this.y)};Rectangle.prototype.isEqual=function(a){return this.x===a.x&&this.y===a.y&&this.w===a.w&&this.h===a.h};
Rectangle.prototype.intersectPoint=function(a,b){return a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h};Rectangle.prototype.contains=function(a,b){return a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h};Rectangle.prototype.intersectRect=function(a){return this.right()>=a.x&&this.x<=a.right()&&this.bottom()>=a.y&&this.y<=a.bottom()};
Rectangle.prototype.intersection=function(a){if(!this.intersectRect(a))return null;var b=new Rectangle;b.x=this.x>a.x?this.x:a.x;b.y=this.y>a.y?this.y:a.y;b.setRight(this.right()<a.right()?this.right():a.right());b.setBottom(this.bottom()<a.bottom()?this.bottom():a.bottom());return b};Rectangle.prototype.containsRect=function(a){return a.x>=this.x&&a.y>=this.y&&a.right()<=this.right()&&a.bottom()<=this.bottom()};Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.w,this.h)};
Rectangle.prototype.copyRectangle=function(a){this.x=a.x;this.y=a.y;this.w=a.w;this.h=a.h};Rectangle.prototype.isEmpty=function(){return 0===this.w&&0===this.h};Rectangle.prototype.setEmpty=function(){this.h=this.w=0};Rectangle.prototype.area=function(){return this.w*this.h};Rectangle.prototype.toString=function(){return"x:"+this.x+" y:"+this.y+" w:"+this.w+" h:"+this.h};function NamedRectangle(a,b,c,d,e){this.m_object=a;Rectangle.call(this,b,c,d,e)}Application.subclass(NamedRectangle,Rectangle);
NamedRectangle.prototype.getObject=function(){return this.m_object};NamedRectangle.prototype.toString=function(){return this.m_object+" ("+this.x+", "+this.y+", "+this.w+", "+this.h+")"};function QuadTree(a,b,c,d,e,f){this.bounds=a;this.level=b;this.parallaxXFactor=c;this.parallaxYFactor=d;this.xOffset=e;this.yOffset=f;this.children=null;this.objects=[];this.m_count=0;this.lastCamera=null}QuadTree.minWidth=100;QuadTree.minHeight=100;QuadTree.MAX_OBJECTS_PER_NODE=4;QuadTree.MAX_WIDTH=1E3;
QuadTree.MAX_HEIGHT=768;QuadTree.prototype.count=function(){return this.m_count};
QuadTree.prototype.split=function(a,b){var c=this.bounds.left(),d=this.bounds.top(),e=this.bounds.w/2,f=this.bounds.h/2;if(a&&b){a=new QuadTree(new Rectangle(c,d,e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset);b=new QuadTree(new Rectangle(c+e,d,e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset);var g=new QuadTree(new Rectangle(c,d+f,e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset);c=new QuadTree(new Rectangle(c+
e,d+f,e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset);this.children=[a,b,g,c]}else if(a)a=new QuadTree(new Rectangle(c,d,e,2*f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset),c=new QuadTree(new Rectangle(c+e,d,e,2*f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset),this.children=[a,c];else if(b)a=new QuadTree(new Rectangle(c,d,2*e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,
this.yOffset),c=new QuadTree(new Rectangle(c,d+f,2*e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset),this.children=[a,c];else return;c=[];d=this.objects.length;e=this.children.length;for(f=0;f<d;f++){a=this.objects[f];b=!1;for(g=0;g<e;g++)if(this.children[g].insert(a)){b=!0;break}b||c.push(a)}this.objects=c};QuadTree.prototype.tryToInsertIntoChildren=function(a){for(var b=this.children.length,c=0;c<b;c++)if(this.children[c].insert(a))return!0;return!1};
QuadTree.prototype.insert=function(a,b){return"undefined"!==typeof b&&b||this.bounds.containsRect(a)?(null===this.children?(this.objects.push(a),this.objects.length>QuadTree.MAX_OBJECTS_PER_NODE&&this.split(this.bounds.w>2*QuadTree.minWidth,this.bounds.h>2*QuadTree.minHeight)):this.tryToInsertIntoChildren(a)||this.objects.push(a),this.m_count++,!0):!1};QuadTree.prototype.queryObjectsAdjusted=function(a){for(var b=[],c=this.objects.length,d=0;d<c;d++){var e=this.objects[d];e.intersectRect(a)&&b.push(e)}return b};
QuadTree.prototype.queryAdjusted=function(a){this.lastCamera=a;var b=[];if(this.bounds.intersectRect(a)){if(null!==this.children)for(var c=this.children.length,d=0;d<c;d++)b=b.concat(this.children[d].queryAdjusted(a));b=b.concat(this.queryObjectsAdjusted(a))}return b};
QuadTree.prototype.query=function(a){return 1===this.parallaxXFactor&&1===this.parallaxYFactor&&0===this.xOffset&&0===this.yOffset?this.queryAdjusted(a):this.queryAdjusted(new Rectangle(a.left()*this.parallaxXFactor-this.xOffset,a.top()*this.parallaxYFactor-this.yOffset,a.w,a.h))};
QuadTree.prototype.remove=function(a){if(a&&this.bounds.containsRect(a)){if(null!==this.children){var b=this.children.length;for(var c=0;c<b;c++){var d=this.children[c];if(d.remove(a))return null===d.children&&0===d.objects.length&&(this.children.splice(c,1),0===this.children.length&&(this.children=null)),!0}}b=this.objects.length;for(c=0;c<b;c++)if(this.objects[c]===a)return this.objects.splice(c,1),!0}return!1};
QuadTree.prototype.free=function(){if(null!==this.children){for(var a=this.children.length,b=0;b<a;b++)this.children[b].free();this.children=null}this.lastCamera=this.bounds=this.objects=null};
QuadTree.prototype.onDebugDraw=function(a){if(null!==this.lastCamera&&this.bounds.intersectRect(this.lastCamera)){ContextGraphics.drawRectangle(a,this.bounds.left()-this.lastCamera.left(),this.bounds.top()-this.lastCamera.top(),this.bounds.w,this.bounds.h,2,Common.COLOR_RED,Common.COLOR_NONE);for(var b=this.objects.length,c=0;c<b;c++){var d=this.objects[c];ContextGraphics.drawRectangle(a,d.left()-this.lastCamera.left(),d.top()-this.lastCamera.top(),d.w,d.h,2,Common.COLOR_GREEN,Common.COLOR_NONE)}if(null!==
this.children)for(b=this.children.length,c=0;c<b;c++)this.children[c].onDebugDraw(a)}};function SGuiControls(a){this.clip=Application.instance.getAnimation(a);this.m_clipName=a;this.controls={}}SGuiControls.prototype.free=function(){for(var a in this.controls)this.controls[a].free(),this.controls[a]=null;this.controls=null;this.clip&&(this.clip.free(),this.clip=null)};SGuiControls.prototype.existsControl=function(a){return this.controls&&this.controls[a]};
SGuiControls.prototype.getControl=function(a){if(this.controls&&this.controls[a])return this.controls[a];Application.warn("Control ["+a+"] no found");return null};SGuiControls.prototype.getControls=function(a,b){var c=[],d;for(d in this.controls)d.match(a)&&c.push(this.controls[d]);b&&(c=c.sort(function(a,b){a=a.name;b=b.name;return a<b?-1:a>b?1:0}));return c};
SGuiControls.prototype.setControlVisible=function(a,b){this.controls&&this.controls[a]?this.controls[a].setVisible(b):Application.error("Control ["+a+"] no found")};SGuiControls.prototype.setControlText=function(a,b){a=this.getControl(a);null!=a&&a.setTextLocalized(b)};SGuiControls.prototype.setControlsEventsLocked=function(a){for(var b in this.controls)this.controls[b].setEventsLocked(a)};
SGuiControls.prototype.parseControls=function(){if(null!=this.clip){for(var a=window.swt_ui,b=Application.RIGHT_TO_LEFT?"_rtl":"_ltr",c,d,e,f,g=0,h=a.length,k=0;k<h;++k)if(a[k].gui===this.m_clipName&&(f=a[k],c=this.clip.getLayer(f.control),null===c&&Application.error("Error loading control:"+f.control),d=c.getSprite(),null!=d))if(0<d.children.length)Application.warn("Possible duplicate control name: "+f.control);else{c=null;switch(Common.trim(f.type).toUpperCase()){case GuiControl.TYPE_TEXT:c=new GuiText(d,
parseInt(a[k].width,10),parseInt(a[k].height,10));c.align=Common.trim(a[k]["hAlign"+b]);c.valign=Common.trim(a[k].vAlign);d=new window.PIXI.TextStyle;d.fontFamily=f["font"+b];d.fontSize=parseInt(f["size"+b],10);d.fill=f.color;d.align=c.align;e=f.border?f.border.split(","):[];2===e.length&&(d.strokeThickness=parseInt(e[0],10),d.stroke=e[1]);e=f.shadow?f.shadow.split(","):[];4===e.length&&(d.dropShadow=!0,d.dropShadowDistance=parseInt(e[0],10),d.dropShadowColor=e[1],d.dropShadowAngle=Common.gradToRadian(parseInt(f.shadow[2],
10)),d.dropShadowBlur=parseInt(e[3],10));e=f.spacing?f.spacing.split(","):[];2===e.length&&(d.letterSpacing=parseInt(e[0],10),0!==parseInt(e[1],10)&&(d.lineHeight=d.fontSize+parseInt(e[1],10)));1===(f.wordWrap?parseInt(f.wordWrap,10):0)&&(d.wordWrap=!0,d.wordWrapWidth=c.baseWidth);d.padding=20;c.textfield?c.textfield.style=d:Application.warn("SGuiControls: control text id ["+f.control+"] was not created");"undefined"!==typeof Application.strings[f.string]?c.setTextLocalized(f.string):Application.warn("SGuiControls: string/style id ["+
f.string+"] no found");break;case GuiControl.TYPE_CLIP:c=new GuiClip(d);c.setClip(f.link);break;case GuiControl.TYPE_ON_OFF:c=new GuiOnOff(d);c.setOnClip(a[k].link+"_on");c.setOffClip(a[k].link+"_off");c.gotoState(GuiOnOff.ST_ON);c.addPressListener(this,this.onUIPress);c.addReleaseListener(this,this.onUIRelease);break;case GuiControl.TYPE_BUTTON:c=a[k].link;c=c.replace(/_.*$/,"");Application.instance.existsAnimation(a[k].link+"_press")||Application.instance.existsAnimation(c+"_press")?c=new GuiButtonState(d,
c):(c=new GuiButton(d),c.setClip(a[k].link));c.addPressListener(this,this.onUIPress);c.addReleaseListener(this,this.onUIRelease);break;case GuiControl.TYPE_4STATES:c=new GuiThumbs4State(d,f.link,f.disableLink,f.selectedLink,f.soonLink);c.addPressListener(this,this.onUIPress);c.addReleaseListener(this,this.onUIRelease);break;case GuiControl.TYPE_CLIP_MOUSE:c=new GuiControlInteractive(d);c.setClip(f.link);c.setInteractive(!0);c.addPressListener(this,this.onUIPress);c.addReleaseListener(this,this.onUIRelease);
c.addMoveListener(this,this.onUIMove);break;case GuiControl.TYPE_CONTENT:c=new GuiContent(d);break;default:Application.error("SGuiControls::parseControls() - Type control unknown: "+Common.trim(f.type).toUpperCase())}c&&(c.name=Common.trim(f.control),this.controls[f.control]=c,g++)}0==g&&Application.warn("SGuiControls::parseControls() - There is no controls in this screen: "+this.m_clipName)}};SGuiControls.prototype.onUIPress=function(a,b){};SGuiControls.prototype.onUIRelease=function(a,b){};
SGuiControls.prototype.onUIPressAndRelease=function(a){};SGuiControls.prototype.onUIMove=function(a){};SGuiControls.prototype.onUIOver=function(a){};SGuiControls.prototype.onUIOut=function(a){};
function SScreen(a,b,c,d){SGuiControls.call(this,"undefined"===typeof a?"":a);this.screenParent="undefined"===typeof d?null:d;this.blurBG=null;this.canvas=Application.instance.addDisplayContainer();Application.instance.canvas.addChild(this.canvas);this.canvas.hitArea=new PIXI.Rectangle(.5*-Application.APP_WIDTH,-100,2*Application.APP_WIDTH,Application.APP_HEIGHT+200);this.canvas.addPressListener(this,this.onPointerPress);this.canvas.addReleaseListener(this,this.onPointerRelease);this.canvas.addPointerMoveListener(this,
this.onPointerMove);this.setInteractive(!1);this.blurContent=Application.instance.addDisplayContainer();this.canvas.addChild(this.blurContent);this.frameWaitActionStop=0;this.clip&&(this.clip.screenLinked=this,this.canvas.addChild(this.clip));this.skipCode=32;this.canvas.position.x=b||0;this.canvas.position.y=c||0;this.m_popup=null;this.spaceBarEnabled=!1;this.lastInteractionControl="";this.parseControls();this.m_transitionFx=null;this.m_state=SScreen.ST_INIT;this.init();this.tweenTime=3E3;this.enableTween=
!1;this.timerTween=0;this.controlNameTween="none";this.m_controlPos={}}Application.subclass(SScreen,SGuiControls);SScreen.ST_INIT=0;SScreen.ST_TRANSITION_INIT=1;SScreen.ST_MAINFRAME=2;SScreen.ST_TRANSITION_END=3;SScreen.ST_END=4;
SScreen.prototype.free=function(){this.blurBG&&(this.blurBG.parent.removeChild(this.blurBG),this.blurBG.free(),this.blurBG=null);null!=this.blurContent&&(this.blurContent.parent.removeChild(this.blurContent),this.blurContent.free(),this.blurContent=null);null!=this.m_transitionFx&&(this.m_transitionFx.free(),this.m_transitionFx=null);var a=document.getElementById("MainCanvasDraw");a&&(a.focus(),a.parentElement.focus());this.dropPopup();this.destroyToolTips();this.screenParent=null;this.canvas&&this.canvas.parent&&
this.canvas.parent.removeChild(this.canvas);this.clip&&this.clip.parent&&this.clip.parent.removeChild(this.clip);this.canvas&&(this.canvas.hitArea=null,this.canvas.free(),this.canvas=null);Application.instance.canvasEvents&&(document.getElementById("MainCanvasEvents").style.cursor="default");this.m_controlPos=null;SGuiControls.prototype.free.call(this)};SScreen.prototype.createTransitionIn=function(){};SScreen.prototype.createTransitionOut=function(){};SScreen.prototype.onEndTransitionIn=function(){};
SScreen.prototype.onEndTransitionOut=function(){};SScreen.prototype.onActionScreen=function(){};SScreen.prototype.hasPopup=function(){return null!=this.m_popup};
SScreen.prototype.applyBlur=function(a){if(null==this.blurBG){a=a||2;var b=new Image;b.src=Application.instance.captureScreen();this.blurBG=new SSprite(b.src);this.blurBG.position.x=-Layout.left/Layout.scale;this.blurBG.scale.x/=Layout.scale;this.blurBG.scale.y/=Layout.scale;this.blurContent.addChild(this.blurBG);b=new window.PIXI.filters.BlurFilter;b.blur=a;this.blurBG.filters=[b]}};
SScreen.prototype.createCustomTransition=function(a,b,c){b=b||null;null!==this.m_transitionFx&&this.m_transitionFx.free();this.m_transitionFx=new a(b,c||this.clip);this.m_transitionFx.onEndAnimation(this,this.onEndTransition)};SScreen.prototype.initControlPositions=function(a){for(var b=0;b<a.length;b++)this.controls[a[b]]&&(this.m_controlPos[a[b]]=new Point(this.getControl(a[b]).canvas.position.x,this.getControl(a[b]).canvas.position.y))};
SScreen.prototype.setInteractive=function(a){this.canvas.interactive=a};SScreen.prototype.init=function(){};SScreen.prototype.onDebugDraw=function(a){};SScreen.prototype.onEndTransition=function(a){a.setAwaitingDelete(!0)};SScreen.prototype.onUIPress=function(a,b){Application.instance.fullScreen();if(null!=this.m_popup)this.m_popup.onUIPress(a);else this.lastInteractionControl=a.name};SScreen.prototype.onUIRelease=function(a,b){Application.instance.fullScreen();if(null!==this.m_popup)this.m_popup.onUIRelease(a)};
SScreen.prototype.onUIPressAndRelease=function(a){if(null!==this.m_popup)this.m_popup.onUIPressAndRelease(a)};SScreen.prototype.onUIMove=function(a){if(null!==this.m_popup)this.m_popup.onUIMove(a)};SScreen.prototype.onUIOver=function(a){if(null!==this.m_popup)this.m_popup.onUIOver(a)};SScreen.prototype.onUIOut=function(a){if(null!==this.m_popup)this.m_popup.onUIOut(a)};SScreen.prototype.onStopScreen=function(){this.clip&&this.clip.stop();this.m_state=SScreen.ST_MAINFRAME};
SScreen.prototype.onResumeScreen=function(){this.clip&&this.clip.resume();this.m_state=SScreen.ST_TRANSITION_END};SScreen.prototype.onFinishScreen=function(){this.m_state===SScreen.ST_INIT?this.m_state=SScreen.ST_MAINFRAME:this.m_state===SScreen.ST_TRANSITION_END&&(this.m_state=SScreen.ST_END)};SScreen.prototype.onSimpleStopScreen=function(){this.clip&&this.clip.stop();this.m_state=SScreen.ST_MAINFRAME};SScreen.prototype.onPointerPress=function(a){};SScreen.prototype.onPointerRelease=function(a){};
SScreen.prototype.onPointerPressAndRelease=function(a){};SScreen.prototype.onPointerOver=function(a){};SScreen.prototype.onPointerMove=function(a){};SScreen.prototype.activePressBar=function(){this.spaceBarEnabled=!0};SScreen.prototype.onPressSpaceBar=function(){this.spaceBarEnabled=!1};
SScreen.prototype.update=function(a){null!=this.m_popup&&this.m_popup.update(a);this.clip&&this.clip.update(a);if(this.controls)for(var b in this.controls)this.controls[b].update(a);this.m_transitionFx&&(this.m_transitionFx.isAwaitingDelete()?(this.m_transitionFx.free(),this.m_transitionFx=null):this.m_transitionFx.update(a));this.enableTween&&null===this.m_popup&&0<this.timerTween&&(this.timerTween-=a,0>=this.timerTween&&(this.timerTween=this.tweenTime,this.initAnimationButtons()))};
SScreen.prototype.onResize=function(a){if(null!==this.m_popup)this.m_popup.onResize(a)};SScreen.prototype.onKeyDown=function(a){if(null!==this.m_popup)this.m_popup.onKeyDown(a);if(this.spaceBarEnabled&&a===this.skipCode)this.onPressSpaceBar()};SScreen.prototype.onKeyUp=function(a){if(null!==this.m_popup)this.m_popup.onKeyUp(a)};SScreen.prototype.onActivate=function(a){if(null!==this.m_popup)this.m_popup.onActivate(a)};SScreen.prototype.popup=function(){return this.m_popup};
SScreen.prototype.addPopup=function(a,b){("undefined"!==typeof b?b:1)&&this.dropPopup();this.m_popup=a;this.m_popup.screenParent=this};SScreen.prototype.dropPopup=function(){null!=this.m_popup&&(this.m_popup.free(),this.m_popup=null)};SScreen.prototype.destroyToolTips=function(){};SScreen.prototype.createTooltips=function(a,b,c,d,e){};
SScreen.prototype.fixGameScale=function(){var a=Layout.left/Layout.scale,b=Layout.top/Layout.scale,c;for(c in this.m_controlPos){var d=this.m_controlPos[c].x<.5*Application.APP_WIDTH?-1:1;this.getControl(c).canvas.position.x=this.m_controlPos[c].x+d*a*.75;d=this.m_controlPos[c].y<.5*Application.APP_HEIGHT?-1:1;this.getControl(c).canvas.position.y=this.m_controlPos[c].y+d*b*.75}};
SScreen.prototype.parseControls=function(){SGuiControls.prototype.parseControls.call(this);for(var a in this.controls)if(this.controls[a].getType()==GuiControl.TYPE_BUTTON||this.controls[a].getType()==GuiControl.TYPE_ANI_BUTTON)this.controls[a].screenContainer=this};SScreen.prototype.stopAnimationButtons=function(){if(this.enableTween){this.enableTween=!1;this.timerTween=0;var a=this.getControl(this.controlNameTween).clip;a&&(a.scale.x=1,a.scale.y=1);this.controlNameTween=""}};
SScreen.prototype.initAnimationButtons=function(){"none"!==this.controlNameTween&&(Common.tween({parent:this,clip:this.getControl(this.controlNameTween).canvas,sx:1,sy:1},{sx:1.2,sy:1.2},1E3,!0,0,TweenEasing.ExponentialIn),Common.tween({parent:this,clip:this.getControl(this.controlNameTween).canvas,sx:1.2,sy:1.2},{sx:1,sy:1},1200,!0,1E3,TweenEasing.BackOut))};SScreen.prototype.isFinished=function(){return this.m_state===SScreen.ST_END};
function SLoaderScreen(a,b,c,d,e,f,g,h){d="undefined"===typeof d?null:d;SScreen.call(this,a);this.m_start="undefined"===typeof e?0:e;this.m_end="undefined"===typeof f?100:f;this.m_jsonFiles=b;SLoaderScreen.instance=this;this.m_soundGroup=null;if(null!=d)for(this.m_soundGroup=[],b=d.length-1;0<=b;--b)a=Application.instance.getSoundGroup(d[b]),null!=a&&this.m_soundGroup.push(a);this.m_loadedfiles=this.m_totalFiles=0;this.m_nextScreen=c;this.m_isReady=!1;this.m_waitTime=600;this.m_isPreload="undefined"===
typeof g?!1:g;this.m_extraAssets="undefined"===typeof h?[]:h;this.m_btnNext=null;this.existsControl("mcGuiBtnNext")&&(this.m_btnNext=this.controls.mcGuiBtnNext,this.m_btnNext.setVisible(!1));this.m_isPreload&&(this.m_waitTime=0);this.loadedJsonFiles=0;if(null!=this.m_jsonFiles)for(c=0;c<this.m_jsonFiles.length;c++)if(Application.jsonFiles[this.m_jsonFiles[c]])this.onJsonLoaded(Application.jsonFiles[this.m_jsonFiles[c]]);else d=new SJsonLoader(this.m_jsonFiles[c]),d.addLoadedListener(this,this.onJsonLoaded),
d.addErrorListener(this,this.onJsonError),d.load();else Application.error("SLoaderScreen: invalid JSON file"),this.m_isReady=!0}Application.subclass(SLoaderScreen,SScreen);SLoaderScreen.showButtonNext=!1;SLoaderScreen.instance=null;SLoaderScreen.prototype.free=function(){this.m_soundGroup=this.m_jsonFiles=this.m_btnNext=null;SLoaderScreen.instance=null;SScreen.prototype.free.call(this)};SLoaderScreen.prototype.createTransitionIn=function(){this.m_isPreload||0==this.m_start&&SScreen.prototype.createTransitionIn.call(this)};
SLoaderScreen.prototype.createTransitionOut=function(){this.m_isPreload||SScreen.prototype.createTransitionOut.call(this)};SLoaderScreen.prototype.onJsonLoaded=function(a){Application.log("[JSON loaded] "+a.url);this.loadedJsonFiles++;Application.jsonFiles[a.url]=a;if(this.loadedJsonFiles>=this.m_jsonFiles.length)this.onAllJsonLoaded()};SLoaderScreen.prototype.onJsonError=function(a){Application.error("JSON no found "+a.url)};
SLoaderScreen.prototype.onAllJsonLoaded=function(){Application.info("[ALL JSON COMPLETE]");var a=[],b;for(b=0;b<this.m_jsonFiles.length;b++){this.m_totalFiles+=Application.jsonFiles[this.m_jsonFiles[b]].json.meta.atlas.length;var c=new SLoader(Application.jsonFiles[this.m_jsonFiles[b]]);c.addLoadListener(this,this.onFileLoaded);a.push(c)}this.m_extraAssets&&0<this.m_extraAssets.length&&(this.m_totalFiles+=this.m_extraAssets.length,c=new SJsonLoader(""),c.json={meta:{atlas:this.m_extraAssets}},c.baseUrl=
"",c=new SLoader(c),c.addLoadListener(this,this.onFileLoaded),a.push(c));for(b=0;b<a.length;b++)a[b].load();if(null!=this.m_soundGroup&&0<this.m_soundGroup.length){for(b=this.m_soundGroup.length-1;0<=b;--b)Application.soundGroups[this.m_soundGroup[b].group]||(this.m_totalFiles+=this.m_soundGroup[b].sounds.length,Application.instance.soundManager.loadSounds(this.m_soundGroup[b].sounds),Application.soundGroups[this.m_soundGroup[b].group]=!0);this.m_soundGroup=null}};
SLoaderScreen.prototype.onUIPress=function(a){Application.instance.playSound("SND_UI_CLICK");switch(a.name){case "mcGuiBtnNext":Application.instance.hideAddressBar(),Application.instance.playSound("MUS_MAINMENU"),GuiManager.instance.gotoScreen(this.m_nextScreen)}};SLoaderScreen.prototype.onFileLoaded=function(){this.m_loadedfiles++;this.m_loadedfiles===this.m_totalFiles&&(this.m_isReady=!0)};
SLoaderScreen.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_isReady&&(this.m_waitTime-=a,0>this.m_waitTime&&(this.onLoadComplete(),this.m_isReady=!1))};
SLoaderScreen.prototype.onLoadComplete=function(){if(this.m_isPreload)Application.instance.onLoaderReady();else Application.instance.isMobileDevice&&null!=this.m_jsonFiles?SLoaderScreen.showButtonNext?(SLoaderScreen.showButtonNext=!1,this.m_btnNext&&this.m_btnNext.setVisible(!0)):GuiManager.instance.gotoScreen(this.m_nextScreen):GuiManager.instance.gotoScreen(this.m_nextScreen)};function DebugScreen(a,b,c,d){SScreen.call(this,a,b,c,d)}Application.subclass(DebugScreen,SScreen);
DebugScreen.prototype.onUIPress=function(a){Application.instance.playSound("SND_UI_CLICK");this.onResumeScreen()};
function DebugScreenNano(){SScreen.call(this,"",0,0);DebugScreenNano.instance=this;this.setInteractive(!0);this.fx=null;this.effectName="";this.followCursor=!1;this.bgImage=null;this.canvasBg=Application.instance.addDisplayContainer();this.bgClip=null;this.canvasClip=Application.instance.addDisplayContainer();this.canvasEffect=Application.instance.addDisplayContainer();this.canvasGuides=Application.instance.addDisplayContainer();this.canvas.addChild(this.canvasBg);this.canvas.addChild(this.canvasClip);
this.canvas.addChild(this.canvasEffect);this.canvas.addChild(this.canvasGuides);this.max=0;this.centerX=.5*Application.APP_WIDTH;this.centerY=.5*Application.APP_HEIGHT;var a=new SGraphics;a.drawLine(this.centerX-100,this.centerY,this.centerX+100,this.centerY,65280);a.drawLine(this.centerX,this.centerY-100,this.centerX,this.centerY+100,65280);a.drawRectangle(10,10,Application.APP_WIDTH-20,Application.APP_HEIGHT-20,1,65280);this.canvasGuides.addChild(a);this.m_debugText=new SPixiText("",{size:15,font:"15px Arial",
fill:"#00FF00"});this.m_debugText.position.x=14;this.m_debugText.position.y=12;this.canvas.addChild(this.m_debugText)}Application.subclass(DebugScreenNano,SScreen);DebugScreenNano.prototype.onKeyDown=function(a){switch(a){case Common.KEY_F:this.followCursor=!this.followCursor,this.followCursor||(this.fx.x=this.centerX,this.fx.y=this.centerY)}};DebugScreenNano.prototype.onPointerPress=function(a){""!==this.effectName&&this.createEffect(this.effectName,a.data.global.x,a.data.global.y)};
DebugScreenNano.prototype.onPointerMove=function(a){this.fx&&this.followCursor&&(this.fx.x=a.data.global.x,this.fx.y=a.data.global.y)};DebugScreenNano.prototype.setBackground=function(a){this.bgImage&&(this.canvasBg.removeChild(this.bgImage),this.bgImage=null);this.bgImage=window.PIXI.Sprite.fromImage(a,!1,PIXI.SCALE_MODES.DEFAULT);this.canvasBg.addChild(this.bgImage)};
DebugScreenNano.prototype.setClip=function(a){this.bgClip&&(this.canvasClip.removeChild(this.bgClip),this.bgClip=null);a&&0<a.length&&"__errorSprite"!=a&&(this.bgClip=Application.instance.getAnimation(a),this.bgClip.setPosition(this.centerX,this.centerY),this.canvasClip.addChild(this.bgClip))};DebugScreenNano.prototype.setClipInFront=function(a){this.canvas.removeChild(this.canvasClip);this.canvas.addChildAt(this.canvasClip,a?3:1)};
DebugScreenNano.prototype.createEffect=function(a,b,c){this.fx&&(this.fx.free(),this.fx=null);this.max=0;this.effectName=a;this.fx=new NanoEffect(a,b||this.centerX,c||this.centerY,this.canvasEffect)};
DebugScreenNano.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.bgClip&&this.bgClip.update(a);if(this.fx){this.fx.update(a);a=window.nano.effects[this.effectName];for(var b=0;b<a.length;b++)this.fx.emittersIndex[a[b].emitter]&&(this.fx.emittersIndex[a[b].emitter].ox=a[b].pos_x,this.fx.emittersIndex[a[b].emitter].oy=a[b].pos_y)}this.max<this.canvasEffect.countChildren()&&(this.max=this.canvasEffect.countChildren());this.m_debugText.text="Particles : "+this.canvasEffect.countChildren()+
" fps : "+Application.instance.fps+(Application.RENDER_MODE===Application.RENDER_CANVAS?" (canvas)":" (webgl)")+" Max : "+this.max};DebugScreenNano.prototype.addDebugText=function(a,b,c,d){"undefined"===typeof d&&(d="#FF0000");"undefined"===typeof c&&(c=18);this.m_debugText=new SPixiText("",{fontSize:c,fontFamily:"Arial",fill:d});this.canvas.addChild(this.m_debugText);this.m_debugText.position.x=a;this.m_debugText.position.y=b};
DebugScreenNano.prototype.setDebugText=function(a){this.m_debugText&&(this.m_debugText.text=a)};function ScreenManager(){this.currentScreen=null;this.currentScreenName="";this.debugDrawModeOn=!0}ScreenManager.prototype.free=function(){this.currentScreen&&this.currentScreen.free();this.currentScreen=null};ScreenManager.prototype.gotoScreen=function(a){this.currentScreen&&this.currentScreen.free();this.currentScreen=null;this.currentScreenName=a;Application.log("GO TO SCREEN :: "+a)};
ScreenManager.prototype.update=function(a){this.currentScreen&&this.currentScreen.update(a)};ScreenManager.prototype.onResize=function(a){if(this.currentScreen)this.currentScreen.onResize(a)};ScreenManager.prototype.onKeyDown=function(a){if(this.currentScreen)this.currentScreen.onKeyDown(a)};ScreenManager.prototype.onKeyUp=function(a){if(this.currentScreen)this.currentScreen.onKeyUp(a)};ScreenManager.prototype.onActivate=function(a){if(this.currentScreen)this.currentScreen.onActivate(a)};
ScreenManager.prototype.onTilt=function(a){};ScreenManager.prototype.onDebugDraw=function(a){if(this.debugDrawModeOn&&null!==this.currentScreen)this.currentScreen.onDebugDraw(a)};ScreenManager.prototype.toggleDebugDraw=function(){this.debugDrawModeOn=!this.debugDrawModeOn};
function RotateScreen(a){this.canvas=a;this.file=window.SwitEntryPoint.infoBrowser.isPhone?"media/images/ui_images/gui_rotatescreen_phone.jpg":"media/images/ui_images/gui_rotatescreen.jpg";this.bg=new PIXI.Graphics;this.bg.beginFill(0,1);this.bg.drawRect(-50,-50,100,100);this.image=PIXI.Sprite.fromImage(this.file,!1,window.PIXI.settings.SCALE_MODE);this.image.pivot.x=150;this.image.pivot.y=150;this.canvas.interactive=!0;this.animate=this.visible=!1}
RotateScreen.prototype.show=function(){this.canvas.addChild(this.bg);this.canvas.addChild(this.image);var a=1/Layout.scale;Common.tween({parent:this,clip:this.image,scale:.2,onComplete:this.onCompleteAnimation},{scale:1.2>a?1.2:a},1500,!0,150,TweenEasing.ElasticOut);this.animate=this.visible=!0};RotateScreen.prototype.onCompleteAnimation=function(a){this.animate=!0};RotateScreen.prototype.hide=function(){this.canvas.removeChild(this.bg);this.canvas.removeChild(this.image);this.visible=!1};
RotateScreen.prototype.onResize=function(){Application.WIDE_SCREEN?(this.image.position.x=.5*window.innerWidth/Layout.scale,this.image.position.y=.5*window.innerHeight/Layout.scale,this.bg.width=window.innerWidth,this.bg.height=window.innerHeight,this.bg.scale.x/=Layout.scale,this.bg.scale.y/=Layout.scale):(this.image.position.x=.5*Application.APP_WIDTH,this.image.position.y=.5*Application.APP_HEIGHT,this.bg.width=Application.APP_WIDTH,this.bg.height=Application.APP_HEIGHT)};
function Vector2D(a,b){this.x="undefined"===typeof a?0:a;this.y="undefined"===typeof b?0:b}Vector2D.prototype.set=function(a,b){this.x=a;this.y=b};Vector2D.prototype.setVector=function(a,b){this.x=a*Math.cos(b);this.y=a*Math.sin(b)};Vector2D.prototype.distanceTo=function(a,b){return Math.sqrt((a-this.x)*(a-this.x)+(b-this.y)*(b-this.y))};Vector2D.prototype.distance=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};
Vector2D.prototype.clone=function(){return new Vector2D(this.x,this.y)};Vector2D.prototype.plus=function(a){return new Vector2D(this.x+a.x,this.y+a.y)};Vector2D.prototype.minus=function(a){return new Vector2D(this.x-a.x,this.y-a.y)};Vector2D.prototype.middle=function(a){return new Vector2D(.5*(this.x+a.x),.5*(this.y+a.y))};Vector2D.prototype.orthogonal=function(){return new Vector2D(-this.y,this.x)};
Vector2D.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.x*b-this.y*a;this.y=this.y*b+this.x*a;this.x=c};Vector2D.prototype.udir=function(){var a=this.clone();a.normalize();return a};Vector2D.prototype.projectionOn=function(a){var b=a.dot(a);if(0===b)return this.clone();var c=a.clone();c.scale(this.dot(a)/b);return c};Vector2D.prototype.dot=function(a){return this.x*a.x+this.y*a.y};Vector2D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};
Vector2D.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y};Vector2D.prototype.copy=function(a){this.x=a.x;this.y=a.y};Vector2D.prototype.scale=function(a){this.x*=a;this.y*=a};Vector2D.prototype.normalize=function(){var a=this.length();0<a?(this.x/=a,this.y/=a):Application.warn("[WARN]: Vector2D.normalize: called on a zero-length vector.")};Vector2D.prototype.normalize2=function(a){var b=this.length();0<b?(this.x/=b,this.y/=b,1!=a&&this.scale(a)):Application.warn("[WARN]: Vector2D.normalize: called on a zero-length vector.")};
Vector2D.prototype.stretch=function(a){var b=this.length();0<b?(this.x*=a/b,this.y*=a/b):Application.warn("[WARN]: Vector2D.stretch: called on a zero-length vector.")};Vector2D.prototype.silentNormalize=function(){var a=this.length();0<a&&(this.x/=a,this.y/=a)};Vector2D.prototype.add=function(a){this.x+=a.x;this.y+=a.y};Vector2D.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y};Vector2D.prototype.product=function(a){return this.y*a.x-this.x*a.y};
Vector2D.prototype.angle=function(){return Math.atan2(this.y,this.x)};Vector2D.prototype.isZero=function(){return 0===this.y&&0===this.x};Vector2D.prototype.toString=function(){return"V2D x:"+this.x+" y:"+this.y};function SGame(a){SGame.instance=this;this.showDebugCollision=this.isAwaitingDelete=!1;this.canvas=a;this.m_world=this.m_hud=null;this.init()}SGame.instance=null;
SGame.prototype.free=function(){this.m_world&&(this.m_world.free(),this.m_world=null);this.m_hud&&(this.m_hud.free(),this.m_hud=null);this.canvas=null;SGame.instance=null};SGame.prototype.init=function(){};SGame.prototype.update=function(a){this.m_hud&&this.m_hud.update(a)};SGame.prototype.onStart=function(){};SGame.prototype.fixGameScale=function(){};SGame.prototype.world=function(){return this.m_world};SGame.prototype.hud=function(){return this.m_hud};SGame.prototype.onDebugDraw=function(a){};
SGame.prototype.toggleDebugCollision=function(){this.showDebugCollision=!this.showDebugCollision};SGame.prototype.onActivate=function(a){};SGame.prototype.onKeyDown=function(a){};SGame.prototype.onKeyUp=function(a){};SGame.prototype.onPointerPress=function(a,b){};SGame.prototype.onPointerRelease=function(a,b){};SGame.prototype.onPointerPressAndRelease=function(a){};SGame.prototype.onPointerOver=function(a){};SGame.prototype.onPointerMove=function(a,b){};
function SEffectAnimo(a,b,c,d,e,f,g,h){SEffect.call(this,a,b,c,d,e,f);this.clip=Application.instance.getAnimation(a);this.clip.setPosition(b,c);g&&(this.clip.scale.x=-1);h&&(this.clip.scale.y=-1);this.canvas.addChild(this.clip);this.clip.onEndAnimation(this,this.onEndLoop);this.type=SEffect.TYPE_ANIMO}Application.subclass(SEffectAnimo,SEffect);SEffectAnimo.prototype.setPaused=function(a){this.m_isPaused!=a&&(SEffect.prototype.setPaused.call(this,a),a?this.clip.stop():this.clip.resume())};
SEffectAnimo.prototype.setVisible=function(a){this.clip.visible=a};SEffectAnimo.prototype.update=function(a){this.clip.update(a)};function SEffectNano(a,b,c,d,e){NanoEffect.call(this,a,b,c,d,e);this.type=SEffect.TYPE_NANO}Application.subclass(SEffectNano,NanoEffect);
SEffectNano.prototype.fix=function(a){if(this.emitters){this.x=a.x;this.y=a.y;for(var b=0;b<this.emitters.length;b++)for(var c=0;c<this.emitters[b].particles.length;c++)this.emitters[b].particles[c].ox=a.x+this.emitters[b].ox,this.emitters[b].particles[c].oy=a.y+this.emitters[b].oy}};
SEffectNano.prototype.update=function(a){NanoEffect.prototype.update.call(this,a);this.isAwaitingDelete()&&null!==this.m_endCompleteCallback&&null!==this.m_endCompleteCaller&&this.m_endCompleteCallback.call(this.m_endCompleteCaller,this)};
function SEffectGui(a,b,c,d,e,f){SEffect.call(this,a,b,c,d,e,f);this.m_guiControls=new SGuiControls(a);this.m_guiControls.parseControls();if(this.clip=this.m_guiControls.clip)this.canvas.addChild(this.clip),this.clip.setPosition(b,c),this.clip.onEndAnimation(this,this.onEndLoop);this.type=SEffect.TYPE_GUI}Application.subclass(SEffectGui,SEffect);
SEffectGui.prototype.free=function(){null!=this.clip&&(null!=this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip=null);this.m_guiControls.free();this.m_guiControls=null;SEffect.prototype.free.call(this)};SEffectGui.prototype.getControl=function(a){"undefined"===typeof this.m_guiControls.controls[a]&&Application.error("Control ["+a+"] no found");return this.m_guiControls.controls[a]};SEffectGui.prototype.update=function(a){this.clip.update(a)};
function SEffectManager(){this.m_effects=[];this.m_k=this.m_len=0}SEffectManager.prototype.free=function(){for(var a=this.m_effects.length-1;0<=a;--a)this.m_effects[a].free(),this.m_effects[a]=null;this.m_effects=null};SEffectManager.prototype.clear=function(){if(0!=this.m_effects.length){for(var a=0;a<this.m_effects.length;a++)this.m_effects[a].free(),this.m_effects[a]=null;this.m_effects.splice(0,this.m_effects.length)}};
SEffectManager.prototype.removeEffect=function(a){for(var b=0;b<this.m_effects.length;b++)this.m_effects[b].name===a&&this.m_effects[b].setAwaitingDelete(!0)};SEffectManager.prototype.add=function(a){this.m_effects.push(a)};SEffectManager.prototype.remove=function(a){a=this.m_effects.indexOf(a);0<=a&&this.m_effects.splice(a,1)};SEffectManager.prototype.pauseAllEffects=function(a){for(var b=0;b<this.m_effects.length;b++)this.m_effects[b].setPaused(a)};
SEffectManager.prototype.createEffect=function(a,b,c,d,e,f){if(window.nano.effects[a])return this.createEffectNano(a,b,c,d,f);for(var g=window.swt_ui,h=g.length-1;0<=h;--h)if(g[h].gui===a)return this.createEffectGui(a,b,c,d,e,f);return this.createEffectAnimo(a,b,c,d,e,f)};SEffectManager.prototype.createEffectAnimo=function(a,b,c,d,e,f,g,h){a=new SEffectAnimo(a,b,c,d,e,f,g,h);this.add(a);return a};
SEffectManager.prototype.createEffectNano=function(a,b,c,d,e){a=new SEffectNano(a,b,c,d,e);this.add(a);return a};SEffectManager.prototype.createEffectGui=function(a,b,c,d,e,f){a=new SEffectGui(a,b,c,d,e,f);this.add(a);return a};
SEffectManager.prototype.update=function(a){this.m_len=this.m_effects.length;for(this.m_k=0;this.m_k<this.m_len;this.m_k++)this.m_effects[this.m_k].isAwaitingDelete()?(this.m_effects[this.m_k].free(),this.m_effects[this.m_k]=null,this.m_effects.splice(this.m_k,1),this.m_k--,this.m_len--):this.m_effects[this.m_k].isPaused()||this.m_effects[this.m_k].update(a)};function ControlGroup(){this.controls=[];this.controlSelected=null}ControlGroup.prototype.addControl=function(a){this.controls.push(a)};
ControlGroup.prototype.onSelectControl=function(a){for(var b=0;b<this.controls.length;b++)this.controls[b].name===a?(this.controls[b].gotoState(GuiControl.ST_SELECTED),this.controlSelected=this.controls[b]):this.controls[b].gotoState(GuiControl.ST_ENABLE)};ControlGroup.prototype.free=function(){this.controlSelected=this.controls=null};
function GuiControl(a){a&&0===a.children.length&&(a.texture._frame.width=0,a.texture._frame.height=0);this.canvas=a;this.clip=null;this.clipName=this.name="";this.state=1;this.enabled=!0;this.screenContainer=null;this.m_isVisible=!0;this.m_eventsLocked=!1;this.m_type=""}
GuiControl.prototype.free=function(){null!=this.clip&&(this.clip.free(),this.clip=null);for(;0<this.canvas.children.length;)Application.warn("The canvas still has children! - This should not happen."),this.canvas.removeChild(this.canvas.getChildAt(0));this.canvas=this.clip=this.screenContainer=null};GuiControl.prototype.setX=function(a){this.canvas.x=a};GuiControl.prototype.setY=function(a){this.canvas.y=a};GuiControl.prototype.setPosition=function(a,b){this.canvas.x=a;this.canvas.y=b};
GuiControl.prototype.getX=function(){return this.canvas.x};GuiControl.prototype.getY=function(){return this.canvas.y};GuiControl.prototype.getWidth=function(){return null!=this.clip?this.clip.width:0};GuiControl.prototype.getHeight=function(){return null!=this.clip?this.clip.height:0};GuiControl.prototype.setVisible=function(a){this.m_isVisible=a;this.clip&&(this.clip.visible=this.m_isVisible)};GuiControl.prototype.isVisible=function(){return this.m_isVisible};
GuiControl.prototype.setEnabled=function(a){this.enabled=a};GuiControl.prototype.setEventsLocked=function(a){this.m_eventsLocked=a};GuiControl.prototype.isEventsLocked=function(){return this.m_eventsLocked};
GuiControl.prototype.setClip=function(a){null!=this.clip&&(null!=this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free());for(this.clipName=a;0<this.canvas.children.length;)Application.error("The canvas still has children! - This should not happen."),this.canvas.removeChild(this.canvas.getChildAt(0));this.clip=Application.instance.getAnimation(this.clipName);this.clip.visible=this.m_isVisible;this.canvas.addChild(this.clip)};GuiControl.prototype.getType=function(){return this.m_type};
GuiControl.prototype.onResetState=function(){};GuiControl.prototype.gotoState=function(a){this.state=a};GuiControl.prototype.update=function(a){};GuiControl.TYPE_TEXT="TEXT";GuiControl.TYPE_CLIP="CLIP";GuiControl.TYPE_ON_OFF="ON_OFF";GuiControl.TYPE_BUTTON="BUTTON";GuiControl.TYPE_4STATES="4STATES";GuiControl.TYPE_CLIP_MOUSE="CLIPMOUSE";GuiControl.TYPE_CONTENT="CONTENT";GuiControl.TYPE_ANI_BUTTON="ANI_BUTTON";GuiControl.ST_ENABLE=1;GuiControl.ST_DISABLE=2;GuiControl.ST_SELECTED=3;
GuiControl.ST_COMMING_SOON=4;GuiControl.ST_RELEASE=5;GuiControl.ST_OVER=6;GuiControl.ST_OUT=7;GuiControl.I_OX=1;GuiControl.I_OY=2;GuiControl.I_SCALE_X=3;GuiControl.I_SCALE_Y=4;GuiControl.I_SCALE=5;GuiControl.I_ROTATION=6;GuiControl.I_ALPHA=7;
function GuiControlInteractive(a){GuiControl.call(this,a);this.m_interactive=!1;this.containerText=this._moveCallback=this._moveCaller=this._pressAndReleaseCallback=this._pressAndReleaseCaller=this._releaseCallback=this._releaseCaller=this._pressCallback=this._pressCaller=null;this.onPressActive=!1;this.commingSoonLink=this.outLink=this.overLink=this.releaseLink=this.selectedLink=this.disableLink=this.enableLink="";this.onPressButton=!1;this._outCallback=this._outCaller=this._overCallback=this._overCaller=
null;this.buttonMode=!1;this.m_type=GuiControl.TYPE_CLIP_MOUSE}Application.subclass(GuiControlInteractive,GuiControl);GuiControlInteractive.prototype.free=function(){this.setInteractive(!1);this.screenContainer=this.containerText=this._moveCallback=this._moveCaller=this._pressAndReleaseCallback=this._pressAndReleaseCaller=this._releaseCallback=this._releaseCaller=this._pressCallback=this._pressCaller=this._outCaller=this._outCallback=this._overCallback=this._overCaller=null;GuiControl.prototype.free.call(this)};
GuiControlInteractive.prototype.setInteractive=function(a){this.m_interactive=a;this.clip&&(this.clip.interactive=this.m_interactive,a?(this.clip.self=this,this.clip.mousedown=function(a){this.self.onPress(a)},this.clip.touchstart=function(a){this.self.onPress(a)},this.clip.mouseup=function(a){this.self.onRelease(a)},this.clip.touchend=function(a){this.self.onRelease(a)},this.clip.mousemove=function(a){this.self.onMove(a)},this.clip.touchmove=function(a){this.self.onMove(a)},this.clip.mouseover=function(a){this.self.onOver(a)},
this.clip.mouseout=function(a){this.self.onOut(a)}):(this.clip.self=null,this.clip.mousedown=null,this.clip.touchstart=null,this.clip.mouseup=null,this.clip.mouseupoutside=null,this.clip.touchend=null,this.clip.touchendoutside=null,this.clip.mousemove=null,this.clip.touchmove=null,this.clip.mouseover=null,this.clip.mouseout=null),this.clip.buttonMode=!0)};GuiControlInteractive.prototype.setClip=function(a){GuiControl.prototype.setClip.call(this,a);this.setInteractive(this.m_interactive)};
GuiControlInteractive.prototype.addPressListener=function(a,b){this._pressCaller=a;this._pressCallback=b};GuiControlInteractive.prototype.addReleaseListener=function(a,b){this._releaseCaller=a;this._releaseCallback=b};GuiControlInteractive.prototype.addPressAndReleaseListener=function(a,b){this._pressAndReleaseCaller=a;this._pressAndReleaseCallback=b};GuiControlInteractive.prototype.addMoveListener=function(a,b){this._moveCallback=b;this._moveCaller=a};
GuiControlInteractive.prototype.addOverListener=function(a,b,c,d){this._overCallback=b;this._overCaller=a;this._outCallback=d;this._outCaller=c};GuiControlInteractive.prototype.onPress=function(a){null!=this._pressCaller&&null!=this._pressCallback&&this._pressCallback.call(this._pressCaller,this,a);this.onPressActive=!0};GuiControlInteractive.prototype.onRelease=function(a){null!=this._releaseCaller&&null!=this._releaseCallback&&this._releaseCallback.call(this._releaseCaller,this,a)};
GuiControlInteractive.prototype.onPressAndRelease=function(a){null!==this._pressAndReleaseCaller&&null!==this._pressAndReleaseCallback&&this._pressAndReleaseCallback.call(this._pressAndReleaseCaller,this)};GuiControlInteractive.prototype.onMove=function(a){null!=this._moveCaller&&null!=this._moveCallback&&this._moveCallback.call(this._moveCaller,this,a)};
GuiControlInteractive.prototype.onOver=function(a){null!=this._overCaller&&null!=this._overCallback&&this._overCallback.call(this._overCaller,this,a);this.buttonMode&&(null!==this.containerText&&(this.containerText.canvas.scale.x=1.15,this.containerText.canvas.scale.y=1.15),Application.instance.canvasEvents&&(Application.instance.canvasEvents.style.cursor="pointer"))};
GuiControlInteractive.prototype.onOut=function(a){null!=this._outCaller&&null!=this._outCallback&&this._outCallback.call(this._outCaller,this,a);null!==this.containerText&&(this.containerText.canvas.scale.x=1,this.containerText.canvas.scale.y=1);Application.instance.canvasEvents&&(Application.instance.canvasEvents.style.cursor="default")};
function GuiThumbs4State(a,b,c,d,e){GuiControlInteractive.call(this,a);this.enableLink=b||"";this.disableLink=c||"";this.selectedLink=d||"";this.commingSoonLink=e||"";this.gotoState(GuiControl.ST_ENABLE);this.m_type=GuiControl.TYPE_4STATES}Application.subclass(GuiThumbs4State,GuiControlInteractive);GuiThumbs4State.prototype.setEnabled=function(a){(this.enabled=a)||this.gotoState(GuiControl.ST_DISABLE)};
GuiThumbs4State.prototype.gotoState=function(a){if(this.enabled)switch(a){case GuiControl.ST_ENABLE:""!==this.enableLink&&(this.setClip(this.enableLink),this.setInteractive(!0),this.state=a);break;case GuiControl.ST_DISABLE:""!==this.disableLink&&(this.setClip(this.disableLink),this.setInteractive(!1),this.enabled=!1,this.state=a);break;case GuiControl.ST_SELECTED:""!==this.selectedLink&&(this.setClip(this.selectedLink),this.setInteractive(!1),this.state=a);break;case GuiControl.ST_COMMING_SOON:""!==
this.commingSoonLink&&(this.setClip(this.commingSoonLink),this.setInteractive(!1),this.state=a,this.enabled=!1)}};function GuiClip(a){GuiControl.call(this,a);this.m_type=GuiControl.TYPE_CLIP}Application.subclass(GuiClip,GuiControl);GuiClip.prototype.gotoAndStop=function(a){null!=this.clip&&this.clip.gotoAndStop(a)};GuiClip.prototype.gotoAndPlay=function(a){null!=this.clip&&this.clip.gotoAndPlay(a)};GuiClip.prototype.update=function(a){null!=this.clip&&this.clip.visible&&this.clip.update(a)};
function GuiOnOff(a){GuiControlInteractive.call(this,a);this.setInteractive(!0);this.addOverListener(this,this.onOverCallback,this,this.onOutCallback);this.m_callbackOff=this.m_callbackOn=this.m_callerSwitch=this.m_offLink=this.m_onLink=null;this.buttonMode=!0;this.m_type=GuiControl.TYPE_ON_OFF}Application.subclass(GuiOnOff,GuiControlInteractive);GuiOnOff.prototype.free=function(){this.m_callbackOff=this.m_callbackOn=this.m_callerSwitch=this.m_offLink=this.m_onLink=null;GuiControlInteractive.prototype.free.call(this)};
GuiOnOff.prototype.onTurnOn=function(a,b){this.m_callerSwitch=a;this.m_callbackOn=b};GuiOnOff.prototype.onTurnOff=function(a,b){this.m_callerSwitch=a;this.m_callbackOff=b};GuiOnOff.prototype.setClip=function(a){GuiControlInteractive.prototype.setClip.call(this,a);null!==this.clip&&this.clip.stop()};GuiOnOff.prototype.setOnClip=function(a){this.m_onLink=a};GuiOnOff.prototype.setOffClip=function(a){this.m_offLink=a};
GuiOnOff.prototype.setEnabled=function(a){GuiControlInteractive.prototype.setEnabled.call(this,a);null!==this.clip&&this.clip.gotoAndStop(this.enabled?1:4)};GuiOnOff.prototype.gotoState=function(a){this.state=a;this.setClip(a===GuiOnOff.ST_ON?this.m_onLink:this.m_offLink)};
GuiOnOff.prototype.onPress=function(a){this.enabled&&(GuiControlInteractive.prototype.onPress.call(this,a),this.state===GuiOnOff.ST_OFF?(this.gotoState(GuiOnOff.ST_ON),null!=this.m_callerSwitch&&null!=this.m_callbackOn&&this.m_callbackOn.call(this.m_callerSwitch)):this.state===GuiOnOff.ST_ON&&(this.gotoState(GuiOnOff.ST_OFF),null!=this.m_callerSwitch&&null!=this.m_callbackOff&&this.m_callbackOff.call(this.m_callerSwitch)))};
GuiOnOff.prototype.onRelease=function(a){this.enabled&&GuiControlInteractive.prototype.onRelease.call(this,a)};GuiOnOff.prototype.onOverCallback=function(a){if(!this.m_eventsLocked&&(null!==this.clip&&this.clip.gotoAndStop(this.enabled?3:4),this.screenContainer&&!Application.instance.isMobileDevice))this.screenContainer.onUIOver(this)};GuiOnOff.prototype.onOutCallback=function(a){null!==this.clip&&this.clip.gotoAndStop(this.enabled?1:4);if(this.screenContainer&&!Application.instance.isMobileDevice)this.screenContainer.onUIOut(this)};
GuiOnOff.ST_ON=1;GuiOnOff.ST_OFF=2;function GuiButton(a){GuiControlInteractive.call(this,a);this.addOverListener(this,this.onOverCallback,this,this.onOutCallback);this.setInteractive(!0);this.buttonMode=!0;this.m_type=GuiControl.TYPE_BUTTON}Application.subclass(GuiButton,GuiControlInteractive);GuiButton.prototype.setClip=function(a){GuiControlInteractive.prototype.setClip.call(this,a);null!=this.clip&&this.clip.stop()};
GuiButton.prototype.setEnabled=function(a){GuiControlInteractive.prototype.setEnabled.call(this,a);null!=this.clip&&this.clip.gotoAndStop(this.enabled?1:4)};GuiButton.prototype.onPress=function(a){this.enabled&&!this.m_eventsLocked&&(GuiControlInteractive.prototype.onPress.call(this,a),null!==this.clip&&this.clip.gotoAndStop(2))};GuiButton.prototype.onRelease=function(a){GuiControlInteractive.prototype.onRelease.call(this,a);null!==this.clip&&this.clip.gotoAndStop(this.enabled?1:4)};
GuiButton.prototype.onOverCallback=function(a){if(!this.m_eventsLocked&&(null!==this.clip&&this.clip.gotoAndStop(this.enabled?3:4),this.screenContainer&&!Application.instance.isMobileDevice))this.screenContainer.onUIOver(this)};GuiButton.prototype.onOutCallback=function(a){null!==this.clip&&this.clip.gotoAndStop(this.enabled?1:4);if(this.screenContainer&&!Application.instance.isMobileDevice)this.screenContainer.onUIOut(this)};
function GuiButtonState(a,b){GuiControlInteractive.call(this,a);this.nameClip=b;this.outLink=b+"_out";this.overLink=b+"_over";this.enableLink=b+"_on";this.disableLink=b+"_off";this.releaseLink=b+"_out";this.selectedLink=b+"_press";this.m_interactive=!0;this.setClip(this.enableLink);this.clip.alpha=0;this.m_instanceName="";this.m_clipState=null;this.m_extraClips=[];this.addOverListener(this,this.onOverCallback,this,this.onOutCallback);this.gotoState(GuiControl.ST_ENABLE);this.buttonMode=!0;this.m_type=
GuiControl.TYPE_ANI_BUTTON}Application.subclass(GuiButtonState,GuiControlInteractive);GuiButtonState.prototype.free=function(){for(var a=this.m_extraClips.length-1;0<=a;a--){var b=this.m_extraClips[a].instance,c=this.m_extraClips[a].clip;this.m_clipState.hasInstance(b)&&this.m_clipState[b].removeChild(c);c.free();this.m_extraClips.splice(a,1)}this.m_extraClips=null;null!=this.m_clipState&&(this.m_clipState.free(),this.m_clipState=null);GuiControlInteractive.prototype.free.call(this)};
GuiButtonState.prototype.setExtraClip=function(a,b){this.m_extraClips.push({instance:b,clip:a})};GuiButtonState.prototype.hasInstance=function(a){return"undefined"!==typeof this.m_clipState[a]};GuiButtonState.prototype.setNameClipBase=function(a){this.nameClip=a;this.outLink=a+"_out";this.overLink=a+"_over";this.enableLink=a+"_on";this.disableLink=a+"_off";this.releaseLink=a+"_out";this.selectedLink=a+"_press";this.gotoState(this.state)};
GuiButtonState.prototype.setEnabled=function(a){GuiControlInteractive.prototype.setEnabled.call(this,a);this.gotoState(this.enabled?GuiControl.ST_ENABLE:GuiControl.ST_DISABLE)};GuiButtonState.prototype.setVisible=function(a){GuiControlInteractive.prototype.setVisible.call(this,a);null!=this.m_clipState&&(this.m_clipState.visible=this.m_isVisible)};
GuiButtonState.prototype.onPress=function(a){this.enabled&&this.m_interactive&&!this.m_eventsLocked&&(GuiControlInteractive.prototype.onPress.call(this,a),this.gotoState(GuiControl.ST_SELECTED))};GuiButtonState.prototype.onRelease=function(a){this.enabled&&this.m_interactive&&(GuiControlInteractive.prototype.onRelease.call(this,a),this.state===GuiControl.ST_SELECTED&&this.gotoState(GuiControl.ST_RELEASE))};
GuiButtonState.prototype.onOverCallback=function(a){if(this.state!==GuiControl.ST_OVER&&!this.onPressButton&&this.m_interactive&&!this.m_eventsLocked&&(this.gotoState(GuiControl.ST_OVER),this.screenContainer&&!Application.instance.isMobileDevice))this.screenContainer.onUIOver(this)};
GuiButtonState.prototype.onOutCallback=function(a){if(this.state===GuiControl.ST_OUT||this.state===GuiControl.ST_RELEASE||this.onPressButton||!this.m_interactive){if(this.onPressButton&&(this.onPressButton=!1,this.state==GuiControl.ST_SELECTED&&(this.gotoState(GuiControl.ST_OUT),this.screenContainer&&!Application.instance.isMobileDevice)))this.screenContainer.onUIOut(this)}else if(this.state!=GuiControl.ST_RELEASE&&this.gotoState(GuiControl.ST_OUT),this.screenContainer&&!Application.instance.isMobileDevice)this.screenContainer.onUIOut(this)};
GuiButtonState.prototype.onResetState=function(){this.enabled&&(this.onPressButton=!1,this.gotoState(GuiControl.ST_ENABLE))};
GuiButtonState.prototype.setClipState=function(a,b){if(this.m_isVisible&&null!==this.canvas){for(null!=this.m_clipState&&this.m_clipState.free();1<this.canvas.children.length;)Application.error("The canvas still has children! - This should not happen."),this.canvas.removeChild(this.canvas.getChildAt(1));this.m_clipState=Application.instance.getAnimation(a);if(null===this.m_clipState){this.gotoState(GuiControl.ST_ENABLE);return}this.m_clipState.visible=this.m_isVisible;this.m_clipState.interactive=
!1;this.canvas.addChild(this.m_clipState)}this.m_interactive!=b&&this.setInteractive(b)};GuiButtonState.prototype.onFade=function(a,b){b=b||500;this.m_clipState.visible=!0;if(this.m_isVisible=a){if(1===this.m_clipState.alpha)return;this.gotoState(GuiControl.ST_ENABLE);a=0;var c=1}else{if(0===this.m_clipState.alpha)return;a=1;c=0}Common.tween({parent:this,clip:this.m_clipState,alpha:a},{alpha:c},b,!0,0,TweenEasing.LinearNone);this.setInteractive(this.m_isVisible)};
GuiButtonState.prototype.update=function(a){for(var b=0;b<this.m_extraClips.length;b++)this.m_extraClips[b].clip.update(a);null!=this.m_clipState&&this.m_clipState.visible&&(this.m_clipState.update(a),this.state!=GuiControl.ST_OUT&&this.state!=GuiControl.ST_RELEASE||this.m_clipState.currentFrame!==this.m_clipState.totalFrames-1||this.gotoState(this.enabled?GuiControl.ST_ENABLE:GuiControl.ST_DISABLE))};
GuiButtonState.prototype.addExtraClips=function(){if(null!==this.m_clipState)for(var a=0;a<this.m_extraClips.length;a++){var b=this.m_extraClips[a].instance,c=this.m_extraClips[a].clip;this.m_clipState.hasInstance(b)&&this.m_clipState[b].addChild(c)}};GuiButtonState.prototype.removeExtraClips=function(){if(null!==this.m_clipState)for(var a=0;a<this.m_extraClips.length;a++){var b=this.m_extraClips[a].instance,c=this.m_extraClips[a].clip;this.m_clipState.hasInstance(b)&&this.m_clipState[b].removeChild(c)}};
GuiButtonState.prototype.gotoState=function(a){null!=this.m_extraClips&&null!=this.m_extraClips.parent&&this.m_extraClips.parent.removeChild(this.m_extraClips);this.removeExtraClips();switch(a){case GuiControl.ST_ENABLE:this.setClipState(this.enableLink,!0);this.state=a;break;case GuiControl.ST_DISABLE:this.setClipState(this.disableLink,!1);this.enabled=!1;this.state=a;break;case GuiControl.ST_SELECTED:this.onPressButton=!0;this.setClipState(this.selectedLink,!0);this.state=a;break;case GuiControl.ST_RELEASE:this.setClipState(this.outLink,
!0);this.state=a;break;case GuiControl.ST_OVER:this.setClipState(this.overLink,!0);this.state=a;break;case GuiControl.ST_OUT:this.setClipState(this.outLink,!0),this.state=a}this.addExtraClips()};
function GuiText(a,b,c){GuiControl.call(this,a);this.align=GuiText.ALIGN_CENTER;this.valign=GuiText.ALIGN_V_MIDDLE;this.textfield=new SPixiText("",{});this.canvas.addChild(this.textfield);this.baseWidth=b||50;this.baseHeight=c||50;this.offsetX=.5*-this.baseWidth;this.offsetY=.5*-this.baseHeight;this.textfield.debugRect=new Rectangle(this.offsetX,this.offsetY,this.baseWidth,this.baseHeight)}Application.subclass(GuiText,GuiControl);
GuiText.prototype.free=function(){this.textfield&&(this.canvas.removeChild(this.textfield),this.textfield.free(),this.textfield=null);GuiControl.prototype.free.call(this)};GuiText.prototype.setText=function(a){this.textfield&&(this.textfield.text=a,GuiText.updateAlign(this))};GuiText.prototype.setVisible=function(a){GuiControl.prototype.setVisible.call(this,a);this.textfield&&(this.textfield.visible=this.m_isVisible)};GuiText.prototype.setTextEmpty=function(){this.setTextLocalized("STR_EMPTY")};
GuiText.prototype.setTextJoined=function(a,b,c,d){d||-1!==b.indexOf(c)?this.setTextLocalized(a+((10<=c?"":"0")+c)):Application.warn("GuiText::setTextJoined: value "+c+" not in range "+b+".")};GuiText.prototype.setTextLocalized=function(a){this.setText(Application.strings[a].value)};GuiText.prototype.setTextNumeric=function(a){"number"===typeof a?this.setText(a.toString()):Application.warn("GuiText::setTextNumeric: text not numeric.")};
GuiText.prototype.setTextRaw=function(a){Application.warn("setTextRaw: "+a);this.setText(a)};GuiText.prototype.setTextReplace=function(a,b,c){Application.strings[a]&&(a=Application.strings[a].value,a=a.replace(b,""+c),this.setText(a))};
GuiText.prototype.setTextReplaceGroup=function(a,b,c){if(b.length!==c.length)Application.warn("GuiText::setTextReplaceGroup: array inputs do not have the same length.");else{var d=Application.strings[a].value;if(d){for(a=0;a<b.length;a++)d=d.replace(b[a],c[a]);this.setText(d)}else Application.warn("GuiText::setTextReplaceGroup: id "+a+" not found.")}};
GuiText.updateAlign=function(a){var b=0;Application.RENDER_MODE===Application.RENDER_CANVAS&&(b=a.textfield.style.padding);if(a.textfield){switch(a.align){case GuiText.ALIGN_LEFT:a.textfield.position.x=a.offsetX-b;break;case GuiText.ALIGN_CENTER:a.textfield.position.x=.5*-a.textfield.width-b;break;case GuiText.ALIGN_RIGHT:a.textfield.position.x=.5*a.baseWidth-a.textfield.width-b}switch(a.valign){case GuiText.ALIGN_V_TOP:a.textfield.position.y=a.offsetY-b;break;case GuiText.ALIGN_V_MIDDLE:a.textfield.position.y=
.5*-a.textfield.height-b;break;case GuiText.ALIGN_V_BOTTOM:a.textfield.position.y=.5*a.baseHeight-a.textfield.height-b}}};GuiText.getPixiAlign=function(a){return a.align===GuiText.ALIGN_LEFT?"left":a.align===GuiText.ALIGN_CENTER?"center":"right"};GuiText.ALIGN_LEFT="left";GuiText.ALIGN_CENTER="center";GuiText.ALIGN_RIGHT="right";GuiText.ALIGN_V_TOP="top";GuiText.ALIGN_V_MIDDLE="center";GuiText.ALIGN_V_BOTTOM="bottom";
function GuiSlider(a,b,c,d){this.x=c;this.y=d;this.m_pressed=!1;this.canvas=a;this.m_collision=this.m_pointer=this.m_animation=null;this.m_nameClip=b;this.m_caller=this.m_callback=null;this.m_collisionPositionX=0;this.createGuiSlider();this.m_currentIdTouch=-1;this.m_lastX=this.m_virtualPointerPositionX=0}GuiSlider.HALF_TOTAL_DISTANCE=50;GuiSlider.POINTER_RADIO=15;GuiSlider.POINTER_RADIO_POW2=225;GuiSlider.POINTER_NAME_INSTANCE="pointer";GuiSlider.COLLISION_NAME_INSTANCE="mcCollision";
GuiSlider.prototype.free=function(){null!=this.m_animation&&(this.canvas.removeChild(this.m_animation),this.m_animation.free(),this.m_animation=null);this.canvas=this.m_caller=this.m_callback=this.m_collision=this.m_pointer=null};GuiSlider.prototype.linkFunction=function(a,b){this.m_callback=b;this.m_caller=a};
GuiSlider.prototype.createGuiSlider=function(){this.m_animation=Application.instance.getAnimation(this.m_nameClip);this.canvas.addChild(this.m_animation);this.m_animation.position.x=this.x;this.m_animation.position.y=this.y;this.m_pointer=this.m_animation.getInstance(GuiSlider.POINTER_NAME_INSTANCE);this.m_collision=this.m_animation.collisions[GuiSlider.COLLISION_NAME_INSTANCE];this.m_collisionPositionX=this.m_collision.x-this.m_pointer.position.x;this.m_animation.interactive=!0;this.m_animation.self=
this;this.m_animation.mousedown=function(a){this.self.onPointerPress(a)};this.m_animation.touchstart=function(a){this.self.onPointerPress(a)};this.m_animation.mouseup=function(a){this.self.onPointerRelease(a)};this.m_animation.mouseupoutside=function(a){this.self.onPointerRelease(a)};this.m_animation.touchend=function(a){this.self.onPointerRelease(a)};this.m_animation.touchendoutside=function(a){this.self.onPointerRelease(a)};this.m_animation.mousemove=function(a){this.self.onPointerMove(a)};this.m_animation.touchmove=
function(a){this.self.onPointerMove(a)}};GuiSlider.prototype.onPointerPress=function(a){if(!Application.instance.isMobileDevice||-1===this.m_currentIdTouch){var b=this.x+this.m_virtualPointerPositionX-a.data.global.x-GuiSlider.HALF_TOTAL_DISTANCE,c=this.y-a.data.global.y;b*b+c*c<GuiSlider.POINTER_RADIO_POW2&&(Application.instance.isMobileDevice&&(this.m_currentIdTouch=a.currentTouchEvent.identifier),this.m_lastX=a.data.global.x,this.m_pressed=!0)}};
GuiSlider.prototype.onPointerRelease=function(a){Application.instance.isMobileDevice&&this.m_currentIdTouch!==a.currentTouchEvent.identifier||(this.m_pressed=!1,this.m_currentIdTouch=-1,this.m_virtualPointerPositionX>2*GuiSlider.HALF_TOTAL_DISTANCE?this.m_virtualPointerPositionX=2*GuiSlider.HALF_TOTAL_DISTANCE:0>this.m_virtualPointerPositionX&&(this.m_virtualPointerPositionX=0))};
GuiSlider.prototype.onPointerMove=function(a){if((!Application.instance.isMobileDevice||this.m_currentIdTouch===a.currentTouchEvent.identifier)&&this.m_pressed){var b=a.data.global.x-this.m_lastX;this.m_lastX=a.data.global.x;this.setPointerPosition((this.m_virtualPointerPositionX+b)/(2*GuiSlider.HALF_TOTAL_DISTANCE))}};GuiSlider.prototype.setPointerPosition=function(a){this.m_virtualPointerPositionX=a*=2*GuiSlider.HALF_TOTAL_DISTANCE;this.updatePointerPosition(a)};
GuiSlider.prototype.updatePointerPosition=function(a){var b=this.m_pointerPositionX;this.m_pointerPositionX=a>2*GuiSlider.HALF_TOTAL_DISTANCE?2*GuiSlider.HALF_TOTAL_DISTANCE:0>a?0:a;this.m_pointerPositionX!==b&&(this.m_pointer.position.x=this.m_pointerPositionX-GuiSlider.HALF_TOTAL_DISTANCE,this.m_collision.x=this.m_pointer.position.x+this.m_collisionPositionX,null!==this.m_callback&&this.m_callback.call(this.m_caller,this,this.m_pointerPositionX/(2*GuiSlider.HALF_TOTAL_DISTANCE)))};
function GuiContent(a){GuiControl.call(this,a);this.m_emptyCanvas=Application.instance.addDisplayContainer();this.canvas.addChild(this.m_emptyCanvas);this.m_type=GuiControl.TYPE_CONTENT}Application.subclass(GuiContent,GuiControl);
GuiContent.prototype.free=function(){for(;0<this.m_emptyCanvas.children.length;)Application.error("The canvas still has children - This should not happen."),this.m_emptyCanvas.removeChild(this.m_emptyCanvas.getChildAt(0));this.m_emptyCanvas.parent.removeChild(this.m_emptyCanvas);this.m_emptyCanvas.free();this.m_emptyCanvas=null;GuiControl.prototype.free.call(this)};GuiContent.prototype.addChild=function(a){this.m_emptyCanvas.addChild(a)};GuiContent.prototype.removeChild=function(a){this.m_emptyCanvas.removeChild(a)};
GuiContent.prototype.getEmptyCanvas=function(){return this.m_emptyCanvas};GuiContent.prototype.setVisible=function(a){GuiControl.prototype.setVisible.call(this,a);this.m_emptyCanvas.visible=this.m_isVisible};GuiContent.prototype.setClip=function(a){null!=this.clip&&(null!=this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free());this.clipName=a;this.clip=Application.instance.getAnimation(this.clipName);this.m_emptyCanvas.addChild(this.clip)};
GuiContent.prototype.update=function(a){null!=this.clip&&this.m_isVisible&&this.clip.update(a)};function DataMovement(a,b){this.motionParams=null;a=Common.getParams(a);this.isLoop=1==parseInt(a.loop,10);this.isReverse=1==parseInt(a.reverse,10);this.speed=parseFloat(a.speed);this.setMotionParams(b)}
DataMovement.prototype.setMotionParams=function(a){this.motionParams=[];a=a.split(";");for(var b=0;b<a.length;){var c=[],d=a[b].split(":");if(2>d.length)Application.error("DataMovement::setMotionParams(): "+a[b]);else{c.push(d[0]);d=d[1].split(",");for(var e=0;e<d.length;)c.push(d[e]),++e;this.motionParams.push(c)}++b}};DataMovement.prototype.free=function(){this.motionParams=null};function Global(){}Global.overrideBConfig=!1;Global.battleSettings=null;Global.fightSettings=null;Global.aiMode=0;
Global.firstMatch=!0;Global.comingFromSandbox=!1;Global.baseScale=1;Global.minScale=1;Global.maxScale=1.2;Global.offsetZoomX=0;Global.offsetZoomY=0;Global.fighterCameraScale=Global.baseScale;Global.NUM_LEVELS=1;Global.sound_content=[0];Global.sound_elements=[1];Global.sound_gameplay=[];
Global.getBGMusicGroup=function(){var a=[8];switch(Global.fightSettings.getStageData().name){case "zoo":return a.concat([4]);case "big_coffee":return a.concat([2]);case "street":return a.concat([6]);case "park":return Global.fightSettings.storyMode?a.concat([11]):a.concat([5]);case "house_front":return Global.fightSettings.modEnabled&&Global.fightSettings.storyMode?a.concat(7):a.concat([1]);case "subway":return a.concat([3]);case "house_back":return a.concat([1]);default:return a}};
Global.reportPlayableSpace=function(){if(FighterGame.instance){var a=FighterGame.instance.world(),b=Math.round(a.camera().width()),c=Math.round(a.initLimitRight-a.initLimitLeft);a=Math.round(a.limitRight-a.limitLeft);Application.log("\n-REPORT PLAYABLE SPACE:\n--camera width: "+b+" px\n--playable width original: "+c+" px\n--playable width current: "+a+" px\n--playable width percent: "+Math.round(a/c*100)+" %\n")}};
Global.getPlayableSpaceProportion=function(){var a=FighterGame.instance.world();return(a.limitRight-a.limitLeft)/(a.initLimitRight-a.initLimitLeft)};function Cheats(){}Cheats.enabled=Application.USE_CHEATS;Cheats.EVENT_ON_TOGGLE_COLLISION="toggleCollision";Cheats.EVENT_ON_END_GAME="endGame";Cheats.events=[Cheats.EVENT_ON_TOGGLE_COLLISION,Cheats.EVENT_ON_END_GAME];
function SavedData(a){this.m_numLevels=a;this.m_isDirty=!1;this.m_levelRegisters=[];this.m_globalRegisters=[];for(a=0;a<this.m_numLevels;++a){this.m_levelRegisters.push([]);for(var b=0;b<SavedData.TOTAL_LEVELREGISTERS;++b)this.m_levelRegisters[a].push(0)}for(a=0;a<SavedData.TOTAL_REGISTERS;++a)this.m_globalRegisters.push(0);this.initData();this.loadData();SavedData.instance=this}SavedData.instance=null;SavedData.DATA_VERSION=1;SavedData.KEY_VERSION="swit518_kv";SavedData.KEY_REGISTERS="swit518_kr";
SavedData.REG_MAX_LEVEL_REACHED=0;SavedData.REG_CHARACTERS=1;SavedData.REG_CHALLENGES=2;SavedData.REG_TROPHIES=3;SavedData.REG_TUTORIAL=4;SavedData.REG_FIRST_ACHIEVEMENT=5;SavedData.REG_COSTUMES=6;SavedData.REG_CHALL_LOCK=7;SavedData.REG_HARD_MODE=8;SavedData.REG_STORY_SAVE=9;SavedData.TOTAL_REGISTERS=10;SavedData.TOTAL_LEVELREGISTERS=0;SavedData.prototype.free=function(){this.m_globalRegisters=this.m_levelRegisters=null;SavedData.instance=null};SavedData.prototype.isDirty=function(){return this.m_isDirty};
SavedData.prototype.initData=function(){this.setRegister(SavedData.REG_MAX_LEVEL_REACHED,1);this.setBinRegister(SavedData.REG_CHARACTERS,[1,1,0,0,1,0,0]);this.setRegister(SavedData.REG_CHALLENGES,0);this.setRegister(SavedData.REG_CHALL_LOCK,1);this.setRegister(SavedData.REG_TROPHIES,0);this.setRegister(SavedData.REG_COSTUMES,0);this.setRegister(SavedData.REG_TUTORIAL,1);this.setRegister(SavedData.REG_FIRST_ACHIEVEMENT,1);this.setRegister(SavedData.REG_HARD_MODE,0);this.setRegister(SavedData.REG_STORY_SAVE,
0);this.initCostumes()};SavedData.prototype.setRegister=function(a,b,c){c="undefined"===typeof c?-1:c;if(-1==c){if(this.validateGlobalRegister(a))return this.m_globalRegisters[a]=b,this.m_isDirty=!0}else if(0<=c&&c<this.m_numLevels&&this.validateLevelRegister(a))return this.m_levelRegisters[c][a]=b,this.m_isDirty=!0;Application.error("SavedData::setRegister() - Invalid register: "+a+", level index: "+c);return!1};
SavedData.prototype.setBinRegister=function(a,b){for(var c=0,d=0;d<b.length;d++)c+=0<b[d]?Math.pow(2,d):0;this.setRegister(a,c)};SavedData.prototype.getRegister=function(a,b){b="undefined"===typeof b?-1:b;if(-1==b){if(this.validateGlobalRegister(a))return this.m_globalRegisters[a]}else if(0<=b&&b<this.m_numLevels&&this.validateLevelRegister(a))return this.m_levelRegisters[b][a];return 0};
SavedData.prototype.getBinRegister=function(a,b){a=this.getRegister(a).toString(2);a=a.split("").reverse().join("");for(var c=[],d=0;d<a.length;d++)c[d]=parseInt(a.charAt(d),10);for(;c.length<b;)c.push(0);return c};
SavedData.prototype.addRegister=function(a,b,c){c="undefined"===typeof c?-1:c;if(-1==c){if(this.validateGlobalRegister(a))return this.m_globalRegisters[a]+=b,this.m_isDirty=!0}else if(0<=c&&c<this.m_numLevels&&this.validateLevelRegister(a))return this.m_levelRegisters[c][a]+=b,this.m_isDirty=!0;Application.error("SavedData::addRegister() - Invalid register: "+a+", level index: "+c);return!1};
SavedData.prototype.resetData=function(){this.clearRegisters();this.initData();this.saveData();TrophyManager.instance&&TrophyManager.instance.updateStates()};
SavedData.prototype.saveData=function(a){if("undefined"===typeof a||!a||this.m_isDirty){a="";var b,c;for(b=0;b<SavedData.TOTAL_REGISTERS;++b)a+=this.m_globalRegisters[b],b<SavedData.TOTAL_REGISTERS-1&&(a+="|");a+="^";for(b=0;b<this.m_numLevels;++b){for(c=0;c<SavedData.TOTAL_LEVELREGISTERS;++c)a+=this.m_levelRegisters[b][c],c<SavedData.TOTAL_LEVELREGISTERS-1&&(a+=",");b<this.m_numLevels-1&&(a+="|")}Common.saveData(SavedData.KEY_REGISTERS,a);Application.log("SavedData::saveData() - data: "+a);this.m_isDirty=
!1}};SavedData.prototype.validateLevelRegister=function(a){return 0<=a&&a<SavedData.TOTAL_LEVELREGISTERS};SavedData.prototype.validateGlobalRegister=function(a){return 0<=a&&a<SavedData.TOTAL_REGISTERS};
SavedData.prototype.loadData=function(){var a=~~Common.loadData(SavedData.KEY_VERSION,"0");if(a!=SavedData.DATA_VERSION)Application.warn("SavedData::loadData() - incomplatible version: "+a),Common.saveData(SavedData.KEY_VERSION,""+SavedData.DATA_VERSION),this.resetData();else{a=Common.loadData(SavedData.KEY_REGISTERS,"");Application.log("SavedData::loadData() - data: "+a);var b=a.split("^");if(1<b.length){var c;a=b[0].split("|");for(c=0;c<a.length;++c)this.m_globalRegisters[c]=~~a[c];a=b[1].split("|");
for(c=0;c<a.length;++c){var d=a[c].split(",");for(b=0;b<d.length;++b)this.m_levelRegisters[c][b]=~~d[b]}}this.m_isDirty=!1}};SavedData.prototype.clearRegisters=function(){for(var a=0;a<this.m_numLevels;++a)for(var b=0;b<SavedData.TOTAL_LEVELREGISTERS;++b)this.m_levelRegisters[a][b]=0;for(a=SavedData.TOTAL_REGISTERS-1;0<=a;--a)this.m_globalRegisters[a]=0;this.setRegister(SavedData.REG_MAX_LEVEL_REACHED,1)};
SavedData.prototype.charaUnlocked=function(a){return 1===this.getBinRegister(SavedData.REG_CHARACTERS,DataHero.NUM_HEROES)[a]};SavedData.prototype.unlockCharacter=function(a){this.setBoolValue(SavedData.REG_CHARACTERS,DataHero.NUM_HEROES,a,!0)};SavedData.prototype.getBoolArray=function(a,b){return this.getBinRegister(a,b).map(function(a){return 1===a})};SavedData.prototype.setBoolValue=function(a,b,c,d){b=this.getBinRegister(a,b);b[c]=d?1:0;this.setBinRegister(a,b);this.saveData()};
SavedData.prototype.tutorialPlayed=function(){return 0===this.getRegister(SavedData.REG_TUTORIAL)};SavedData.prototype.completeTutorial=function(){this.setRegister(SavedData.REG_TUTORIAL,0);this.saveData()};SavedData.prototype.isFirstAchievement=function(){return 1===this.getRegister(SavedData.REG_FIRST_ACHIEVEMENT)};SavedData.prototype.onFirstAchieve=function(){this.setRegister(SavedData.REG_FIRST_ACHIEVEMENT,0);this.saveData()};
SavedData.prototype.unlockAll=function(){this.setBinRegister(SavedData.REG_CHARACTERS,[1,1,1,1,1,1,1]);this.unlockChallenges();this.unlockCostume(DataHero.ID_CRICKET,1);this.unlockCostume(DataHero.ID_TILLY,1);this.unlockCostume(DataHero.ID_REMY,1);this.unlockCostume(DataHero.ID_BILL,1);this.unlockCostume(DataHero.ID_GRAMMA,1);this.completeTutorial();this.onFirstAchieve();this.setRegister(SavedData.REG_HARD_MODE,1);this.saveData()};
SavedData.prototype.initCostumes=function(){this.setRegister(SavedData.REG_COSTUMES,0);for(var a=this.getBinRegister(SavedData.REG_COSTUMES,DataHero.NUM_HEROES*DataHero.NUM_COSTUMES),b=0;b<DataHero.NUM_HEROES;b++)a[b*DataHero.NUM_COSTUMES]=1;this.setBinRegister(SavedData.REG_COSTUMES,a)};SavedData.prototype.unlockCostume=function(a,b){this.setBoolValue(SavedData.REG_COSTUMES,DataHero.NUM_HEROES*DataHero.NUM_COSTUMES,a*DataHero.NUM_COSTUMES+b,!0);this.saveData()};
SavedData.prototype.getCostumes=function(a){return this.getBoolArray(SavedData.REG_COSTUMES,DataHero.NUM_HEROES*DataHero.NUM_COSTUMES).slice(a*DataHero.NUM_COSTUMES,(a+1)*DataHero.NUM_COSTUMES)};SavedData.prototype.hasCostumes=function(a){a=this.getBoolArray(SavedData.REG_COSTUMES,DataHero.NUM_HEROES*DataHero.NUM_COSTUMES).slice(a*DataHero.NUM_COSTUMES,a*DataHero.NUM_COSTUMES+DataHero.NUM_COSTUMES);for(var b=0,c=0;c<a.length;c++)a[c]&&b++;return 1<b};
SavedData.prototype.challengesEnabled=function(){return 0===this.getRegister(SavedData.REG_CHALL_LOCK)};SavedData.prototype.unlockChallenges=function(){this.setRegister(SavedData.REG_CHALL_LOCK,0);this.saveData()};SavedData.prototype.completeAllChallenges=function(){this.setRegister(SavedData.REG_CHALLENGES,Math.pow(2,ChallManager.NUM_CHALLENGES)-1);this.saveData()};SavedData.prototype.hardModeEnabled=function(){return 1===this.getRegister(SavedData.REG_HARD_MODE)};
SavedData.prototype.unlockHardMode=function(){this.setRegister(SavedData.REG_HARD_MODE,1);this.saveData()};SavedData.prototype.saveStoryProgress=function(a,b,c){this.setRegister(SavedData.REG_STORY_SAVE,parseInt(""+(a+1)+b+(c+1),10));this.saveData()};SavedData.prototype.clearStoryProgress=function(){this.setRegister(SavedData.REG_STORY_SAVE,0);this.saveData()};SavedData.prototype.hasStoryProgress=function(){return 0!=this.getRegister(SavedData.REG_STORY_SAVE)};
SavedData.prototype.loadStoryProgress=function(){if(StoryManager.instance){var a=""+this.getRegister(SavedData.REG_STORY_SAVE),b=parseInt(a.charAt(0),10)-1,c=parseInt(a.charAt(1),10);a=parseInt(a.substr(2),10)-1;StoryManager.instance.setCharacter(b);StoryManager.instance.setDifficulty(c);StoryManager.instance.toStage(a)}};
function StoryManager(){StoryManager.instance=this;this.m_difficulty=-1;this.m_data=null;this.m_idChar=-1;this.m_oppArray=[];this.m_aiArray=[];this.m_stageArray=[];this.m_currStage=-1;this.perfectRun=!0}StoryManager.instance=null;StoryManager.clearInstance=function(){StoryManager.instance&&StoryManager.instance.free()};StoryManager.prototype.setCharacter=function(a){this.m_idChar=a};
StoryManager.prototype.setDifficulty=function(a){this.m_difficulty=a;this.m_data=Application.config.story[a];this.m_oppArray=this.m_data.fightOrder;this.m_aiArray=this.m_data.difficultyOrder;this.m_stageArray=this.m_data.stageOrder};StoryManager.prototype.getCurrentAI=function(){return this.m_aiArray[this.m_currStage]};
StoryManager.prototype.getCurrentOpponent=function(){var a=this.m_oppArray[this.m_currStage];return a===this.m_idChar?this.m_idChar===DataHero.ID_CRICKET?DataHero.ID_TILLY:DataHero.ID_CRICKET:a};StoryManager.prototype.getCurrentStage=function(){return this.m_stageArray[this.m_currStage]};StoryManager.prototype.getLevel=function(){return this.m_currStage};StoryManager.prototype.getDifficulty=function(){return this.m_difficulty};StoryManager.prototype.getHPMult=function(){return this.m_data.hpMult};
StoryManager.prototype.getDmgMult=function(){return this.m_data.dmgMult};
StoryManager.prototype.toStage=function(a){this.m_currStage=a;if(this.m_currStage<this.m_oppArray.length){Global.aiMode=this.getCurrentAI();Global.fightSettings=new DataFight;Global.fightSettings.storyMode=!0;Global.fightSettings.setStageData(this.getCurrentStage());Global.fightSettings.p1CharId=this.m_idChar;Global.fightSettings.p2CharId=this.getCurrentOpponent();if(0===this.m_currStage||this.getCurrentStage()==DataStage.ID_ZOO)Global.fightSettings.modEnabled=!1,this.getCurrentStage()===DataStage.ID_ZOO&&
(Global.fightSettings.bonusStage=!0);return!0}return!1};StoryManager.prototype.toNextStage=function(){return this.toStage(++this.m_currStage)};StoryManager.prototype.lastStage=function(){return this.m_currStage===this.m_stageArray.length-1};StoryManager.prototype.bossEnabled=function(){return this.lastStage()&&this.m_difficulty>AICore.MODE_NONE};StoryManager.prototype.setStageIndex=function(a){this.m_currStage=a};
StoryManager.prototype.free=function(){this.m_stageArray=this.m_aiArray=this.m_oppArray=this.m_data=null;StoryManager.instance=null};
function RingUIHandler(a,b,c,d){this.m_controls=a;this.m_numItems=this.m_controls.length;this.m_axisX=b.axisX;this.m_axisY=b.axisY;this.m_cX=b.cX;this.m_cY=b.cY;this.m_centerIndx=b.centerIdx;this.m_animationTimer=0;this.m_scrollTime=250;this.m_state=RingUIHandler.ST_IDLE;this.m_deltaAngle=2*(Application.RIGHT_TO_LEFT?-1:1)*Math.PI/this.m_numItems;Math.abs(this.m_axisX)>=Math.abs(this.m_axisY)?(this.m_deltaAngle*=-1,this.m_currentAngle=.5*Math.PI+this.m_centerIndx*this.m_deltaAngle):(this.m_deltaAngle*=
-1,this.m_currentAngle=0+this.m_centerIndx*this.m_deltaAngle);this.m_startAngle=this.m_targetAngle=this.m_currentAngle;this.m_maxScale=b.maxScale;this.m_minScale=b.minScale;this.m_hideFarItems=b.hideFar;this.movDataArr=this.m_endCallback=this.m_endCaller=null;this.isReadyToIntro=!1;this.creator=c?c:null;this.initAnimation=d?d:!1;this.init()}RingUIHandler.ST_IDLE="stIdle";RingUIHandler.ST_SCROLLING_LEFT="stScrollingLeft";RingUIHandler.ST_SCROLLING_RIGHT="stScrollingRight";
RingUIHandler.prototype.free=function(){this.m_endCallback=this.m_endCaller=this.m_controls=null};RingUIHandler.prototype.getCurrentIndex=function(){return this.m_centerIndx};RingUIHandler.prototype.getState=function(){return this.m_state};
RingUIHandler.prototype.init=function(){if(this.initAnimation)for(var a=0;a<this.m_numItems;a++)this.initControlPosition(a,this.m_currentAngle+a*this.m_deltaAngle),this.setControlPreScale(a);else{for(a=0;a<this.m_numItems;a++)this.setControlPosition(a,this.m_currentAngle+a*this.m_deltaAngle),this.setControlScale(a);if(this.creator&&this.creator.onRingIntroDone)this.creator.onRingIntroDone()}};
RingUIHandler.prototype.onEndScroll=function(){this.m_state=RingUIHandler.ST_IDLE;this.m_currentAngle=this.m_targetAngle;null!==this.m_endCaller&&null!==this.m_endCallback&&this.m_endCallback.call(this.m_endCaller)};RingUIHandler.prototype.update=function(a){if(this.movDataArr&&this.isReadyToIntro)for(var b=0;b<this.movDataArr.length;b++)if(this.movDataArr[b]){var c=this.movDataArr[b],d=c.m;c=this.m_controls[c.i];c.setX(d.getX());c.setY(d.getY());d.update(a);if(!this.movDataArr)break}};
RingUIHandler.prototype.setReadyToIntro=function(){if(null!==this.movDataArr){for(var a=0;a<this.movDataArr.length;a++)this.movDataArr[a].m.gotoPosition(this.movDataArr[a].fx,this.movDataArr[a].fy);this.isReadyToIntro=!0}};
RingUIHandler.prototype.initControlPosition=function(a,b){var c=this.m_cX+this.m_axisX*Math.cos(b);b=this.m_cY+this.m_axisY*Math.sin(b);this.m_controls[a].canvas.depth=10*b;var d=new LinearMovement(this.m_controls[a].getX(),this.m_controls[a].getY(),.9);d.setCallbacks(this,this.onEndMov,null);var e={};e.m=d;e.i=a;e.fx=c;e.fy=b;d.extraData=e;this.movDataArr||(this.movDataArr=[]);this.movDataArr.push(e)};
RingUIHandler.prototype.onEndMov=function(a){var b=a.extraData,c=b.fy,d=this.m_controls[b.i];d.setX(b.fx);d.setY(c);for(c=0;c<this.movDataArr.length;c++)if(this.movDataArr[c]&&b.i===this.movDataArr[c].i){this.movDataArr[c]=null;this.movDataArr.splice(c--,1);break}if(0>=this.movDataArr.length&&(Application.log("INTRO RING DONE"),this.movDataArr=null,this.creator&&this.creator.onRingIntroDone))this.creator.onRingIntroDone();a.free()};
RingUIHandler.prototype.setControlPosition=function(a,b){var c=this.m_cY+this.m_axisY*Math.sin(b);this.m_controls[a].setX(this.m_cX+this.m_axisX*Math.cos(b));this.m_controls[a].setY(c);this.m_controls[a].canvas.depth=10*c};
RingUIHandler.prototype.setControlScale=function(a){if(Math.abs(this.m_axisX)>=Math.abs(this.m_axisY)){var b=this.m_controls[a].getY();var c=this.m_cY+this.m_axisY-b;b=1-c/(2*this.m_axisY);b=this.m_minScale+(this.m_maxScale-this.m_minScale)*b;this.m_hideFarItems&&Math.abs(c)>1.25*Math.abs(this.m_axisY)&&(b=0)}else b=this.m_controls[a].getX(),c=this.m_cX+this.m_axisX-b,b=1-c/(2*this.m_axisX),b=this.m_minScale+(this.m_maxScale-this.m_minScale)*b,this.m_hideFarItems&&Math.abs(c)>1.25*Math.abs(this.m_axisX)&&
(b=0);this.m_controls[a].canvas.scale.set(b)};
RingUIHandler.prototype.setControlPreScale=function(a){if(Math.abs(this.m_axisX)>=Math.abs(this.m_axisY)){var b=this.m_cY+this.m_axisY-this.movDataArr[a].fy;var c=1-b/(2*this.m_axisY);c=this.m_minScale+(this.m_maxScale-this.m_minScale)*c;this.m_hideFarItems&&Math.abs(b)>1.25*Math.abs(this.m_axisY)&&(c=0)}else b=this.m_cX+this.m_axisX-this.movDataArr[a].fx,c=1-b/(2*this.m_axisX),c=this.m_minScale+(this.m_maxScale-this.m_minScale)*c,this.m_hideFarItems&&Math.abs(b)>1.25*Math.abs(this.m_axisX)&&(c=0);
this.m_controls[a].canvas.scale.set(c)};RingUIHandler.prototype.setEndScroll=function(a,b){this.m_endCaller=a;this.m_endCallback=b};
RingUIHandler.prototype.startScrollLeft=function(){this.m_state=RingUIHandler.ST_SCROLLING_LEFT;this.m_targetAngle+=this.m_deltaAngle;this.m_startAngle=this.m_currentAngle;this.m_animationTimer=0;this.m_centerIndx+=Application.RIGHT_TO_LEFT?1:-1;this.m_centerIndx=(this.m_centerIndx+this.m_numItems)%this.m_numItems;Tween2.get({angle:this.m_startAngle,parent:this,f:this.updateControls},{onChange:function(a){a=a.target;a.f.call(a.parent,a.angle)}}).to({angle:this.m_targetAngle},this.m_scrollTime,TweenEasing.QuadraticOut).call(this.onEndScroll,
null,this)};
RingUIHandler.prototype.startScrollRight=function(){this.m_state=RingUIHandler.ST_SCROLLING_RIGHT;this.m_targetAngle-=this.m_deltaAngle;this.m_startAngle=this.m_currentAngle;this.m_animationTimer=0;this.m_centerIndx+=Application.RIGHT_TO_LEFT?-1:1;this.m_centerIndx=(this.m_centerIndx+this.m_numItems)%this.m_numItems;Tween2.get({angle:this.m_startAngle,parent:this,f:this.updateControls},{onChange:function(a){a=a.target;a.f.call(a.parent,a.angle)}}).to({angle:this.m_targetAngle},this.m_scrollTime,TweenEasing.QuadraticOut).call(this.onEndScroll,
null,this)};RingUIHandler.prototype.updateControls=function(a){for(var b=0;b<this.m_numItems;b++)this.setControlPosition(b,a+b*this.m_deltaAngle),this.setControlScale(b)};RingUIHandler.prototype.isIdle=function(){return this.m_state===RingUIHandler.ST_IDLE};
function GuiLoader(a,b,c,d,e,f,g,h){SLoaderScreen.call(this,a,b,c,d,e,f,g,h);GuiLoader.instance=this;(this.txtLoading=this.controls.mcGuiTxtLoading)&&this.txtLoading.setTextReplace("STR_LOADING_PERCENT","#",this.m_start);this.mcGuiLoaderFill=null;this.controls.mcGuiBar&&(this.mcGuiLoaderFill=this.getControl("mcGuiBar"),this.mcGuiLoaderFill.clip.gotoAndStop(e))}Application.subclass(GuiLoader,SLoaderScreen);GuiLoader.instance=null;
GuiLoader.prototype.free=function(){this.mcGuiLoaderFill=null;GuiLoader.instance=null;SLoaderScreen.prototype.free.call(this)};
GuiLoader.prototype.onFileLoaded=function(){SLoaderScreen.prototype.onFileLoaded.call(this);var a=this.m_start;a+=this.m_loadedfiles/this.m_totalFiles*(this.m_end-this.m_start);a=parseInt(a,10);this.mcGuiLoaderFill&&this.mcGuiLoaderFill.clip.gotoAndStop(a);this.txtLoading&&this.txtLoading.setTextReplace("STR_LOADING_PERCENT","#",a);Application.info("onLoadProgress > "+this.m_loadedfiles+" of "+this.m_totalFiles+" percent : "+a+"%")};
GuiLoader.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);"mcGuiBtnNext"===this.lastInteractionControl&&GuiManager.instance.gotoScreen(this.m_nextScreen)};GuiLoader.prototype.onUIPress=function(a){Application.instance.fullScreen();this.lastInteractionControl=a.name};GuiLoader.prototype.onUIRelease=function(a){switch(a.name){case "mcGuiBtnNext":Application.instance.hideAddressBar(),this.onResumeScreen()}};
function GuiEndGame(a,b,c){var d=Global.fightSettings.storyMode||Global.fightSettings.isChallenge()?"mcGuiScreenEndlevel":0===GuiEndGame.idPlayerWin?"mcGuiScreenEndlevel":"mcGuiScreenRematch";SScreen.call(this,d,a,b,c);this.m_charaLose=this.getControl("mcGuiCharacterLose");this.m_charaWin=this.getControl("mcGuiCharacterWin");this.m_winTxt=this.getControl("mcGuiTxtVictoryQuote");this.initControls();Application.instance.stopAllSounds();Global.aiMode===AICore.MODE_NONE?Application.instance.playSound("SND_BG_WIN"):
Application.instance.playSound(0===GuiEndGame.idPlayerWin?"SND_BG_WIN":"SND_BG_LOSE");this.extraBg=this.m_storyDiag=this.timer=null;this.prepareDlog()}Application.subclass(GuiEndGame,SScreen);GuiEndGame.idPlayerWin=0;
GuiEndGame.prototype.prepareDlog=function(){Global.fightSettings.storyMode&&0===GuiEndGame.idPlayerWin&&6!==DataHero.getCharaId(Global.fightSettings.p2CharId)&&(this.getControl("mcGuiBtnMainmenu").setVisible(!1),this.getControl("mcGuiBtnChange").setVisible(!1),this.getControl("mcGuiBtnRestart").setVisible(!1),this.getControl("mcGuiBtnNext").setVisible(!1),this.timer=new SInterval(this,"onEndInterval",3E3))};
GuiEndGame.prototype.onEndInterval=function(){this.timer.free();this.timer=null;var a=DataHero.getCharaId(Global.fightSettings.p1CharId);a="STORY_POST_FIGHT_"+DataHero.getCharaId(Global.fightSettings.p2CharId)+"_"+a;DialogueNode.exists(a)&&(this.m_storyDiag=new GuiDialogue("mcGuiPopupDialogue"),this.m_storyDiag.onComplete(this,this.onDialogueEnd),this.addPopup(this.m_storyDiag),this.m_storyDiag.initDialogue(a),this.extraBg=Application.instance.getClip("gui_popup_bg"),this.extraBg.setPosition(.5*Application.APP_WIDTH,
.5*Application.APP_HEIGHT),this.canvas.addChild(this.extraBg))};GuiEndGame.prototype.onDialogueEnd=function(){this.m_storyDiag=null;this.lastInteractionControl="mcGuiBtnNext";this.onResumeScreen()};
GuiEndGame.prototype.initControls=function(){var a=GuiEndGame.idPlayerWin,b=Global.fightSettings.storyMode||Global.fightSettings.isChallenge(),c=DataHero.getCharaId(0===a?Global.fightSettings.p1CharId:Global.fightSettings.p2CharId),d=DataHero.getCharaId(0!==a?Global.fightSettings.p1CharId:Global.fightSettings.p2CharId),e=0===a||!b,f=this.getControls(/mcGuiTxtWin.*$/,!1),g=this.getQuotes("STR_REP_ENDLEVEL_WIN");f.forEach(function(a){a.setVisible(e);a.setTextLocalized(this.title)},{title:Common.getRandomFromArray(g)});
g=this.getQuotes("STR_REP_ENDLEVEL_LOSE");f=this.getControls(/mcGuiTxtLose.*$/,!1);f.forEach(function(a){a.setVisible(!e);a.setTextLocalized(this.title)},{title:Common.getRandomFromArray(g)});b&&(this.getControl("mcGuiBtnChange").setVisible(!1),0===a?this.getControl("mcGuiBtnRestart").setVisible(!1):this.getControl("mcGuiBtnNext").setVisible(!1));Global.fightSettings.isChallenge()&&0===a&&this.getControl("mcGuiBtnMainmenu").setVisible(!1);this.m_charaLose.clip.gotoAndStop(DataHero.toGUIIndex(d)+1);
this.m_charaWin.setClip("gui_screens_endlevel_character_win0"+c);this.m_charaWin.setVisible(c!==DataHero.ID_CRICKET);this.getControl("mcGuiCricketWin").setVisible(c===DataHero.ID_CRICKET);a=this.getWinQuotes(c);this.m_winTxt.setTextLocalized(Common.getRandomFromArray(a))};
GuiEndGame.prototype.free=function(){GuiEndGame.idPlayerWin=0;Application.instance.effectManager.clear();this.extraBg&&(this.extraBg.free(),this.canvas.removeChild(this.extraBg),this.extraBg=null);this.timer&&(this.timer.free(),this.timer=null);SScreen.prototype.free.call(this)};
GuiEndGame.prototype.onUIRelease=function(a){SScreen.prototype.onUIRelease.call(this,a);Application.instance.playSound("SND_UI_CLICK");switch(a.name){case "mcGuiBtnMainmenu":this.onResumeScreen();break;case "mcGuiBtnChange":case "mcGuiBtnRestart":case "mcGuiBtnNext":Global.fightSettings.storyMode&&0===GuiEndGame.idPlayerWin&&StoryManager.instance.toNextStage(),this.onResumeScreen()}};
GuiEndGame.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);var a="";switch(this.lastInteractionControl){case "mcGuiBtnMainmenu":SLoader.unloadFromList(SLoader.getGameplayFiles());Application.instance.unloadSoundsFromList(Global.getBGMusicGroup());a=Global.fightSettings.isChallenge()?GuiManager.SC_CHALLENGE:GuiManager.SC_MAIN_MENU;break;case "mcGuiBtnChange":SLoader.unloadFromList(SLoader.getGameplayFiles());Application.instance.unloadSoundsFromList(Global.getBGMusicGroup());
a=GuiManager.SC_CHARA_SEL;break;case "mcGuiBtnRestart":a=GuiManager.SC_GAME;break;case "mcGuiBtnNext":Global.fightSettings.storyMode?(SLoader.unloadFromList(SLoader.getCharacterFiles()),Application.instance.unloadSoundsFromList(Global.getBGMusicGroup()),StoryManager.instance.getCurrentOpponent()===DataHero.ID_TILLY||StoryManager.instance.getCurrentOpponent()===DataHero.ID_CRICKET?(GuiDialogCutscene.current=2,a=GuiManager.SC_CUTSCENE):a=GuiManager.SC_GAME):(SLoader.unloadFromList(SLoader.getGameplayFiles()),
Application.instance.unloadSoundsFromList(Global.getBGMusicGroup()),a=Global.fightSettings.isChallenge()?GuiManager.SC_CHALLENGE:GuiManager.SC_MAIN_MENU)}Global.fightSettings.storyMode&&0===GuiEndGame.idPlayerWin&&StoryManager.instance.toNextStage();GuiManager.instance.gotoScreen(a)};GuiEndGame.prototype.getWinQuotes=function(a){a=DataHero.getData(a).name.toUpperCase();return this.getQuotes("STR_REP_WIN_QUOTE_"+a)};
GuiEndGame.prototype.getQuotes=function(a){a=new RegExp(a);var b=[],c;for(c in Application.strings)Application.strings.hasOwnProperty(c)&&a.test(c)&&b.push(c);return b};GuiEndGame.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.timer&&this.timer.update(a)};
function GuiFinishGame(a,b,c){SScreen.call(this,"mcGuiScreenEndGame",a,b,c);this.actMan=new ActionManager;Application.instance.stopAllSounds();Application.instance.playSound("SND_BG_END_GAME");this.actMan.addCallback(this,function(){Application.instance.playSound("VO_CUTSCENE12")},1750);SavedData.instance.challengesEnabled()||(SavedData.instance.unlockChallenges(),GuiMainMenu.challPopupPending=!0);SavedData.instance.hardModeEnabled()||StoryManager.instance.getDifficulty()!==AICore.MODE_MEDIUM||(SavedData.instance.unlockHardMode(),
GuiMainMenu.hardPopupPending=!0);Global.fightSettings.p1CharId===DataHero.ID_CRICKET?this.getControl("mcGuiCharacters02").setVisible(!1):this.getControl("mcGuiCharacters").setVisible(!1)}Application.subclass(GuiFinishGame,SScreen);GuiFinishGame.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.actMan.update(a)};
GuiFinishGame.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnMainmenu":Application.instance.stopSound("SND_BG_END_GAME"),GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU),SLoader.unloadFromList(SLoader.getGameplayFiles()),Application.instance.unloadSoundsFromList(Global.getBGMusicGroup())}};
GuiFinishGame.prototype.onUIRelease=function(a){SScreen.prototype.onUIRelease.call(this,a);Application.instance.playSound("SND_UI_CLICK");switch(a.name){case "mcGuiBtnMainmenu":this.onResumeScreen()}};
function GuiGame(){SScreen.call(this,"",0,0);GuiGame.instance=this;this.m_game=null;this.m_lagger=new Lagger;this.m_round=null;this.m_msgMap={};this.m_countRound=1;this.m_firstFight=!0;this.nextScreen="";this.setInteractive(!0);this.canvasGame=Application.instance.addDisplayContainer();this.canvasControl=Application.instance.addDisplayContainer();this.canvasEffects=Application.instance.addDisplayContainer();this.canvas.addChild(this.canvasGame);this.canvas.addChild(this.canvasControl);this.canvas.addChild(this.canvasEffects);
this.createGame();this.fixGameScale();this.gameplayBG="SND_BG_GAMEPLAY_4";this.setBGMusic();this.m_game.createModifier();this.zoomScaleNormalHit=Application.config.camera.zoomScaleNormalHit;this.zoomScaleFinalHit=Application.config.camera.zoomScaleFinalHit;this.screenFreezeTime=Application.config.camera.screenFreezeTime;this.screenFreezeTimeFinal=Application.config.camera.screenFreezeTimeFinal;this.m_popupQueue=[];this.m_msgPopup=null;this.p1Id=Global.fightSettings.p1CharId;this.p2Id=Global.fightSettings.p2CharId;
this.tutorialMode=Global.fightSettings.tutorialMode;this.bonusMode=Global.fightSettings.bonusStage;Global.reportPlayableSpace()}Application.subclass(GuiGame,SScreen);GuiGame.MSG_PERF="msg_perfect";GuiGame.MSG_DESTR="msg_destroyed";GuiGame.MSG_CHALL="msg_challenge";GuiGame.MSG_SKIN="msg_skin";
GuiGame.prototype.free=function(){Application.instance.tweenManager.removeAll();Application.instance.effectManager.clear();null!==this.m_game&&(this.m_game.free(),this.m_game=null);null!==this.m_lagger&&(this.m_lagger.free(),this.m_lagger=null);this.canvas.removeChild(this.canvasGame);this.canvasGame.free();this.canvasGame=null;this.canvas.removeChild(this.canvasControl);this.canvasControl.free();this.canvasControl=null;this.canvas.removeChild(this.canvasEffects);this.canvasEffects.free();this.canvasEffects=
null;SScreen.prototype.free.call(this);switch(this.nextScreen){case GuiManager.SC_END_GAME:case GuiManager.SC_FINISH_GAME:break;case GuiManager.SC_GAME:if(Global.fightSettings.p1CharId!==this.p1Id||Global.fightSettings.p2CharId!==this.p2Id)SLoader.unloadFromList(SLoader.getCharacterFiles(this.p1Id,this.p2Id)),Application.instance.unloadSoundsFromList(Global.getBGMusicGroup());break;default:SLoader.unloadFromList(SLoader.getGameplayFiles()),Application.instance.unloadSoundsFromList(Global.getBGMusicGroup())}GuiGame.instance=
null};GuiGame.instance=null;GuiGame.prototype.onStart=function(){this.m_firstFight=!1;if(this.m_game&&this.m_game.onStart)this.m_game.onStart()};GuiGame.prototype.onFXRound=function(a){this.m_firstFight||(a?this.m_round=Application.instance.effectManager.createEffectGui("mcGuiMessageTieBreaker",0,0,this.canvas):(this.m_countRound++,this.m_round=this.createCountdownFx(!1)),this.m_round.onComplete(this,this.onStart))};
GuiGame.prototype.onNewTrophy=function(a,b,c){this.m_popupQueue.push(new GuiMsgInfo(a,b,c,GuiMsgInfo.TYPE_TROPHY))};GuiGame.prototype.onNewCharacter=function(a,b,c){this.m_popupQueue.push(new GuiMsgInfo(a,b,c,GuiMsgInfo.TYPE_NEW_CHAR))};GuiGame.prototype.onNewSkin=function(a,b,c){this.m_popupQueue.push(new GuiMsgInfo(a,b,c,GuiMsgInfo.TYPE_NEW_SKIN))};
GuiGame.prototype.createMsgPopup=function(a){switch(a.type){case GuiMsgInfo.TYPE_TROPHY:this.createTrophyPopup(a);break;case GuiMsgInfo.TYPE_NEW_CHAR:this.createNewCharPopup(a);break;case GuiMsgInfo.TYPE_NEW_SKIN:this.createNewSkinPopup(a)}Application.instance.isPlayingSound("SND_PERFECT")||Application.instance.isPlayingSound("SND_DESTROYED")||Application.instance.isPlayingSound("SND_CHALLENGE_COMPLETED")||Application.instance.playSound("SND_NEW_ACHIEVEMENT");SavedData.instance.isFirstAchievement()&&
(this.addPopup(this.m_msgPopup),this.m_msgPopup.delay=3500,this.m_msgPopup.addBackground(),SavedData.instance.onFirstAchieve())};GuiGame.prototype.createTrophyPopup=function(a){var b=new GuiPopupTrophy(0,0,this,a.itemId),c=b.getControl("mcGuiTxtDescription"),d=b.getControl("mcGuiTxtTitle");c.setTextLocalized(a.desc);d.setTextLocalized(a.title);this.m_msgPopup=b};
GuiGame.prototype.createNewCharPopup=function(a){var b=new GuiPopupNewChar(0,0,this,a.itemId),c=b.getControl("mcGuiTxtDescription"),d=b.getControl("mcGuiTxtTitle");c.setTextReplace(a.desc,"#",Application.strings["STR_REP_MESSAGE_CHARACTERNAME_"+a.itemId].value);d.setTextLocalized(a.title);this.m_msgPopup=b};
GuiGame.prototype.createNewSkinPopup=function(a){var b=new GuiPopupNewSkin(0,0,this,a.itemId),c=b.getControl("mcGuiTxtDescription"),d=b.getControl("mcGuiTxtTitle");c.setTextReplace(a.desc,"#",Application.strings["STR_REP_MESSAGE_CHARACTERNAME_"+a.itemId].value);d.setTextLocalized(a.title);this.m_msgPopup=b};GuiGame.prototype.trophyPopupsDone=function(){return 0===this.m_popupQueue.length&&null===this.m_msgPopup};
GuiGame.prototype.createMessage=function(a,b){this.m_msgMap[a]=Application.instance.effectManager.createEffectGui(b,0,0,this.canvas);this.m_msgMap[a].onComplete({id:a,gui:this},function(){this.gui.deleteMessage(this.id)});switch(a){case GuiGame.MSG_PERF:Application.instance.playSound("SND_PERFECT");break;case GuiGame.MSG_DESTR:Application.instance.playSound("SND_DESTROYED");break;case GuiGame.MSG_CHALL:Application.instance.playSound("SND_CHALLENGE_COMPLETED")}};
GuiGame.prototype.deleteMessage=function(a){this.m_msgMap.hasOwnProperty(a)&&(this.m_msgMap[a]=null,delete this.m_msgMap[a])};GuiGame.prototype.getMessage=function(a){return this.m_msgMap.hasOwnProperty(a)?this.m_msgMap[a]:null};GuiGame.prototype.messageFinished=function(a){return null===this.getMessage(a)};
GuiGame.prototype.createCountdownFx=function(a){Application.instance.playSound("SND_ROUND");var b=Application.instance.effectManager.createEffectGui("mcGuiMessageRound",0,0,this.canvas),c=Global.fightSettings.tutorialMode?"STR_REP_MESSAGE_TRAINING":"STR_REP_MESSAGE_ROUND";b.getControl("mcGuiTxtRound").setTextReplace(c,"#",this.m_countRound);b.getControl("mcGuiTxtRound_S").setTextReplace(c+"_S","#",this.m_countRound);b.getControl("mcGuiTxtRound1").setTextReplace(c,"#",this.m_countRound);b.getControl("mcGuiTxtRound2").setTextReplace(c,
"#",this.m_countRound);b.getControl("mcGuiTxtRound3").setTextReplace(c,"#",this.m_countRound);b.getControl("mcGuiTxtRound4").setTextReplace(c,"#",this.m_countRound);if(a)b.onComplete(this,this.onStart);return b};
GuiGame.prototype.createWinFx=function(a){var b=Application.instance.effectManager.createEffectGui("mcGuiMessagePlayerWins",0,0,this.canvas),c=b.getControl("mcGuiTxtCharacterName"),d=b.getControl("mcGuiTxtCharacterNameS");c.setTextLocalized("STR_REP_MESSAGE_CHARACTERNAME_"+a);d.setTextLocalized("STR_REP_MESSAGE_CHARACTERNAME_"+a);Application.instance.playSound("SND_MESSAGE_WIN");return b};
GuiGame.prototype.fixGameScale=function(){FighterHUD.instance&&FighterHUD.instance.fixGameScale();this.canvasGame&&(Application.WIDE_SCREEN?(this.canvasGame.position.x=-Layout.left/Layout.scale,this.canvasGame.position.y=-Layout.top/Layout.scale,this.adjustCamera(Global.fighterCameraScale),FighterGame.instance.world().camera().setUnscaleLimits()):(this.canvasGame.position.x=0,this.canvasGame.position.y=0),this.m_game&&this.m_game.fixGameScale())};
GuiGame.prototype.createGame=function(){if(Application.sandbox){Application.log("-----------------------------------");Application.log("SANDBOX START SETTINGS");for(var a in Application.sandbox.startSettings)Application.log("SANDBOX "+a+" : "+Application.sandbox.startSettings[a]);Application.log("-----------------------------------")}Global.comingFromSandbox&&(Application.instance.isMobileDevice=Application.sandbox.startSettings.setAsMobileDevice);a=Global.aiMode;if(!StoryManager.instance&&!Global.fightSettings.isChallenge()&&
!Global.comingFromSandbox)switch(a){case AICore.MODE_EASY:a=3;break;case AICore.MODE_MEDIUM:a=5;break;case AICore.MODE_HARD:a=8}this.m_game=new FighterGame(this.canvasGame,this.canvasControl,"fighter_stage0",a)};
GuiGame.prototype.gameFinished=function(a){var b=StoryManager.instance;Global.fightSettings.tutorialMode?Global.fightSettings.tutorialReturn?GuiGame.instance.removeGame(GuiManager.SC_MAIN_MENU):(Global.fightSettings.storyMode?b.toNextStage():(Global.fightSettings.p2CharId=Global.fightSettings.p2CharIdSaved,Global.fightSettings.modEnabled=!0,Global.fightSettings.tutorialMode=!1),GuiGame.instance.removeGame(GuiManager.SC_GAME)):b?Global.fightSettings.bonusStage?(b.toNextStage(),this.removeGame(GuiManager.SC_GAME)):
1===a||0===a&&!b.lastStage()?(1==a?b.perfectRun=!1:SavedData.instance.saveStoryProgress(Global.fightSettings.p1CharId,b.getDifficulty(),b.getLevel()+1),this.removeGame(GuiManager.SC_END_GAME)):0===a&&(SavedData.instance.clearStoryProgress(),this.removeGame(GuiManager.SC_FINISH_GAME)):GuiGame.instance.removeGame(GuiManager.SC_END_GAME)};GuiGame.prototype.removeGame=function(a){null!==this.m_game&&(this.nextScreen=a,this.m_game.free(),this.m_game=null,GuiManager.instance.gotoScreen(a))};
GuiGame.prototype.onDebugDraw=function(a){if(null!==this.m_game)this.m_game.onDebugDraw(a)};GuiGame.prototype.onPointerPress=function(a){var b=Layout.fixInteractionEvent(a);if(this.m_popup)this.m_popup.onPointerPress(a);else if(this.m_game)this.m_game.onPointerPress(b)};GuiGame.prototype.onPointerRelease=function(a){var b=Layout.fixInteractionEvent(a);if(this.m_popup)this.m_popup.onPointerRelease(a);else if(this.m_game)this.m_game.onPointerRelease(b)};
GuiGame.prototype.onPointerMove=function(a){var b=Layout.fixInteractionEvent(a);if(this.m_popup)this.m_popup.onPointerMove(a);else if(this.m_game)this.m_game.onPointerMove(b)};GuiGame.prototype.onKeyUp=function(a){SScreen.prototype.onKeyUp.call(this,a);if(null!==this.m_popup)this.m_popup.onKeyUp(a);else if(null!==this.m_game)this.m_game.onKeyUp(a)};GuiGame.prototype.onKeyDown=function(a){SScreen.prototype.onKeyDown.call(this,a);if(null!==this.m_popup)this.m_popup.onKeyDown(a);else if(null!==this.m_game)this.m_game.onKeyDown(a)};
GuiGame.prototype.game=function(){return this.m_game};GuiGame.prototype.update=function(a){SScreen.prototype.update.call(this,a);null!==this.m_game&&null==this.m_popup&&this.m_game.update(a);this.m_msgPopup&&(this.m_msgPopup.update(a),this.m_msgPopup.isFinished()&&(this.m_popup?this.dropPopup():this.m_msgPopup.free(),this.m_msgPopup=null));0<this.m_popupQueue.length&&null===this.m_msgPopup&&(a=this.m_popupQueue.splice(0,1)[0],this.createMsgPopup(a))};
GuiGame.prototype.adjustCamera=function(a){this.canvasGame.scale.x=a;this.canvasGame.scale.y=a;this.canvasEffects.scale.x=a;this.canvasEffects.scale.y=a;var b=FighterGame.instance.world();b.scaleWorld();var c=b.width();b.height();var d=b.camera();c=this.canvasGame.position.x+.5*c;b.bgOffX=c+Layout.left/Layout.scale-.5*d.width();b.bgOffY=d.height();d.setX(b.bgOffX);d.setY(b.bgOffY);d.setWidth(d.width()/a);d.setHeight(d.height()/a);d.resetMinMax();d.setX(c+Layout.left/Layout.scale-.5*d.width());d.setY(1232-
.5*d.height())};GuiGame.prototype.isFirstFight=function(){return this.m_firstFight};
GuiGame.prototype.setBGMusic=function(){switch(Global.fightSettings.getStageData().name){case "zoo":this.gameplayBG="SND_BG_GAMEPLAY_4";break;case "big_coffee":this.gameplayBG="SND_BG_GAMEPLAY_2";break;case "street":this.gameplayBG="SND_BG_GAMEPLAY_6";break;case "park":this.gameplayBG=Global.fightSettings.storyMode?"SND_BG_BILL":"SND_BG_GAMEPLAY_5";break;case "house_front":this.gameplayBG=Global.fightSettings.modEnabled&&Global.fightSettings.storyMode?"SND_BG_GRAMMA":"SND_BG_GAMEPLAY_1";break;case "subway":this.gameplayBG=
"SND_BG_GAMEPLAY_3";break;case "house_back":this.gameplayBG="SND_BG_GAMEPLAY_1"}Application.instance.stopAllSounds();Application.instance.playSound(this.gameplayBG)};function GuiMsgInfo(a,b,c,d){this.title=a;this.desc=b;this.itemId=c;this.type=d}GuiMsgInfo.TYPE_TROPHY=0;GuiMsgInfo.TYPE_NEW_CHAR=1;GuiMsgInfo.TYPE_NEW_SKIN=2;
function GuiChallenge(a,b,c,d){SScreen.call(this,a,b,c,d);this.m_scrollPress=this.m_pressButton=this.m_finish=!1;this.m_baseScrollX=this.getControl("mcGuiBtnScroll03").canvas.position.x;this.m_baseContentX=this.getControl("mcGuiItemChallenge").canvas.position.x;this.m_content=[];this.m_eventId=-1;this.m_sliderInitIdx=0;this.setInteractive(!0);this.mask=(new window.PIXI.Graphics).beginFill(391829).drawRect(0,0,720,520);this.getControl("mcGuiMask").canvas.addChild(this.mask);this.getControl("mcGuiItemChallenge").canvas.mask=
this.mask;for(a=0;a<GuiChallenge.TOTAL_CONTENTS;a++)b=new GuiChallengeItems("mcGuiItemChallenge",this,a+1),b.clip.position.x=0,b.clip.position.y=GuiChallenge.OFFSET_Y*a,this.getControl("mcGuiItemChallenge").canvas.addChild(b.canvas),this.m_content.push(b);Application.instance.isPlayingSound("SND_BG_MAINMENU")||(Application.instance.stopAllSounds(),Application.instance.playSound("SND_BG_MAINMENU"))}Application.subclass(GuiChallenge,SScreen);GuiChallenge.TOTAL_CONTENTS=15;GuiChallenge.OFFSET_Y=155;
GuiChallenge.MIN_SCROLLING=230;GuiChallenge.MAX_SCROLLING=590;GuiChallenge.INIT_CONTENT_ITEM_Y=280;GuiChallenge.CONTENT_ITEM_VIEW=500;GuiChallenge.prototype.free=function(){for(var a=0;a<this.m_content.length;a++)this.getControl("mcGuiItemChallenge").canvas.removeChild(this.m_content[a].canvas);this.getControl("mcGuiMask").canvas.removeChild(this.mask);this.m_content=null;SScreen.prototype.free.call(this)};
GuiChallenge.prototype.onPointerMove=function(a){this.m_scrollPress&&!this.m_finish&&(a=Layout.fixInteractionEvent(a),this.movePanel(a.data.global.y))};GuiChallenge.prototype.onPointerPress=function(a){var b=Layout.fixInteractionEvent(a);a=b.data.global.x;b=b.data.global.y;840<a&&900>a&&200<b&&660>b&&(this.m_scrollPress=!0,this.movePanel(b))};GuiChallenge.prototype.onPointerRelease=function(a){this.m_scrollPress=!1};
GuiChallenge.prototype.movePanel=function(a){a=a>=GuiChallenge.MIN_SCROLLING&&a<=GuiChallenge.MAX_SCROLLING?a:a<GuiChallenge.MIN_SCROLLING?GuiChallenge.MIN_SCROLLING:GuiChallenge.MAX_SCROLLING;this.getControl("mcGuiBtnScroll03").canvas.position.x=this.m_baseScrollX+.018*a-4;this.getControl("mcGuiBtnScroll03").canvas.position.y=a;a-=GuiChallenge.MIN_SCROLLING;var b=GuiChallenge.OFFSET_Y*this.m_content.length-GuiChallenge.CONTENT_ITEM_VIEW;this.getControl("mcGuiItemChallenge").canvas.position.y=GuiChallenge.INIT_CONTENT_ITEM_Y-
a*b*.0028};
GuiChallenge.prototype.onNextScreen=function(){for(var a=[this.getControl("mcGuiItemChallenge"),this.getControl("mcGuiMask"),this.getControl("mcGuiFrame"),this.getControl("mcGuiScrollbar"),this.getControl("mcGuiBoard"),this.getControl("mcGuiBtnScroll03")],b=0;b<a.length;b++)Common.tween({parent:this,clip:a[b].canvas,y:a[b].canvas.position.y},{y:a[b].canvas.position.y+800},1E3,!0,0,TweenEasing.ElasticIn),Common.tween({parent:this,clip:a[b].canvas,alpha:1},{alpha:0},1E3,!0,0,TweenEasing.ElasticIn);Common.tween({parent:this,
clip:this.getControl("mcGuiTitlebase").canvas,alpha:1},{alpha:0},600,!0,0,TweenEasing.ElasticIn);Common.tween({parent:this,clip:this.getControl("mcGuiTxtChallenge").canvas,alpha:1},{alpha:0},600,!0,0,TweenEasing.ElasticIn);Common.tween({parent:this,clip:this.getControl("mcGuiBtnBack").canvas,sx:.9,sy:.9},{sx:1.2,sy:1.2},800,!0,0,TweenEasing.ElasticIn);Common.tween({parent:this,clip:this.getControl("mcGuiBtnBack").canvas,alpha:1,onComplete:this.onCompletedTween},{alpha:0},500,!0,500,TweenEasing.LinearNone)};
GuiChallenge.prototype.onCompletedTween=function(a){switch(this.lastInteractionControl){case "mcGuiBtnBack":GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU)}/mcGuiBtnChallenge/.test(this.lastInteractionControl)&&GuiManager.instance.gotoScreen(GuiManager.SC_GAME)};
GuiChallenge.prototype.onUIPress=function(a){if(!this.m_pressButton&&!this.m_finish)switch(SScreen.prototype.onUIPress.call(this,a),a.name){case "mcGuiBtnBack":this.m_pressButton=!0;this.onNextScreen();break;case "mcGuiBtnScroll03":this.m_scrollPress=!0;break;default:if(/mcGuiBtnChallenge/.test(a.name)){var b=a.name.split(/(\d+)/);this.m_finish=!0;Global.fightSettings=new DataFight;Global.fightSettings.setChallenge(parseInt(b[1],10));this.lastInteractionControl=a.name;this.onNextScreen()}}};
GuiChallenge.prototype.onResumeScreen=function(){SScreen.prototype.onResumeScreen.call(this)};GuiChallenge.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);ChallManager.allChallengesComplete()};GuiChallenge.prototype.onFinishScreen=function(){switch(this.lastInteractionControl){case "mcGuiBtnBack":GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU)}/mcGuiBtnChallenge/.test(this.lastInteractionControl)&&GuiManager.instance.gotoScreen(GuiManager.SC_GAME)};
GuiChallenge.prototype.update=function(a){if(!this.m_finish)for(var b=0;b<this.m_content.length;b++)null!==this.m_content[b]&&this.m_content[b].update(a);SScreen.prototype.update.call(this,a)};
function GuiChallengeItems(a,b,c){SScreen.call(this,a,0,0,b);this.idChallenge=c;this.isCompleted=SavedData.instance.getBoolArray(SavedData.REG_CHALLENGES,ChallManager.NUM_CHALLENGES)[c];a=Application.config.challenges[this.idChallenge];b=this.isCompleted?"":"_off";this.getControl("mcGuiBase").name="mcGuiBtnChallenge"+this.idChallenge;this.getControl("mcGuiImage").setClip("gui_screen_challenge_0"+DataHero.getCharaId(a.opponent)+b);this.overAndOutText(!1)}Application.subclass(GuiChallengeItems,SScreen);
GuiChallengeItems.prototype.overAndOutText=function(a){this.getControl("mcGuiTxtTitleOn").setTextEmpty();this.getControl("mcGuiTxtTitleOff").setTextEmpty();this.getControl("mcGuiTxtTitleOnOver").setTextEmpty();this.getControl("mcGuiTxtTitleOffOver").setTextEmpty();this.getControl("mcGuiTxtDescriptionOn").setTextEmpty();this.getControl("mcGuiTxtDescriptionOff").setTextEmpty();this.getControl("mcGuiTxtDescriptionOnOver").setTextEmpty();this.getControl("mcGuiTxtDescriptionOffOver").setTextEmpty();var b=
this.isCompleted?"On":"Off",c="mcGuiTxtDescription"+b+""+(a?"Over":"");this.getControl("mcGuiTxtTitle"+b+""+(a?"Over":"")).setTextLocalized("STR_REP_CHALLENGE_TITLE_N"+this.idChallenge);this.getControl(c).setTextLocalized("STR_REP_CHALLENGE_DESCRIPTION_N"+this.idChallenge);this.getControl("mcGuiImage").clip.setScale(a?1.15:1,a?1.15:1)};GuiChallengeItems.prototype.onUIPress=function(a,b){SScreen.prototype.onUIPress.call(this,a,b);this.screenParent.onUIPress(a,b)};
GuiChallengeItems.prototype.update=function(a){SScreen.prototype.update.call(this,a)};GuiChallengeItems.prototype.onUIOver=function(a){SScreen.prototype.onUIOver.call(this,a);this.overAndOutText(!0)};GuiChallengeItems.prototype.onUIOut=function(a){SScreen.prototype.onUIOut.call(this,a);this.overAndOutText(!1)};
function GuiPopupPause(a,b,c,d){SScreen.call(this,a,b,c,d);Application.instance.effectManager.pauseAllEffects(!0);this.setInteractive(!0);this.getControl("mcGuiBtnSound").gotoState(GuiOnOff.ST_ON);Application.instance.isSoundOn()||this.getControl("mcGuiBtnSound").gotoState(GuiOnOff.ST_OFF)}Application.subclass(GuiPopupPause,SScreen);GuiPopupPause.prototype.onQuitConfirm=function(a){this.clip.visible=!0;a&&(this.screenParent.dropPopup(),GuiGame.instance.removeGame(GuiManager.SC_MAIN_MENU))};
GuiPopupPause.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnResume":Application.instance.effectManager.pauseAllEffects(!1);GuiGame.instance.dropPopup();break;case "mcGuiBtnHelp":GuiGame.instance.addPopup(new GuiPopupHelp("mcGuiScreenHelp"));break;case "mcGuiBtnMainMenu":GuiGame.instance.addPopup(new GuiPopupQuit("mcGuiPopupConfirm"));break;case "mcGuiBtnRestart":Application.instance.stopAllMusics(),GuiGame.instance.dropPopup(),
GuiGame.instance.removeGame(GuiManager.SC_GAME)}};
GuiPopupPause.prototype.onUIPress=function(a){if(this.m_state==SScreen.ST_MAINFRAME&&(SScreen.prototype.onUIPress.call(this,a),null==this.m_popup))switch(Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnHelp":case "mcGuiBtnResume":case "mcGuiBtnRestart":case "mcGuiBtnMainMenu":this.onResumeScreen();this.getControl("mcGuiSignal").clip.resume();break;case "mcGuiBtnTrophy":this.addPopup(new GuiTrophies("mcGuiScreenTrophies",0,0,this));break;case "mcGuiBtnSound":Application.instance.toggleMute(),
Application.instance.isSoundOn()&&(Application.instance.isPlayingSound(GuiGame.instance.gameplayBG)||Application.instance.playSound(GuiGame.instance.gameplayBG))}};function GuiPopupHelp(a,b,c,d){SScreen.call(this,a,b,c,d);this.isReady=!1;this.setInteractive(!0);this.m_helpItems=new GuiContentHelp("mcGuiContentHelp",this);this.getControl("mcGuiHelpItem").canvas.addChild(this.m_helpItems.canvas);this.m_onUIPress=!1;this.m_eventId=-1;this.m_sliderInitIdx=0;this.m_initPoint=new Point}
Application.subclass(GuiPopupHelp,SScreen);GuiPopupHelp.prototype.free=function(){this.getControl("mcGuiHelpItem").canvas.removeChild(this.m_helpItems.canvas);this.m_helpItems.free();this.m_initPoint=this.m_helpItems=null;SScreen.prototype.free.call(this)};
GuiPopupHelp.prototype.onPointerPress=function(a){!this.isReady||this.m_state!==SScreen.ST_MAINFRAME||0<=this.m_eventId||this.m_onUIPress||this.m_helpItems.sliderMgr().getState()!==RingUIHandler.ST_IDLE||(this.m_eventId=Common.getIdentifier(a),this.m_initPoint.x=Math.floor(a.data.global.x),this.m_initPoint.y=Math.floor(a.data.global.y))};
GuiPopupHelp.prototype.onPointerRelease=function(a){this.isReady&&(this.m_state!==SScreen.ST_MAINFRAME||this.m_eventId!==Common.getIdentifier(a)||this.m_onUIPress||this.m_helpItems.sliderMgr().getState()!==RingUIHandler.ST_IDLE?(this.m_onUIPress=!1,this.m_eventId=-1):(this.m_eventId=-1,a=Math.floor(a.data.global.x)-this.m_initPoint.x,100<Math.abs(a)&&(0<a?this.m_helpItems.sliderMgr().startScrollLeft():this.m_helpItems.sliderMgr().startScrollRight())))};
GuiPopupHelp.prototype.onUIPress=function(a){if(this.isReady&&!(this.m_state!=SScreen.ST_MAINFRAME||0<=this.m_eventId||this.m_helpItems.sliderMgr().getState()!==RingUIHandler.ST_IDLE))switch(SScreen.prototype.onUIPress.call(this,a),a.name){case "mcGuiBtnBack":this.m_onUIPress=!0;this.isReady=!1;this.onResumeScreen();break;case "mcGuiBtnScroll2":this.m_onUIPress=!0;this.m_helpItems.sliderMgr().startScrollLeft();break;case "mcGuiBtnScroll":this.m_onUIPress=!0,this.m_helpItems.sliderMgr().startScrollRight()}};
GuiPopupHelp.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.m_helpItems&&this.m_helpItems.initRingIntro()};
GuiPopupHelp.prototype.onFinishScreen=function(){switch(this.lastInteractionControl){case "mcGuiBtnBack":if(GuiGame.instance)this.screenParent.dropPopup(),GuiGame.instance.addPopup(new GuiPopupPause("mcGuiPopupPause"));else{SLoader.unloadTextureFromJson(window.SWT_BUNDLES["media_help"+(Application.RIGHT_TO_LEFT?"_rtl":"")]);GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU);var a=GuiManager.instance.currentScreen;a.addPopup(new GuiPopupModes(0,0,a))}}};GuiPopupHelp.prototype.onEndScroll=function(){};
GuiPopupHelp.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_helpItems&&this.m_helpItems.update(a)};
function GuiContentHelp(a,b){SScreen.call(this,a,0,0,b);this.clip.sortByDepth=!0;this.m_helpItems=[];a=[];for(var c=1;c<=GuiContentHelp.TOTAL_ITEMS;++c){var d=new GuiPopupHelpItems("mcGuiItemHelp",this,c);this.getControl("mcGuiBase"+c).canvas.addChild(d.canvas);this.m_helpItems.push(d);d=this.getControl("mcGuiBase"+c);a.push(d)}this.m_sliderMgr=new RingUIHandler(a,{cX:0,cY:0,axisX:220,axisY:1,centerIdx:0,maxScale:.9,minScale:.4,hideFar:!1},this);this.m_sliderMgr.setEndScroll(b,b.onEndScroll)}
Application.subclass(GuiContentHelp,SScreen);GuiContentHelp.TOTAL_ITEMS=6;GuiContentHelp.prototype.free=function(){null!==this.m_sliderMgr&&(this.m_sliderMgr.free(),this.m_sliderMgr=null);for(var a=0;a<this.m_helpItems.length;a++)this.getControl("mcGuiBase"+(a+1)).canvas.removeChild(this.m_helpItems[a].canvas);SScreen.prototype.free.call(this)};GuiContentHelp.prototype.onRingIntroDone=function(){this.screenParent.isReady=!0};GuiContentHelp.prototype.sliderMgr=function(){return this.m_sliderMgr};
GuiContentHelp.prototype.initRingIntro=function(){this.m_sliderMgr&&this.m_sliderMgr.setReadyToIntro()};GuiContentHelp.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_sliderMgr&&this.m_sliderMgr.update(a)};
function GuiPopupHelpItems(a,b,c){SScreen.call(this,a,0,0,b);this.getControl("mcGuiImg").setClip("gui_screen_help_img"+c);this.getControl("mcGuiTxtTitle").setTextLocalized("STR_REP_HELP_TITLE_"+c);a=Application.instance.isMobileDevice?"":"PC_";this.getControl("mcGuiTextDescription").setTextLocalized("STR_HELP_DESCRIPTION_"+a+c)}Application.subclass(GuiPopupHelpItems,SScreen);
function GuiPopupTutorial(a,b,c){SScreen.call(this,Application.instance.isMobileDevice?"mcGuiTutorialMovilButtonComplete":"mcGuiTutorialButtonComplete",a,b,c);this.m_timer=0;this.setInteractive(!0);Application.instance.isMobileDevice?this.getControls(/mcGuiSkipText/,!1).forEach(function(a){a.setTextLocalized("STR_REP_TUTORIAL_SKIP_M")}):this.initPCKeys();this.canvas.parent.removeChild(this.canvas)}Application.subclass(GuiPopupTutorial,SScreen);GuiPopupTutorial.MIN_TUTORIAL_TIME=2E3;
GuiPopupTutorial.MAX_TUTORIAL_TIME=6E4;
GuiPopupTutorial.prototype.initPCKeys=function(){this.initKey("mcGuiTxt01","mcGuiClip01","STR_REP_TUTORIAL_BTN_JUMP_P1");this.initKey("mcGuiTxt02","mcGuiClip02","STR_REP_TUTORIAL_BTN_DIVE_P1");this.initKey("mcGuiTxt03","mcGuiClip03","STR_REP_TUTORIAL_BTN_BACK_P1");this.initKey("mcGuiTxt04","mcGuiClip04","STR_REP_TUTORIAL_BTN_FWD_P1");this.initKey("mcGuiTxt05","mcGuiClip05","STR_REP_TUTORIAL_BTN_SPEC_P1");this.initKey("mcGuiTxt06","mcGuiClip06","STR_REP_TUTORIAL_BTN_JUMP_P2");this.initKey("mcGuiTxt07",
"mcGuiClip07","STR_REP_TUTORIAL_BTN_DIVE_P2");this.initKey("mcGuiTxt08","mcGuiClip08","STR_REP_TUTORIAL_BTN_BACK_P2");this.initKey("mcGuiTxt09","mcGuiClip09","STR_REP_TUTORIAL_BTN_FWD_P2");this.initKey("mcGuiTxt09","mcGuiClip10","STR_REP_TUTORIAL_BTN_SPEC_P2")};GuiPopupTutorial.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_timer+=a;this.m_state===SScreen.ST_MAINFRAME&&this.m_timer>GuiPopupTutorial.MAX_TUTORIAL_TIME&&(this.m_timer=0,this.onResumeScreen())};
GuiPopupTutorial.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);this.screenParent.dropPopup()};GuiPopupTutorial.prototype.initKey=function(a,b,c){-1!==Application.strings[c].value.search("ARROW")?this.getControl(a).setVisible(!1):(this.setControlText(a,c),this.getControl(b)&&this.getControl(b).setVisible(!1))};GuiPopupTutorial.prototype.onPointerPress=function(a){SScreen.prototype.onPointerPress.call(this,a);if(this.m_state===SScreen.ST_MAINFRAME&&this.m_timer>GuiPopupTutorial.MIN_TUTORIAL_TIME)this.onResumeScreen()};
GuiPopupTutorial.prototype.onKeyDown=function(a){SScreen.prototype.onKeyDown.call(this,a);if(this.m_state===SScreen.ST_MAINFRAME&&this.m_timer>GuiPopupTutorial.MIN_TUTORIAL_TIME)this.onResumeScreen()};function GuiPopupSelectVS(a,b,c,d){SScreen.call(this,a,b,c,d);this.setInteractive(!0)}Application.subclass(GuiPopupSelectVS,SScreen);GuiPopupSelectVS.prototype.free=function(){SScreen.prototype.free.call(this)};GuiPopupSelectVS.prototype.init=function(){SScreen.prototype.init.call(this)};
GuiPopupSelectVS.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnVSPlayer":Global.aiMode=AICore.MODE_NONE;StoryManager.clearInstance();GuiManager.instance.gotoScreen(GuiManager.SC_CHARA_SEL);break;case "mcGuiBtnVSCpu":StoryManager.clearInstance();GuiManager.instance.gotoScreen(GuiManager.SC_DIFFICULTY);break;case "mcGuiBtnClose":var a=this.screenParent;this.screenParent.dropPopup();a.addPopup(new GuiPopupModes)}};
GuiPopupSelectVS.prototype.onUIRelease=function(a){SScreen.prototype.onUIRelease.call(this,a);Application.instance.hideAddressBar();switch(a.name){case "mcGuiBtnClose":case "mcGuiBtnVSCpu":case "mcGuiBtnVSPlayer":Application.instance.playSound("SND_UI_CLICK"),this.onResumeScreen()}};function GuiPopupReset(a,b,c,d){SScreen.call(this,a,b,c,d);Application.instance.effectManager.pauseAllEffects(!0);this.setInteractive(!0)}Application.subclass(GuiPopupReset,SScreen);
GuiPopupReset.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnNo":this.screenParent.dropPopup();break;case "mcGuiBtnYes":SavedData.instance.resetData(),this.screenParent.dropPopup()}};GuiPopupReset.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);Application.instance.playSound("SND_UI_CLICK");switch(a.name){case "mcGuiBtnNo":case "mcGuiBtnYes":this.onResumeScreen(),this.getControl("mcGuiSignal").clip.resume()}};
function GuiPopupQuit(a,b,c,d){SScreen.call(this,a,b,c,d);Application.instance.effectManager.pauseAllEffects(!0);this.setInteractive(!0)}Application.subclass(GuiPopupQuit,SScreen);
GuiPopupQuit.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnNo":GuiGame.instance?GuiGame.instance.addPopup(new GuiPopupPause("mcGuiPopupPause")):this.screenParent.dropPopup();break;case "mcGuiBtnYes":GuiGame.instance?(this.screenParent.dropPopup(),GuiGame.instance.removeGame(GuiManager.SC_MAIN_MENU)):(this.screenParent.onResumeScreen(),this.screenParent.dropPopup())}};
GuiPopupQuit.prototype.onUIPress=function(a){if(this.m_state==SScreen.ST_MAINFRAME&&(SScreen.prototype.onUIPress.call(this,a),null==this.m_popup))switch(Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnNo":case "mcGuiBtnYes":this.onResumeScreen(),this.getControl("mcGuiSignal").clip.resume()}};function GuiPopupLocked(a,b,c){SScreen.call(this,"mcGuiPopupLockedMode",0,0,c);this.setInteractive(!0);this.m_time=0;this.m_activeAnimation=!1;this.initText(a,b)}
Application.subclass(GuiPopupLocked,SScreen);GuiPopupLocked.TIME_MAX=1E3;GuiPopupLocked.prototype.initText=function(a,b){this.getControl("mcGuiTxtTitle").setTextLocalized(a);this.getControl("mcGuiTxtDescription").setTextLocalized(b)};GuiPopupLocked.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.m_activeAnimation=!0};GuiPopupLocked.prototype.free=function(){SScreen.prototype.free.call(this)};
GuiPopupLocked.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_activeAnimation&&(this.m_time+=a,this.m_time>=GuiPopupLocked.TIME_MAX&&(this.m_time=0,this.m_activeAnimation=!1,this.onResumeScreen()))};GuiPopupLocked.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this)};
function GuiPopupModes(a,b,c){SScreen.call(this,"mcGuiPopupSelectMode",a,b,c);this.setInteractive(!0);this.m_enabledChallenge=!1;this.m_content=null;this.m_enabledChallenge=SavedData.instance.challengesEnabled();this.getControl("mcGuiBtnChallenge").setEnabled(this.m_enabledChallenge);this.m_enabledChallenge||(this.getControl("mcGuiBtnChallenge").setVisible(!1),this.m_content=new GuiButtonItems("mcGuiItemButton",this),this.getControl("mcGuiBtnContent").addChild(this.m_content.canvas),this.getControl("mcGuiTxtChallenge").setTextEmpty());
this.m_popupMan=new PopupManager(this);this.getControl("mcGuiBtnHelp").setVisible(SavedData.instance.tutorialPlayed())}Application.subclass(GuiPopupModes,SScreen);GuiPopupModes.prototype.free=function(){this.m_content&&(this.m_content.free(),this.m_content=null);this.m_popupMan.free();SScreen.prototype.free.call(this)};GuiPopupModes.prototype.init=function(){SScreen.prototype.init.call(this)};GuiPopupModes.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_popupMan.update(a)};
GuiPopupModes.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnStory":SavedData.instance.hasStoryProgress()?this.screenParent.addPopup(new GuiPopupContinue(0,0,this.screenParent)):(new StoryManager,GuiManager.instance.gotoScreen(GuiManager.SC_DIFFICULTY));break;case "mcGuiBtnChallenge":StoryManager.clearInstance();GuiManager.instance.gotoScreen(GuiManager.SC_CHALLENGE);break;case "mcGuiBtnVS":var a=this.screenParent;
this.screenParent.dropPopup();a.addPopup(new GuiPopupSelectVS("mcGuiPopupVSmode"));break;case "mcGuiBtnTutorial":StoryManager.clearInstance();Global.fightSettings=new DataFight;Global.fightSettings.setStageData(DataStage.ID_HOUSE_FRONT);Global.fightSettings.modEnabled=!1;Global.fightSettings.storyMode=!1;Global.fightSettings.tutorialMode=!0;Global.fightSettings.p1CharId=DataHero.ID_CRICKET;Global.fightSettings.p2CharId=DataHero.ID_PIG;Global.fightSettings.tutorialReturn=!0;GuiManager.instance.gotoScreen(GuiManager.SC_GAME);
break;case "mcGuiBtnHelp":GuiManager.instance.gotoScreen(GuiManager.SC_HELP);break;case "mcGuiBtnNo":this.screenParent.dropPopup()}};GuiPopupModes.prototype.onUIRelease=function(a){SScreen.prototype.onUIRelease.call(this,a);Application.instance.hideAddressBar();Application.instance.playSound("SND_UI_CLICK");switch(a.name){case "mcGuiBtnStory":case "mcGuiBtnChallenge":case "mcGuiBtnVS":case "mcGuiBtnNo":case "mcGuiBtnTutorial":case "mcGuiBtnHelp":this.onResumeScreen();break;case "mcGuiBtn":this.m_popupMan.showPopup(PopupManager.MSG_CHALL_LOCK)}};
function GuiButtonItems(a,b){SScreen.call(this,a,0,0,b);this.getControl("mcGuiBtn").clip.buttonMode=!1}Application.subclass(GuiButtonItems,SScreen);GuiButtonItems.prototype.onUIRelease=function(a,b){SScreen.prototype.onUIRelease.call(this,a,b);this.screenParent.onUIRelease(a,b)};function GuiPopupAchievement(a,b,c,d,e,f){SScreen.call(this,a,b,c,d);this.delay=f||0;this.m_background=this.m_container=this.m_contItem=null}Application.subclass(GuiPopupAchievement,SScreen);
GuiPopupAchievement.prototype.initContentItem=function(){null===this.m_contItem&&(this.m_contItem=new GuiContentItem("mcGuiNewTrophy",0,0,this));this.m_contItem.onStopScreen();null===this.m_container&&(this.m_container=this.getControl("mcGuiTrophies"));this.m_container.getEmptyCanvas().addChild(this.m_contItem.canvas)};
GuiPopupAchievement.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.delay-=a;this.m_contItem&&(this.m_contItem.update(a),this.m_contItem.finished&&0>=this.delay&&(this.onResumeScreen(),this.m_contItem.finished=!1))};GuiPopupAchievement.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);if(this.m_contItem)this.m_contItem.onResumeScreen()};
GuiPopupAchievement.prototype.addBackground=function(){0<this.delay&&(this.setInteractive(!0),this.m_background=Application.instance.getClip("gui_popup_bg"),this.m_background.setPosition(Application.APP_WIDTH/2,Application.APP_HEIGHT/2),this.canvas.addChildAt(this.m_background,0))};
GuiPopupAchievement.prototype.free=function(){this.m_contItem&&(this.m_container.getEmptyCanvas().removeChild(this.m_contItem),this.m_contItem.free());this.m_background&&(this.canvas.removeChild(this.m_background),this.m_background.free());SScreen.prototype.free.call(this)};function GuiContentItem(a,b,c,d){SScreen.call(this,a,b,c,d);this.finished=!1}Application.subclass(GuiContentItem,SScreen);
GuiContentItem.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);this.onStopScreen();this.finished=!0};function GuiPopupTrophy(a,b,c,d,e){GuiPopupAchievement.call(this,"mcGuiPopupNewTrophy",a,b,c,d,e);this.m_contItem=new GuiTrophyItem(0,0,GuiTrophies.getTrophyGuiId(d),this);this.m_container=this.getControl("mcGuiTrophies");this.initContentItem()}Application.subclass(GuiPopupTrophy,GuiPopupAchievement);
function GuiTrophyItem(a,b,c,d){c=c||0;GuiContentItem.call(this,"mcGuiNewTrophy",a,b,d);this.getControl("mcGuiTrophies").clip.gotoAndStop(c)}Application.subclass(GuiTrophyItem,GuiContentItem);function GuiPopupNewChar(a,b,c,d,e){GuiPopupAchievement.call(this,"mcGuiPopupNewCharacter",a,b,c,d,e);this.m_contItem=new GuiCharacterItem(0,0,d+1,this);this.m_container=this.getControl("mcGuiCharacters");this.initContentItem()}Application.subclass(GuiPopupNewChar,GuiPopupAchievement);
function GuiCharacterItem(a,b,c,d){c=c||0;GuiContentItem.call(this,"mcGuiNewCharacter",a,b,d);this.getControl("layer_1").clip.gotoAndStop(c)}Application.subclass(GuiCharacterItem,GuiContentItem);function GuiPopupNewSkin(a,b,c,d,e){GuiPopupAchievement.call(this,"mcGuiPopupNewSkin",a,b,c,d,e);this.m_contItem=new GuiSkinItem(0,0,d+1,this);this.m_container=this.getControl("mcGuiCharacters");this.initContentItem()}Application.subclass(GuiPopupNewSkin,GuiPopupAchievement);
function GuiSkinItem(a,b,c,d){c=c||0;GuiContentItem.call(this,"mcGuiNewSkin",a,b,d);this.getControl("layer_2").clip.gotoAndStop(c)}Application.subclass(GuiSkinItem,GuiContentItem);function GuiPopupContinue(a,b,c){SScreen.call(this,"mcGuiPopupContinue",a,b,c)}Application.subclass(GuiPopupContinue,SScreen);
GuiPopupContinue.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnNo":SavedData.instance.clearStoryProgress();this.screenParent.dropPopup();StoryManager.clearInstance();new StoryManager;GuiManager.instance.gotoScreen(GuiManager.SC_DIFFICULTY);break;case "mcGuiBtnYes":StoryManager.clearInstance(),new StoryManager,SavedData.instance.loadStoryProgress(),this.screenParent.dropPopup(),GuiManager.instance.gotoScreen(GuiManager.SC_CONTINUE)}};
GuiPopupContinue.prototype.onUIPress=function(a){if(this.m_state==SScreen.ST_MAINFRAME)switch(SScreen.prototype.onUIPress.call(this,a),Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnNo":case "mcGuiBtnYes":this.onResumeScreen(),this.getControl("mcGuiSignal").clip.resume()}};function PopupManager(a){this.m_parentScreen=a;this.m_popupQueue=[];this.m_popup=null}PopupManager.MSG_CHALL_LOCK="msg_chall";PopupManager.MSG_CHALL_UNLOCK="msg_challUnlock";PopupManager.MSG_HARD_UNLOCK="msg_lock";
PopupManager.prototype.free=function(){Application.instance.tweenManager.removeAll();Application.instance.effectManager.clear();this.m_popup&&(this.m_popup.free(),this.m_popupQueue=null)};PopupManager.prototype.update=function(a){this.m_popup&&(this.m_popup.update(a),this.m_popup.isFinished()&&(this.m_popup.free(),this.m_popup=null));0<this.m_popupQueue.length&&null===this.m_popup&&(a=this.m_popupQueue.splice(0,1)[0],this.createPopup(a))};
PopupManager.prototype.showPopup=function(a){switch(a){case PopupManager.MSG_CHALL_UNLOCK:this.m_popupQueue.push(new PopupInfo("STR_REP_NEW_MODE_TITLE","STR_REP_NEW_MODE_DESCRIPTION",0));break;case PopupManager.MSG_CHALL_LOCK:this.m_popupQueue.push(new PopupInfo("STR_REP_MODE_LOCKED_TITLE","STR_REP_MODE_LOCKED_DESCRIPTION",0));break;case PopupManager.MSG_HARD_UNLOCK:this.m_popupQueue.push(new PopupInfo("STR_REP_HARD_MODE_TITLE","STR_REP_HARD_MODE_DESCRIPTION",0))}};
PopupManager.prototype.createPopup=function(a){this.m_popup=new GuiPopupLocked(a.title,a.desc,this.m_parentScreen);Application.instance.playSound("SND_NEW_ACHIEVEMENT")};PopupManager.prototype.popupsDone=function(){return 0===this.m_popupQueue.length&&null===this.m_popup};function PopupInfo(a,b,c){this.title=a;this.desc=b;this.itemId=c}
function GuiMainMenu(a,b,c,d){SScreen.call(this,a,b,c,d);this.m_small=this.m_logo=null;this.percentageParallaxY=this.percentageParallaxX=0;this.m_chapter04=this.m_chapter03=this.m_chapter02=this.m_chapter01=null;this.m_initPostY_chapter04=this.m_initPostX_chapter04=this.m_initPostY_chapter03=this.m_initPostX_chapter03=this.m_initPostY_chapter02=this.m_initPostX_chapter02=this.m_initPostY_chapter01=this.m_initPostX_chapter01=0;Application.instance.isPlayingSound("SND_BG_MAINMENU")||(Application.instance.stopAllSounds(),
Application.instance.playSound("SND_BG_MAINMENU"));this.initLocalizedSprites();this.chargeImageParallax();this.timerTween=3E3;this.enableTween=!0;this.controlNameTween="mcGuiBtnPlay";this.setInteractive(!0);this.popupMan=new PopupManager(this)}Application.subclass(GuiMainMenu,SScreen);GuiMainMenu.doneFirstLoader=!1;GuiMainMenu.challPopupPending=!1;GuiMainMenu.hardPopupPending=!1;
GuiMainMenu.prototype.chargeImageParallax=function(){this.m_chapter01=this.getControl("mcGuiCharacter1").clip;this.m_initPostX_chapter01=this.getControl("mcGuiCharacter1").clip.position.x;this.m_initPostY_chapter01=this.getControl("mcGuiCharacter1").clip.position.y;this.m_chapter01.position.x=this.m_initPostX_chapter01;this.m_chapter01.position.y=this.m_initPostY_chapter01;this.m_chapter02=this.getControl("mcGuiCharacter2").clip;this.m_initPostX_chapter02=this.getControl("mcGuiCharacter2").clip.position.x;
this.m_initPostY_chapter02=this.getControl("mcGuiCharacter2").clip.position.y;this.m_chapter02.position.x=this.m_initPostX_chapter02;this.m_chapter02.position.y=this.m_initPostY_chapter02;this.m_chapter03=this.getControl("mcGuiCharacter3").clip;this.m_initPostX_chapter03=this.getControl("mcGuiCharacter3").clip.position.x;this.m_initPostY_chapter03=this.getControl("mcGuiCharacter3").clip.position.y;this.m_chapter03.position.x=this.m_initPostX_chapter03;this.m_chapter03.position.y=this.m_initPostY_chapter03;
this.m_chapter04=this.getControl("mcGuiCharacter4").clip;this.m_initPostX_chapter04=this.getControl("mcGuiCharacter4").clip.position.x;this.m_initPostY_chapter04=this.getControl("mcGuiCharacter4").clip.position.y;this.m_chapter04.position.x=this.m_initPostX_chapter04;this.m_chapter04.position.y=this.m_initPostY_chapter04};
GuiMainMenu.prototype.free=function(){null!==this.m_logo&&(this.m_logo.free(),this.m_logo=null);null!==this.m_small&&(this.m_small.free(),this.m_small=null);this.popupMan.free();Application.instance.socialShareObject&&Application.instance.socialShareObject.closeSharing();SScreen.prototype.free.call(this)};GuiMainMenu.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.popupMan.update(a)};GuiMainMenu.prototype.init=function(){SScreen.prototype.init.call(this);Application.instance.onOrientationchange(null)};
GuiMainMenu.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);Application.instance.hideAddressBar();GuiMainMenu.challPopupPending&&(GuiMainMenu.challPopupPending=!1,this.popupMan.showPopup(PopupManager.MSG_CHALL_UNLOCK));GuiMainMenu.hardPopupPending&&(GuiMainMenu.hardPopupPending=!1,this.popupMan.showPopup(PopupManager.MSG_HARD_UNLOCK))};GuiMainMenu.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this)};
GuiMainMenu.prototype.onUIRelease=function(a,b){SScreen.prototype.onUIRelease.call(this,a);Application.instance.hideAddressBar();Application.instance.playSound("SND_UI_CLICK");switch(a.name){case "mcGuiBtnPlay":this.addPopup(new GuiPopupModes(0,0,this));break;case "mcGuiBtnTrophies":GuiManager.instance.gotoScreen(GuiManager.SC_TROPHIES);break;case "mcGuiBtnRestart":this.addPopup(new GuiPopupReset("mcGuiPopupReset"))}};
GuiMainMenu.prototype.initLocalizedSprites=function(){this.m_logo=Application.instance.getLocalizedImage("gui_localized_logo.png");this.m_logo.pivot.x=218;this.m_logo.pivot.y=137;this.m_small=Application.instance.getLocalizedImage("gui_localized_logo_ip.png");this.m_small.pivot.x=75;this.m_small.pivot.y=60;this.getControl("mcGuiLocalizedLogo").canvas.addChild(this.m_logo);this.getControl("mcGuiLocalizedLogoIP").canvas.addChild(this.m_small)};
GuiMainMenu.prototype.onPointerMove=function(a){null===this.m_popup&&(this.percentageParallaxX=(a.data.global.x-Application.APP_WIDTH/2)/Application.APP_WIDTH*.2,this.percentageParallaxY=(a.data.global.y-Application.APP_HEIGHT/2)/Application.APP_HEIGHT*.2,1<this.percentageParallaxX?this.percentageParallaxX=1:-1>this.percentageParallaxX&&(this.percentageParallaxX=-1),1<this.percentageParallaxY?this.percentageParallaxY=1:-1>this.percentageParallaxY&&(this.percentageParallaxY=-1),this.m_chapter01&&(this.m_chapter01.position.x=
this.m_initPostX_chapter01+200*this.percentageParallaxX,this.m_chapter01.position.y=this.m_initPostY_chapter01+80*this.percentageParallaxY),this.m_chapter02&&(this.m_chapter02.position.x=this.m_initPostX_chapter02+200*this.percentageParallaxX,this.m_chapter02.position.y=this.m_initPostY_chapter02+100*this.percentageParallaxY),this.m_chapter03&&(this.m_chapter03.position.x=this.m_initPostX_chapter03+150*this.percentageParallaxX,this.m_chapter03.position.y=this.m_initPostY_chapter03+60*this.percentageParallaxY),
this.m_chapter04&&(this.m_chapter04.position.x=this.m_initPostX_chapter04+80*this.percentageParallaxX,this.m_chapter04.position.y=this.m_initPostY_chapter04+20*this.percentageParallaxY))};function GuiPopupAnimations(a,b,c,d){SScreen.call(this,a,b,c,d);this.setInteractive(!0)}Application.subclass(GuiPopupAnimations,SScreen);
GuiPopupAnimations.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiAnimation_1":GuiMainAnimations.idAnimation=1;GuiManager.instance.gotoScreen(GuiManager.SC_ANIMATIONS);break;case "mcGuiAnimation_2":GuiMainAnimations.idAnimation=2,GuiManager.instance.gotoScreen(GuiManager.SC_ANIMATIONS)}};
GuiPopupAnimations.prototype.onUIRelease=function(a){SScreen.prototype.onUIRelease.call(this,a);Application.instance.hideAddressBar();switch(a.name){case "mcGuiAnimation_1":case "mcGuiAnimation_2":Application.instance.playSound("SND_UI_CLICK"),this.onResumeScreen()}};function GuiMainAnimations(a,b,c,d){SScreen.call(this,a,b,c,d);GuiMainAnimations.instance=this;this.m_animations=[];this.onLoadData(GuiMainAnimations.idAnimation)}Application.subclass(GuiMainAnimations,SScreen);
GuiMainAnimations.instance=null;GuiMainAnimations.idAnimation=0;GuiMainAnimations.prototype.onLoadData=function(a){switch(a){case 1:this.onChargeAniCricket();break;case 2:this.onChargeAniTilly()}};
GuiMainAnimations.prototype.onChargeAniCricket=function(){this.getControl("mcGuiTxtChallenge").setTextLocalized("STR_ANIMATION_TITLE_CRICKET");var a=Application.instance.getClip("ani_player_cricket_backdash");this.getControl("mcGuiAnimations_1").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_cricket_dive01");this.getControl("mcGuiAnimations_3").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_cricket_dive02");this.getControl("mcGuiAnimations_5").canvas.addChild(a);
this.m_animations.push(a);a=Application.instance.getClip("ani_player_cricket_jump_down");this.getControl("mcGuiAnimations_8").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_cricket_jump");this.getControl("mcGuiAnimations_10").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_cricket_jump_up");this.getControl("mcGuiAnimations_13").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_cricket_punch");
this.getControl("mcGuiAnimations_15").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_cricket_stand");this.getControl("mcGuiAnimations_17").canvas.addChild(a);this.m_animations.push(a)};
GuiMainAnimations.prototype.onChargeAniTilly=function(){this.getControl("mcGuiTxtChallenge").setTextLocalized("STR_ANIMATION_TITLE_TILLY");var a=Application.instance.getClip("ani_player_tilly_backdash");this.getControl("mcGuiAnimations_1").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_tilly_dive01");this.getControl("mcGuiAnimations_3").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_tilly_dive02");this.getControl("mcGuiAnimations_5").canvas.addChild(a);
this.m_animations.push(a);a=Application.instance.getClip("ani_player_tilly_jump_down");this.getControl("mcGuiAnimations_8").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_tilly_jump");this.getControl("mcGuiAnimations_10").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_tilly_jump_up");this.getControl("mcGuiAnimations_13").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_tilly_punch");
this.getControl("mcGuiAnimations_15").canvas.addChild(a);this.m_animations.push(a);a=Application.instance.getClip("ani_player_tilly_stand");this.getControl("mcGuiAnimations_17").canvas.addChild(a);this.m_animations.push(a)};GuiMainAnimations.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);Application.instance.hideAddressBar()};GuiMainAnimations.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this)};
GuiMainAnimations.prototype.update=function(a){SScreen.prototype.update.call(this,a);for(var b=0;b<this.m_animations.length;b++)this.m_animations[b].update(a)};GuiMainAnimations.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);Application.instance.hideAddressBar();Application.instance.playSound("mcGuiBtnBack"===a.name?"SND_CLICK_BACK":"SND_UI_CLICK");switch(a.name){case "mcGuiBtnBack":GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU)}};
GuiMainAnimations.prototype.free=function(){SScreen.prototype.free.call(this);var a=window.SWT_BUNDLES.media_gameplay;a=a.concat(window.SWT_BUNDLES.media_characters);SLoader.unloadFromList(a);GuiMainAnimations.instance=null};
function GuiTrophies(a,b,c,d){SScreen.call(this,a,b,c,d);this.m_oldSelected=this.m_idSelected=1;this.m_content=null;this.m_trophies=this.getControls(/mcGuiBtnTrophy\d+$/,!0);this.m_txtTitle=this.getControl("mcGuiTxtTrophyname");this.m_txtDesc=this.getControl("mcGuiTxtTrophydescription");this.m_bigTrophy=this.getControl("mcGuiTrophy");TrophyManager.instance.updateStates();this.initTrophies();this.selectTrophy(0)}Application.subclass(GuiTrophies,SScreen);
GuiTrophies.prototype.initTrophies=function(){for(var a=0;a<this.m_trophies.length;a++)if(0<TrophyManager.instance.getQualityOwned(a)){var b=this.m_trophies[a],c=GuiTrophies.getTrophyGuiId(a);b.setNameClipBase("mcGuiButtonTrophy"+(9<c?""+c:"0"+c));b.setEnabled(!0)}};GuiTrophies.prototype.free=function(){this.destroySelectedTrophy();SScreen.prototype.free.call(this)};GuiTrophies.prototype.init=function(){SScreen.prototype.init.call(this)};GuiTrophies.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this)};
GuiTrophies.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnBack":null!=this.screenParent?this.screenParent.dropPopup():GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU)}};
GuiTrophies.prototype.onUIRelease=function(a){SScreen.prototype.onUIRelease.call(this,a);switch(a.name){case "mcGuiBtnBack":Application.instance.playSound("SND_CLICK_BACK");this.onResumeScreen();break;case "mcGuiBtnTrophy1":case "mcGuiBtnTrophy2":case "mcGuiBtnTrophy3":case "mcGuiBtnTrophy4":case "mcGuiBtnTrophy5":this.m_idSelected=parseInt(a.name.substr(14),10),this.selectTrophy(parseInt(a.name.charAt(a.name.length-1),10)-1)}};
GuiTrophies.prototype.selectTrophy=function(a){TrophyManager.instance.isOwned(a)?this.m_bigTrophy.clip.gotoAndStop(GuiTrophies.getTrophyGuiId(a)):this.m_bigTrophy.clip.gotoAndStop(16);this.m_txtTitle.setTextLocalized("STR_REP_NEW_TROPHY_TITLE0"+(a+1));this.m_txtDesc.setTextLocalized("STR_REP_NEW_TROPHY_DESCRIPTION0"+(a+1));for(a=0;a<this.m_trophies.length;a++)this.m_trophies[a].setVisible(!0);this.m_trophies[this.m_idSelected-1].setVisible(!1);this.createSelectedTrophy(this.m_trophies[this.m_idSelected-
1].nameClip)};GuiTrophies.prototype.createSelectedTrophy=function(a){this.destroySelectedTrophy();this.m_content=new GuiTrophieItem("mcGuiItemTrophie",a);this.getControl("mcGuiContent"+this.m_idSelected).canvas.addChild(this.m_content.canvas);this.m_oldSelected=this.m_idSelected};GuiTrophies.prototype.destroySelectedTrophy=function(){null!==this.m_content&&(this.getControl("mcGuiContent"+this.m_oldSelected).canvas.removeChild(this.m_content.canvas),this.m_content.free(),this.m_content=null)};
GuiTrophies.getTrophyGuiId=function(a){var b=TrophyManager.instance.getQualityOwned(a);return 3*a+b};GuiTrophies.prototype.update=function(a){SScreen.prototype.update.call(this,a);null!==this.m_content&&this.m_content.update(a)};function GuiTrophieItem(a,b){SScreen.call(this,a,0,0,null);this.m_indicator=this.getControl("mcGuiIndicator");this.getControl("mcGuiBase").setClip(b+"_select")}Application.subclass(GuiTrophieItem,SScreen);
GuiTrophieItem.prototype.update=function(a){SScreen.prototype.update.call(this,a);null!==this.m_indicator&&this.m_indicator.update(a)};function GuiScreenVS(a,b,c,d,e,f,g){SLoaderScreen.call(this,"mcGuiScreenVersus",a,b,c,d,e,f,g);GuiScreenVS.instance=this;this.m_elapsedTime=0;this.m_txtNames=this.getControls(/mcGuiTextPlayerName/,!0);this.m_characters=this.getControls(/mcGuiCharacter/,!0);this.initControls();Application.instance.stopAllSounds();Application.instance.playSound("SND_BG_UI_VS")}
Application.subclass(GuiScreenVS,SLoaderScreen);GuiScreenVS.MIN_WAIT_TIME=4E3;GuiScreenVS.instance=null;GuiScreenVS.prototype.free=function(){GuiScreenVS.instance=null;Application.instance.effectManager.clear();SLoaderScreen.prototype.free.call(this);Application.instance.stopAllSounds()};
GuiScreenVS.prototype.initControls=function(){var a=[DataHero.getCharaId(Global.fightSettings.p1CharId),DataHero.getCharaId(Global.fightSettings.p2CharId)];this.m_characters[0].clip.gotoAndStop(DataHero.toGUIIndex(a[0])+1);this.m_characters[1].clip.gotoAndStop(DataHero.toGUIIndex(a[1])+1);for(var b=0;2>b;b++){var c=this.getString("STR_REP_MESSAGE_CHARACTERNAME_"+DataHero.getCharaId(a[b]));1===b&&Global.fightSettings.challengeId===ChallManager.ID_GIANT_BILL&&(c=this.getString("STR_REP_CHARACTERNAME_GIANT")+
" "+c);this.m_txtNames[b].setText(c);this.m_txtNames[b+2].setText(c)}Global.aiMode!==AICore.MODE_NONE&&(this.getControl("mcGuiTextPlayer02").setVisible(!1),this.getControl("mcGuiTextPlayer02S").setVisible(!1));""!==Application.disneyProfileName&&(c=Application.disneyProfileName,this.getControl("mcGuiTextPlayer01").setText(c),this.getControl("mcGuiTextPlayer01S").setText(c))};
GuiScreenVS.prototype.onFileLoaded=function(){SLoaderScreen.prototype.onFileLoaded.call(this);var a=this.m_start;a+=this.m_loadedfiles/this.m_totalFiles*(this.m_end-this.m_start);a=parseInt(a,10);Application.info("onLoadProgress > "+this.m_loadedfiles+" of "+this.m_totalFiles+" percent : "+a+"%")};GuiScreenVS.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);GuiManager.instance.gotoScreen(this.m_nextScreen)};
GuiScreenVS.prototype.onUIRelease=function(a){switch(a.name){case "mcGuiBtnNext":Application.instance.hideAddressBar(),this.onResumeScreen()}};GuiScreenVS.prototype.update=function(a){SLoaderScreen.prototype.update.call(this,a);this.m_elapsedTime+=a;this.m_elapsedTime>=GuiScreenVS.MIN_WAIT_TIME&&this.m_loadedfiles===this.m_totalFiles&&(this.m_elapsedTime=0,this.onResumeScreen())};GuiScreenVS.prototype.onLoadComplete=function(){};GuiScreenVS.prototype.getString=function(a){return Application.strings[a].value};
function GuiStageSelect(a,b,c,d){SScreen.call(this,a,b,c,d);this.isReady=!1;this.setInteractive(!0);this.m_stageItems=new GuiContentStage("mcGuiContentSelectStage",this);this.getControl("mcGuiBtnStage").canvas.addChild(this.m_stageItems.canvas);this.m_onUIPress=!1;this.m_eventId=-1;this.m_sliderInitIdx=0;this.m_initPoint=new Point}Application.subclass(GuiStageSelect,SScreen);
GuiStageSelect.prototype.toUIID=function(a){switch(a){case DataStage.ID_BACKYARD:return DataStage.ID_HOUSE_FRONT;case DataStage.ID_HOUSE_FRONT:return DataStage.ID_BACKYARD;default:return a}};GuiStageSelect.prototype.free=function(){this.m_initPoint=null;this.m_stageItems&&(this.m_stageItems.free(),this.m_stageItems=null);SScreen.prototype.free.call(this)};
GuiStageSelect.prototype.localizedStage=function(a){a=this.toUIID(a);this.getControl("mcGuiTxtDescription").setTextLocalized("STR_SELECTSTAGE_DESCRIPTION_"+a)};GuiStageSelect.prototype.onPointerPress=function(a){!this.isReady||this.m_state!==SScreen.ST_MAINFRAME||0<=this.m_eventId||this.m_onUIPress||this.m_stageItems.sliderMgr().getState()!==RingUIHandler.ST_IDLE||(this.m_eventId=Common.getIdentifier(a),this.m_initPoint.x=Math.floor(a.data.global.x),this.m_initPoint.y=Math.floor(a.data.global.y))};
GuiStageSelect.prototype.onPointerRelease=function(a){if(this.isReady)if(this.m_state!==SScreen.ST_MAINFRAME||this.m_eventId!==Common.getIdentifier(a)||this.m_onUIPress||this.m_stageItems.sliderMgr().getState()!==RingUIHandler.ST_IDLE)this.m_onUIPress=!1,this.m_eventId=-1;else if(this.m_eventId=-1,a=Math.floor(a.data.global.x)-this.m_initPoint.x,100<Math.abs(a))if(0<a)this.m_stageItems.onMoveScroll(!0);else this.m_stageItems.onMoveScroll(!1)};
GuiStageSelect.prototype.onUIPress=function(a){if(this.isReady&&!(this.m_state!=SScreen.ST_MAINFRAME||0<=this.m_eventId||this.m_stageItems.sliderMgr().getState()!==RingUIHandler.ST_IDLE))switch(SScreen.prototype.onUIPress.call(this,a),a.name){case "mcGuiBtnBack":this.m_onUIPress=!0;this.isReady=!1;this.onResumeScreen();Application.instance.playSound("SND_CLICK_BACK");break;case "mcGuiBtnScroll2":this.m_onUIPress=!0;Application.instance.playSound("SND_SCROLL");this.m_stageItems.onMoveScroll(!1);break;
case "mcGuiBtnScroll":this.m_onUIPress=!0;Application.instance.playSound("SND_SCROLL");this.m_stageItems.onMoveScroll(!0);break;case "mcGuiBtnSelectStage":Application.instance.playSound("SND_PICK"),a=this.toUIID(this.m_stageItems.sliderMgr().getCurrentIndex()),Global.fightSettings.setStageData(a),this.onResumeScreen()}};
GuiStageSelect.prototype.onUIRelease=function(a,b){if(this.isReady)switch(SScreen.prototype.onUIRelease.call(this,a),a.name){case "mcGuiBtnStage01":case "mcGuiBtnStage02":case "mcGuiBtnStage03":case "mcGuiBtnStage04":case "mcGuiBtnStage05":case "mcGuiBtnStage06":case "mcGuiBtnStage07":b=parseInt(a.name.substr(14),10)-1,b=this.toUIID(b),Application.instance.playSound("SND_PICK"),this.lastInteractionControl=a.name,Global.fightSettings.setStageData(b),this.onResumeScreen()}};
GuiStageSelect.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.m_stageItems&&this.m_stageItems.initRingIntro()};GuiStageSelect.prototype.onFinishScreen=function(){switch(this.lastInteractionControl){case "mcGuiBtnBack":GuiManager.instance.gotoScreen(GuiManager.SC_CHARA_SEL);break;case "mcGuiBtnStage01":case "mcGuiBtnStage02":case "mcGuiBtnStage03":case "mcGuiBtnStage04":case "mcGuiBtnStage05":case "mcGuiBtnStage06":case "mcGuiBtnStage07":case "mcGuiBtnSelectStage":GuiManager.instance.gotoScreen(GuiManager.SC_GAME)}};
GuiStageSelect.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_stageItems&&this.m_stageItems.update(a)};
function GuiContentStage(a,b){SScreen.call(this,a,0,0,b);this.clip.sortByDepth=!0;this.m_sliderMgr=null;this.m_ringElems=[];this.m_ringElems.push(this.getControl("mcGuiBtnStage01"));this.m_ringElems.push(this.getControl("mcGuiBtnStage02"));this.m_ringElems.push(this.getControl("mcGuiBtnStage03"));this.m_ringElems.push(this.getControl("mcGuiBtnStage04"));this.m_ringElems.push(this.getControl("mcGuiBtnStage05"));this.m_ringElems.push(this.getControl("mcGuiBtnStage06"));this.m_ringElems.push(this.getControl("mcGuiBtnStage07"));
this.disableStageBtns();this.initRing()}Application.subclass(GuiContentStage,SScreen);GuiContentStage.prototype.initRing=function(){this.clip.sortByDepth=!0;var a={};a.cX=this.m_ringElems[0].getX();a.cY=this.m_ringElems[0].getY();a.axisX=220;a.axisY=1;a.centerIdx=0;a.maxScale=1;a.minScale=.5;a.hideFar=!1;this.m_sliderMgr=new RingUIHandler(this.m_ringElems,a,this,!0);this.onEndScroll();this.m_sliderMgr.setEndScroll(this,this.onEndScroll)};GuiContentStage.prototype.disableStageBtns=function(){this.m_ringElems.forEach(function(a){a.setEnabled(!1)})};
GuiContentStage.prototype.onEndScroll=function(){var a=this.m_sliderMgr.getCurrentIndex();this.m_ringElems[a].setEnabled(!0);this.screenParent.localizedStage(a)};GuiContentStage.prototype.free=function(){null!==this.m_sliderMgr&&(this.m_sliderMgr.free(),this.m_sliderMgr=null);SScreen.prototype.free.call(this)};GuiContentStage.prototype.onRingIntroDone=function(){this.screenParent.isReady=!0};GuiContentStage.prototype.sliderMgr=function(){return this.m_sliderMgr};
GuiContentStage.prototype.onMoveScroll=function(a){this.disableStageBtns();a?this.m_sliderMgr.startScrollLeft():this.m_sliderMgr.startScrollRight()};GuiContentStage.prototype.initRingIntro=function(){this.m_sliderMgr&&this.m_sliderMgr.setReadyToIntro()};GuiContentStage.prototype.onUIRelease=function(a,b){SScreen.prototype.onUIRelease.call(this,a,b);this.screenParent.onUIRelease(a,b)};GuiContentStage.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_sliderMgr&&this.m_sliderMgr.update(a)};
function GuiCharaSelect(a,b,c){SScreen.call(this,"mcGuiScreenSelectCharacterVS",a,b,c);this.m_selectFx=[Application.instance.getClip("mcGuiSelectorChara1"),Application.instance.getClip("mcGuiSelectorChara2")];this.canvas.addChild(this.m_selectFx[0]);this.canvas.addChild(this.m_selectFx[1]);this.m_selIndex=[0,1];this.m_selCostume=[0,0];this.m_glowTimers=[GuiCharaSelect.GLOW_WAIT,GuiCharaSelect.GLOW_WAIT];this.m_locked=[!1,!1];this.m_charaBtns=this.getControls(/mcGuiCharacter\d+$/,!0);this.m_charaGlows=
this.getControls(/mcGuiGlow\d+$/,!0);this.m_charaGlows[0].setVisible(!1);this.m_charaGlows[0].setVisible(!0);this.m_charaTxts=this.getControls(/mcGuiTxtCharacter\d.*$/,!0);this.m_thumbnails=this.getControls(/mcGuiChara(\d+|Random)$/,!0);this.m_lockFx=[];this.m_actManager=new ActionManager;this.updateCharaBtns(0);this.updateCharaBtns(1);this.updateSelectFx();this.updateSelectText();this.initLockedChars();Global.aiMode!==AICore.MODE_NONE&&this.moveCursor(1,!0);Application.instance.isPlayingSound("SND_BG_MAINMENU")||
(Application.instance.stopAllSounds(),Application.instance.playSound("SND_BG_MAINMENU"))}Application.subclass(GuiCharaSelect,SScreen);GuiCharaSelect.doneFirstLoader=!1;GuiCharaSelect.GLOW_WAIT=4E3;GuiCharaSelect.prototype.free=function(){this.m_selectFx.forEach(function(a){this.canvas.removeChild(a);a.free()},this);this.m_lockFx.forEach(function(a){null!==a&&a.setAwaitingDelete(!0)},this);this.m_lockFx=[];this.m_selectFx=[];SScreen.prototype.free.call(this)};
GuiCharaSelect.prototype.init=function(){SScreen.prototype.init.call(this);Application.instance.onOrientationchange(null)};GuiCharaSelect.prototype.updateLockFx=function(a){if(this.m_locked[a]){var b=Application.instance.effectManager,c=this.getControl("mcGuiPopupBlackBox0"+(a+1));b=b.createEffectGui("mcGuiPopupBlackBox0"+(a+1),0,0,c.getEmptyCanvas(),0);this.m_lockFx[a]=b}else this.m_lockFx[a].setAwaitingDelete(!0),this.m_lockFx[a]=null};
GuiCharaSelect.prototype.initLockedChars=function(){for(var a=0;a<DataHero.NUM_HEROES;a++)this.m_thumbnails[a].clip.showLayerName("Iconlock",!SavedData.instance.charaUnlocked(a))};GuiCharaSelect.prototype.updateCostumeBtns=function(){var a=this.getControls(/mcGuiBtnClothing\d+$/,!0);a[0].setVisible(SavedData.instance.hasCostumes(this.m_selIndex[0]));a[1].setVisible(SavedData.instance.hasCostumes(this.m_selIndex[1]))};
GuiCharaSelect.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnBack":Global.aiMode===AICore.MODE_NONE?GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU):GuiManager.instance.gotoScreen(GuiManager.SC_DIFFICULTY);break;default:GuiManager.instance.gotoScreen(GuiManager.SC_STAGE_SEL)}};
GuiCharaSelect.prototype.onResumeScreen=function(){SScreen.prototype.onResumeScreen.call(this);this.m_selectFx[0].visible=!1;this.m_selectFx[1].visible=!1};GuiCharaSelect.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.updateSelectFx()};
GuiCharaSelect.prototype.update=function(a){this.m_actManager.update(a);SScreen.prototype.update.call(this,a);for(var b=0;2>b;b++)this.m_charaGlows[b].isVisible()?this.m_charaGlows[b].setVisible(0>=this.m_glowTimers[b]):this.m_locked[b]||(this.m_glowTimers[b]-=a,0>=this.m_glowTimers[b]&&(this.m_charaGlows[b].clip.gotoAndPlay(20),this.m_charaGlows[b].setVisible(!0)))};
GuiCharaSelect.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);if(this.m_state==SScreen.ST_MAINFRAME)switch(a.name){case "mcGuiBtnBack":Application.instance.playSound("SND_CLICK_BACK");this.onResumeScreen();break;case "mcGuiBtnChara1":this.charaLock(0);break;case "mcGuiBtnChara2":this.charaLock(1);break;case "mcGuiBtnScrollC1":if(this.m_locked[0])break;Application.instance.playSound("SND_UI_CLICK");this.moveCursor(0,!0);break;case "mcGuiBtnScrollC1_1":if(this.m_locked[0])break;
Application.instance.playSound("SND_UI_CLICK");this.moveCursor(0,!1);break;case "mcGuiBtnScrollC2":if(this.m_locked[1])break;Application.instance.playSound("SND_UI_CLICK");this.moveCursor(1,!0);break;case "mcGuiBtnScrollC2_1":if(this.m_locked[1])break;Application.instance.playSound("SND_UI_CLICK");this.moveCursor(1,!1);break;case "mcGuiBtnClothing1":if(this.m_locked[0])break;this.changeCostume(0);break;case "mcGuiBtnClothing2":this.m_locked[1]||this.changeCostume(1)}};
GuiCharaSelect.prototype.charaLock=function(a){this.m_locked[a]=!this.m_locked[a];this.highlightThumbnail(a,this.m_locked[a]);this.updateLockFx(a);this.m_glowTimers[a]=GuiCharaSelect.GLOW_WAIT;Application.instance.playSound(this.m_locked[a]?"SND_PICK":"SND_DESELECT");if(this.m_locked[a]&&this.m_locked[0]&&this.m_locked[1]){a=this.m_selIndex[0];var b=this.m_selIndex[1],c=this.m_thumbnails.length-1;a=a===c?Common.getRandomFromArray(this.getRandomChara()):a;this.m_selIndex[0]=a;b=b===c?Common.getRandomFromArray(this.getRandomChara()):
b;Global.fightSettings=new DataFight;Global.fightSettings.p1CharId=a;Global.fightSettings.p2CharId=b;Global.fightSettings.p1Costume=this.m_selCostume[0];Global.fightSettings.p2Costume=this.m_selCostume[1];SavedData.instance.tutorialPlayed()||(Global.fightSettings.p2CharIdSaved=b,Global.fightSettings.p2CharId=DataHero.ID_PIG,Global.fightSettings.tutorialMode=!0,Global.fightSettings.modEnabled=!1);this.m_state=SScreen.ST_TRANSITION_END;this.m_actManager.addCallback(this,this.onResumeScreen,650)}};
GuiCharaSelect.prototype.getRandomChara=function(){for(var a=[],b=this.m_selIndex[0],c=this.m_selIndex[1],d=0;d<DataHero.NUM_HEROES;d++)d!==b&&d!==c&&SavedData.instance.charaUnlocked(d)&&a.push(d);return a};
GuiCharaSelect.prototype.highlightThumbnail=function(a,b){var c=this.m_selIndex[a];c!==this.m_thumbnails.length-1&&(c=this.m_thumbnails[c].clip,b?(0===a?(c.showLayerName("Blue",!1),c.showLayerName("Red",!0)):(c.showLayerName("Blue",!0),c.showLayerName("Red",!1)),c.showLayerName("Brown",!1)):(c.showLayerName("Blue",!1),c.showLayerName("Red",!1),c.showLayerName("Brown",!0)))};
GuiCharaSelect.prototype.moveCursor=function(a,b){this.m_selIndex[a]=(this.m_selIndex[a]+(b?-1:1))%this.m_thumbnails.length;var c=this.m_selIndex[a];this.m_selCostume[a]=0;this.m_selIndex[a]=0>c?this.m_thumbnails.length-1:c;this.updateSelectFx();this.updateCharaBtns(a);this.updateSelectText();c=this.m_selIndex[a]===this.m_thumbnails.length-1;var d=SavedData.instance.charaUnlocked(this.m_selIndex[a]);(this.m_selIndex[0]==this.m_selIndex[1]&&!c||!d&&!c)&&this.moveCursor(a,b)};
GuiCharaSelect.prototype.changeCostume=function(a){var b=SavedData.instance.getCostumes(this.m_selIndex[a]);for(this.m_selCostume[a]=(this.m_selCostume[a]+1)%b.length;!b[this.m_selCostume[a]];)this.m_selCostume[a]=(this.m_selCostume[a]+1)%b.length;b=this.m_selCostume[a]*DataHero.NUM_HEROES;this.m_charaBtns[a].clip.gotoAndStop(this.m_selIndex[a]+1+(b+(0<b?1:0)))};
GuiCharaSelect.prototype.updateSelectFx=function(){this.m_selectFx.forEach(function(a,c){c=this.m_thumbnails[this.m_selIndex[c]];a.setPosition(c.getX(),c.getY())},this);for(var a=0;a<DataHero.NUM_HEROES+1;a++)this.m_thumbnails[a].clip.showLayerName("Gray",!(a===this.m_selIndex[0]||a===this.m_selIndex[1]))};
GuiCharaSelect.prototype.updateSelectText=function(){for(var a=0;a<this.m_charaTxts.length;a+=2){var b=this.m_charaTxts[a],c=this.m_charaTxts[a+1];if(this.m_selIndex[~~(a/2)]<DataHero.NUM_HEROES){var d=this.m_selIndex[~~(a/2)];b.setTextLocalized("STR_REP_MESSAGE_CHARACTERNAME_"+d);c.setTextLocalized("STR_REP_MESSAGE_CHARACTERNAME_"+d)}else b.setText("RANDOM"),c.setText("RANDOM")}};
GuiCharaSelect.prototype.updateCharaBtns=function(a){this.m_charaBtns[a].clip.gotoAndStop(this.m_selIndex[a]+1);this.m_glowTimers[a]=GuiCharaSelect.GLOW_WAIT;this.updateCostumeBtns()};function GuiStorySelect(a,b,c){SScreen.call(this,"mcGuiScreenSelectCharacter",a,b,c);this.m_oldSelected=this.m_idSelected=1;this.m_content=null;this.m_lockScreen=!1;this.m_currentTime=0;this.m_charaBtns=this.getControls(/mcGuiBtnChara\d+$/,!0);Global.fightSettings=new DataFight;Global.fightSettings.storyMode=!0}
Application.subclass(GuiStorySelect,SScreen);GuiStorySelect.DELAY_TIME=1E3;GuiStorySelect.prototype.init=function(){SScreen.prototype.init.call(this);Application.instance.onOrientationchange(null)};
GuiStorySelect.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnBack":GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU);break;default:null!==StoryManager.instance&&(StoryManager.instance.setCharacter(Global.fightSettings.p1CharId),SavedData.instance.tutorialPlayed()?StoryManager.instance.toNextStage():(Global.fightSettings.setStageData(DataStage.ID_HOUSE_FRONT),Global.fightSettings.modEnabled=!1,Global.fightSettings.storyMode=
!0,Global.fightSettings.tutorialMode=!0,Global.fightSettings.p2CharId=DataHero.ID_PIG),GuiDialogCutscene.current=1,GuiManager.instance.gotoScreen(GuiManager.SC_CUTSCENE))}};
GuiStorySelect.prototype.onUIPress=function(a){if(!this.m_lockScreen)switch(SScreen.prototype.onUIPress.call(this,a),Application.instance.playSound("mcGuiBtnBack"===a.name?"SND_CLICK_BACK":"SND_UI_CLICK"),a.name){case "mcGuiBtnBack":this.onResumeScreen();break;case "mcGuiBtnChara1":this.m_lockScreen=!0;Global.fightSettings.p1CharId=DataHero.ID_CRICKET;this.onSelectCharcater(1);break;case "mcGuiBtnChara2":this.m_lockScreen=!0,Global.fightSettings.p1CharId=DataHero.ID_TILLY,this.onSelectCharcater(2)}};
GuiStorySelect.prototype.onSelectCharcater=function(a){this.getControl("mcGuiBtnChara1").setVisible(!0);this.getControl("mcGuiBtnChara2").setVisible(!0);this.getControl("mcGuiBtnChara"+a).setVisible(!1);this.m_idSelected=a;this.createSelectedPlayer()};
GuiStorySelect.prototype.createSelectedPlayer=function(){this.destroySelectedPlayer();this.m_content=new GuiSelectCharacterItem("mcGuiItemsCharacter",this.m_idSelected);this.getControl("mcGuiContent"+this.m_idSelected).canvas.addChild(this.m_content.canvas);this.m_oldSelected=this.m_idSelected};
GuiStorySelect.prototype.destroySelectedPlayer=function(){null!==this.m_content&&(this.getControl("mcGuiContent"+this.m_oldSelected).canvas.removeChild(this.m_content.canvas),this.m_content.free(),this.m_content=null)};GuiStorySelect.prototype.getControls=function(a,b){var c=[],d;for(d in this.controls)d.match(a)&&c.push(this.controls[d]);b&&(c=c.sort(function(a,b){a=a.name;b=b.name;return a<b?-1:a>b?1:0}));return c};
GuiStorySelect.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_lockScreen&&(this.m_currentTime+=a,this.m_currentTime>=GuiStorySelect.DELAY_TIME&&(this.onResumeScreen(),this.m_currentTime=0));null!==this.m_content&&this.m_content.update(a)};GuiStorySelect.prototype.free=function(){this.destroySelectedPlayer();SScreen.prototype.free.call(this)};
function GuiSelectCharacterItem(a,b){SScreen.call(this,a,0,0,null);this.m_indicator=this.getControl("mcGuiIndicator");this.getControl("mcGuiBase").setClip("mcGuiButtonCharacter"+b+"_select")}Application.subclass(GuiSelectCharacterItem,SScreen);GuiSelectCharacterItem.prototype.update=function(a){SScreen.prototype.update.call(this,a);null!==this.m_indicator&&this.m_indicator.update(a)};
function GuiDialogCutscene(a,b){SScreen.call(this,a);this.m_actualOrder=0;this.m_minTimeRead=-1;b=DataHero.getCharaId(Global.fightSettings.p1CharId);if(1===GuiDialogCutscene.current)if(0===b){b=["STR_CUTSCENE_DIALOG_CRICKET_01_01","STR_CUTSCENE_DIALOG_CRICKET_01_02","STR_CUTSCENE_DIALOG_CRICKET_01_04","STR_CUTSCENE_DIALOG_CRICKET_01_03"];a=["gui_screen_cutscene_01","gui_screen_cutscene_02","gui_screen_cutscene_03","gui_screen_cutscene_04"];var c=["VO_CUTSCENE1","VO_CUTSCENE2","VO_CUTSCENE3","VO_CUTSCENE4A"]}else b=
["STR_CUTSCENE_DIALOG_TILLY_01_01","STR_CUTSCENE_DIALOG_TILLY_01_02","STR_CUTSCENE_DIALOG_TILLY_01_04","STR_CUTSCENE_DIALOG_TILLY_01_03"],a=["gui_screen_cutscene_01","gui_screen_cutscene_02","gui_screen_cutscene_03","gui_screen_cutscene_05"],c=["VO_CUTSCENE1","VO_CUTSCENE2","VO_CUTSCENE3","VO_CUTSCENE4B"];else 0===b?(b="STR_CUTSCENE_DIALOG_CRICKET_02_01 STR_CUTSCENE_DIALOG_CRICKET_02_02 STR_CUTSCENE_DIALOG_CRICKET_02_03 STR_CUTSCENE_DIALOG_CRICKET_02_04 STR_CUTSCENE_DIALOG_CRICKET_02_05 STR_CUTSCENE_DIALOG_CRICKET_02_06".split(" "),
a="gui_screen_cutscene_06 gui_screen_cutscene_07 gui_screen_cutscene_08 gui_screen_cutscene_09 gui_screen_cutscene_10 gui_screen_cutscene_11".split(" "),c="VO_CUTSCENE5A VO_CUTSCENE6A VO_CUTSCENE7A VO_CUTSCENE8 VO_CUTSCENE10A VO_CUTSCENE11A".split(" ")):(b="STR_CUTSCENE_DIALOG_TILLY_02_01 STR_CUTSCENE_DIALOG_TILLY_02_02 STR_CUTSCENE_DIALOG_TILLY_02_03 STR_CUTSCENE_DIALOG_TILLY_02_04 STR_CUTSCENE_DIALOG_TILLY_02_05 STR_CUTSCENE_DIALOG_TILLY_02_06".split(" "),a="gui_screen_cutscene_12 gui_screen_cutscene_13 gui_screen_cutscene_14 gui_screen_cutscene_09 gui_screen_cutscene_15 gui_screen_cutscene_16".split(" "),
c="VO_CUTSCENE5B VO_CUTSCENE6B VO_CUTSCENE7B VO_CUTSCENE8 VO_CUTSCENE10B VO_CUTSCENE11B".split(" "));this.m_dialogData=b;this.m_clipData=a;this.m_voData=c;this.m_text=this.getControl("mcGuiTxtCutscene");this.m_btnSkip=this.getControl("mcGuiBtnNo");this.getControl("mcGuiScene").setClip(this.m_clipData[0]);this.getControl("mcGuiBtnBack").setVisible(!1);2===GuiDialogCutscene.current?(Application.instance.stopAllSounds(),Application.instance.playSound("SND_CUTSCENE2")):Application.instance.isPlayingSound("SND_BG_MAINMENU")?
Application.instance.setVolumeById("SND_BG_MAINMENU",.2):(Application.instance.stopAllSounds(),Application.instance.playSound("SND_BG_MAINMENU"));this.showText(this.m_actualOrder);this.playVo(!0)}Application.subclass(GuiDialogCutscene,SScreen);GuiDialogCutscene.current=1;
GuiDialogCutscene.prototype.free=function(){for(var a=this.getControl("mcGuiScene").getEmptyCanvas();0<a.children.length;)a.removeChild(a.getChildAt(0));this.m_btnSkip=this.m_text=this.m_clipData=this.m_dialogData=null;SScreen.prototype.free.call(this);SLoader.unloadFromList(window.SWT_BUNDLES["media_cutscenes"+(Application.RIGHT_TO_LEFT?"_rtl":"")]);1===GuiDialogCutscene.current?Application.instance.unloadSoundsFromList([10]):Application.instance.unloadSoundsFromList([9])};
GuiDialogCutscene.MIN_TIME_TO_READ=100;GuiDialogCutscene.prototype.scrollText=function(a){this.m_actualOrder+=a?1:-1;this.m_actualOrder=Math.max(this.m_actualOrder,0);if(this.m_actualOrder>=this.m_dialogData.length)this.onResumeScreen();else this.showText(this.m_actualOrder);this.playVo(a)};
GuiDialogCutscene.prototype.playVo=function(a){a?0<this.m_actualOrder&&Application.instance.stopSound(this.m_voData[this.m_actualOrder-1]):this.m_actualOrder<this.m_voData.length-1&&Application.instance.stopSound(this.m_voData[this.m_actualOrder+1]);Application.instance.playSound(this.m_voData[this.m_actualOrder])};GuiDialogCutscene.prototype.showText=function(a){this.m_text.setTextLocalized(this.m_dialogData[this.m_actualOrder]);this.m_minTimeRead=GuiDialogCutscene.MIN_TIME_TO_READ;this.getControl("mcGuiScene").setClip(this.m_clipData[this.m_actualOrder])};
GuiDialogCutscene.prototype.onFinishScreen=function(){this.screenParent&&this.screenParent.dropPopup();GuiManager.instance.gotoScreen(GuiManager.SC_GAME)};GuiDialogCutscene.prototype.onUIRelease=function(a,b){switch(a.name){case "mcGuiBtnNext":Application.instance.playSound("SND_UI_CLICK");this.scrollText(!0);break;case "mcGuiBtnBack":Application.instance.playSound("SND_UI_CLICK");this.scrollText(!1);break;case "mcGuiBtnNo":this.onResumeScreen()}};GuiDialogCutscene.prototype.onKeyUp=function(a){switch(a){case Common.KEY_SPACE:this.scrollText(!0)}};
GuiDialogCutscene.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_state===SScreen.ST_MAINFRAME&&this.getControl("mcGuiBtnBack").setVisible(0<this.m_actualOrder)};function GuiSelectDifficulty(a,b,c){SScreen.call(this,"mcGuiScreenDifficulty",a,b,c);this.difficultyLock(SavedData.instance.hardModeEnabled())}Application.subclass(GuiSelectDifficulty,SScreen);GuiSelectDifficulty.prototype.free=function(){SScreen.prototype.free.call(this)};GuiSelectDifficulty.prototype.init=function(){SScreen.prototype.init.call(this)};
GuiSelectDifficulty.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnBack":GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU);break;case "mcGuiBtnDifficulty1":this.toNextScreen(AICore.MODE_EASY);break;case "mcGuiBtnDifficulty2":this.toNextScreen(AICore.MODE_MEDIUM);break;case "mcGuiBtnDifficulty3":this.toNextScreen(AICore.MODE_HARD)}};
GuiSelectDifficulty.prototype.difficultyLock=function(a){a?this.getControl("mcGuiTxtLocked").setTextEmpty():(this.getControl("mcGuiTxtHard").setTextEmpty(),this.getControl("mcGuiTxtHardOver").setTextEmpty(),this.getControl("mcGuiBtnDifficulty3").setEnabled(!1))};
GuiSelectDifficulty.prototype.onUIPress=function(a,b){SScreen.prototype.onUIPress.call(this,a);if(Application.instance.isMobileDevice)switch(a.name){case "mcGuiBtnDifficulty1":case "mcGuiBtnDifficulty2":case "mcGuiBtnDifficulty3":a=parseInt(a.name.substr(18),10),this.overAndOutText(!0,a)}};
GuiSelectDifficulty.prototype.onUIRelease=function(a){SScreen.prototype.onUIRelease.call(this,a);Application.instance.hideAddressBar();Application.instance.playSound("mcGuiBtnBack"===a.name?"SND_CLICK_BACK":"SND_UI_CLICK");switch(a.name){case "mcGuiBtnBack":this.onResumeScreen();break;case "mcGuiBtnDifficulty1":case "mcGuiBtnDifficulty2":case "mcGuiBtnDifficulty3":Application.instance.isMobileDevice&&(a=parseInt(a.name.substr(18),10),this.overAndOutText(!1,a)),this.onResumeScreen()}};
GuiSelectDifficulty.prototype.onUIOver=function(a){SScreen.prototype.onUIOver.call(this,a);switch(a.name){case "mcGuiBtnDifficulty1":case "mcGuiBtnDifficulty2":case "mcGuiBtnDifficulty3":a=parseInt(a.name.substr(18),10),this.overAndOutText(!0,a)}};GuiSelectDifficulty.prototype.onUIOut=function(a){SScreen.prototype.onUIOut.call(this,a);switch(a.name){case "mcGuiBtnDifficulty1":case "mcGuiBtnDifficulty2":case "mcGuiBtnDifficulty3":a=parseInt(a.name.substr(18),10),this.overAndOutText(!1,a)}};
GuiSelectDifficulty.prototype.overAndOutText=function(a,b){var c="";switch(b){case 1:this.getControl("mcGuiTxtEasy").setTextEmpty();this.getControl("mcGuiTxtEasyOver").setTextEmpty();c="mcGuiTxtEasy"+(a?"Over":"");break;case 2:this.getControl("mcGuiTxtNormal").setTextEmpty();this.getControl("mcGuiTxtNormalOver").setTextEmpty();c="mcGuiTxtNormal"+(a?"Over":"");break;case 3:this.getControl("mcGuiTxtHard").setTextEmpty(),this.getControl("mcGuiTxtHardOver").setTextEmpty(),c="mcGuiTxtHard"+(a?"Over":"")}""!==
c&&this.getControl(c).setTextLocalized("STR_SELECTDIFFICULTY_D"+b)};GuiSelectDifficulty.prototype.toNextScreen=function(a){StoryManager.instance?(StoryManager.instance.setDifficulty(a),GuiManager.instance.gotoScreen(GuiManager.SC_STORY_SEL)):(Global.aiMode=a,GuiManager.instance.gotoScreen(GuiManager.SC_CHARA_SEL))};function GuiManager(){ScreenManager.call(this);GuiManager.instance=this;new SavedData(Global.NUM_LEVELS+1);new TrophyManager}Application.subclass(GuiManager,ScreenManager);
GuiManager.instance=null;GuiManager.sandboxGuiView="";GuiManager.SC_SANDBOX="gui_sandbox";GuiManager.SC_SANDBOX_GUI_VIEW="gui_sandbox_gui_view";GuiManager.SC_SANDBOX_NANO_VIEW="gui_sandbox_nano_view";GuiManager.SC_PRELOAD="gui_preload";GuiManager.SC_LOADER="gui_loader";GuiManager.SC_MAIN_MENU="gui_main_menu";GuiManager.SC_ANIMATIONS="gui_animations";GuiManager.SC_METAMAP="gui_metamap";GuiManager.SC_STAGE_SEL="gui_stage_sel";GuiManager.SC_CONTINUE="gui_stage_continue";GuiManager.SC_CHARA_SEL="gui_chara_sel";
GuiManager.SC_STORY_SEL="gui_story_sel";GuiManager.SC_DIFFICULTY="gui_diff";GuiManager.SC_GAME="gui_game";GuiManager.SC_TROPHIES="gui_trophies";GuiManager.SC_END_GAME="gui_end_game";GuiManager.SC_TRY_AGAIN="gui_try_again";GuiManager.SC_CUTSCENE="gui_cutscene";GuiManager.SC_FINISH_GAME="gui_finish_game";GuiManager.SC_CHALLENGE="gui_challenge";GuiManager.SC_HELP="gui_help";GuiManager.prototype.free=function(){GuiManager.instance=null;ScreenManager.prototype.free.call(this)};
GuiManager.prototype.gotoScreen=function(a){ScreenManager.prototype.gotoScreen.call(this,a);switch(a){case GuiManager.SC_SANDBOX_NANO_VIEW:window.Assets.sandbox_nano?(this.currentScreen=new GuiLoader("mcGuiScreenLoader",window.Assets.sandbox_nano,GuiManager.SC_SANDBOX_NANO_VIEW),window.Assets.sandbox_nano=null):this.currentScreen=new DebugScreenNano;break;case GuiManager.SC_PRELOAD:a=window.SWT_BUNDLES["preload"+(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)||(this.currentScreen=
new GuiLoader("",a,GuiManager.SC_MAIN_MENU,null,0,100,!0,window.SWT_BUNDLES.localized));break;case GuiManager.SC_MAIN_MENU:a=window.SWT_BUNDLES["media_content"+(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiMainMenu("mcGuiScreenMainMenu"):(SLoaderScreen.showButtonNext=!GuiMainMenu.doneFirstLoader,this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_MAIN_MENU,[0]));break;case GuiManager.SC_CHALLENGE:a=window.SWT_BUNDLES["media_elements"+
(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiChallenge("mcGuiScreenChallenge"):this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_CHALLENGE,[]);break;case GuiManager.SC_TROPHIES:this.currentScreen=new GuiTrophies("mcGuiScreenTrophies");break;case GuiManager.SC_GAME:a=window.SWT_BUNDLES["media_gameplay"+(Application.RIGHT_TO_LEFT?"_rtl":"")].slice();a=a.concat(SLoader.getCharacterFiles());a=SLoader.getFilesWithoutList(a,SLoader.getTexturesLoaded());
SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiGame:this.currentScreen=Global.fightSettings.tutorialMode||Global.fightSettings.bonusStage?new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_GAME,Global.getBGMusicGroup()):new GuiScreenVS(a,GuiManager.SC_GAME,Global.getBGMusicGroup());break;case GuiManager.SC_CONTINUE:a=window.SWT_BUNDLES["media_elements"+(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)?this.gotoScreen(GuiManager.SC_GAME):this.currentScreen=new GuiLoader("mcGuiScreenLoader",
a,GuiManager.SC_CONTINUE,[]);break;case GuiManager.SC_SANDBOX:a=window.SWT_BUNDLES.media_gameplay;a=a.concat(window.SWT_BUNDLES.media_elements);SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiGame:this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_GAME,[0]);break;case GuiManager.SC_SANDBOX_GUI_VIEW:a=window.SWT_BUNDLES["media_gameplay"+(Application.RIGHT_TO_LEFT?"_rtl":"")];a=a.concat(window.SWT_BUNDLES["media_content"+(Application.RIGHT_TO_LEFT?"_rtl":"")]);a=a.concat(window.SWT_BUNDLES["media_elements"+
(Application.RIGHT_TO_LEFT?"_rtl":"")]);a=a.concat(window.SWT_BUNDLES["preload"+(Application.RIGHT_TO_LEFT?"_rtl":"")]);a=a.concat(window.SWT_BUNDLES["media_cutscenes"+(Application.RIGHT_TO_LEFT?"_rtl":"")]);SLoader.checkTexturesLoaded(a)?this.currentScreen=new DebugScreen(GuiManager.sandboxGuiView):this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_SANDBOX_GUI_VIEW);break;case GuiManager.SC_END_GAME:a=window.SWT_BUNDLES["media_content"+(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)?
this.currentScreen=new GuiEndGame:this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_END_GAME,[]);break;case GuiManager.SC_CHARA_SEL:a=window.SWT_BUNDLES["media_elements"+(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiCharaSelect:this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_CHARA_SEL,[]);break;case GuiManager.SC_STAGE_SEL:a=window.SWT_BUNDLES["media_elements"+(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)?
this.currentScreen=new GuiStageSelect("mcGuiScreenSelectStage"):this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_STAGE_SEL,[]);break;case GuiManager.SC_STORY_SEL:var b=[10];a=window.SWT_BUNDLES["media_elements"+(Application.RIGHT_TO_LEFT?"_rtl":"")];a=a.concat(a=window.SWT_BUNDLES["media_cutscenes"+(Application.RIGHT_TO_LEFT?"_rtl":"")]);a=SLoader.getFilesWithoutList(a,SLoader.getTexturesLoaded());SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiStorySelect:this.currentScreen=
new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_STORY_SEL,b);break;case GuiManager.SC_DIFFICULTY:a=window.SWT_BUNDLES["media_content"+(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiSelectDifficulty:this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_DIFFICULTY,[]);break;case GuiManager.SC_FINISH_GAME:a=window.SWT_BUNDLES["media_elements"+(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiFinishGame:
this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_FINISH_GAME,[]);break;case GuiManager.SC_CUTSCENE:b=1===GuiDialogCutscene.current?[10]:[9];a=window.SWT_BUNDLES["media_cutscenes"+(Application.RIGHT_TO_LEFT?"_rtl":"")];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiDialogCutscene("mcGuiScreenCutscene",["Placeholder Dialogue 1","Placeholder Dialogue 2","Placeholder Dialogue 3"]):this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_CUTSCENE,b);break;case GuiManager.SC_HELP:a=
window.SWT_BUNDLES["media_help"+(Application.RIGHT_TO_LEFT?"_rtl":"")],SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiPopupHelp("mcGuiScreenHelp"):this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_HELP,[])}};GuiManager.prototype.onKeyDown=function(a){ScreenManager.prototype.onKeyDown.call(this,a)};function BaseAction(){this.m_finished=!1}BaseAction.prototype.update=function(a){};BaseAction.prototype.onFinish=function(){this.m_finished=!0};
BaseAction.prototype.isFinished=function(){return this.m_finished};BaseAction.prototype.free=function(){};function DelayAction(a){BaseAction.call(this);this.m_delay=a||0}Application.subclass(DelayAction,BaseAction);DelayAction.prototype.execute=function(){};DelayAction.prototype.update=function(a){this.m_finished||(this.m_delay-=a,0>this.m_delay&&(this.execute(),this.onFinish()))};function ObserverAction(a,b,c){BaseAction.call(this);this.m_triggerOwner=a;this.m_triggerFunc=b;this.m_param=c}
Application.subclass(ObserverAction,BaseAction);ObserverAction.prototype.update=function(a){if(!this.m_finished)if(this.m_triggerOwner){if(this.m_triggerFunc.apply(this.m_triggerOwner,this.m_param))this.onFinish()}else this.onFinish()};function CallbackAction(a,b,c,d){DelayAction.call(this,c);this.m_caller=a;this.m_callback=b;this.m_args="undefined"===typeof d?null:d}Application.subclass(CallbackAction,DelayAction);
CallbackAction.prototype.execute=function(){null!==this.m_caller&&(null===this.m_args?this.m_callback.call(this.m_caller):this.m_callback.apply(this.m_caller,this.m_args))};CallbackAction.prototype.free=function(){this.m_callback=this.m_caller=null};function SequenceAction(a){BaseAction.call(this);this.m_actions=a}Application.subclass(SequenceAction,BaseAction);
SequenceAction.prototype.update=function(a){if(0===this.m_actions.length)this.onFinish();else{var b=this.m_actions[0];b.isFinished()?(b.free(),this.m_actions.splice(0,1),0<this.m_actions.length&&this.m_actions[0].update(0)):b.update(a)}};SequenceAction.prototype.add=function(a){this.m_actions.push(a)};function ParallelAction(a){BaseAction.call(this);this.m_actions=a}Application.subclass(ParallelAction,BaseAction);
ParallelAction.prototype.update=function(a){for(var b=this.m_actions.length-1;0<=b;b--){var c=this.m_actions[b];c.isFinished()?(c.free(),this.m_actions.splice(b,1)):c.update(a)}0===this.m_actions.length&&(this.m_finished=!0)};function ActionManager(){this.m_actions=[]}ActionManager.prototype.free=function(){this.m_actions=null};ActionManager.prototype.addAction=function(a){this.m_actions.push(a)};ActionManager.prototype.addSequence=function(a){this.m_actions.push(new SequenceAction(a))};
ActionManager.prototype.addCallback=function(a,b,c,d){a=new CallbackAction(a,b,c,d);this.addAction(a)};ActionManager.prototype.update=function(a){for(var b=this.m_actions.length-1;0<=b;b--){var c=this.m_actions[b];c.isFinished()?(c.free(),this.m_actions.splice(b,1)):c.update(a)}};
function DataHero(a){this.id=a.charaId;this.name=a.name;this.skin=a.skin;this.maxVy=a.maxVy;this.jumpImpulse=a.jumpImpulse;this.djumpImpulse=a.djumpImpulse;this.gravFactor=a.gravFactor;this.backFriction=a.backFriction;this.backSpeed=a.backSpeed;this.diveSpeed=a.diveSpeed;this.diveAngle=a.diveAngle;this.diveYOffset=a.diveYOffset;this.gravity=a.gravity;this.maxHp=a.maxHp;this.diveBar=a.diveBar;this.bulletId=a.bulletId;this.damage=a.damage;this.punchDmg=a.punchDmg;this.shadowScale=a.shadowScale;this.diveSound=
a.diveSound}DataHero.ID_CRICKET=0;DataHero.ID_TILLY=1;DataHero.ID_PIG=2;DataHero.ID_CHICKEN=3;DataHero.ID_REMY=4;DataHero.ID_BILL=5;DataHero.ID_GRAMMA=6;DataHero.ID_BOSS_GRAMMA=7;DataHero.GUI_MAP=[0,1,5,6,3,4,2];DataHero.NUM_HEROES=7;DataHero.NUM_COSTUMES=3;DataHero.NAMES="cricket tilly pig chicken remy bill gramma".split(" ");DataHero.getData=function(a){var b=Application.config.heroes;return a>=b.length?(Application.error("A hero data with this ID does not exist: "+a),null):new DataHero(b[a])};
DataHero.getMediaId=function(a){var b=Application.config.heroes;return a>=b.length?(Application.error("A hero data with this ID does not exist: "+a),-1):b[a].mediaId};DataHero.toGUIIndex=function(a){return a>=DataHero.GUI_MAP.length?DataHero.toGUIIndex(DataHero.NUM_HEROES-1):DataHero.GUI_MAP[a]};DataHero.getCharaId=function(a){var b=Application.config.heroes;return a>=b.length?(Application.error("A hero data with this ID does not exist: "+a),-1):b[a].charaId};
function DataBattle(a){this.iniDistance=a.iniDistance;this.iniNumTaps=a.iniNumTaps;this.maxNumTaps=a.maxNumTaps;this.tapIncRatio=a.tapIncRatio;this.parryStun=a.parryStun;this.backSlideSpeed=a.backSlideSpeed;this.repositionDist=a.repositionDist;this.repositionSpeed=a.repositionSpeed;this.globalGravity=a.globalGravity;this.roundTime=a.roundTime;this.modHitG=a.modHitG;this.modHitSp=a.modHitSp;this.spChargeTime=a.spChargeTime;this.recoveryDmg=a.recoveryDmg;this.scale=a.scale}DataBattle.ID_STANDARD=0;
DataBattle.prototype.toDefault=function(){var a=DataBattle.getData(DataBattle.ID_STANDARD),b;for(b in a)this[b]=a[b]};DataBattle.getData=function(a){var b=Application.config.battleConfig;return a>=b.length?(Application.error("A battle data with this ID does not exist: "+a),null):new DataBattle(b[a])};function DataBullet(a,b,c,d){this.skin=a;this.speed=b;this.damageArray=c;this.damage=c[0];this.rotation=d||0}DataBullet.ID_DUMMY1=0;DataBullet.ID_DUMMY2=1;
DataBullet.prototype.clone=function(){return new DataBullet(this.skin,this.speed,this.damageArray,this.rotation)};DataBullet.getBulletData=function(a,b){var c=Application.config.bullets;if(a>=c.length)return Application.error("A bullet data with this ID does not exist: "+a),null;a=c[a];return new DataBullet(a.skin[b],a.speed,a.damage,a.rotation)};function DataStage(a){this.name=a.name;this.modifierId=a.modifierId}DataStage.ID_HOUSE_FRONT=0;DataStage.ID_BIG_COFFEE=1;DataStage.ID_SUBWAY=2;
DataStage.ID_ZOO=3;DataStage.ID_STREET=4;DataStage.ID_PARK=5;DataStage.ID_BACKYARD=6;DataStage.getData=function(a){var b=Application.config.stages;return a>=b.length?(Application.error("A Stage data with this ID does not exist: "+a),null):new DataStage(b[a])};
function DataFight(){this.p1Costume=this.p1CharId=0;this.p2CharIdSaved=this.p2CharId=1;this.p2Costume=0;this.m_stage=null;this.modifierId=-1;this.challengeId=ChallManager.ID_NONE;this.modEnabled=!0;this.tutorialReturn=this.tutorialMode=this.storyMode=this.bonusStage=!1}DataFight.prototype.setStageData=function(a){this.m_stage=DataStage.getData(a);this.modifierId=this.m_stage.modifierId};DataFight.prototype.getStageData=function(){return this.m_stage};
DataFight.prototype.setChallenge=function(a){this.challengeId=a;var b=Application.config.challenges[a];Global.fightSettings.setStageData(b.stage);Global.fightSettings.modEnabled=a===ChallManager.ID_STAMPEDE;Global.fightSettings.p1CharId=b.player;Global.fightSettings.p2CharId=b.opponent;Global.aiMode=b.aiDifficulty};DataFight.prototype.isChallenge=function(){return this.challengeId!==ChallManager.ID_NONE};function RandomTable(){this.m_values=[];this.m_weights={}}
RandomTable.prototype.put=function(a,b){this.entryExists(a)||this.m_values.push(a);this.m_weights[a]=new RandomTableEntry(b)};RandomTable.prototype.putCustomFactor=function(a,b){this.entryExists(a)&&(this.m_weights[a].customFactor=b)};RandomTable.prototype.resetCustomFactors=function(){for(var a in this.m_weights)this.m_weights[a].customFactor=1};
RandomTable.prototype.remove=function(a){if(this.entryExists(a)){for(var b=this.m_values.length-1;0<=b;b--)this.m_values[b]===a&&this.m_values.splice(b,1);delete this.m_weights[a]}};
RandomTable.prototype.getRandomValue=function(){var a=0,b=0,c="",d;for(d in this.m_weights){var e=this.m_weights[d];a+=e.weight*e.customFactor*e.repeatFactor}var f=Math.random()*a;for(d in this.m_weights)e=this.m_weights[d],a=e.weight*e.customFactor*e.repeatFactor,0!==a&&(f>=b&&f<b+a?(c=d,e.repeatFactor*=.3):e.repeatFactor=1,b+=a);return c};RandomTable.prototype.entryExists=function(a){return this.m_weights.hasOwnProperty(a)};
function RandomTableEntry(a){this.weight=a;this.repeatFactor=this.customFactor=1}
function AIConfig(a){this.safeDistance=a.safeDistance;this.diveChance=a.diveChance;this.tackleChance=a.tackleChance;this.gEvadeChance=a.gEvadeChance;this.halfSpChance=a.halfSpChance;this.insActionWait=a.instantActionWait;this.inputDelay=a.inputDelay;this.recoveryTime=a.recoveryTime;this.pollTime=a.pollTime;this.m_probabilityMap={};this.m_probabilityMap.g2g=a.g2g;this.m_probabilityMap.g2a=a.g2a;this.m_probabilityMap.a2g=a.a2g;this.m_probabilityMap.a2a=a.a2a;this.m_probabilityMap.corner=a.corner;this.m_probabilityMap.approach=
a.approach}AIConfig.prototype.getProbArray=function(a){a=a.replace("st_","");return this.m_probabilityMap[a]};AIConfig.getData=function(a){var b=Application.config.aiConfig;return a>=b.length?(Application.error("An AI data with this ID does not exist: "+a),null):new AIConfig(b[a])};
function AIData(a,b,c){this.config=c;this.world=a;this.me=a.players()[b];this.opponent=this.me.opponent;this.playerVDist=this.playerHDist=0;this.tackleDist=AIData.getTackleDistance(this.me);this.useHalfBarSpecial=this.hasSpecial=this.canHit=this.willBeHit=!1}AIData.prototype.rebind=function(a){this.me=this.world.players()[a];this.opponent=this.me.opponent;this.playerVDist=this.playerHDist=0;this.tackleDist=AIData.getTackleDistance(this.me);this.hasSpecial=this.canHit=this.willBeHit=!1};
AIData.prototype.updateData=function(){this.playerHDist=Common.distance(this.me.getX(),0,this.opponent.getX(),0);this.playerVDist=Common.distance(0,this.me.getY(),0,this.opponent.getY());this.willBeHit=AIData.willHit(this.opponent,this.me);this.canHit=AIData.canHit(this.me,this.opponent);this.hasSpecial=this.useHalfBarSpecial?this.me.specialReady():this.me.MPIsFull()};AIData.willHit=function(a,b){return a.getMState()!==FighterActor.ST_DIVE?!1:AIData.canHit(a,b)};
AIData.canHit=function(a,b){var c=a.getMainCollision().w;b=new Vector2D(b.getX(),b.getY());var d=new Vector2D(a.getX(),a.getY());a=a.getDiveSpeed();var e=(b.dot(a)-d.dot(a))/a.squaredLength();a.scale(e);return b.minus(d.plus(a)).length()<c/2};AIData.canHit2=function(a,b){var c=a.getMainCollision().w;b=new Vector2D(b.getX(),b.getY());var d=new Vector2D(a.getX(),a.getY());a=a.getDiveSpeed().udir();a=d.minus(b).projectionOn(a);return d.minus(b).minus(a).length()<c/2};
AIData.getTackleDistance=function(a){var b=a.data.backSpeed;return b*b/(2*a.data.backFriction/1E3)};function AIState(a){this.name="";this.data=a;this.m_randTable=new RandomTable;this.instantAction=null;this.m_canChooseDive=!0;this.m_spActionTimer=0}AIState.ST_A2A="st_a2a";AIState.ST_G2G="st_g2g";AIState.ST_A2G="st_a2g";AIState.ST_G2A="st_g2a";AIState.ST_CORNER="st_corner";AIState.ST_APPROACH="st_approach";
AIState.prototype.loadActionWeights=function(){var a=this.data.config.getProbArray(this.name);"undefined"!==typeof a&&(this.m_randTable.put(AICore.ACT_JUMP,a[0]),this.m_randTable.put(AICore.ACT_ATTACK,a[1]),this.m_randTable.put(AICore.ACT_BDASH,a[2]),this.m_randTable.put(AICore.ACT_WAIT,a[3]),this.m_randTable.put(AICore.ACT_SPECIAL,a[4]))};
AIState.prototype.update=function(a){0===this.m_spActionTimer?this.checkSpecialActions()&&(this.m_spActionTimer=this.data.config.insActionWait):this.m_spActionTimer=Math.max(0,this.m_spActionTimer-a)};AIState.prototype.checkSpecialActions=function(){return!1};AIState.prototype.selectAction=function(){return this.m_randTable.getRandomValue()};
AIState.prototype.checkCertainDive=function(){return this.data.canHit&&this.m_canChooseDive?(Math.random()<=this.data.config.diveChance&&(this.instantAction=AICore.ACT_ATTACK,this.m_canChooseDive=!1),!0):!1};AIState.prototype.checkCertainTackle=function(){return this.data.playerHDist<this.data.tackleDist-30&&80>this.data.playerVDist?(Math.random()<=this.data.config.tackleChance&&(this.instantAction=AICore.ACT_ATTACK,this.m_canChooseDive=!1),!0):!1};
AIState.prototype.checkEnemyDive=function(){return this.data.willBeHit?(Math.random()<=this.data.config.gEvadeChance&&(this.data.me.isAgainstWall()?this.instantAction=AICore.ACT_JUMP:this.instantAction=AICore.ACT_BDASH),!0):!1};
AIState.prototype.checkBDashPossible=function(){if(this.data.me.isAgainstWall())return this.m_randTable.putCustomFactor(AICore.ACT_BDASH,0),!1;var a=AIState.linear(1,.1,100,this.data.config.safeDistance,this.data.playerHDist);this.m_randTable.putCustomFactor(AICore.ACT_BDASH,a);return!0};
AIState.prototype.checkSpecial=function(){var a=this.data.world.getFloorY()-this.data.opponent.getY();if(this.data.hasSpecial&&150>a)return this.m_randTable.putCustomFactor(AICore.ACT_SPECIAL,1),this.selectAction()===AICore.ACT_SPECIAL&&(this.instantAction=AICore.ACT_SPECIAL),this.m_randTable.putCustomFactor(AICore.ACT_SPECIAL,0),!0;this.m_randTable.putCustomFactor(AICore.ACT_SPECIAL,0);return!1};
AIState.prototype.checkAirSpecial=function(){var a=this.data.me,b=this.data.opponent,c=0>b.speed().y&&200>this.data.playerVDist&&a.getY()<b.getY();b=50>this.data.playerVDist&&b.isOnFloor();if(this.data.hasSpecial&&a.canAct(FighterActor.KEY_BOTH)&&(c||b))return this.m_randTable.putCustomFactor(AICore.ACT_SPECIAL,1),this.selectAction()===AICore.ACT_SPECIAL&&(this.instantAction=AICore.ACT_SPECIAL),this.m_randTable.putCustomFactor(AICore.ACT_SPECIAL,0),!0;this.m_randTable.putCustomFactor(AICore.ACT_SPECIAL,
0);return!1};
AIState.prototype.checkPowerup=function(){var a=this.data.me;if(!FighterGame.instance.modifier)return!1;var b=FighterGame.instance.modifier.elements;b=b.filter(function(a){return null!==a});for(var c=0;c<b.length;c++){var d=b[c],e=d.getX()-a.getX();switch(d.aiType){case AICore.PU_TYPE_PICK:if(a.isOnFloor()&&d.isActive()&&Math.abs(e)<=this.data.tackleDist){if(.9<Math.random())continue;a.dirSign()===Math.sign(e)&&a.canAct(FighterActor.KEY_PUNCH)?this.instantAction=AICore.ACT_ATTACK:a.dirSign()!==Math.sign(e)&&
a.canAct(FighterActor.KEY_EVD)&&(this.instantAction=AICore.ACT_BDASH);return!0}case AICore.PU_TYPE_HIT:if(!a.isOnFloor()&&d.isActive()&&AIData.canHit(a,d)&&a.canDive())return.9>=Math.random()&&(this.instantAction=AICore.ACT_ATTACK,this.m_canChooseDive=!1),!0}}return!1};
AIState.getState=function(a,b){switch(a){case AIState.ST_G2G:return new G2GState(b);case AIState.ST_A2G:return new A2GState(b);case AIState.ST_G2A:return new G2AState(b);case AIState.ST_A2A:return new A2AState(b);case AIState.ST_CORNER:return new CornerState(b);case AIState.ST_APPROACH:return new ApproachState(b);default:return new AIState(b)}};
AIState.getNextState=function(a){var b=!a.opponent.isOnFloor(),c=!a.me.isOnFloor(),d=a.world.limitRight-a.world.limitLeft;return a.me.isAgainstWall()&&a.playerHDist<d/2?AIState.ST_CORNER:a.playerHDist>d/2?AIState.ST_APPROACH:b&&c?AIState.ST_A2A:b?AIState.ST_G2A:c?AIState.ST_A2G:AIState.ST_G2G};AIState.linear=function(a,b,c,d,e){return e<=c?a:e>=d?b:(b-a)/(d-c)*(e-c)+a};function A2GState(a){AIState.call(this,a);this.name=AIState.ST_A2G;this.loadActionWeights()}Application.subclass(A2GState,AIState);
A2GState.prototype.update=function(a){AIState.prototype.update.call(this,a)};A2GState.prototype.checkSpecialActions=function(){return this.checkAirSpecial()||this.checkPowerup()||this.checkCertainDive()};function G2AState(a){AIState.call(this,a);this.name=AIState.ST_G2A;this.loadActionWeights();this.m_randTable.putCustomFactor(AICore.ACT_SPECIAL,0)}Application.subclass(G2AState,AIState);G2AState.prototype.update=function(a){AIState.prototype.update.call(this,a);this.checkBDashPossible()};
G2AState.prototype.checkSpecialActions=function(){return this.checkEnemyDive()||this.checkPowerup()||this.checkCertainTackle()||this.checkSpecial()};function G2GState(a){AIState.call(this,a);this.name=AIState.ST_G2G;this.loadActionWeights();this.m_randTable.putCustomFactor(AICore.ACT_SPECIAL,0)}Application.subclass(G2GState,AIState);G2GState.prototype.update=function(a){AIState.prototype.update.call(this,a);this.checkBDashPossible()};
G2GState.prototype.checkSpecialActions=function(){return this.checkSpecial()||this.checkPowerup()||this.checkCertainTackle()};function A2AState(a){AIState.call(this,a);this.name=AIState.ST_A2A;this.loadActionWeights()}Application.subclass(A2AState,AIState);A2AState.prototype.update=function(a){AIState.prototype.update.call(this,a);this.data.me.canAct(FighterActor.KEY_JMP)||this.m_randTable.putCustomFactor(AICore.ACT_JUMP,0)};
A2AState.prototype.checkSpecialActions=function(){return this.checkAirSpecial()||this.checkCertainDive()||this.checkPowerup()};function CornerState(a){AIState.call(this,a);this.name=AIState.ST_CORNER;this.loadActionWeights()}Application.subclass(CornerState,AIState);CornerState.prototype.update=function(a){AIState.prototype.update.call(this,a);this.data.me.isOnFloor()?this.checkBDashPossible():this.m_randTable.putCustomFactor(AICore.ACT_ATTACK,1)};
CornerState.prototype.checkSpecialActions=function(){var a=this.data.opponent,b=this.data.me;return b.isOnFloor()?this.checkEnemyDive():b.isOnFloor()||a.isOnFloor()||!(b.getBotY()-a.getBotY()>b.getMainCollision().h&&300>this.data.playerHDist||a.getBotY()-b.getBotY()>b.getMainCollision().h&&150>this.data.playerHDist)?this.checkCertainDive():(this.instantAction=AICore.ACT_ATTACK,!0)};function ApproachState(a){AIState.call(this,a);this.name=AIState.ST_APPROACH;this.loadActionWeights()}
Application.subclass(ApproachState,AIState);ApproachState.prototype.update=function(a){AIState.prototype.update.call(this,a);a=this.data.opponent;this.data.me.isOnFloor()?a.isOnFloor()?this.m_randTable.putCustomFactor(AICore.ACT_ATTACK,1.5):(this.m_randTable.putCustomFactor(AICore.ACT_ATTACK,.75),this.m_randTable.putCustomFactor(AICore.ACT_JUMP,1.25)):(this.m_randTable.resetCustomFactors(),this.m_randTable.putCustomFactor(AICore.ACT_ATTACK,1.75))};
ApproachState.prototype.checkSpecialActions=function(){return this.data.me.isOnFloor()?this.checkEnemyDive()||this.checkPowerup():this.checkCertainDive()||this.checkPowerup()};
function AICore(a,b,c){this.m_data=new AIData(b,a,AIConfig.getData(c));this.idConfig=c;this.m_playerId=a;this.m_state=AIState.getState(AIState.ST_G2G,this.m_data);this.m_prevState="";this.m_inputTimer=this.m_actionTimer=0;this.m_recoveryTimer=this.getTapInterval();this.m_cachedAction=this.m_selectedKey=null;this.m_cacheTimer=0;this.m_actionLog=[];this.m_disabled=this.m_choseSpStrategy=!1;this.applyMultipliers()}AICore.CACHE_TIME=250;AICore.LOG_LIMIT=5;AICore.MODE_NONE=-1;AICore.MODE_EASY=0;
AICore.MODE_MEDIUM=1;AICore.MODE_HARD=2;AICore.MODE_CHUCK=3;AICore.PU_TYPE_NONE=-1;AICore.PU_TYPE_HIT=0;AICore.PU_TYPE_PICK=1;AICore.ACT_WAIT="a_wait";AICore.ACT_JUMP="a_jmp";AICore.ACT_BDASH="a_bdash";AICore.ACT_ATTACK="a_attack";AICore.ACT_SPECIAL="a_special";AICore.prototype.rebindData=function(){this.m_data.rebind(this.m_playerId);this.applyMultipliers()};
AICore.prototype.update=function(a){this.m_data.updateData();null===this.m_state||this.m_disabled||(this.m_data.me.isDown()?this.recoveryLoop(a):null!==this.m_selectedKey&&0<this.m_inputTimer?this.m_inputTimer-=a:(null!==this.m_selectedKey&&(this.pressKey(this.m_selectedKey),this.m_selectedKey=null),!this.m_choseSpStrategy&&this.m_data.me.specialReady()&&(this.m_choseSpStrategy=!0,this.m_data.useHalfBarSpecial=Math.random()<=this.m_data.config.halfSpChance||ChallManager.instance.getId()===ChallManager.ID_SPEC_SPAM),
0<this.m_cacheTimer?this.m_cacheTimer-=a:this.m_cachedAction&&(this.m_cachedAction=null),this.m_state.update(a),this.m_state.instantAction?(this.m_cachedAction=null,this.queueAction(this.m_state.instantAction,!1),this.m_state.instantAction=null,this.m_actionTimer=this.m_data.config.pollTime):(this.m_actionTimer-=a,this.m_cachedAction?this.queueAction(this.m_cachedAction,!0):0>this.m_actionTimer&&this.queueAction(this.m_state.selectAction(),!0),a=AIState.getNextState(this.m_data),a!==this.m_state.name&&
(this.m_prevState=this.m_state.name,this.m_state=AIState.getState(a,this.m_data)))))};
AICore.prototype.queueAction=function(a,b){if(a===AICore.ACT_WAIT)this.m_actionTimer=this.m_data.config.pollTime,a=null!==this.m_state.instantAction?a+"(F)":a,this.addActionLog(a);else{var c=this.actionToKey(a),d=this.m_data.me.rawKeyToFightKey(c);this.m_data.me.canAct(d)?(this.m_actionTimer=this.m_data.config.pollTime,this.m_cachedAction=null,this.m_cacheTimer=0,a===AICore.ACT_SPECIAL&&(this.m_choseSpStrategy=!1),this.m_selectedKey=c,this.m_inputTimer=b?0:this.m_data.config.inputDelay,a=null!==this.m_state.instantAction?
a+"(F)":a,this.addActionLog(a)):null===this.m_cachedAction&&(this.m_cachedAction=a,this.m_cacheTimer=AICore.CACHE_TIME)}};AICore.prototype.actionToKey=function(a){switch(a){default:return-1;case AICore.ACT_ATTACK:return FighterInput.KEY_FWD;case AICore.ACT_BDASH:return FighterInput.KEY_BACK;case AICore.ACT_JUMP:return FighterInput.KEY_UP;case AICore.ACT_SPECIAL:return FighterInput.KEY_SPEC}};
AICore.prototype.recoveryLoop=function(a){this.m_recoveryTimer-=a;0>=this.m_recoveryTimer&&(this.pressKey(FighterInput.KEY_RECOV),this.m_recoveryTimer=this.getTapInterval())};AICore.prototype.getTapInterval=function(){return this.m_data.config.recoveryTime/this.m_data.me.getNumTaps()};AICore.prototype.applyMultipliers=function(){var a=this.m_data.me;StoryManager.instance&&(a.maxHp*=StoryManager.instance.getHPMult(),a.addHP(a.maxHp),1===a.dmgMultiplier&&(a.dmgMultiplier=StoryManager.instance.getDmgMult()))};
AICore.prototype.getState=function(){return this.m_state.name};AICore.prototype.getPrevState=function(){return this.m_prevState};AICore.prototype.pressKey=function(a){if(this.m_data.me.isInverted())switch(a){case FighterInput.KEY_FWD:a=FighterInput.KEY_BACK;break;case FighterInput.KEY_BACK:a=FighterInput.KEY_FWD}this.m_data.me.keyDown(a);this.m_data.me.keyUp(a)};
AICore.prototype.addActionLog=function(a){this.m_actionLog.unshift(a);this.m_actionLog.length>AICore.LOG_LIMIT&&this.m_actionLog.splice(AICore.LOG_LIMIT,1)};AICore.prototype.getActionLog=function(){for(var a="",b=0;b<this.m_actionLog.length;b++)a+=b+":"+this.m_actionLog[b].replace("a_","")+"\n";return a};AICore.prototype.disable=function(a){this.m_disabled=a};
function VOHandler(a,b,c){this.m_charaName=DataHero.NAMES[a].toUpperCase();this.m_minWait=b;this.m_maxWait=c;this.m_timeout=0;this.m_globalWait=Common.randomInt(b,c);this.m_waitMap={};this.lastPlayedId="";this.m_numVariations=[0,0,0,0,0,0,0,0];this.m_variationTurn=[0,0,0,0,0,0,0,0];this.initVariations()}VOHandler.VO_TYPE_HURT=0;VOHandler.VO_TYPE_DIVE=1;VOHandler.VO_TYPE_BDASH=2;VOHandler.VO_TYPE_JUMP=3;VOHandler.VO_TYPE_TACKLE=4;VOHandler.VO_TYPE_SP=5;VOHandler.VO_TYPE_TAUNT=6;
VOHandler.VO_TYPE_WIN=7;VOHandler.VO_TIMEOUT=3500;VOHandler.VO_SUFFIX="hurt dive back jump tackle special taunt win".split(" ");VOHandler.prototype.initVariations=function(){for(var a=0;a<this.m_numVariations.length;a++){var b=VOHandler.VO_SUFFIX[a].toUpperCase();this.m_numVariations[a]=VOHandler.getVOVariations("VO_"+this.m_charaName+"_"+b).length}};VOHandler.prototype.playVO=function(a){a=VOHandler.getVOVariations("VO_"+this.m_charaName+"_"+a);Application.instance.playSound(Common.getRandomFromArray(a))};
VOHandler.prototype.playGameplayVO=function(a,b,c){if(0!=this.m_numVariations[a]){var d=VOHandler.VO_SUFFIX[a].toUpperCase();d="VO_"+this.m_charaName+"_"+d;if("undefined"===typeof c||c>=this.m_numVariations[a])c=this.m_variationTurn[a];c=d+c;b?(Application.instance.playSound(c),this.m_timeout=VOHandler.VO_TIMEOUT,this.lastPlayedId=c):this.playSound(c,d)&&(this.m_variationTurn[a]=(this.m_variationTurn[a]+1)%this.m_numVariations[a])}};
VOHandler.prototype.playSound=function(a,b){if("undefined"===typeof this.m_globalWait)this.m_waitMap[b]=Common.randomInt(this.m_minWait,this.m_maxWait);else if(this.m_globalWait--,0>=this.m_globalWait)return Application.instance.playSound(a),this.m_timeout=VOHandler.VO_TIMEOUT,this.lastPlayedId=a,this.m_globalWait=Common.randomInt(this.m_minWait,this.m_maxWait),!0;return!1};VOHandler.prototype.update=function(a){this.m_timeout-=a};VOHandler.prototype.isPlayingLastVO=function(){return Application.instance.isPlayingSound(this.lastPlayedId)};
VOHandler.getVOVariations=function(a){a=new RegExp(a);for(var b=[],c=Application.config.sounds,d=0;d<c.length;d++)a.test(c[d].id)&&b.push(c[d].id);return b};function InputComponent(a){this.m_player=a;this.inputDelay=20;this.bufferDuration=120;this.bufferTimer=this.bufferedKey=-1;this.instantMode=!0;this.m_inverted=!1;this.m_inputSendTime=-1;this.m_keyPress={};this.m_keyHold={};this.init()}
InputComponent.prototype.init=function(){this.resetKeyPress();this.m_keyHold[""+FighterInput.KEY_FWD]=!1;this.m_keyHold[""+FighterInput.KEY_UP]=!1;this.m_keyHold[""+FighterInput.KEY_BACK]=!1;this.m_keyHold[""+FighterInput.KEY_DOWN]=!1;this.m_keyHold[""+FighterInput.KEY_SPEC]=!1;this.m_keyHold[""+FighterInput.KEY_RECOV]=!1};
InputComponent.prototype.resetKeyPress=function(){this.m_inputSendTime=-1;this.m_keyPress[""+FighterInput.KEY_FWD]=!1;this.m_keyPress[""+FighterInput.KEY_UP]=!1;this.m_keyPress[""+FighterInput.KEY_BACK]=!1;this.m_keyPress[""+FighterInput.KEY_DOWN]=!1;this.m_keyPress[""+FighterInput.KEY_SPEC]=!1;this.m_keyPress[""+FighterInput.KEY_RECOV]=!1};
InputComponent.prototype.onKeyDown=function(a){this.m_inverted&&(a=this.reverseKey(a));this.m_keyPress.hasOwnProperty(""+a)&&(this.m_keyHold[""+a]||(this.m_keyPress[""+a]=!0,this.resetBuffer(),this.instantMode?(this.resolveInput(),this.resetKeyPress()):this.m_inputSendTime=this.inputDelay),this.m_keyHold[""+a]=!0)};InputComponent.prototype.onKeyUp=function(a){this.m_inverted&&(a=this.reverseKey(a));this.m_keyHold.hasOwnProperty(""+a)&&(this.m_keyHold[""+a]=!1)};
InputComponent.prototype.reverseKey=function(a){switch(a){case FighterInput.KEY_FWD:return FighterInput.KEY_BACK;case FighterInput.KEY_BACK:return FighterInput.KEY_FWD;default:return a}};
InputComponent.prototype.update=function(a){this.m_inverted!==this.m_player.isInverted()&&(this.m_inverted=this.m_player.isInverted(),this.init(),this.bufferedKey=this.reverseKey(this.bufferedKey));if(-1!==this.bufferedKey)if(this.bufferTimer-=a,0>this.bufferTimer)this.resetBuffer();else{var b=this.m_player.rawKeyToFightKey(this.bufferedKey);this.m_player.canAct(b)&&(this.m_player.triggerKey(b),this.resetBuffer())}0<this.m_inputSendTime?this.m_inputSendTime=Math.max(0,this.m_inputSendTime-a):0===
this.m_inputSendTime&&(this.resolveInput(),this.resetKeyPress())};InputComponent.prototype.resetBuffer=function(){this.bufferedKey=this.bufferTimer=-1};InputComponent.prototype.resolveInput=function(){var a=!1,b=-1,c;for(c in this.m_keyPress)this.m_keyPress[c]&&(b=parseInt(c,10),a=this.m_player.rawKeyToFightKey(b),a=this.m_player.triggerKey(a));a?this.resetBuffer():(this.bufferedKey=b,this.bufferTimer=this.bufferDuration)};
function SimpleWorldActor(a,b,c,d,e){this.m_health=this.m_oldY=this.m_oldX=this.m_y=this.m_x=0;this.m_scaleY=this.m_scaleX=this.m_scale=1;this.m_damage=0;this.m_skin=this.m_state="";this.m_className="SimpleWorldActor";this.m_isRangeControlled=this.m_isAwaitingDelete=this.m_flipX=this.m_isIdle=!1;this.m_canvas=a;this.m_world=b;this.m_movement=this.m_character=this.m_clip=this.m_standBounds=this.m_boundsAttack=this.m_bounds=this.m_speed=null;this.m_rawData="undefined"!==typeof e?e:null;this.setPosition(c,
d)}SimpleWorldActor.prototype.free=function(){null!==this.m_character&&(this.m_character.free(),this.m_clip=this.m_character=null);null!==this.m_clip&&(this.m_canvas.removeChild(this.m_clip),this.m_clip.free(),this.m_clip=null);this.m_movement&&(this.m_movement.free(),this.m_movement=null);this.m_speed=this.m_world=this.m_canvas=this.m_boundsAttack=this.m_bounds=this.m_rawData=null};SimpleWorldActor.prototype.onHit=function(a){return!0};SimpleWorldActor.prototype.onEndAnimation=function(a){};
SimpleWorldActor.prototype.saveData=function(){};SimpleWorldActor.prototype.className=function(){return this.m_className};SimpleWorldActor.prototype.isAwaitingDelete=function(){return this.m_isAwaitingDelete};SimpleWorldActor.prototype.setAwaitingDelete=function(a){this.m_isAwaitingDelete=a};SimpleWorldActor.prototype.isRangeControlled=function(){return this.m_isRangeControlled};SimpleWorldActor.prototype.setRangeControlled=function(a){this.m_isRangeControlled=a};SimpleWorldActor.prototype.clip=function(){return this.m_clip};
SimpleWorldActor.prototype.bounds=function(){return this.m_bounds};SimpleWorldActor.prototype.boundsAttack=function(){return this.m_boundsAttack};SimpleWorldActor.prototype.speed=function(){return this.m_speed};SimpleWorldActor.prototype.world=function(){return this.m_world};SimpleWorldActor.prototype.isIdle=function(){return this.m_isIdle};SimpleWorldActor.prototype.scale=function(){return this.m_scale};SimpleWorldActor.prototype.getX=function(){return this.m_x};SimpleWorldActor.prototype.getY=function(){return this.m_y};
SimpleWorldActor.prototype.skin=function(){return this.m_skin};SimpleWorldActor.prototype.flipX=function(){return this.m_flipX};SimpleWorldActor.prototype.canvas=function(){return this.m_canvas};SimpleWorldActor.prototype.setPosition=function(a,b){this.setX(a);this.setY(b)};SimpleWorldActor.prototype.setX=function(a){this.m_oldX=this.m_x=a};SimpleWorldActor.prototype.setY=function(a){this.m_oldY=this.m_y=a};
SimpleWorldActor.prototype.setFlipX=function(a){this.m_flipX!==a&&(this.m_flipX=a,null!==this.m_clip&&(this.m_clip.scale.x=this.m_flipX?-this.m_scaleX:this.m_scaleX))};SimpleWorldActor.prototype.setScale=function(a){this.m_scale!==a&&(null!==this.m_clip&&this.m_clip.setScale(this.m_flipX?-a:a,a),this.m_scaleY=this.m_scaleX=this.m_scale=a)};SimpleWorldActor.prototype.setScaleX=function(a){this.m_scaleX!==a&&(null!==this.m_clip&&(this.m_clip.scale.x=this.m_flipX?-a:a),this.m_scaleX=a)};
SimpleWorldActor.prototype.setScaleY=function(a){this.m_scaleY!==a&&(null!==this.m_clip&&(this.m_clip.scale.y=a),this.m_scaleY=a)};SimpleWorldActor.prototype.setScaleXY=function(a,b){this.setScaleX(a);this.setScaleY(b)};SimpleWorldActor.prototype.movementUpdate=function(a){this.m_movement&&(this.m_movement.update(a),this.m_x=this.m_movement.getX(),this.m_y=this.m_movement.getY())};
SimpleWorldActor.prototype.showInCamera=function(){null!==this.m_character?this.m_character.setPosition(this.m_x-this.m_world.camera().getX(),this.m_y-this.m_world.camera().getY()):null!==this.m_clip&&this.m_clip.setPosition(this.m_x-this.m_world.camera().getX(),this.m_y-this.m_world.camera().getY())};SimpleWorldActor.prototype.update=function(a){null!==this.m_character?this.m_character.update(a):null!==this.m_clip&&this.m_clip.update(a)};
SimpleWorldActor.prototype.hitTestWithActorByBounds=function(a,b,c){b="undefined"!==typeof b?b:"mcCollision";c="undefined"!==typeof c?c:"mcCollision";return null===a||"undefined"===typeof a.clip||null===a.clip()||null===a.clip().getCollision(c)||null===this.m_clip||null===this.m_clip.getCollision(b)?!1:SDisplayObjectContainer.hitTestByBounds(this.m_clip,this.m_clip.getCollision(b),a.clip(),a.clip().getCollision(c))};SimpleWorldActor.prototype.state=function(){return this.m_state};
SimpleWorldActor.prototype.createStandBounds=function(){null!==this.m_character.clip.getCollision("mcCollision")&&(this.m_standBounds=this.m_character.clip.getCollision("mcCollision").clone(),this.m_standBounds.x=0,this.m_standBounds.y=0,this.m_standBounds.w*=this.m_scaleX,this.m_standBounds.h*=this.m_scaleY)};SimpleWorldActor.prototype.standBounds=function(){return this.m_standBounds};
SimpleWorldActor.prototype.gotoState=function(a,b){a!==this.m_state&&(this.characterGotoState(a,b),this.m_state=a,null!==this.m_clip&&null!==this.m_clip.getCollision("mcCollision")&&(this.m_bounds=this.m_clip.getCollision("mcCollision").clone(),this.m_bounds.x+=.5*this.m_bounds.w*(1-this.m_scaleX),this.m_bounds.y+=.5*this.m_bounds.h*(1-this.m_scaleY),this.m_bounds.w*=this.m_scaleX,this.m_bounds.h*=this.m_scaleY))};
SimpleWorldActor.prototype.characterGotoState=function(a,b){b="undefined"===typeof b?!0:b;a!==this.m_state&&null!==this.m_character&&(this.m_character.gotoState(a),this.m_clip=this.m_character.clip,this.m_clip.scale.x=this.m_flipX?-this.m_scaleX:this.m_scaleX,this.m_clip.scale.y=this.m_scaleY,this.m_clip.loop=b)};
SimpleWorldActor.prototype.isInCamera=function(a){a="undefined"!==typeof a?a:100;var b=this.m_x,c=this.m_x,d=this.m_y,e=this.m_y;this.m_bounds&&(b+=this.m_bounds.x,c=b+this.m_bounds.w,d+=this.m_bounds.y,e=d+this.m_bounds.h);var f=Application.WIDE_SCREEN?Layout.left:0,g=Application.WIDE_SCREEN?Layout.top:0;return c>=this.m_world.camera().getX()-f/Layout.scale-a&&b<=this.m_world.camera().getX()+this.m_world.camera().width()+a&&e>=this.m_world.camera().getY()-g/Layout.scale-a&&d<=this.m_world.camera().getY()+
this.m_world.camera().height()+a};SimpleWorldActor.prototype.onIdle=function(a){this.m_isIdle=a;null!==this.m_clip&&(this.m_clip.visible=!a)};SimpleWorldActor.prototype.damage=function(){return this.m_damage};SimpleWorldActor.prototype.character=function(){return this.m_character};SimpleWorldActor.prototype.onCollisionWithModElement=function(a){};
function GenericBullet(a,b,c,d,e,f){SimpleWorldActor.call(this,a,b,d,e);this.m_fWorld=b;this.m_owner=c;this.m_endY=this.m_endX=this.m_vy=this.m_vx=0;this.m_skin=f.skin;this.m_motionLimit=new Rectangle;this.hasDirection=!1;this.offRot=f.rotation;this.m_bulletSpeed=f.speed;this.fullPower=this.m_deletePending=!1;this.m_damage=f.damage;if(this.m_clip=Application.instance.getAnimation(this.m_skin))this.showInCamera(),this.m_canvas.addChild(this.m_clip);this.m_className="GenericBullet"}
Application.subclass(GenericBullet,SimpleWorldActor);GenericBullet.prototype.free=function(){this.m_clip&&(this.m_canvas.removeChild(this.m_clip),this.m_clip.free(),this.m_clip=null);this.m_motionLimit=null;SimpleWorldActor.prototype.free.call(this)};
GenericBullet.prototype.gotoPosition=function(a,b,c){c="undefined"!==typeof c?c:this.m_bulletSpeed;this.m_endX=a;this.m_endY=b;this.settingMotionLimit(this.m_x,this.m_y,this.m_endX-this.m_x,this.m_endY-this.m_y);a=Math.atan2(this.m_endY-this.m_y,this.m_endX-this.m_x);this.hasDirection&&(this.m_clip.rotation=this.offRot+a);this.m_vx=SMath.fastCos(a)*c;this.m_vy=SMath.fastSin(a)*c};
GenericBullet.prototype.settingMotionLimit=function(a,b,c,d){0!==c?(this.m_motionLimit.x=0<=c?a:a+c,this.m_motionLimit.w=0<=c?c:-c):(this.m_motionLimit.w=100,this.m_motionLimit.x=a-.5*this.m_motionLimit.w);0!==d?(this.m_motionLimit.y=0<=d?b:b+d,this.m_motionLimit.h=0<=d?d:-d):(this.m_motionLimit.h=100,this.m_motionLimit.y=b-.5*this.m_motionLimit.h)};
GenericBullet.prototype.checkCollision=function(){if(this.m_clip&&this.m_clip.getCollision("mcCollision")){var a=this.m_owner.opponent;if(a&&a.checkActorHit(this,"mcCollision"))this.onPlayerCollision()}};
GenericBullet.prototype.onPlayerCollision=function(){this.m_deletePending=!0;var a=Math.sign(this.m_vx);a=this.m_owner.opponent.getX()+a*this.m_owner.wData.repositionDist*.4;var b=Math.max(ChallManager.instance.superDamage(),this.damage());this.m_owner.opponent.onPushback(a,void 0,this.fullPower,b);this.m_owner.opponent.playHitSound(!0);a=(this.m_owner.opponent.getX()+this.m_x)/2;0===this.m_owner.opponent.getHP()?(this.world().createEffect("aniFxHit4",a,this.m_y),ChallManager.instance.onSpecialFinish()):
this.world().createEffect("aniFxHit2",a,this.m_y);this.m_owner.comboCounter.count();this.m_owner.id()===this.m_fWorld.player1().id()&&this.fullPower&&Global.aiMode!==AICore.MODE_NONE&&TrophyManager.instance.trophyObtained(TrophyManager.ID_FULL_SPECIAL);this.fullPower?this.m_fWorld.hitEffects(700,0,0!==this.m_owner.opponent.getHP()):this.m_fWorld.hitEffects(400);window.navigator.hasOwnProperty("vibrate")&&window.navigator.vibrate(350)};
GenericBullet.prototype.onBulletCollision=function(a){this.m_deletePending||a.m_owner.id()===this.m_owner.id()||(this.fullPower&&a.fullPower?(this.onHit(1),a.m_deletePending||(this.m_fWorld.spClashEffects(),this.world().createEffect("aniFxSpecialCrash",(this.getX()+a.getX())/2,(this.getY()+a.getY())/2),Application.instance.playSound("SND_SPECIAL_FULL_IMPACT"),window.navigator.hasOwnProperty("vibrate")&&window.navigator.vibrate(350))):this.fullPower||(this.onHit(1),Application.instance.playSound("SND_SPECIAL_HALF_IMPACT")))};
GenericBullet.prototype.onIdle=function(a){SimpleWorldActor.prototype.onIdle.call(this,a);this.setAwaitingDelete(!0)};
GenericBullet.prototype.update=function(a){if(this.m_deletePending)this.setAwaitingDelete(!0);else{SimpleWorldActor.prototype.update.call(this,a);this.m_x+=this.m_vx*a;this.m_y+=this.m_vy*a;this.checkCollision();a=this.world().actorManager().actors();for(var b=0;b<a.length;b++)if(this.hitTestWithActorByBounds(a[b]))if(a[b]instanceof Statue)a[b].onHit(this.damage()),this.m_deletePending=!0;else if(a[b]instanceof GenericBullet)this.onBulletCollision(a[b]);(this.m_x<this.m_fWorld.limitLeft-200||this.m_x>
this.m_fWorld.limitRight+200)&&this.setAwaitingDelete(!0)}};GenericBullet.prototype.getSpeed=function(){return new Vector2D(this.m_vx,this.m_vy)};GenericBullet.prototype.onHit=function(a){this.world().createEffect("aniFxBulletDisappear",this.getX(),this.getY());return this.m_deletePending=!0};
function FighterActor(a,b,c,d,e,f,g){SimpleWorldActor.call(this,c,b,d,e);this.data=DataHero.getData(f);this.wData=b.fData;this.gravity=this.data.gravity;this.maxVy=this.data.maxVy;this.jumpImpulse=this.data.jumpImpulse;this.djumpImpulse=this.data.djumpImpulse;this.gravFactor=this.data.gravFactor;this.backFriction=this.data.backFriction;this.backSpeed=this.data.backSpeed;this.diveSpeed=this.data.diveSpeed;this.diveAngle=this.data.diveAngle;this.diveYOffset=this.data.diveYOffset;this.diveBar=this.data.diveBar;
this.maxHp=this.data.maxHp;this.chargeTime=this.wData.spChargeTime;this.dmgMultiplier=1;this.bulletData=DataBullet.getBulletData(this.data.bulletId,g);this.m_id=a;this.m_fWorld=b;this.m_metaState=FighterActor.ST_NORMAL;this.m_currHp=this.maxHp;this.m_vy=this.m_vx=this.m_currMp=0;this.m_numJumps=FighterActor.MAX_JUMPS;this.m_bounceCount=0;this.m_onFloor=this.m_faceRight=!0;this.m_shieldPowerup=this.m_invulnerable=this.m_disabled=!1;this.m_defeatBounces=FighterActor.NUM_DEFEAT_BOUNCES;this.m_recovTaps=
this.wData.iniNumTaps;this.m_actionTimer=this.m_koTimes=0;this.m_stunPending=!1;this.m_chargeTimer=this.m_specialLevel=this.m_stunTimer=0;this.opponent=null;this.meanLookEnabled=!0;this.m_pendingAnimState="";this.m_keepOldState=!0;this.m_pendingAnimLoop=!1;this.m_pendingPunchDir=1;this.perfectRound=this.m_canAirAttack=!0;this.m_inputComp=new InputComponent(this);this.m_voHandler=new VOHandler(this.data.id,Application.config.settings.VO_FREQUENCY_MIN,Application.config.settings.VO_FREQUENCY_MAX);this.m_shadow=
Application.instance.getAnimation("ani_shadow");this.m_smoothieFx={canvas:null,fx:null};this.m_smoothieFx.canvas=new SDisplayObjectContainer;c.addChildAt(this.m_smoothieFx.canvas,0);this.world().objectCanvas().addChild(this.m_shadow);this.m_skin=this.data.skin[g];this.m_damage=this.data.damage;this.setRangeControlled(!1);this.m_character=new Character(d,e,c);this.initStates();this.setScale(this.wData.scale);this.comboCounter=new ComboCounter(this.m_x);this.m_blockedActions={};this.blockAllKeys(!1)}
Application.subclass(FighterActor,SimpleWorldActor);FighterActor.NUM_DEFEAT_BOUNCES=2;FighterActor.MAX_JUMPS=2;FighterActor.BOUNCE_FACTOR=.3;FighterActor.CHAIN_DELAY=75;FighterActor.ACTION_DELAY=80;FighterActor.MAX_MP=100;FighterActor.MIN_DIVE_HEIGHT=180;FighterActor.RECOVERY_ENABLED=!1;FighterActor.KEY_ATK=0;FighterActor.KEY_JMP=1;FighterActor.KEY_BOTH=2;FighterActor.KEY_EVD=3;FighterActor.KEY_PUNCH=4;FighterActor.ST_NORMAL="st_normal";FighterActor.ST_BDASH="st_bdash";FighterActor.ST_JUMP="st_jump";
FighterActor.ST_DIVE="st_dive";FighterActor.ST_PARRY="st_parry";FighterActor.ST_PUNCH="st_punch";FighterActor.ST_SP_CHARGE="st_sp_charge";FighterActor.ST_SPECIAL="st_sp";FighterActor.ST_PUSHED="st_push";FighterActor.ST_RECOVERY="st_recovery";FighterActor.ST_HIT_SLIDE="st_hitSlide";FighterActor.ST_STUN="st_stunned";FighterActor.ST_DOWN="st_down";FighterActor.ST_DYING="st_dying";FighterActor.ST_DEAD="st_dead";FighterActor.ANIM_ST_ATTACK="ast_attack";FighterActor.ANIM_ST_ATTACK2="ast_attack2";
FighterActor.ANIM_ST_SPECIAL="ast_special";FighterActor.ANIM_ST_SPECIAL2="ast_special2";FighterActor.ANIM_ST_SPECIAL2_IN="ast_special2_in";FighterActor.ANIM_ST_SPECIAL2_CHR="ast_special_chr";FighterActor.ANIM_ST_STAND="ast_stand";FighterActor.ANIM_ST_STAND_ANG="ast_stand_angry";FighterActor.ANIM_ST_JUMP_IN="ast_jump_in";FighterActor.ANIM_ST_JUMP="ast_jump";FighterActor.ANIM_ST_JUMP_DBL="ast_jump_dbl";FighterActor.ANIM_ST_JUMP_OUT="ast_jump_out";FighterActor.ANIM_ST_HIT="ast_hit";
FighterActor.ANIM_ST_HIT_AIR="ast_hit_air";FighterActor.ANIM_ST_BDASH="ast_bdash";FighterActor.ANIM_ST_PUNCH="ast_punch";FighterActor.ANIM_ST_FALL="ast_fall";FighterActor.ANIM_ST_FALL_IN="ast_fall_in";FighterActor.ANIM_ST_FALL_OUT="ast_fall_out";FighterActor.ANIM_ST_FALL_REC="ast_fall_rec";FighterActor.ANIM_ST_PARRY="ast_parry";FighterActor.ANIM_ST_DEFEAT="ast_defeat";FighterActor.ANIM_ST_WIN="ast_win";
FighterActor.getClass=function(a){switch(a){case DataHero.ID_PIG:return Pig;case DataHero.ID_TILLY:return Tilly;case DataHero.ID_BILL:return Bill;default:return FighterActor}};
FighterActor.prototype.initStates=function(){var a=this.getTriggerFrames();this.m_character.addState(FighterActor.ANIM_ST_ATTACK,this.m_skin+"_dive01");this.m_character.addState(FighterActor.ANIM_ST_ATTACK2,this.m_skin+"_dive02");this.m_character.addState(FighterActor.ANIM_ST_SPECIAL,this.m_skin+"_special_attack",[{frame:a[0],caller:this,callback:this.onShoot}]);this.m_character.addState(FighterActor.ANIM_ST_SPECIAL2,this.m_skin+"_special_attack_02_action",[{frame:a[1],caller:this,callback:this.onShoot}]);
this.m_character.addState(FighterActor.ANIM_ST_SPECIAL2_IN,this.m_skin+"_special_attack_02_in");this.m_character.addState(FighterActor.ANIM_ST_SPECIAL2_CHR,this.m_skin+"_special_attack_02_charge");this.m_character.addState(FighterActor.ANIM_ST_STAND,this.m_skin+"_stand");this.m_character.addState(FighterActor.ANIM_ST_STAND_ANG,this.m_skin+"_stand_02");this.m_character.addState(FighterActor.ANIM_ST_JUMP_IN,this.m_skin+"_jump_up");this.m_character.addState(FighterActor.ANIM_ST_JUMP,this.m_skin+"_jump");
this.m_character.addState(FighterActor.ANIM_ST_JUMP_DBL,this.m_skin+"_double_jump");this.m_character.addState(FighterActor.ANIM_ST_JUMP_OUT,this.m_skin+"_jump_down");this.m_character.addState(FighterActor.ANIM_ST_PARRY,this.m_skin+"_parry");this.m_character.addState(FighterActor.ANIM_ST_BDASH,this.m_skin+"_backdash");this.m_character.addState(FighterActor.ANIM_ST_PUNCH,this.m_skin+"_punch",[{frame:a[2],caller:this,callback:this.onPunch}]);this.m_character.addState(FighterActor.ANIM_ST_HIT_AIR,this.m_skin+
"_hit_air");this.m_character.addState(FighterActor.ANIM_ST_HIT,this.m_skin+"_hit");this.m_character.addState(FighterActor.ANIM_ST_FALL_IN,this.m_skin+"_onground");this.m_character.addState(FighterActor.ANIM_ST_FALL,this.m_skin+"_onground_stand");this.m_character.addState(FighterActor.ANIM_ST_FALL_OUT,this.m_skin+"_onground_up",[{frame:1,caller:this,callback:this.wakeupShake}]);this.m_character.addState(FighterActor.ANIM_ST_FALL_REC,this.m_skin+"_onground_recovering");this.m_character.addState(FighterActor.ANIM_ST_DEFEAT,
this.m_skin+"_defeat");this.m_character.addState(FighterActor.ANIM_ST_WIN,this.m_skin+"_win");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(FighterActor.ANIM_ST_STAND);this.createStandBounds()};FighterActor.prototype.getTriggerFrames=function(){switch(this.data.id){case DataHero.ID_CRICKET:return[7,4,3];case DataHero.ID_CHICKEN:return[10,4,3];case DataHero.ID_REMY:return[7,4,3];case DataHero.ID_GRAMMA:return[7,7,3];default:return[6,4,3]}};
FighterActor.prototype.rebindData=function(a,b){this.data=DataHero.getData(a);this.gravity=this.data.gravity;this.maxVy=this.data.maxVy;this.jumpImpulse=this.data.jumpImpulse;this.djumpImpulse=this.data.djumpImpulse;this.gravFactor=this.data.gravFactor;this.backFriction=this.data.backFriction;this.backSpeed=this.data.backSpeed;this.diveSpeed=this.data.diveSpeed;this.diveAngle=this.data.diveAngle;this.diveYOffset=this.data.diveYOffset;this.diveBar=this.data.diveBar;this.maxHp=this.data.maxHp;this.chargeTime=
this.wData.spChargeTime;this.setSkin(b)};
FighterActor.prototype.gotoState=function(a,b){if(this.state()!==FighterActor.ANIM_ST_DEFEAT)switch(SimpleWorldActor.prototype.gotoState.call(this,a,b),a){case FighterActor.ANIM_ST_STAND:case FighterActor.ANIM_ST_JUMP_OUT:this.m_metaState!==FighterActor.ST_STUN&&this.m_metaState!==FighterActor.ST_DYING&&(this.m_metaState=FighterActor.ST_NORMAL);break;case FighterActor.ANIM_ST_JUMP:case FighterActor.ANIM_ST_JUMP_DBL:this.m_metaState=FighterActor.ST_JUMP;break;case FighterActor.ANIM_ST_ATTACK:case FighterActor.ANIM_ST_ATTACK2:this.m_metaState=
FighterActor.ST_DIVE;break;case FighterActor.ANIM_ST_PARRY:this.m_metaState=FighterActor.ST_PARRY}};FighterActor.prototype.forceState=function(a,b){this.m_state="";this.gotoState(a,b)};FighterActor.prototype.gotoStateDelayed=function(a,b,c){this.m_pendingAnimState=a;this.m_pendingAnimLoop="undefined"===typeof b?!0:b;this.m_keepOldState="undefined"===typeof c?!0:c};
FighterActor.prototype.onEndAnimation=function(a){switch(a){case FighterActor.ANIM_ST_JUMP_IN:this.m_onFloor=!1;this.gotoState(FighterActor.ANIM_ST_JUMP,!0);this.m_vy=-this.jumpImpulse;this.m_numJumps<=FighterActor.MAX_JUMPS-1&&this.world().createEffect("aniFxDoubleJump",this.m_x,this.m_y);this.m_numJumps--;break;case FighterActor.ANIM_ST_FALL_IN:this.gotoState(FighterActor.ANIM_ST_FALL);break;case FighterActor.ANIM_ST_JUMP_OUT:case FighterActor.ANIM_ST_FALL_OUT:this.gotoState(FighterActor.ANIM_ST_STAND);
break;case FighterActor.ANIM_ST_HIT:this.m_metaState!==FighterActor.ST_HIT_SLIDE&&(this.gotoState(FighterActor.ANIM_ST_STAND),this.m_invulnerable=!1);break;case FighterActor.ANIM_ST_SPECIAL2_IN:this.gotoState(FighterActor.ANIM_ST_SPECIAL2_CHR);this.m_metaState=FighterActor.ST_SP_CHARGE;this.m_chargeTimer=this.chargeTime;break;case FighterActor.ANIM_ST_SPECIAL:case FighterActor.ANIM_ST_SPECIAL2:this.setEnabled(!0);case FighterActor.ANIM_ST_PARRY:this.m_onFloor?this.gotoState(FighterActor.ANIM_ST_STAND):
this.gotoState(FighterActor.ANIM_ST_JUMP);this.m_invulnerable=!1;break;case FighterActor.ANIM_ST_STAND_ANG:this.meanLookEnabled||this.gotoState(FighterActor.ANIM_ST_STAND,!0)}};
FighterActor.prototype.onJump=function(){return this.isDefeated()||this.m_metaState===FighterActor.ST_BDASH?!1:this.m_onFloor||this.m_metaState===FighterActor.ST_JUMP&&0<this.m_numJumps?(this.m_vx=0,this.m_onFloor?Application.instance.playSound("SND_JUMP"):Application.instance.playSound("SND_DOUBLE_JUMP"),ChallManager.instance.playerJump(this),this.gotoState(FighterActor.ANIM_ST_JUMP_IN,!1),this.m_actionTimer=200,this.m_voHandler.playGameplayVO(VOHandler.VO_TYPE_JUMP),!0):!1};
FighterActor.prototype.onBackJump=function(){return this.m_onFloor&&this.m_metaState===FighterActor.ST_NORMAL?(this.gotoState(FighterActor.ANIM_ST_BDASH,!1),this.m_vx=-this.backSpeed*this.dirSign(),this.m_metaState=FighterActor.ST_BDASH,Application.instance.playSound("SND_PLY_BACKDASH"),this.m_voHandler.playGameplayVO(VOHandler.VO_TYPE_BDASH),!0):!1};
FighterActor.prototype.onPunchStart=function(){return this.m_onFloor&&this.m_metaState===FighterActor.ST_NORMAL?(this.gotoState(FighterActor.ANIM_ST_PUNCH,!1),this.m_pendingPunchDir=this.dirSign(),this.m_voHandler.playGameplayVO(VOHandler.VO_TYPE_TACKLE),!0):!1};FighterActor.prototype.onPunch=function(){this.m_onFloor&&this.m_metaState===FighterActor.ST_NORMAL&&(this.m_vx=this.backSpeed*this.m_pendingPunchDir,this.m_metaState=FighterActor.ST_PUNCH,this.playDiveSound())};
FighterActor.prototype.onDive=function(){if(this.canDive()){this.m_canAirAttack=!1;var a=this.diveAngle*Math.PI/180;this.m_vx=SMath.fastCos(a)*this.diveSpeed*this.dirSign();this.m_vy=SMath.fastSin(a)*this.diveSpeed;if(.5>Math.random()){this.gotoState(FighterActor.ANIM_ST_ATTACK);var b=0}else b=1,this.gotoState(FighterActor.ANIM_ST_ATTACK2);this.clip().rotation=this.m_faceRight?a:-a;this.addMP(this.diveBar);this.playDiveSound();this.m_voHandler.playGameplayVO(VOHandler.VO_TYPE_DIVE,!1,b);return!0}return!1};
FighterActor.prototype.forceDive=function(a,b){this.m_vx=a;this.m_vy=b;a=Math.atan2(a,b);this.gotoState(FighterActor.ANIM_ST_ATTACK);this.clip().rotation=a};
FighterActor.prototype.onSuper=function(){if(this.canAct(FighterActor.KEY_BOTH)){this.setEnabled(!1);this.m_vx=this.m_vy=0;this.m_metaState=FighterActor.ST_SPECIAL;this.m_specialLevel=Math.floor(this.m_currMp/(FighterActor.MAX_MP/2))-1;this.addMP(-(this.m_specialLevel+1)*FighterActor.MAX_MP/2);if(0===this.m_specialLevel)this.gotoState(FighterActor.ANIM_ST_SPECIAL,!1),Application.instance.playSound("SND_SPECIAL"),this.m_voHandler.playGameplayVO(VOHandler.VO_TYPE_TACKLE,!0);else{var a=this.getChargeFxPos();
this.gotoState(FighterActor.ANIM_ST_SPECIAL2_IN,!1);Application.instance.playSound("SND_ALT_SPECIAL");this.m_voHandler.playGameplayVO(VOHandler.VO_TYPE_SP,!0);this.world().createEffect("aniFxChargeFinalizer1",a.x,a.y)}this.isOnFloor()||(this.m_canAirAttack=!1);return!0}return!1};
FighterActor.prototype.onShoot=function(){var a=this.bulletData.clone(),b=this.getBulletPos();a.damage=a.damageArray[this.m_specialLevel]*this.dmgMultiplier;0<this.m_specialLevel&&(a.skin+="_02");a=new GenericBullet(this.world().objectCanvas(),this.m_fWorld,this,b.x,b.y,a);a.setScale(this.wData.scale);a.fullPower=this.m_specialLevel===this.bulletData.damageArray.length-1;this.world().actorManager().add(a);a.gotoPosition(b.x+1E3*this.dirSign(),b.y);a.clip().scale.x*=this.dirSign();this.m_onFloor?this.m_metaState=
FighterActor.ST_NORMAL:(this.m_vx=-.2*this.dirSign(),this.m_vy=.2*-this.jumpImpulse,this.m_metaState=FighterActor.ST_JUMP)};FighterActor.prototype.getBulletPos=function(){var a=new Vector2D(this.getX(),this.getY()-50);if(this.clip().getInstance("bullet")){var b=this.clip().getInstance("bullet");a.x+=b.x*this.dirSign();a.y+=b.y+50}return a};FighterActor.prototype.getChargeFxPos=function(){return new Vector2D(this.getX(),this.getY()-this.diveYOffset)};
FighterActor.prototype.onParry=function(){this.m_onFloor&&this.m_metaState===FighterActor.ST_NORMAL&&this.gotoState(FighterActor.ANIM_ST_PARRY,!1)};
FighterActor.prototype.onFightHit=function(a,b,c){b="undefined"===typeof b?new Vector2D(a.m_vx,a.m_vy):b;c="undefined"===typeof c?this.opponent.damage():c;c=this.m_shieldPowerup?0:c;if(this.isDefeated()||this.m_state===FighterActor.ANIM_ST_HIT)return!1;this.addHP(-c);this.createHitEffect(this.opponent);if(0>=this.m_currHp)this.gotoState(FighterActor.ANIM_ST_DEFEAT,!1),this.m_metaState=FighterActor.ST_DYING,this.m_vx=1.6*b.x,this.m_vy=1.6*b.y;else switch(this.m_invulnerable=!0,this.m_metaState){case FighterActor.ST_PARRY:this.addHP(c);
break;case FighterActor.ST_DOWN:this.gotoState(FighterActor.ANIM_ST_HIT,!1);this.m_metaState=FighterActor.ST_NORMAL;this.m_actionTimer=400;this.m_inputComp.instantMode=!1;break;default:this.m_onFloor?(this.gotoState(FighterActor.ANIM_ST_HIT,!1),this.setEnabled(!0),this.m_metaState=FighterActor.ST_HIT_SLIDE,this.setFaceRight(0>b.x),this.m_vx=Math.sign(b.x)*this.wData.backSlideSpeed):(this.gotoStateDelayed(FighterActor.ANIM_ST_HIT_AIR,!1),this.m_metaState=FighterActor.ST_DOWN,this.m_vx=1.6*b.x,this.m_vy=
1.6*b.y),this.m_recovTaps=this.getNumTaps(),this.m_koTimes++}return!0};
FighterActor.prototype.onFightHit2=function(a,b){if(this.isDefeated()||this.m_state===FighterActor.ANIM_ST_HIT||this.m_invulnerable)return!1;if(this.m_onFloor){var c=new Vector2D(Math.sign(a-this.m_x),0);if(0<=b){this.perfectRound=!1;this.opponent.updateComboCount();this.comboCounter.reset();if(this.opponent.isOnFloor())this.onFightHit(this.opponent,c,b);else this.onPushback(a,void 0,!1,b),this.createHitEffect(this.opponent);this.playHitSound()}else this.m_metaState===FighterActor.ST_PUNCH&&(this.m_vx=
.7*-Math.sqrt(2*this.backFriction/1E3*Math.abs(this.getX()-a))*this.dirSign(),this.m_metaState=FighterActor.ST_HIT_SLIDE)}else this.onPushback(a,void 0,!1,b),0<=b&&(this.perfectRound=!1,this.opponent.updateComboCount(),this.comboCounter.reset(),this.playHitSound(),this.createHitEffect(this.opponent))};FighterActor.prototype.updateComboCount=function(){this.comboCounter.count();2<=this.comboCounter.combo&&this.addMP(Application.config.challValues.comboHitBonusSP||0)};
FighterActor.prototype.onLandHit=function(a,b){b=b||0;var c=-Math.sign(this.m_vx);switch(a){case FighterActor.ST_PARRY:this.onPushback(this.getX()+this.wData.repositionDist*c,void 0,!1,this.damage());break;case FighterActor.ST_DOWN:this.onPushback(this.getX()+this.wData.repositionDist*c);break;default:this.onPushback(this.getX()+b*c)}};
FighterActor.prototype.onPushback=function(a,b,c,d,e){c="undefined"===typeof c||this.m_shieldPowerup?!1:c;d="undefined"===typeof d||this.m_shieldPowerup?-1:d;this.m_canAirAttack=0>d;this.perfectRound=this.perfectRound&&0>=d;this.m_actionTimer=300+this.m_bounceCount*FighterActor.CHAIN_DELAY;this.m_bounceCount+=0>d?1:0;Global.fightSettings.bonusStage&&(this.m_actionTimer+=200);0<=d&&this.addHP(-d);0>=this.m_currHp?(this.gotoState(FighterActor.ANIM_ST_DEFEAT,!1),this.m_metaState=FighterActor.ST_DYING,
this.m_smoothieFx&&this.m_smoothieFx.fx&&(this.m_smoothieFx.fx.setAwaitingDelete(!0),this.m_smoothieFx.fx=null)):(0<=d?(this.gotoStateDelayed(FighterActor.ANIM_ST_HIT_AIR,!1),this.m_invulnerable=!0,this.m_fWorld.actionManager.addCallback(this,function(){this.m_invulnerable=!1},500)):this.gotoStateDelayed(FighterActor.ANIM_ST_JUMP,!1),this.setEnabled(!0),this.m_metaState=FighterActor.ST_PUSHED,this.m_onFloor=!1,this.m_stunPending=c);this.calculatePushSpeed(a-this.getX(),e)};
FighterActor.prototype.calculatePushSpeed=function(a,b){b="undefined"===typeof b?this.wData.repositionSpeed:b;var c=this.wData.globalGravity/1E3;this.m_vy=-b;b=-this.m_vy/c;var d=this.m_vy*b/2;d=this.m_fWorld.getFloorY()-(this.getY()+d);this.m_vx=a/(Math.sqrt(2*d/c)+b)};
FighterActor.prototype.onCollisionWithModElement=function(a){if(!this.m_invulnerable&&this.m_metaState!==FighterActor.ST_DYING)switch(a.type){case ModifierElement.TYPE_RACCOON:this.activateShield();break;case ModifierElement.TYPE_ROBOT_HP:this.addHP(-a.damage());break;case ModifierElement.TYPE_PIDGEON:var b=this.m_faceRight?-1:1;this.onPushback(this.getX()+150*b,0,!1,a.damage(),1.5);this.playHitSound();this.m_fWorld.hitEffects(200);break;case ModifierElement.TYPE_FARM_ANIMAL:b=Math.sign(a.speed().x);
var c=ChallManager.instance.getModDamage();this.onPushback(this.getX()+150*b,0,!1,Math.max(a.damage(),c),1.5);this.m_fWorld.hitEffects(200);this.playHitSound();break;case ModifierElement.TYPE_COFFEE_CUP:this.boostJumpAndDive(a.boostJump,a.boostDive,a.boostDash);break;case ModifierElement.TYPE_MANHOLE:a.state()===ModifierElement.ST_OPEN?this.teleportLock():(a=.5*this.m_world.width(),b=this.m_x<a?1:-1,this.onPushbackNoDamage(this.getX()+300*b,0,!1,2),this.m_fWorld.hitEffects(200))}};
FighterActor.prototype.getDisplacement=function(){var a=this.m_onFloor?Math.pow(this.m_vx,2)/(2*this.data.backFriction/1E3):(this.m_y-this.m_fWorld.getFloorY())/this.m_vy*this.m_vx;return this.wData.repositionDist-Math.abs(a)};FighterActor.prototype.hitTestWithActorByBounds=function(a,b,c){return SimpleWorldActor.prototype.hitTestWithActorByBounds.call(this,a,b,c)&&!this.m_invulnerable};
FighterActor.prototype.createHitEffect=function(a){var b=0,c=0;a instanceof FighterActor&&a.m_metaState===FighterActor.ST_DIVE&&(b=a.getDiveYOffset(),c=a.getDiveXOffset()*a.dirSign());this.m_metaState!==FighterActor.ST_DIVE&&(b-=.8*this.data.diveYOffset);c=(this.m_x+a.getX()+c)/2;a=(this.m_y+a.getY()+b)/2;0===this.getHP()?this.world().createEffect("aniFxHit3",c,a):this.world().createEffect("aniFxHit1",c,a)};
FighterActor.prototype.teleportLock=function(){this.gotoState(FighterActor.ANIM_ST_STAND);this.m_onFloor=!0;this.setY(this.m_fWorld.getFloorY());this.setEnabled(!1);this.m_invulnerable=!0;this.m_bounceCount=this.m_vy=this.m_vx=0;this.world().createEffect("ani_stickman_fx_dust",this.m_x,this.m_y);this.m_clip.visible=!1};
FighterActor.prototype.teleport=function(a){this.setX(a);this.faceOpponent();this.world().createEffect("ani_stickman_fx_dust",this.m_x,this.m_y);this.m_clip.visible=!0;a=.5*this.m_world.width();a=this.m_x<a?1:-1;this.onPushbackNoDamage(this.getX()+300*a,0,!1,2.4)};FighterActor.prototype.teleportUnlock=function(){this.setEnabled(!0);this.m_invulnerable=!1};FighterActor.prototype.keyDown=function(a){if(!this.m_disabled)this.m_inputComp.onKeyDown(a)};FighterActor.prototype.keyUp=function(a){this.m_inputComp.onKeyUp(a)};
FighterActor.prototype.rawKeyToFightKey=function(a){switch(a){case FighterInput.KEY_UP:return FighterActor.KEY_JMP;case FighterInput.KEY_DOWN:return this.isOnFloor()?-1:FighterActor.KEY_ATK;case FighterInput.KEY_BACK:return FighterActor.KEY_EVD;case FighterInput.KEY_FWD:return this.isOnFloor()?FighterActor.KEY_PUNCH:FighterActor.KEY_ATK;case FighterInput.KEY_SPEC:return FighterActor.KEY_BOTH;default:return-1}};
FighterActor.prototype.triggerKey=function(a){if(this.m_metaState===FighterActor.ST_DOWN)return this.m_recovTaps--,!0;if(0<this.m_actionTimer||0<this.m_stunTimer||this.m_blockedActions[a])return!1;switch(a){case FighterActor.KEY_ATK:a=this.attackKeyDown();break;case FighterActor.KEY_PUNCH:a=this.punchKeyDown();break;case FighterActor.KEY_JMP:a=this.jumpKeyDown();break;case FighterActor.KEY_EVD:a=this.evadeKeyDown();break;case FighterActor.KEY_BOTH:a=this.onSuper();break;default:return!1}this.m_actionTimer=
FighterActor.ACTION_DELAY;return a};FighterActor.prototype.jumpKeyDown=function(){return this.m_metaState===FighterActor.ST_NORMAL||this.m_metaState===FighterActor.ST_JUMP?this.onJump():!1};FighterActor.prototype.attackKeyDown=function(){return this.m_onFloor?!1:this.onDive()};FighterActor.prototype.punchKeyDown=function(){return this.m_onFloor?this.onPunchStart():!1};
FighterActor.prototype.evadeKeyDown=function(){return this.m_onFloor?this.m_metaState===FighterActor.ST_BDASH?!1:this.onBackJump():!1};FighterActor.prototype.blockKeys=function(a,b){for(var c=0;c<a.length;c++)"undefined"!==typeof this.m_blockedActions[c]&&(this.m_blockedActions[a[c]]=b)};
FighterActor.prototype.blockAllKeys=function(a){this.m_blockedActions[FighterActor.KEY_JMP]=a;this.m_blockedActions[FighterActor.KEY_EVD]=a;this.m_blockedActions[FighterActor.KEY_ATK]=a;this.m_blockedActions[FighterActor.KEY_BOTH]=a;this.m_blockedActions[FighterActor.KEY_PUNCH]=a};
FighterActor.prototype.floorCollision=function(){var a=this.m_y,b=this.m_fWorld.getFloorY();this.m_metaState===FighterActor.ST_DIVE&&(a=this.m_y+this.getDiveYOffset());if(a>b){if(this.m_metaState===FighterActor.ST_DYING&&0<this.m_defeatBounces)this.m_defeatBounces--,this.m_y=b,this.m_vy=-this.m_vy*FighterActor.BOUNCE_FACTOR,this.m_vx*=FighterActor.BOUNCE_FACTOR;else switch(this.m_canAirAttack=!0,this.m_bounceCount=0,this.m_onFloor=!0,this.m_numJumps=FighterActor.MAX_JUMPS,this.m_vx=this.m_vy=0,this.m_y=
b,this.m_metaState){default:this.faceOpponent();this.m_metaState===FighterActor.ST_DIVE&&(this.world().createEffect("aniFxReboundFloor",this.m_x,this.m_y),this.m_actionTimer=FighterActor.ACTION_DELAY,Application.instance.playSound("SND_HIT_FLOOR"),ChallManager.instance.onGroundDive(this));this.m_stunPending?(this.enterDownState(),this.m_stunPending=!1,this.m_metaState=FighterActor.ST_DOWN):this.gotoState(FighterActor.ANIM_ST_JUMP_OUT);this.m_invulnerable=!1;this.setEnabled(!0);break;case FighterActor.ST_DOWN:this.enterDownState();
break;case FighterActor.ST_DYING:this.m_metaState=FighterActor.ST_DEAD}return!0}return!1};FighterActor.prototype.enterDownState=function(){this.gotoState(FighterActor.ANIM_ST_FALL_IN,!1);this.m_inputComp.instantMode=!0;this.m_recovTaps=this.getNumTaps();this.m_invulnerable=!1};FighterActor.prototype.faceOpponent=function(){this.setFaceRight(this.m_x<this.opponent.getX())};
FighterActor.prototype.updateCharacter=function(a){var b=0;if(this.m_world.camera()){var c=this.m_world.camera().getX();b=this.m_world.camera().getY()}null!==this.m_character&&(this.m_character.setPosition(this.m_x-c,this.m_y-b),this.m_character.update(a))};
FighterActor.prototype.updateShadow=function(){if(this.m_shadow){var a=this.data.shadowScale;this.m_shadow.setPosition(this.m_character.getX(),this.m_fWorld.getFloorY()-this.world().camera().getY());a=AIState.linear(a,.1*a,20,1300,this.m_fWorld.getFloorY()-this.getY());this.m_shadow.scale.x=a}this.m_smoothieFx.fx&&(1!=Global.fighterCameraScale&&this.m_smoothieFx.fx.isPaused()&&this.m_smoothieFx.fx.setPaused(!1),this.m_smoothieFx.fx.x=this.m_character.getX(),this.m_smoothieFx.fx.y=this.m_character.getY()-
this.diveYOffset)};FighterActor.prototype.showInCamera=function(){SimpleWorldActor.prototype.showInCamera.call(this);this.m_character&&this.updateShadow()};
FighterActor.prototype.update=function(a){this.updateDelayedState();this.updateCharacter(a);this.m_voHandler.update(a);this.m_inputComp.update(a);this.m_y+=this.m_vy*a;this.m_x+=this.m_vx*a;this.floorCollision();0<this.m_actionTimer&&(this.m_actionTimer-=a);this.comboCounter&&this.comboCounter.update(a);switch(this.m_metaState){case FighterActor.ST_DYING:this.m_vy+=this.wData.globalGravity*a/1E3;this.checkWallBounce();break;case FighterActor.ST_DEAD:case FighterActor.ST_PARRY:case FighterActor.ST_RECOVERY:case FighterActor.ST_SPECIAL:break;
case FighterActor.ST_DOWN:0>=this.m_recovTaps&&(this.gotoState(FighterActor.ANIM_ST_FALL_OUT),this.m_metaState=FighterActor.ST_RECOVERY,Application.instance.playSound("SND_ALT_SPECIAL"),this.m_inputComp.instantMode=!1);break;case FighterActor.ST_PUSHED:this.m_vy+=this.wData.globalGravity*a/1E3;this.m_vy=Math.min(this.m_vy,this.maxVy);this.checkWallBounce();break;case FighterActor.ST_STUN:this.m_stunTimer-=a;0>=this.m_stunTimer&&(this.m_metaState=FighterActor.ST_NORMAL,this.gotoState(FighterActor.ANIM_ST_FALL_OUT));
break;case FighterActor.ST_SP_CHARGE:0<this.m_chargeTimer&&(this.m_chargeTimer-=a,0>=this.m_chargeTimer&&(this.gotoState(FighterActor.ANIM_ST_SPECIAL2),this.m_fWorld.specialAttackFx(400,new Vector2D(this.getX(),this.m_fWorld.getFloorY()-200))));break;case FighterActor.ST_PUNCH:var b=Math.sign(this.m_vx);this.m_vx+=-b*this.backFriction*a/1E3;Math.abs(this.m_vx)<=.2*this.backSpeed&&(this.finishSlide(),this.faceOpponent());break;case FighterActor.ST_HIT_SLIDE:case FighterActor.ST_BDASH:b=Math.sign(this.m_vx);
this.m_vx+=-b*this.backFriction*a/1E3;Math.sign(this.m_vx)!==b&&this.finishSlide();break;case FighterActor.ST_DIVE:this.m_vy+=this.gravity*this.gravFactor*a/1E3;this.m_vy=Math.min(this.m_vy,this.maxVy);break;default:this.m_onFloor?this.m_state!==FighterActor.ANIM_ST_PUNCH&&this.faceOpponent():(this.m_vy+=this.gravity*a/1E3,this.m_vy=Math.min(this.m_vy,this.maxVy))}};
FighterActor.prototype.updateDelayedState=function(){if(""!==this.m_pendingAnimState){var a=this.m_metaState;this.gotoState(this.m_pendingAnimState,this.m_pendingAnimLoop);this.m_keepOldState&&(this.m_metaState=a);this.m_pendingAnimState="";this.m_pendingAnimLoop=!0}};
FighterActor.prototype.finishSlide=function(){this.m_vx=0;this.m_metaState===FighterActor.ST_HIT_SLIDE&&FighterActor.RECOVERY_ENABLED?(this.enterDownState(),this.m_metaState=FighterActor.ST_DOWN):this.m_metaState===FighterActor.ST_PUNCH?this.gotoStateDelayed(FighterActor.ANIM_ST_STAND,!0,!1):this.gotoState(FighterActor.ANIM_ST_STAND);this.m_invulnerable=!1};
FighterActor.prototype.checkWallBounce=function(){var a=this.getMainCollision(),b=[this.world().limitLeft,this.world().limitRight],c=this.getX()-a.w/2-(b[0]+10);b=b[1]-10-(this.getX()+a.w/2);var d=Math.min(c,b);if(0>=b||0>=c)this.m_x+=d*Math.sign(this.m_vx),this.m_vx*=-.8,c=0<this.m_vx?this.m_world.limitRight<this.m_world.initLimitRight?"fx_water_01":"aniFxReboundWallLeft":this.m_world.limitRight<this.m_world.initLimitRight?"fx_water_01":"aniFxReboundWallRight",this.world().createEffect(c,this.m_x,
this.m_y-a.h/2)};FighterActor.prototype.wakeupShake=function(){this.m_metaState===FighterActor.ST_DOWN&&this.m_fWorld.hitEffects(150)};FighterActor.prototype.dirSign=function(){return this.m_faceRight?1:-1};FighterActor.prototype.getNumTaps=function(){return Math.min(this.wData.iniNumTaps+this.wData.tapIncRatio*this.m_koTimes,this.wData.maxNumTaps)};FighterActor.prototype.id=function(){return this.m_id};FighterActor.prototype.inputComponent=function(){return this.m_inputComp};
FighterActor.prototype.speed=function(){return new Vector2D(this.m_vx,this.m_vy)};FighterActor.prototype.setInvulnerable=function(a){this.m_invulnerable=a};FighterActor.prototype.setInvencibility=function(a){this.m_shieldPowerup=a};FighterActor.prototype.getDiveSpeed=function(){var a=this.diveAngle*Math.PI/180,b=SMath.fastCos(a)*this.diveSpeed*this.dirSign();a=SMath.fastSin(a)*this.diveSpeed;return new Vector2D(b,a)};FighterActor.prototype.setFaceRight=function(a){this.m_faceRight=a;this.setFlipX(!a)};
FighterActor.prototype.setEnabled=function(a){this.m_fWorld.fightStopped()&&a||(this.m_disabled=!a)};FighterActor.prototype.addHP=function(a,b){this.m_currHp=Math.max(Math.min(this.m_currHp+a,this.maxHp),0);FighterHUD.instance.setHP(this.id(),this.m_currHp/this.maxHp,b)};FighterActor.prototype.getHP=function(){return this.m_currHp};FighterActor.prototype.getHPPercent=function(){return Math.floor(this.m_currHp/this.maxHp*100)};
FighterActor.prototype.addMP=function(a,b){this.m_currMp=Math.max(Math.min(this.m_currMp+a,FighterActor.MAX_MP),0);this.m_currMp=Math.min(ChallManager.instance.getMPLimit(),this.m_currMp);FighterHUD.instance.setMP(this.id(),this.m_currMp/FighterActor.MAX_MP,b)};FighterActor.prototype.getMP=function(){return this.m_currMp};FighterActor.prototype.specialReady=function(){return this.m_currMp>=FighterActor.MAX_MP/2};FighterActor.prototype.MPIsFull=function(){return this.m_currMp===FighterActor.MAX_MP};
FighterActor.prototype.getDiveYOffset=function(){return this.diveYOffset*SMath.fastSin(this.diveAngle*Math.PI/180)};FighterActor.prototype.getDiveXOffset=function(){return this.diveYOffset*SMath.fastCos(this.diveAngle*Math.PI/180)};FighterActor.prototype.getTopY=function(){return this.m_metaState===FighterActor.ST_DIVE?this.m_y-this.getDiveYOffset():this.m_y};FighterActor.prototype.getBotY=function(){return this.m_metaState===FighterActor.ST_DIVE?this.m_y+this.getDiveYOffset():this.m_y};
FighterActor.prototype.voHandler=function(){return this.m_voHandler};FighterActor.prototype.getMState=function(){return this.m_metaState};FighterActor.prototype.setMState=function(a){this.m_metaState=a};FighterActor.prototype.setSkin=function(a){a>=this.data.skin.length||(this.m_skin=this.data.skin[a],this.bulletData=DataBullet.getBulletData(this.data.bulletId,a),this.initStates())};
FighterActor.prototype.getMainCollision=function(){return this.clip()&&this.clip().getCollision("mcCollision")?this.clip().getCollision("mcCollision"):new Rectangle(0,0,60,90)};FighterActor.prototype.forceDefeat=function(){Application.instance.playSound("SND_LAST_HIT");this.gotoState(FighterActor.ANIM_ST_DEFEAT,!1);this.m_metaState=FighterActor.ST_DYING;this.m_vx=0;this.m_vy=.5};
FighterActor.prototype.checkActorHit=function(a,b){if(a instanceof FighterActor&&this.opponent.isBeingPushed()||this.opponent.m_metaState===FighterActor.ST_DOWN||this.isDefeated()||this.m_invulnerable||this.m_metaState===FighterActor.ST_RECOVERY)return!1;var c=this.hitTestWithActorByBounds(a,"mcCollision",b);a=this.hitTestWithActorByBounds(a,"mcAttack",b);return c||a};FighterActor.prototype.isDefeated=function(){return this.m_metaState==FighterActor.ST_DYING||this.m_metaState==FighterActor.ST_DEAD};
FighterActor.prototype.isBeingPushed=function(){return this.m_metaState===FighterActor.ST_PUSHED||this.m_metaState===FighterActor.ST_HIT_SLIDE};FighterActor.prototype.isFinished=function(){return this.m_metaState===FighterActor.ST_DEAD};FighterActor.prototype.isJumping=function(){return this.m_metaState===FighterActor.ST_JUMP};FighterActor.prototype.isDown=function(){return this.m_metaState===FighterActor.ST_DOWN};
FighterActor.prototype.isAgainstWall=function(){if(this.m_faceRight){var a=this.world().limitLeft+100;return this.getX()-a<this.getMainCollision().w}a=this.world().limitRight-100;return a-this.getX()<this.getMainCollision().w};FighterActor.prototype.isOnFloor=function(){return this.m_onFloor};FighterActor.prototype.isInverted=function(){return this.m_id===this.m_fWorld.player1().id()?!this.m_faceRight:this.m_faceRight};
FighterActor.prototype.canDive=function(){return this.canAirAtack()&&(0<this.m_vy||this.m_y<this.m_fWorld.getFloorY()-FighterActor.MIN_DIVE_HEIGHT)};FighterActor.prototype.onDoubleJump=function(){return 0===this.m_numJumps};FighterActor.prototype.damage=function(){return this.m_metaState===FighterActor.ST_RECOVERY?0===this.dmgMultiplier?0:this.wData.recoveryDmg:this.m_metaState===FighterActor.ST_PUNCH?this.data.punchDmg*this.dmgMultiplier:SimpleWorldActor.prototype.damage.call(this)*this.dmgMultiplier};
FighterActor.prototype.boostJumpAndDive=function(a,b,c){this.m_smoothieFx.fx=Application.instance.effectManager.createEffect("aniFxSmoothieAura",0,0,this.m_smoothieFx.canvas,0);this.updateShadow();this.jumpImpulse*=a;this.gravity=Math.pow(this.jumpImpulse,2)*this.data.gravity/Math.pow(this.data.jumpImpulse,2);this.djumpImpulse*=a;this.diveSpeed*=b;this.backSpeed*=c;this.backFriction=Math.pow(this.backSpeed,2)*this.data.backFriction/Math.pow(this.data.backSpeed,2)};
FighterActor.prototype.resetJumpAndDive=function(){this.m_smoothieFx&&this.m_smoothieFx.fx&&(this.m_smoothieFx.fx.setAwaitingDelete(!0),this.m_smoothieFx.fx=null);this.gravity=this.data.gravity;this.djumpImpulse=this.data.djumpImpulse;this.jumpImpulse=this.data.jumpImpulse;this.diveSpeed=this.data.diveSpeed;this.backSpeed=this.data.backSpeed;this.backFriction=this.data.backFriction};
FighterActor.prototype.activateShield=function(){this.m_smoothieFx.fx=Application.instance.effectManager.createEffect("aniFxInvencibilityAura",0,0,this.m_smoothieFx.canvas,0);this.updateShadow();this.m_shieldPowerup=!0};FighterActor.prototype.deactivateShield=function(){this.m_smoothieFx.fx.setAwaitingDelete(!0);this.m_shieldPowerup=!1};
FighterActor.prototype.playHitSound=function(a){0>=this.m_currHp?Application.instance.playSound("SND_LAST_HIT"):a?Application.instance.playSound("SND_SPECIAL_HIT"):Application.instance.playSound("SND_REGULAR_HIT"+Common.randomInt(1,2));this.m_voHandler.playGameplayVO(VOHandler.VO_TYPE_HURT)};FighterActor.prototype.playDiveSound=function(){switch(this.data.diveSound){case 0:Application.instance.playSound("SND_AIR_ATTACK_HIGH");break;case 1:Application.instance.playSound("SND_AIR_ATTACK");break;case 2:Application.instance.playSound("SND_AIR_ATTACK_LOW")}};
FighterActor.prototype.playTaunt=function(){this.m_voHandler.playGameplayVO(VOHandler.VO_TYPE_TAUNT,!0)};FighterActor.prototype.win=function(){this.m_voHandler.playGameplayVO(VOHandler.VO_TYPE_WIN,!0);this.isDefeated()||this.gotoState(FighterActor.ANIM_ST_WIN,!1)};FighterActor.prototype.isStopped=function(){return this.isDefeated()||this.state()===FighterActor.ANIM_ST_WIN?this.clip().m_stopped:this.isOnFloor()&&0===this.speed().x};
FighterActor.prototype.free=function(){this.m_shadow&&(this.m_fWorld.objectCanvas().removeChild(this.m_shadow),this.m_shadow.free(),this.m_shadow=null);this.comboCounter&&(this.comboCounter.free(),this.comboCounter=null);this.canvas().removeChild(this.m_smoothieFx.canvas);this.m_smoothieFx.canvas.free();this.opponent=this.m_fWorld=null;SimpleWorldActor.prototype.free.call(this)};
FighterActor.prototype.canAct=function(a){var b="undefined"===typeof a;if(0<this.m_actionTimer||this.m_disabled||this.isDefeated()||this.m_metaState===FighterActor.ST_DIVE||this.m_blockedActions[a||0])return!1;if(b)return!0;switch(a){case FighterActor.KEY_ATK:return this.canDive();case FighterActor.KEY_PUNCH:return this.m_onFloor&&this.m_metaState===FighterActor.ST_NORMAL;case FighterActor.KEY_EVD:return this.m_onFloor?this.m_metaState===FighterActor.ST_NORMAL:!1;case FighterActor.KEY_JMP:return this.m_onFloor?
this.m_metaState===FighterActor.ST_NORMAL:0<this.m_numJumps;case FighterActor.KEY_BOTH:return this.specialReady()&&(this.m_metaState===FighterActor.ST_NORMAL||this.canAirAtack());default:return!1}};FighterActor.prototype.canAirAtack=function(){return!this.isOnFloor()&&0>=this.m_actionTimer&&this.m_canAirAttack};
FighterActor.prototype.onPushbackNoDamage=function(a,b,c,d){c="undefined"===typeof c?!1:c;this.m_canAirAttack=this.m_invulnerable=!0;this.m_numJumps=0;this.m_fWorld.actionManager.addCallback(this,function(){this.m_invulnerable=!1},500);this.m_metaState=FighterActor.ST_PUSHED;this.m_onFloor=!1;this.m_stunPending=c;this.gotoState(FighterActor.ANIM_ST_JUMP);this.calculatePushSpeed(a-this.getX(),d)};
FighterActor.prototype.switchCanvas=function(a){this.canvas().removeChild(this.clip());this.m_canvas=a;this.m_character.canvas=a;this.m_canvas.addChild(this.clip())};function Pig(a,b,c,d,e,f,g){FighterActor.call(this,a,b,c,d,e,f,g);this.chargeTime*=1.75}Application.subclass(Pig,FighterActor);Pig.prototype.getChargeFxPos=function(){var a=FighterActor.prototype.getChargeFxPos.call(this);a.x+=40*this.dirSign();return a};
function Tilly(a,b,c,d,e,f,g){FighterActor.call(this,a,b,c,d,e,f,g);this.m_miceFx=null}Application.subclass(Tilly,FighterActor);Tilly.prototype.onEndAnimation=function(a){FighterActor.prototype.onEndAnimation.call(this,a);switch(a){case FighterActor.ANIM_ST_WIN:this.gotoState(FighterActor.ANIM_ST_STAND),this.m_miceFx=this.world().createEffect("ani_player_tilly_win_mouse",this.getX(),this.getY(),0),this.m_miceFx.clip.scale.x=this.clip().scale.x,this.m_miceFx.clip.scale.y=this.clip().scale.y}};
Tilly.prototype.free=function(){this.m_miceFx&&(this.m_miceFx.setAwaitingDelete(!0),this.m_miceFx=null);FighterActor.prototype.free.call(this)};function Bill(a,b,c,d,e,f,g){FighterActor.call(this,a,b,c,d,e,f,g)}Application.subclass(Bill,FighterActor);Bill.prototype.initStates=function(){this.rebindAnimations();this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(FighterActor.ANIM_ST_STAND);this.createStandBounds()};
Bill.prototype.rebindAnimations=function(){if(this.m_character){var a=this.getTriggerFrames(),b=this.m_faceRight?"_R":"_L";this.m_character.addState(FighterActor.ANIM_ST_ATTACK,this.m_skin+"_dive01"+b);this.m_character.addState(FighterActor.ANIM_ST_ATTACK2,this.m_skin+"_dive02"+b);this.m_character.addState(FighterActor.ANIM_ST_SPECIAL,this.m_skin+"_special_attack"+b,[{frame:a[0],caller:this,callback:this.onShoot}]);this.m_character.addState(FighterActor.ANIM_ST_SPECIAL2,this.m_skin+"_special_attack_02_action"+
b,[{frame:a[1],caller:this,callback:this.onShoot}]);this.m_character.addState(FighterActor.ANIM_ST_SPECIAL2_IN,this.m_skin+"_special_attack_02_in"+b);this.m_character.addState(FighterActor.ANIM_ST_SPECIAL2_CHR,this.m_skin+"_special_attack_02_charge"+b);this.m_character.addState(FighterActor.ANIM_ST_STAND,this.m_skin+"_stand"+b);this.m_character.addState(FighterActor.ANIM_ST_STAND_ANG,this.m_skin+"_stand_02"+b);this.m_character.addState(FighterActor.ANIM_ST_JUMP_IN,this.m_skin+"_jump_up"+b);this.m_character.addState(FighterActor.ANIM_ST_JUMP,
this.m_skin+"_jump"+b);this.m_character.addState(FighterActor.ANIM_ST_JUMP_DBL,this.m_skin+"_double_jump"+b);this.m_character.addState(FighterActor.ANIM_ST_JUMP_OUT,this.m_skin+"_jump_down"+b);this.m_character.addState(FighterActor.ANIM_ST_PARRY,this.m_skin+"_parry"+b);this.m_character.addState(FighterActor.ANIM_ST_BDASH,this.m_skin+"_backdash"+b);this.m_character.addState(FighterActor.ANIM_ST_PUNCH,this.m_skin+"_punch"+b,[{frame:a[2],caller:this,callback:this.onPunch}]);this.m_character.addState(FighterActor.ANIM_ST_HIT_AIR,
this.m_skin+"_hit_air"+b);this.m_character.addState(FighterActor.ANIM_ST_HIT,this.m_skin+"_hit"+b);this.m_character.addState(FighterActor.ANIM_ST_FALL_IN,this.m_skin+"_onground"+b);this.m_character.addState(FighterActor.ANIM_ST_FALL,this.m_skin+"_onground_stand"+b);this.m_character.addState(FighterActor.ANIM_ST_FALL_OUT,this.m_skin+"_onground_up"+b,[{frame:1,caller:this,callback:this.wakeupShake}]);this.m_character.addState(FighterActor.ANIM_ST_FALL_REC,this.m_skin+"_onground_recovering"+b);this.m_character.addState(FighterActor.ANIM_ST_DEFEAT,
this.m_skin+"_defeat"+b);this.m_character.addState(FighterActor.ANIM_ST_WIN,this.m_skin+"_win"+b)}};Bill.prototype.setFaceRight=function(a){this.m_faceRight!==a&&(this.m_faceRight=a,this.rebindAnimations(),a=this.clip().currentFrame,this.forceState(this.m_state,!0),this.clip().gotoAndPlay(a))};Bill.prototype.getBulletPos=function(){var a=new Vector2D(this.getX(),this.getY()-50);if(this.clip().getInstance("bullet")){var b=this.clip().getInstance("bullet");a.x+=b.x;a.y+=b.y+50}return a};
function Statue(a,b,c,d){SimpleWorldActor.call(this,a,b,c,d);this.m_skin="Scn_obj_statue";this.m_fWorld=b;this.m_stateNum=0;this.m_currHp=this.m_maxHp=Application.config.modifiers.statueHealth;this.m_animArray=[];this.m_animArray[0]=[Statue.AST_STAND1,Statue.AST_STAND2,Statue.AST_STAND3,Statue.AST_STAND4,Statue.AST_STAND5];this.m_animArray[1]=[Statue.AST_HIT1,Statue.AST_HIT2,Statue.AST_HIT3,Statue.AST_HIT4];this.m_animArray[2]=[Statue.AST_HIT1_OUT,Statue.AST_HIT2_OUT,Statue.AST_HIT3_OUT,Statue.AST_HIT4_OUT];
this.initStates()}Application.subclass(Statue,SimpleWorldActor);Statue.AST_STAND1="ast_stand1";Statue.AST_HIT1="ast_hit1";Statue.AST_HIT1_OUT="ast_hit1_out";Statue.AST_STAND2="ast_stand2";Statue.AST_HIT2="ast_hit2";Statue.AST_HIT2_OUT="ast_hit2_out";Statue.AST_STAND3="ast_stand3";Statue.AST_HIT3="ast_hit3";Statue.AST_HIT3_OUT="ast_hit3_out";Statue.AST_STAND4="ast_stand4";Statue.AST_HIT4="ast_hit4";Statue.AST_HIT4_OUT="ast_hit4_out";Statue.AST_STAND5="ast_stand5";Statue.ST_ID_STAND=0;
Statue.ST_ID_HIT=1;Statue.ST_ID_HITOUT=2;Statue.NUM_STATES=4;
Statue.prototype.initStates=function(){this.m_character=new Character(this.m_x,this.m_y,this.canvas());this.m_character.addState(Statue.AST_STAND1,this.skin()+"_stand");this.m_character.addState(Statue.AST_HIT1,this.skin()+"_hit");this.m_character.addState(Statue.AST_HIT1_OUT,this.skin()+"_hit2");this.m_character.addState(Statue.AST_STAND2,this.skin()+"_state_01_stand");this.m_character.addState(Statue.AST_HIT2,this.skin()+"_state_01_hit");this.m_character.addState(Statue.AST_HIT2_OUT,this.skin()+
"_state_01_hit2");this.m_character.addState(Statue.AST_STAND3,this.skin()+"_state_02_stand");this.m_character.addState(Statue.AST_HIT3,this.skin()+"_state_02_hit");this.m_character.addState(Statue.AST_HIT3_OUT,this.skin()+"_state_02_hit2");this.m_character.addState(Statue.AST_STAND4,this.skin()+"_state_03_stand");this.m_character.addState(Statue.AST_HIT4,this.skin()+"_state_03_hit");this.m_character.addState(Statue.AST_HIT4_OUT,this.skin()+"_state_04_final");this.m_character.addState(Statue.AST_STAND5,
this.skin()+"_state_04_stand");this.gotoAnimState(Statue.ST_ID_STAND);this.m_character.onEndAnimation(this,this.onEndAnimation)};Statue.prototype.gotoAnimState=function(a){this.gotoState(this.m_animArray[a][this.m_stateNum])};Statue.prototype.onEndAnimation=function(a){switch(a){case Statue.AST_HIT1:case Statue.AST_HIT2:case Statue.AST_HIT3:case Statue.AST_HIT4:case Statue.AST_HIT1_OUT:case Statue.AST_HIT2_OUT:case Statue.AST_HIT3_OUT:this.gotoAnimState(Statue.ST_ID_STAND);break;case Statue.AST_HIT4_OUT:this.gotoAnimState(Statue.ST_ID_STAND)}};
Statue.prototype.onHit=function(a){this.m_fWorld.fightStopped()&&(a=0);var b=this.getStateNumber(),c=this.m_fWorld.player1();this.m_currHp=Math.max(this.m_currHp-a,0);a=this.getStateNumber();FighterGame.instance.onShake(12,25,250);if(0!==this.m_currHp){var d=c.getY()-c.getMainCollision().h/2;c=(c.getX()+2*this.getX())/3;this.world().createEffect("aniFxHit1",c,d);this.world().createEffect("aniFxHitStatue",this.getX(),this.getY())}b!==a?(this.gotoAnimState(Statue.ST_ID_HITOUT),this.m_stateNum=a,Application.instance.playSound("SND_ROCK_CRACK")):
(this.gotoAnimState(Statue.ST_ID_HIT),Application.instance.playSound("SND_ROCK_HIT"));0===this.m_currHp&&(this.m_fWorld.player1().perfectRound=!0,FighterGame.instance.killPlayer(1),this.m_fWorld.player2().clip().visible=!1,Application.instance.playSound("SND_ROCK_DESTROY"),TrophyManager.instance.unlockChara(DataHero.ID_PIG));return!0};
Statue.prototype.update=function(a){SimpleWorldActor.prototype.update.call(this,a);a=this.m_fWorld.player1();this.hitTestWithActorByBounds(a,"mcCollision","mcAttack")&&(this.onHit(a.damage()),a.onPushback(this.m_x-250))};Statue.prototype.getStateNumber=function(){return~~((this.m_maxHp-this.m_currHp)/(this.m_maxHp/Statue.NUM_STATES))};Statue.prototype.isDead=function(){return 0==this.m_currHp};
function SpriteActor(a,b,c,d,e,f,g,h){this.m_canvas=a;this.m_world=b;this.m_clip=null;this.m_x=c;this.m_y=d;this.m_parallaxXFactor=e;this.m_parallaxYFactor=f;this.m_xOffset=g;this.m_yOffset=h;this.m_alwaysVisible=this.m_isIdle=!1;this.m_quadtreeRect=null;this.m_isAwaitingDelete=!1}SpriteActor.prototype.isIdle=function(){return this.m_isIdle};SpriteActor.prototype.onIdle=function(a){this.m_isIdle=a;null!==this.m_clip&&(this.m_clip.visible=!a)};SpriteActor.prototype.getX=function(){return this.m_x};
SpriteActor.prototype.getY=function(){return this.m_y};SpriteActor.prototype.isAlwaysVisible=function(){return this.m_alwaysVisible};SpriteActor.prototype.setAlwaysVisible=function(a){this.m_alwaysVisible=a};SpriteActor.prototype.getQuadtreeRect=function(){return this.m_quadtreeRect};SpriteActor.prototype.setQuadtreeRect=function(a){this.m_quadtreeRect=a};SpriteActor.prototype.isAwaitingDelete=function(){return this.m_isAwaitingDelete};
SpriteActor.prototype.setAwaitingDelete=function(a){this.m_isAwaitingDelete=a};SpriteActor.prototype.free=function(){null!==this.m_clip&&(this.m_clip.free(),this.m_canvas.removeChild(this.m_clip),this.m_clip=null);this.m_quadtreeRect=this.m_world=this.m_canvas=null};
SpriteActor.prototype.update=function(a){this.m_clip&&(this.m_clip.position.x=this.m_x-(~~(this.m_world.camera().getX()*this.m_parallaxXFactor)-this.m_xOffset),this.m_clip.position.y=this.m_y-(~~(this.m_world.camera().getY()*this.m_parallaxYFactor)-this.m_yOffset),this.m_clip.update&&this.m_clip.update(a))};
function Camera(a,b,c,d,e,f,g){this.m_x="undefined"!==typeof f?f:0;this.m_y="undefined"!==typeof g?g:0;this.m_width=b;this.m_height=c;this.m_maxY=this.m_maxX=this.m_minY=this.m_minX=0;this.screenX="undefined"!==typeof d?d:0;this.screenY="undefined"!==typeof e?e:0;this.m_followOffsetX=0;this.m_followOffsetY=Application.config.camera.cameraOffsetY;Global.comingFromSandbox&&(this.m_followOffsetY=Application.sandbox.startSettings.cameraOffsetY);this.m_lockState=Camera.LOCK_OFF;this.parallaxY=this.parallaxX=
!0;this.isCameraFree=!1;this.m_followTarget=null;this.m_world=a;this.unscaleLimits=this.areaPlayers=null;this.limitMinFollowY=(2-(Application.config.camera.maxVerticalSpace?Application.config.camera.maxVerticalSpace:1.5))*Application.APP_HEIGHT;this.resetMinMax();this.mov=this.posToGo=this.prePosToGo=null;this.zoomSpeed=this.duration=this.movSpeed=0;this.isZoomUpdated=this.isMoveUpdated=!1}Camera.prototype.free=function(){this.unscaleLimits=this.m_world=this.m_followTarget=null};Camera.LOCK_OFF=0;
Camera.FOLLOW_TARGET=1;Camera.ZOOM_ACTIVE=2;Camera.MOV_TO_POS=3;Camera.ZOOM_IN=4;Camera.ZOOM_STAY=5;Camera.ZOOM_OUT=6;Camera.prototype.setUnscaleLimits=function(){this.unscaleLimits||(this.unscaleLimits=[],this.unscaleLimits[0]=this.m_x,this.unscaleLimits[1]=this.m_x+this.m_width)};Camera.prototype.followOffsetX=function(){return this.m_followOffsetX};Camera.prototype.followOffsetY=function(){return this.m_followOffsetY};
Camera.prototype.resetMinMax=function(){this.m_minX=.5*this.m_world.width()-.8*Application.APP_WIDTH;this.m_minY=0;this.m_maxX=.5*this.m_world.width()+.8*Application.APP_WIDTH-this.m_width;this.m_maxY=this.m_world.height()-this.m_height};Camera.prototype.setMinX=function(a){this.m_minX=a};Camera.prototype.setMinY=function(a){this.m_minY=a};Camera.prototype.setMaxX=function(a){this.m_maxX=a};Camera.prototype.setMaxY=function(a){this.m_maxY=a};
Camera.prototype.doFollowTarget=function(){this.m_lockState!==Camera.FOLLOW_TARGET&&(this.m_lockState=Camera.FOLLOW_TARGET)};
Camera.prototype.update=function(a){switch(this.m_lockState){case Camera.LOCK_OFF:this.checkLimitsY();break;case Camera.FOLLOW_TARGET:this.updateFollowTargetPosition(a);this.m_y=this.m_followTarget.y-.5*this.m_height+this.m_followOffsetY;this.m_y<=this.limitMinFollowY&&(this.m_y=this.limitMinFollowY);this.checkLimitsY();break;case Camera.ZOOM_IN:this.isZoomUpdated||(Global.fighterCameraScale+=this.zoomSpeed*a,Global.fighterCameraScale>=Global.maxScale&&(Global.fighterCameraScale=Global.maxScale,this.isZoomUpdated=
!0),GuiGame.instance.adjustCamera(Global.fighterCameraScale),this.m_x=this.posToGo.x-.5*this.m_width,this.m_y=this.posToGo.y-.5*this.m_height);!this.isMoveUpdated&&this.mov&&(this.m_x=this.mov.getX()-.5*this.m_width,this.m_y=this.mov.getY()-.5*this.m_height,this.mov.update(a),this.mov||(this.isMoveUpdated=!0));this.isZoomUpdated&&this.isMoveUpdated&&(this.m_lockState=Camera.ZOOM_STAY);break;case Camera.ZOOM_STAY:this.m_x=this.posToGo.x-.5*this.m_width;this.m_y=this.posToGo.y-.5*this.m_height;break;
case Camera.ZOOM_OUT:this.isZoomUpdated||(Global.fighterCameraScale-=this.zoomSpeed*a,Global.fighterCameraScale<=Global.baseScale&&(Global.fighterCameraScale=Global.baseScale,this.isZoomUpdated=!0),GuiGame.instance.adjustCamera(Global.fighterCameraScale),this.m_x=this.posToGo.x-.5*this.m_width,this.m_y=this.posToGo.y-.5*this.m_height),!this.isMoveUpdated&&this.mov&&(this.m_x=this.mov.getX()-.5*this.m_width,this.m_y=this.mov.getY()-.5*this.m_height,this.mov.update(a),this.mov||(this.isMoveUpdated=
!0)),this.isZoomUpdated&&this.isMoveUpdated&&(this.m_lockState=Camera.FOLLOW_TARGET,this.m_x=GuiGame.instance.canvasGame.position.x+.5*this.m_world.width()+Layout.left/Layout.scale-.5*this.m_width)}GuiGame.instance.canvasEffects.position.x=-this.m_x*Global.fighterCameraScale;GuiGame.instance.canvasEffects.position.y=-this.m_y*Global.fighterCameraScale;Application.WIDE_SCREEN&&(GuiGame.instance.canvasEffects.position.x-=Layout.left/Layout.scale,GuiGame.instance.canvasEffects.position.y-=Layout.top/
Layout.scale)};Camera.prototype.checkLimitsX=function(){this.m_x<this.m_minX?this.m_x=this.m_minX:this.m_x>this.m_maxX&&(this.m_x=this.m_maxX)};Camera.prototype.checkLimitsY=function(){this.m_y<this.m_minY?this.m_y=this.m_minY:this.m_y>this.m_maxY&&(this.m_y=this.m_maxY)};Camera.prototype.lockState=function(){return this.m_lockState};Camera.prototype.getX=function(){return this.m_x};Camera.prototype.getY=function(){return this.m_y};Camera.prototype.setX=function(a){this.m_x=a};
Camera.prototype.setY=function(a){this.m_y=a};Camera.prototype.width=function(){return this.m_width};Camera.prototype.height=function(){return this.m_height};Camera.prototype.setWidth=function(a){this.m_width=a};Camera.prototype.setHeight=function(a){this.m_height=a};
Camera.prototype.onDebugDraw=function(a){ContextGraphics.drawRectangle(a,0,0,Global.fighterCameraScale*this.m_width/Layout.scale,Global.fighterCameraScale*this.m_height/Layout.scale,4,Common.COLOR_RED,Common.COLOR_NONE);this.areaPlayers&&ContextGraphics.drawRectangle(a,Global.fighterCameraScale*(this.areaPlayers.x-this.m_x)/Layout.scale,Global.fighterCameraScale*(this.areaPlayers.y-this.m_y)/Layout.scale,Global.fighterCameraScale*this.areaPlayers.w/Layout.scale,Global.fighterCameraScale*this.areaPlayers.h/
Layout.scale,4,Common.COLOR_BLUE,Common.COLOR_NONE)};
Camera.prototype.getFollowTargetArea=function(){var a=this.m_world.getPlayersRef();if(a&&a[0]&&a[1]){var b=a[0],c=a[1],d=0,e=0;a=b.standBounds().clone();d=a.w+20;e=a.h+20;a.x=b.getX()-.5*d;a.y=b.getY()-e;a.w=d;a.h=e;b=c.standBounds().clone();d=b.w+20;e=b.h+20;b.x=c.getX()-.5*d;b.y=c.getY()-e;b.w=d;b.h=e;c=[a.x,a.x+a.w,b.x,b.x+b.w];a=[a.y,a.y+a.h,b.y,b.y+b.h];c.sort(function(a,b){return a-b});a.sort(function(a,b){return a-b});return new Rectangle(c[0],a[0],c[3]-c[0],a[3]-a[0])}};
Camera.prototype.updateFollowTargetPosition=function(a){this.areaPlayers=this.getFollowTargetArea();this.m_followTarget||(this.m_followTarget={});this.m_followTarget.x=this.areaPlayers.x+.5*this.areaPlayers.w;this.m_followTarget.y=this.areaPlayers.y+.5*this.areaPlayers.h};
Camera.prototype.doInOutZoom=function(a,b,c,d){this.m_lockState===Camera.FOLLOW_TARGET&&(this.prePosToGo||(this.prePosToGo=new Vector2D),this.prePosToGo.x=this.m_x+.5*this.m_width,this.prePosToGo.y=this.m_y+.5*this.m_height,this.posToGo||(this.posToGo=new Vector2D),this.posToGo.x=a,this.posToGo.x-.5*this.m_width<this.m_minX?this.posToGo.x=this.m_minX+.5*this.m_width:this.posToGo.x-.5*this.m_width>this.m_maxX&&(this.posToGo.x=this.m_maxX+.5*this.m_width),this.posToGo.y=this.m_y+.5*this.m_height,a=
this.posToGo.distanceTo(this.m_x+.5*this.m_width,this.m_y+.5*this.m_height),this.duration=.6*c,this.movSpeed=a/(.2*c),this.mov&&this.mov.free(),this.mov=new LinearMovement(this.m_x+.5*this.m_width,this.m_y+.5*this.m_height,this.movSpeed),this.mov.extraData={},this.mov.extraData.id="GO",this.mov.setCallbacks(this,this.onEndMov,null),this.mov.gotoPosition(this.posToGo.x,this.posToGo.y),Global.maxScale=d,this.zoomSpeed=Math.abs(Global.maxScale-Global.baseScale)/(.2*c),this.isMoveUpdated=this.isZoomUpdated=
!1,this.m_lockState=Camera.ZOOM_IN)};Camera.prototype.onEndMov=function(a){this.mov&&this.mov.free();this.mov=null};Camera.prototype.zoomCenterFighters=function(a,b){a=a?GuiGame.instance.zoomScaleNormalHit:GuiGame.instance.zoomScaleFinalHit;1>=a||(this.updateFollowTargetPosition(0),this.doInOutZoom(this.m_followTarget.x,this.m_followTarget.y,b,a))};
Camera.prototype.forceZoomOut=function(){this.m_lockState===Camera.ZOOM_STAY&&(this.m_lockState=Camera.ZOOM_OUT,this.mov&&this.mov.free(),this.mov=new LinearMovement(this.m_x+.5*this.m_width,this.m_y+.5*this.m_height,this.movSpeed),this.mov.extraData={},this.mov.extraData.id="COMEBACK",this.mov.gotoPosition(this.prePosToGo.x,this.m_y+.5*this.m_height),this.mov.setCallbacks(this,this.onEndMov,null),this.isMoveUpdated=this.isZoomUpdated=!1)};
function CollisionPoint(a,b,c,d){this.position=new Vector2D(a,b);this.normal=new Vector2D(c,d)}CollisionPoint.prototype.free=function(){this.normal=this.position=null};CollisionPoint.prototype.toString=function(){return"\n[COLL] "+this.position+" "+this.normal};function Npc(){this.y=this.x=this.id=0;this.canvas=null;this.params="";this.rawData=null;this.movement="";this.alwaysAwake=!1;this.rotation=0}Npc.prototype.free=function(){this.rawData=this.canvas=null};
function NpcManager(a){this.m_height=this.m_width=0;this.m_showCollisions=!1;this.m_world=a;this.m_buffer=[];this.m_actors=[];this.m_bullets=[];this.m_freeze=!1}NpcManager.prototype.free=function(){var a;for(a=this.m_buffer.length-1;0<=a;a--)this.m_buffer.splice(a,1)[0].free();for(a=this.m_actors.length-1;0<=a;a--)this.m_actors.splice(a,1)[0].free();for(a=this.m_bullets.length-1;0<=a;a--)this.m_bullets.splice(a,1)[0].free();this.m_bullets=this.m_world=this.m_actors=this.m_buffer=null};
NpcManager.OBJ_TUTO=1;NpcManager.prototype.init=function(){for(var a=this.m_buffer.length-1;0<=a;a--)this.m_buffer.splice(a,1)};NpcManager.prototype.showCollision=function(a){this.m_showCollisions=a};NpcManager.prototype.addNpc=function(a){this.m_buffer.push(a)};NpcManager.prototype.add=function(a){SimpleWorldActor.prototype.update.call(a,0);this.m_actors.push(a)};NpcManager.prototype.saveData=function(a){for(a=this.m_actors.length-1;0<=a;a--)this.m_actors[a]&&this.m_actors[a].saveData()};
NpcManager.prototype.checkArray=function(a){a.className()};NpcManager.prototype.fixGameScale=function(){};
NpcManager.prototype.update=function(a){var b;for(b=0;b<this.m_actors.length;b++)this.m_actors[b].isAwaitingDelete()?(this.checkArray(this.m_actors[b]),this.m_actors[b].free(),this.m_actors[b]=null,this.m_actors.splice(b--,1)):this.m_freeze||NpcManager.doActorUpdate(this.m_actors[b],a);for(b=0;b<this.m_bullets.length;b++)this.m_bullets[b].isAwaitingDelete()?(this.m_bullets[b].free(),this.m_bullets[b]=null,this.m_bullets.splice(b--,1)):this.m_freeze||NpcManager.doActorUpdate(this.m_bullets[b],a);for(b=
0;b<this.m_actors.length;b++)this.m_actors[b].showInCamera()};NpcManager.prototype.showInCamera=function(){for(var a=0;a<this.m_actors.length;a++)this.m_actors[a].showInCamera()};NpcManager.doActorUpdate=function(a,b){if(!a.isInCamera(150)){if(a.isRangeControlled()&&!a.isIdle())a.onIdle(!0)}else if(a.isIdle())a.onIdle(!1);a.isIdle()?a.movementUpdate(b):a.update(b)};NpcManager.prototype.onDebugDraw=function(a){};NpcManager.prototype.actors=function(){return this.m_actors};
NpcManager.prototype.freezeActors=function(a){this.m_freeze=a};NpcManager.prototype.actorsFrozen=function(){return this.m_freeze};
function World(a,b){this.limitRight=this.limitLeft=this.initLimitRight=this.initLimitLeft=0;this.m_showCollisions=!1;this.m_rangeTilesBelow=this.m_height=this.m_width=this.m_cameraXMin=this.m_cameraXMax=this.m_cameraYMin=this.m_cameraYMax=this.m_cameraScreenY=this.m_cameraScreenX=this.m_cameraHeight=this.m_cameraWidth=0;this.m_game=b;this.m_layers=[];this.m_objectsCanvas=[];this.m_layerNames={};this.m_mapWords=this.m_worldData=this.m_actorManager=this.m_camera=this.m_collisions=null;this.canvas=a;
this.fg=this.bg=this.fgCanvas=this.bgCanvas=null;this.bgOffY=this.bgOffX=0;this.initBackground()}World.MAX_SCAN_FLOOR=750;
World.prototype.free=function(){this.m_game=null;null!==this.m_actorManager&&(this.m_actorManager.free(),this.m_actorManager=null);for(var a=this.m_objectsCanvas.length-1;0<=a;a--)this.m_objectsCanvas[a].free(),this.m_objectsCanvas[a]=null;null!==this.m_camera&&(this.m_camera.free(),this.m_camera=null);for(a=0;a<this.m_layers.length;a++)this.m_layers[a].free(),this.m_layers[a]=null;this.m_mapWords=this.m_worldData=this.m_layers=this.m_layerNames=this.m_collisions=this.m_objectsCanvas=null;if(this.bg&&
0<this.bg.length)for(a=0;a<this.bg.length;a++)this.bgCanvas.removeChild(this.bg[a]),this.bg[a].free(),this.bg[a]=null;this.bg=null;if(this.fg&&0<this.fg.length)for(a=0;a<this.fg.length;a++)this.fgCanvas.removeChild(this.fg[a]),this.fg[a].free(),this.fg[a]=null;this.fg=null;this.bgCanvas&&(this.canvas.removeChild(this.bgCanvas),this.bgCanvas.free(),this.bgCanvas=null);this.fgCanvas&&(this.canvas.removeChild(this.fgCanvas),this.fgCanvas.free(),this.fgCanvas=null);this.canvas=null};
World.prototype.initBackground=function(){};World.prototype.initForeground=function(){};
World.prototype.updateBackground=function(a){var b;if(this.bgCanvas){if(this.bg&&0<this.bg.length)for(b=0;b<this.bg.length;b++)this.bg[b].update(a);this.bgCanvas.position.x=-this.m_camera.getX()+this.bgOffX;this.bgCanvas.position.y=-this.m_camera.getY()+this.bgOffY;Application.WIDE_SCREEN&&(this.bgCanvas.position.x+=Layout.left/Layout.scale,this.bgCanvas.position.y+=Layout.top/Layout.scale)}if(this.fgCanvas){if(this.fg&&0<this.fg.length)for(b=0;b<this.fg.length;b++)this.fg[b].update(a);this.fgCanvas.position.x=
-this.m_camera.getX()+this.bgOffX;this.fgCanvas.position.y=-this.m_camera.getY()+this.bgOffY;Application.WIDE_SCREEN&&(this.fgCanvas.position.x+=Layout.left/Layout.scale,this.fgCanvas.position.y+=Layout.top/Layout.scale)}};
World.prototype.loadData=function(a){this.m_worldData=window[a];this.m_mapWords=this.m_worldData.mapWords;a=this.m_worldData.properties;this.m_width=Common.getData(a,"width",this.m_width);this.m_height=Common.getData(a,"height",this.m_height);this.m_showCollisions=!1;Application.instance.isMobileDevice&&(this.m_showCollisions=!1);0>=this.m_cameraWidth&&(this.m_cameraWidth=Application.APP_WIDTH);0>=this.m_cameraHeight&&(this.m_cameraHeight=Application.APP_HEIGHT);this.m_cameraScreenX=Common.getData(a,
"cameraScreenX",this.m_cameraScreenX);this.m_cameraScreenY=Common.getData(a,"cameraScreenY",this.m_cameraScreenY);this.m_cameraYMax=Common.getData(a,"cameraYMax",this.m_cameraYMax);this.m_cameraYMin=Common.getData(a,"cameraYMin",this.m_cameraYMin);this.m_cameraXMax=Common.getData(a,"cameraXMax",this.m_cameraXMax);this.m_cameraXMin=Common.getData(a,"cameraXMin",this.m_cameraXMin);this.createCamera();this.createNpcManagers();this.createLayers();this.limitLeft=.5*this.m_width-.65*Application.APP_WIDTH+
this.m_collisions.tileWidth();this.limitRight=.5*this.m_width+.65*Application.APP_WIDTH-this.m_collisions.tileWidth();this.initLimitLeft=this.limitLeft;this.initLimitRight=this.limitRight};World.prototype.changeLimits=function(a,b){a?this.limitLeft=b:this.limitRight=b};World.prototype.setInitialLimits=function(a){a?this.limitLeft=this.initLimitLeft:this.limitRight=this.initLimitRight};
World.prototype.createCamera=function(){null!==this.m_camera&&this.m_camera.free();this.m_camera=new Camera(this,this.m_cameraWidth,this.m_cameraHeight,this.m_cameraScreenX,this.m_cameraScreenY)};World.prototype.createNpcManagers=function(){};World.prototype.addNpc=function(a,b){var c=new Npc;c.id=Common.getData(a,"id",c.id);c.x=Common.getData(a,"x",c.x);c.y=Common.getData(a,"y",c.y);c.canvas=b;c.params=Common.getData(a,"params",c.params);c.rawData=a;this.m_actorManager.addNpc(c)};
World.prototype.createLayers=function(){if(0<this.m_layers.length)Application.error("World::createLayers() - The layers have already been created.");else{for(var a=this.m_worldData.layerTypes,b=0;b<a.length;b++)this.addLayer(a[b].type,a[b]);this.m_worldData=null}};
World.prototype.addLayer=function(a,b){if(a===WorldBaseLayer.ID_OBJECTS){a=Application.instance.addDisplayContainer();var c=Application.instance.addDisplayContainer(),d=Application.instance.addDisplayContainer();this.canvas.addChild(c);this.canvas.addChild(a);this.canvas.addChild(d);b=b.object;for(var e=0;e<b.length;e++){for(var f={},g=0;g<b[e].length;g+=2)0<=b[e][g]?f[this.m_mapWords[b[e][g]]]=b[e][g+1]:f[this.m_mapWords[-b[e][g]]]=this.m_mapWords[b[e][g+1]];this.addNpc(f,a)}this.m_objectsCanvas.push(c);
this.m_objectsCanvas.push(a);this.m_objectsCanvas.push(d)}else a===WorldBaseLayer.ID_COLLISIONS&&(this.m_collisions=new WorldCollisionLayer(this,b),this.m_layerNames[this.m_collisions.name()]=this.m_collisions,this.m_layers.push(this.m_collisions),this.m_rangeTilesBelow=2*this.m_collisions.tileHeight())};World.prototype.createEffect=function(a,b,c,d){return Application.instance.effectManager.createEffect(a,b,c,GuiGame.instance.canvasEffects,d)};
World.prototype.init=function(){this.setX(this.m_camera.screenX);this.setY(this.m_camera.screenY);for(var a=0;a<this.m_layers.length;a++)this.m_layers[a].init();this.initForeground()};World.prototype.getTileBelow=function(a,b){if(null!==this.m_collisions)return this.m_collisions.getTileBelow(a,b,this.m_rangeTilesBelow);Application.error("getTileBelow: no collisions");return WorldCollisionLayer.CELL_EMPTY};
World.prototype.getFloorCollision=function(a,b){if(null!==this.m_collisions)return this.m_collisions.getFloorCollision(a,b);Application.error("getFloorCollision: no collisions");return new Vector2D(a,b)};World.prototype.getMaxRightLeftRange=function(a,b,c){if(null!==this.m_collisions)return"undefined"===typeof c&&(c=World.MAX_SCAN_FLOOR),this.m_collisions.getMaxRightLeftRange(a,b,c);Application.error("getMaxRightLeftRange: no collisions");return new Rectangle(a,b)};
World.prototype.getMaxFloorRange=function(a,b,c){if(null!==this.m_collisions)return"undefined"===typeof c&&(c=World.MAX_SCAN_FLOOR),this.m_collisions.getMaxFloorRange(a,b,c);Application.error("getMaxFloorRange: no collisions");return new Rectangle(a,b)};
World.prototype.getMaxFloorRangeElevations=function(a,b,c){if(null!==this.m_collisions)return"undefined"===typeof c&&(c=World.MAX_SCAN_FLOOR),this.m_collisions.getMaxFloorRangeElevations(a,b,c);Application.error("getMaxFloorRangeElevations: no collisions");return new Rectangle(a,b)};World.prototype.getRayCollision=function(a,b,c,d){if(null!==this.m_collisions)return this.m_collisions.getRayCollision(a,b,c,d);Application.error("getRayCollision: no collisions");return null};
World.prototype.showCollision=function(a){this.m_collisions.setVisible(a)};World.prototype.refreshCollision=function(){this.m_collisions.refresh()};World.prototype.setCollisionCell=function(a,b,c){this.m_collisions.setCell(a,b,c)};World.prototype.collisions=function(){return this.m_collisions};World.prototype.getCollisionCell=function(a,b){return this.m_collisions.getCell(a,b)};World.prototype.getTilePosition=function(a,b){return this.m_collisions.getTilePosition(a,b)};
World.prototype.setRangeCollisionCell=function(a,b,c,d,e,f){for(;a<=c;a++)for(var g=b;g<=d;g++)this.setCollisionCell(a,g,e);f&&this.refreshCollision()};World.prototype.getCellInPosition=function(a,b){return this.m_collisions.getCellInPosition(a,b)};World.prototype.game=function(){return this.m_game};World.prototype.setX=function(a){for(var b=0;b<this.m_layers.length;b++)this.m_layers[b].setX(a)};World.prototype.setY=function(a){for(var b=0;b<this.m_layers.length;b++)this.m_layers[b].setY(a)};
World.prototype.objectCanvas=function(){return this.m_objectsCanvas[0]};World.prototype.playerCanvas=function(){return this.m_objectsCanvas[this.m_objectsCanvas.length-2]};World.prototype.objectFrontCanvas=function(){return this.m_objectsCanvas[this.m_objectsCanvas.length-1]};World.prototype.camera=function(){return this.m_camera};World.prototype.width=function(){return this.m_width};World.prototype.height=function(){return this.m_height};World.prototype.tileWidth=function(){return this.m_collisions.tileWidth()};
World.prototype.tileHeight=function(){return this.m_collisions.tileHeight()};World.prototype.cameraHeight=function(){return this.m_cameraHeight};World.prototype.cameraWidth=function(){return this.m_cameraWidth};World.prototype.cameraXMin=function(){return this.m_cameraXMin};World.prototype.cameraXMax=function(){return this.m_cameraXMax};World.prototype.cameraYMin=function(){return this.m_cameraYMin};World.prototype.cameraYMax=function(){return this.m_cameraYMax};World.prototype.showCollisions=function(){return this.m_showCollisions};
World.prototype.columns=function(){return this.m_collisions.columns()};World.prototype.rows=function(){return this.m_collisions.rows()};World.prototype.actorManager=function(){return this.m_actorManager};World.prototype.layers=function(){return this.m_layers};World.prototype.getLayer=function(a){return this.m_layerNames[a]};
World.prototype.update=function(a){this.m_actorManager.update(a);this.checkCameraBoundaries();this.m_camera.update(a);this.updateBackground(a);for(var b=0;b<this.m_layers.length;b++)this.m_layers[b].visible()&&this.m_layers[b].render(a);this.m_actorManager.showInCamera()};World.prototype.onDebugDraw=function(a){this.m_actorManager.onDebugDraw(a);this.m_camera.onDebugDraw(a)};
World.prototype.scaleWorld=function(){Application.WIDE_SCREEN?0!==Layout.left?(this.m_camera.setWidth(Math.floor((this.m_cameraWidth+2*Layout.left/Layout.scale)/Global.baseScale)),this.m_camera.setHeight(Math.floor(this.m_cameraHeight/Global.baseScale))):0!==Layout.top?(this.m_camera.setWidth(Math.floor(this.m_cameraWidth/Global.baseScale)),this.m_camera.setHeight(Math.floor((this.m_cameraHeight+2*Layout.top/Layout.scale)/Global.baseScale))):(this.m_camera.setWidth(Math.floor(this.m_cameraWidth/Global.baseScale)),
this.m_camera.setHeight(Math.floor(this.m_cameraHeight/Global.baseScale))):(this.m_camera.setWidth(Math.floor(this.m_cameraWidth/Global.baseScale)),this.m_camera.setHeight(Math.floor(this.m_cameraHeight/Global.baseScale)));null!==this.m_actorManager&&this.m_actorManager.fixGameScale()};
World.prototype.checkWorldBoundaries=function(a){if(this.m_camera.lockState()===Camera.FOLLOW_TARGET){var b=a.standBounds().clone(),c=b.w+20,d=b.h+20;b.x=a.getX()-.5*c;b.y=a.getY()-d;b.w=c;b.h=d;null!==b&&(b.x<this.limitLeft&&a.setX(this.limitLeft+.5*b.w),b.x+b.w>this.limitRight&&a.setX(this.limitRight-.5*b.w),0>=b.y&&a.setY(b.h),b.y+b.h>=this.m_height&&a.setY(this.m_height-b.h))}};
World.prototype.checkCameraBoundaries=function(){if(this.m_camera.lockState()===Camera.FOLLOW_TARGET){var a=this.getPlayersRef();if(a&&a[0]&&a[1])for(var b=this.m_camera.unscaleLimits[0],c=this.m_camera.unscaleLimits[1],d=0;d<a.length;d++){var e=a[d],f=e.standBounds().clone();e.getX()-.5*f.w-10<b?e.setX(b+.5*f.w+10):e.getX()+.5*f.w+10>c&&e.setX(c-.5*f.w-10)}}};World.prototype.getPlayersRef=function(){return null};
function FighterWorld(a,b,c){World.call(this,a,b);this.m_started=!1;this.m_fPlayers=[];this.fData=DataBattle.getData(c||0);this.m_roundsToWin=3;this.m_roundsLeft=[this.m_roundsToWin,this.m_roundsToWin];this.m_roundFinished=!1;this.m_roundTimer=this.fData.roundTime;this.m_ignoreTimer=!1;this.m_heroIds=[Global.fightSettings.p1CharId,Global.fightSettings.p2CharId];this.m_cosIds=[Global.fightSettings.p1Costume,Global.fightSettings.p2Costume];this.ai=null;this.actionManager=new ActionManager;this.m_endTime=
!1;this.m_bonusStage=Global.fightSettings.bonusStage;this.statue=this.m_winFx=this.m_koFx=this.m_fadeFx=null;this.m_activeFxs={};this.m_spCanvas=Application.instance.addDisplayContainer()}Application.subclass(FighterWorld,World);FighterWorld.TIE_THRESHOLD=10;FighterWorld.BONUS_TIME=2E4;FighterWorld.prototype.loadData=function(a){World.prototype.loadData.call(this,a);this.createPlayers();this.init();Application.instance.canvas.addChild(this.m_spCanvas)};
FighterWorld.prototype.createCamera=function(){null!==this.m_camera&&this.m_camera.free();this.m_camera=new Camera(this,this.m_cameraWidth,this.m_cameraHeight,this.m_cameraScreenX,this.m_cameraScreenY);this.scaleWorld()};FighterWorld.prototype.createNpcManagers=function(){this.m_actorManager=new NpcManager(this)};
FighterWorld.prototype.createPlayers=function(){var a=this.m_heroIds[0],b=this.m_heroIds[1],c=this.m_cosIds[0],d=this.m_cosIds[1],e=FighterActor.getClass(DataHero.getCharaId(a)),f=FighterActor.getClass(DataHero.getCharaId(b));this.m_fPlayers.push(new e(0,this,this.playerCanvas(),.5*this.width()-this.fData.iniDistance/2,this.getFloorY(),a,c));this.m_fPlayers.push(new f(1,this,this.playerCanvas(),.5*this.width()+this.fData.iniDistance/2,this.getFloorY(),b,d));FighterHUD.instance.updatePortraits(this.player1().data.id,
this.player2().data.id);this.m_bonusStage&&this.initBonusStage();this.m_fPlayers.forEach(function(a){this.actorManager().add(a)},this);this.player1().opponent=this.player2();this.player1().setEnabled(!1);this.player2().opponent=this.player1();this.player2().setEnabled(!1);ChallManager.instance.onLoadPlayers()};FighterWorld.prototype.clearPlayers=function(){for(var a=this.m_fPlayers.length-1;0<=a;a--)this.m_fPlayers[a].setAwaitingDelete(!0),this.m_fPlayers.splice(a,1)};
FighterWorld.prototype.resetPlayers=function(a){a=a||!1;this.m_roundTimer=this.fData.roundTime;FighterHUD.instance.resetHUD(a);FighterHUD.instance.updateTimer(this.m_roundTimer/1E3);FighterHUD.instance.firstHitDone=!1;var b=this.player1().getMP(),c=this.player2().getMP();this.clearPlayers();this.createPlayers();this.player1().addMP(b,!0);this.player2().addMP(c,!0);(this.m_ignoreTimer=a)&&FighterHUD.instance.disableTimer();Global.fighterCameraScale=Global.baseScale;GuiGame.instance.adjustCamera(Global.fighterCameraScale);
Global.comingFromSandbox&&FighterGame.instance.rebindPlayerParams();this.ai&&this.ai.rebindData()};
FighterWorld.prototype.initBonusStage=function(){FighterHUD.instance.hideRightSide();this.player1().perfectRound=!1;this.m_fPlayers[1].setX(this.width()/2);this.m_fPlayers[1].clip().visible=!1;this.m_fPlayers[1].setEnabled(!1);this.m_fPlayers[1].addHP(-this.m_fPlayers[1].getHP()+1);this.m_fPlayers[1].setInvulnerable(!0);this.statue=new Statue(this.objectCanvas(),this,this.width()/2,this.getFloorY());this.statue.setFlipX(!0);this.actorManager().add(this.statue);this.m_roundTimer=FighterWorld.BONUS_TIME;
this.m_roundsLeft[0]=1};FighterWorld.prototype.player1=function(){return this.m_fPlayers[0]};FighterWorld.prototype.player2=function(){return this.m_fPlayers[1]};FighterWorld.prototype.players=function(){return this.m_fPlayers};FighterWorld.prototype.getFloorY=function(){return this.getFloorCollision(300,200).y+30};
FighterWorld.prototype.update=function(a){this.m_spCanvas.setPosition(this.canvas.x,this.canvas.y);this.m_started&&!this.m_roundFinished&&(this.ai&&this.ai.update(a),this.resolveCollisions(),this.checkRoundFinish(),this.m_endTime||this.m_ignoreTimer||(this.m_roundTimer-=a,0>=this.m_roundTimer&&(Application.instance.playSound("SND_TIME_OUT"),this.m_roundFinished=this.m_endTime=!0,this.m_roundTimer=0,FighterHUD.instance.updateTimer(this.m_roundTimer),Application.instance.effectManager.createEffectGui("mcGuiMessageTimeOut",
0,0,GuiGame.instance.canvas).onComplete(this,this.timeOver),this.m_fPlayers.forEach(function(a){a.setEnabled(!1);a.setInvulnerable(!0)}))));for(var b=0;b<this.m_fPlayers.length;b++){var c=this.m_fPlayers[b];this.checkWorldBoundaries(c);c.showInCamera()}this.m_endTime||this.m_ignoreTimer||FighterHUD.instance.updateTimer(this.m_roundTimer/1E3);this.actionManager.update(a);World.prototype.update.call(this,a)};
FighterWorld.prototype.resolveCollisions=function(){var a=this.player1(),b=this.player2();if(!a.isDefeated()&&!b.isDefeated()){var c=a.checkActorHit(b,"mcAttack"),d=b.checkActorHit(a,"mcAttack");if(c||d){var e=a.isOnFloor()&&b.isOnFloor(),f=this.resolveDamage(c,d),g=(a.getX()+b.getX())/2;c=this.getP1PushbackDir(c,d);d=this.getRepositionDist(c);var h=this.fData.repositionDist/2;a.onFightHit2(g+Math.max(d,h)*c,f.p1);b.onFightHit2(g-Math.max(this.fData.repositionDist-d,h)*c,f.p2);if(0>=a.getHP()||0>=
b.getHP())this.lastHitEffects(),this.m_camera.zoomCenterFighters(!1,GuiGame.instance.screenFreezeTimeFinal);else{if(e)FighterGame.instance.onShake(10,25,300);else this.hitEffects(GuiGame.instance.screenFreezeTime);this.m_camera.zoomCenterFighters(!0,GuiGame.instance.screenFreezeTime)}}}};
FighterWorld.prototype.getP1PushbackDir=function(a,b){var c=this.player1(),d=this.player2();return a&&b?(a=-Math.sign(c.speed().x)||Math.sign(d.speed().x),0===a&&(a=-c.dirSign()),a):a?Math.sign(d.speed().x)||d.dirSign():-Math.sign(c.speed().x)||-c.dirSign()};
FighterWorld.prototype.getRepositionDist=function(a){var b=this.player1(),c=this.player2(),d=[this.limitLeft,this.limitRight];b=(b.getX()+c.getX())/2;c=this.fData.repositionDist/2;var e=c-Math.max(0,d[0]-(b+c*a));e-=Math.max(0,b+c*a-d[1]);e+=Math.max(0,d[0]-(b-c*a));return e+=Math.max(0,b-c*a-d[1])};
FighterWorld.prototype.resolveDamage=function(a,b){var c=this.player1(),d=this.player2(),e={p1:-1,p2:-1};a&&b?(a=c.getTopY()-d.getTopY(),Math.abs(a)<=FighterWorld.TIE_THRESHOLD||c.isOnFloor()||d.isOnFloor()?(e.p2=c.damage(),e.p1=d.damage()):0>a?e.p2=c.damage():e.p1=d.damage()):a?e.p1=d.damage():b&&(e.p2=c.damage());return e};
FighterWorld.prototype.startRound=function(){this.m_started=!0;this.player1().setEnabled(!0);this.player1().setInvulnerable(!1);this.player2().setEnabled(!Global.fightSettings.bonusStage);this.player1().setInvulnerable(!1);ChallManager.instance.onStartRound()};
FighterWorld.prototype.checkRoundFinish=function(){if(!this.m_roundFinished){var a=this.player1().isDefeated(),b=this.player2().isDefeated();if(this.m_roundFinished=a||b)this.m_fPlayers.forEach(function(a){a.setEnabled(!1)}),this.actionManager.addCallback(this,function(){this.resolveWinner()},400)}};FighterWorld.prototype.forceRoundFinish=function(){this.m_roundFinished=!0,this.m_fPlayers.forEach(function(a){a.setEnabled(!1)})};
FighterWorld.prototype.resolveWinner=function(){var a=this.player1().isDefeated(),b=this.player2().isDefeated();this.m_fPlayers.forEach(function(a){a.setInvulnerable(!0)});a&&b?this.triggerEndSequence(null):a?this.triggerEndSequence(1):b&&(ChallManager.instance.wrongWinCondition()?this.triggerEndSequence(1):(this.triggerEndSequence(0),this.player1().getHP()===this.player1().maxHp&&Global.aiMode!==AICore.MODE_NONE&&TrophyManager.instance.trophyObtained(TrophyManager.ID_UNTOUCHABLE)))};
FighterWorld.prototype.setRoundTimer=function(a){this.m_roundTimer=a};FighterWorld.prototype.timeOver=function(){this.m_roundFinished=!0;this.m_fPlayers.forEach(function(a){a.setEnabled(!1);a.setInvulnerable(!0)});var a=this.player1(),b=this.player2(),c=ChallManager.instance.timeoutWin();null!==c?this.triggerEndSequence(c?0:1):a.getHPPercent()>b.getHPPercent()?this.triggerEndSequence(0):b.getHPPercent()>a.getHPPercent()?this.triggerEndSequence(1):this.triggerEndSequence(null);this.m_endTime=!1};
FighterWorld.prototype.triggerEndSequence=function(a){if(null!==a&&(this.m_roundsLeft[a]--,StoryManager.instance&&StoryManager.instance.bossEnabled())){if(0===a&&1===this.m_roundsLeft[0]&&0===this.m_cosIds[1]){this.bossSequence();Application.instance.stopAllMusics();return}0===this.m_roundsLeft[0]&&Application.instance.stopAllMusics()}0===this.m_roundsLeft[0]||0===this.m_roundsLeft[1]?this.finalSequence(a):this.roundEndSequence(a)};
FighterWorld.prototype.roundEndSequence=function(a){var b=[],c=new ObserverAction({w:this.player1(),l:this.player2()},function(){return this.w.isStopped()&&this.l.isStopped()});b.push(new CallbackAction(this,this.updateRoundsHUD,300));b.push(c);b=b.concat(this.getPerfectActions(a));b=b.concat(this.getEndActions());a=new CallbackAction(this,this.roundRestart,0,[null===a]);b.push(a);this.actionManager.addSequence(b)};
FighterWorld.prototype.finalSequence=function(a){var b=[],c=this.players()[a],d=this.players()[(a+1)%2];c=new ObserverAction({w:c,l:d},function(){return this.w.isStopped()&&this.l.isStopped()});b.push(c);b.push(new CallbackAction(this,this.updateRoundsHUD,0,[a]));b=Global.fightSettings.isChallenge()?b.concat(this.getChallengeActions(a)):b.concat(this.getFinalActions(a));b.push(new ObserverAction(GuiGame.instance,GuiGame.instance.trophyPopupsDone));Global.fightSettings.bonusStage&&(b.push(new CallbackAction(FighterGame.instance,
FighterGame.instance.initStatueDialogue)),b.push(new ObserverAction(FighterGame.instance,FighterGame.instance.dialoguesOver)));b.push(new CallbackAction(this,function(){},Global.fightSettings.isChallenge()?500:0));b.push(new ObserverAction(this,function(){return!this.players()[a].voHandler().isPlayingLastVO()}));c=new CallbackAction(this,this.roundRestart,0,[null===a]);b.push(c);this.actionManager.addSequence(b)};
FighterWorld.prototype.bossSequence=function(){var a=[],b=this.player1(),c=this.player2();b=new ObserverAction({w:b,l:c},function(){return this.w.isStopped()&&this.l.isStopped()});a.push(new CallbackAction(this,this.updateRoundsHUD,300,[0]));a.push(b);a=a.concat(this.getEndActions("gui_hud_fade2"));b=new CallbackAction(this,function(){this.player1().setX(.5*this.width()-.6*this.fData.iniDistance);this.player2().setX(.5*this.width()+.6*this.fData.iniDistance);this.player1().faceOpponent();this.player2().faceOpponent();
this.player1().addHP(this.player1().data.maxHp);FighterHUD.instance.showLetterBox(!0,12);this.m_fadeFx.setPaused(!1);this.m_fadeFx.onComplete(this,function(){this.m_fadeFx=null})},350);a.push(b);a.push(new ObserverAction(this,function(){return null===this.m_fadeFx}));a.push(new CallbackAction(FighterGame.instance,FighterGame.instance.initBossDialogue,500));a.push(new CallbackAction(FighterGame.instance,FighterGame.instance.nextDialogue,4500));a.push(new ObserverAction(FighterGame.instance,FighterGame.instance.dialoguesOver));
a.push(new CallbackAction(this,function(){var a=this.player2(),b=this.camera();FighterGame.instance.onShake(8,50,9999999);Application.instance.playSound("SND_GRAMMA_QUAKE");this.m_activeFxs.bossAura=Application.instance.effectManager.createEffect("fxGreenAura",a.getX()-60-b.getX(),a.getY()-b.getY(),this.objectCanvas())},1E3));a.push(new CallbackAction(this,function(){var a=this.player2();FighterGame.instance.stopShake();this.m_activeFxs.bossAura.setAwaitingDelete(!0);this.createEffect("fxGreenRay",
a.getX()-60,a.getY());Application.instance.playSound("SND_GRAMMA_BEAM")},3500));a.push(new CallbackAction(this,function(){var a=this.player2();a.rebindData(DataHero.ID_BOSS_GRAMMA,1);this.m_heroIds[1]=DataHero.ID_BOSS_GRAMMA;this.m_cosIds[1]=1;a.setMState(FighterActor.ST_RECOVERY);a.forceState(FighterActor.ANIM_ST_JUMP,!1);a.setY(a.getY()-150)},1E3));a.push(new CallbackAction(this,function(){var a=this.player2();FighterHUD.instance.showLetterBox(!1,19);a.addHP(a.data.maxHp);a.setMState(FighterActor.ST_NORMAL);
a.m_onFloor=!1},2250));a.push(new ObserverAction(this.player2(),this.player2().isOnFloor));a.push(new CallbackAction(this,function(){Application.instance.playSound("SND_HIT_FLOOR")}));a.push(new CallbackAction(this,function(){Application.instance.playSound("SND_BG_BOSSBATTLE")},1450));a.push(new CallbackAction(this,function(){this.m_started=this.m_roundFinished=!1;GuiGame.instance.onFXRound()},300));this.actionManager.addSequence(a)};
FighterWorld.prototype.getEndActions=function(a){a="undefined"===typeof a?"gui_hud_fade":a;var b=[];b.push(new ObserverAction(GuiGame.instance,GuiGame.instance.trophyPopupsDone));var c=new CallbackAction(this,function(){Application.instance.effectManager.createEffect(a+"_in",0,0,Application.instance.canvas).onComplete(this,function(){this.m_fadeFx=Application.instance.effectManager.createEffect(a+"_out",0,0,Application.instance.canvas);this.m_fadeFx.setPaused(!0);FighterGame.instance.modifier&&(FighterGame.instance.modifier.stop(),
FighterGame.instance.modifier.onGamePreStart())})},250);b.push(c);b.push(new ObserverAction(this,function(){return null!==this.m_fadeFx}));return b};
FighterWorld.prototype.getPerfectActions=function(a){if(null===a||1==a&&Global.aiMode!=AICore.MODE_NONE)return[];var b=[];this.players()[a].perfectRound&&0<this.m_roundTimer&&(b.push(new CallbackAction(GuiGame.instance,GuiGame.instance.createMessage,0,[GuiGame.MSG_PERF,"mcGuiMessagePerfect"])),b.push(new ObserverAction(GuiGame.instance,GuiGame.instance.messageFinished,[GuiGame.MSG_PERF])));return b};
FighterWorld.prototype.getDestroyedActions=function(a){if(null===a||0==a&&Global.aiMode!=AICore.MODE_NONE)return[];var b=[];Global.fightSettings.isChallenge()||Global.fightSettings.bonusStage||this.m_roundsLeft[a]!==this.m_roundsToWin||(b.push(new CallbackAction(GuiGame.instance,GuiGame.instance.createMessage,0,[GuiGame.MSG_DESTR,"mcGuiMessageDestroyed"])),b.push(new ObserverAction(GuiGame.instance,GuiGame.instance.messageFinished,[GuiGame.MSG_DESTR])));return b};
FighterWorld.prototype.getChallengeActions=function(a){var b=[];0===a?(b.push(new CallbackAction(GuiGame.instance,GuiGame.instance.createMessage,0,[GuiGame.MSG_CHALL,"mcGuiChallengeComplete"])),b.push(new CallbackAction(ChallManager.instance,ChallManager.instance.checkUnlockables)),b.push(new ObserverAction(GuiGame.instance,GuiGame.instance.messageFinished,[GuiGame.MSG_CHALL])),b=b.concat(this.getEndActions()),ChallManager.instance.completeChallenge()):(b.push(new CallbackAction(GuiGame.instance,
GuiGame.instance.createMessage,0,[GuiGame.MSG_CHALL,"mcGuiChallengeFailed"])),b.push(new ObserverAction(GuiGame.instance,GuiGame.instance.messageFinished,[GuiGame.MSG_CHALL])));return b};
FighterWorld.prototype.getFinalActions=function(a){var b=[],c=this.players()[a],d=this.getPerfectActions(a),e=this.getDestroyedActions((a+1)%2),f=0===d.length||0===e.length?1200:900,g=c.data.id;if(!Global.fightSettings.bonusStage||this.statue&&this.statue.isDead())b.push(new CallbackAction(this,function(a){this.m_winFx=GuiGame.instance.createWinFx(a);this.m_winFx.onComplete(this,function(){this.m_winFx=null})},0,[g])),b.push(new ObserverAction(this,function(){return null===this.m_winFx})),b.push(new CallbackAction(c,
c.win,350)),b.push(new CallbackAction(this,function(){},800));0===a&&Global.aiMode!==AICore.MODE_NONE&&b.push(new CallbackAction(this,this.roundEndUnlocks,100,[a]));b=b.concat(d);b=b.concat(e);b.push(new CallbackAction(this,function(){},f));return b};FighterWorld.prototype.updateRoundsHUD=function(){FighterHUD.instance.updateRounds(this.m_roundsToWin-this.m_roundsLeft[0],this.m_roundsToWin-this.m_roundsLeft[1])};
FighterWorld.prototype.roundEndUnlocks=function(a){var b=this.player2().data.id;Global.fightSettings.tutorialMode||b!==DataHero.ID_BILL&&b!==DataHero.ID_GRAMMA||TrophyManager.instance.unlockChara(b);StoryManager.instance&&StoryManager.instance.lastStage()&&0===a&&(StoryManager.instance.perfectRun&&TrophyManager.instance.unlockChara(DataHero.ID_CHICKEN),TrophyManager.instance.unlockCostume(this.player1().id(),1));b===DataHero.ID_CHICKEN?TrophyManager.instance.trophyObtained(TrophyManager.ID_DEF_CHICKEN):
b===DataHero.ID_GRAMMA&&TrophyManager.instance.trophyObtained(TrophyManager.ID_TRUE_GREEN)};FighterWorld.prototype.setRoundsToWin=function(a,b){this.m_roundsLeft[0]=a;this.m_roundsLeft[1]="undefined"===typeof b?a:b;FighterHUD.instance.updateRounds(this.m_roundsToWin-this.m_roundsLeft[0],this.m_roundsToWin-this.m_roundsLeft[1])};
FighterWorld.prototype.roundRestart=function(a){a=a||!1;this.m_started=this.m_roundFinished=!1;for(var b=0;b<this.m_roundsLeft.length;b++)if(0===this.m_roundsLeft[b]){FighterGame.instance.onGameEnd(b);return}this.resetPlayers(a);this.m_fadeFx&&(this.m_fadeFx.setPaused(!1),this.m_fadeFx.onComplete({tie:a,w:this},function(){this.w.actionManager.addCallback(GuiGame.instance,GuiGame.instance.onFXRound,500,[this.tie])}),this.m_fadeFx=null);a&&this.players().forEach(function(a){a.addHP(-a.getHP()+1);a.perfectRound=
!1})};
FighterWorld.prototype.hitEffects=function(a,b,c){b=b||0;var d=[];0>=this.player1().getHP()||0>=this.player2().getHP()?this.lastHitEffects():(d.push(new CallbackAction({w:this,time:a},function(){FighterGame.instance.onShake(8,30,this.time);this.w.actorManager().freezeActors(!0)})),d.push(new CallbackAction(this,function(){Application.instance.effectManager.pauseAllEffects(!0)})),c&&d.push(new CallbackAction(this,function(){Application.instance.effectManager.createEffect("aniFxFlash",0,0,FighterHUD.instance.canvas)},b)),
d.push(new CallbackAction(this,function(){this.actorManager().freezeActors(!1);Application.instance.effectManager.pauseAllEffects(!1);this.m_camera.forceZoomOut()},a)),this.actionManager.addSequence(d))};
FighterWorld.prototype.spClashEffects=function(){if(!this.fightStopped()){var a=new CallbackAction({w:this,time:3E3},function(){FighterGame.instance.onShake(8,30,this.time);this.w.actorManager().freezeActors(!0)}),b=new CallbackAction(this,function(){Application.instance.effectManager.pauseAllEffects(!0)}),c=new CallbackAction(this,function(){Application.instance.effectManager.createEffect("aniFxFlash",0,0,FighterHUD.instance.canvas)}),d=new CallbackAction(this,function(){var a=this.player1();this.actorManager().freezeActors(!1);
Application.instance.effectManager.pauseAllEffects(!1);this.m_camera.forceZoomOut();FighterGame.instance.stopShake();a.onPushback(a.getX()-150*a.dirSign(),void 0,!0,0);a=this.player2();a.onPushback(a.getX()-150*a.dirSign(),void 0,!0,0)},300);this.actionManager.addSequence([a,b,d,c])}};
FighterWorld.prototype.lastHitEffects=function(){var a=new CallbackAction(this,function(){this.m_koFx=Application.instance.effectManager.createEffectGui("mcGuiMessageKO",0,0,FighterHUD.instance.canvas)}),b=new CallbackAction(this,function(){FighterGame.instance.onShake(8,30,5E3);this.actorManager().freezeActors(!0)}),c=new CallbackAction(this,function(){Application.instance.effectManager.pauseAllEffects(!0);this.m_koFx.setPaused(!1)}),d=new ObserverAction(this,function(){return this.m_koFx.isAwaitingDelete()}),
e=new CallbackAction(this,function(){this.actorManager().freezeActors(!1);Application.instance.effectManager.pauseAllEffects(!1);FighterGame.instance.stopShake();this.m_koFx=null;this.m_camera.forceZoomOut()});this.actionManager.addSequence([a,b,c,d,e])};
FighterWorld.prototype.specialAttackFx=function(a,b){var c=[];b.x-=this.camera().getX();b.y-=this.camera().getY();c.push(new CallbackAction(this,this.specialAttackStart));c.push(new CallbackAction(this,function(){Application.instance.effectManager.createEffect("aniFxSpecialSpark",b.x,b.y,this.m_spCanvas)},100));c.push(new CallbackAction(this,this.specialAttackEnd,a));this.actionManager.addSequence(c)};
FighterWorld.prototype.specialAttackStart=function(){this.actorManager().freezeActors(!0);Application.instance.effectManager.pauseAllEffects(!0);FighterHUD.instance.darkenScreen(!0);this.player1().switchCanvas(this.m_spCanvas);this.player2().switchCanvas(this.m_spCanvas)};
FighterWorld.prototype.specialAttackEnd=function(){this.actorManager().freezeActors(!1);Application.instance.effectManager.pauseAllEffects(!1);FighterHUD.instance.darkenScreen(!1);this.player1().switchCanvas(this.playerCanvas());this.player2().switchCanvas(this.playerCanvas())};
FighterWorld.prototype.initBackground=function(){this.bgCanvas=Application.instance.addDisplayContainer();this.bg||(this.bg=[]);switch(Global.fightSettings.getStageData().name){case "zoo":this.bg.push(Application.instance.getAnimation("scn_dogpark_1"));this.bg.push(Application.instance.getAnimation("scn_dogpark_can_ani"));this.bg.push(Application.instance.getAnimation("scn_dogpark_2"));this.bg.push(Application.instance.getAnimation("scn_dogpark_leaves_ani"));this.bg.push(Application.instance.getAnimation("scn_dogpark_plasticbag_ani"));
break;case "big_coffee":this.bg.push(Application.instance.getAnimation("scn_shop_1"));this.bg.push(Application.instance.getAnimation("scn_shop_shadows_ani"));this.bg.push(Application.instance.getAnimation("scn_shop_lamps_ani"));this.bg.push(Application.instance.getAnimation("scn_shop_npc_ani"));this.bg.push(Application.instance.getAnimation("scn_shop_2"));break;case "street":this.bg.push(Application.instance.getAnimation("scn_citystreet"));this.bg.push(Application.instance.getAnimation("scn_citystreet_npc_ani"));
this.bg.push(Application.instance.getAnimation("scn_citystreet_paperball_ani"));this.bg.push(Application.instance.getAnimation("scn_citystreet_plasticbag_ani"));break;case "park":this.bg.push(Application.instance.getAnimation("scn_park_1"));this.bg.push(Application.instance.getAnimation("scn_park_leaves_ani"));this.bg.push(Application.instance.getAnimation("scn_park_2"));this.bg.push(Application.instance.getAnimation("scn_park_can_ani"));break;case "house_front":this.bg.push(Application.instance.getAnimation("scn_housefront"));
this.bg.push(Application.instance.getAnimation("scn_house_chicken_ani"));this.bg.push(Application.instance.getAnimation("scn_house_chicken2_ani"));this.bg.push(Application.instance.getAnimation("scn_house_windmill_ani"));this.bg.push(Application.instance.getAnimation("scn_house_paperball_ani"));this.bg.push(Application.instance.getAnimation("scn_house_papers_ani"));break;case "subway":this.bg.push(Application.instance.getAnimation("scn_subway"));this.bg.push(Application.instance.getAnimation("scn_subway_machine_ani"));
this.bg.push(Application.instance.getAnimation("scn_subway_lights_ani"));this.bg.push(Application.instance.getAnimation("scn_subway_paperball_ani"));break;case "house_back":this.bg.push(Application.instance.getAnimation("scn_backyard")),this.bg.push(Application.instance.getAnimation("scn_backyard_papers_ani"))}if(this.bg&&0<this.bg.length)for(var a=0;a<this.bg.length;a++)this.bgCanvas.addChild(this.bg[a]);this.canvas.addChild(this.bgCanvas)};
FighterWorld.prototype.initForeground=function(){this.fgCanvas=Application.instance.addDisplayContainer();this.fg||(this.fg=[]);switch(Global.fightSettings.getStageData().name){case "big_coffee":this.fg.push(Application.instance.getAnimation("scn_shop_fore"));break;case "house_front":this.fg.push(Application.instance.getAnimation("scn_housefront_fore"));break;case "subway":this.fg.push(Application.instance.getAnimation("scn_subway_fore"))}this.fg.push(Application.instance.getAnimation("scn_common_fade"));
if(this.fg&&0<this.fg.length)for(var a=0;a<this.fg.length;a++)this.fgCanvas.addChild(this.fg[a]);this.canvas.addChild(this.fgCanvas)};FighterWorld.prototype.getPlayersRef=function(){return this.m_fPlayers[0]&&this.m_fPlayers[1]?[this.m_fPlayers[0],this.m_fPlayers[1]]:null};FighterWorld.prototype.fightStopped=function(){return!this.m_started||this.m_roundFinished};FighterWorld.prototype.fillMP=function(){this.m_fPlayers.forEach(function(a){a.addMP(100)})};
FighterWorld.prototype.forceWin=function(){this.m_roundsLeft[0]=0;this.roundRestart(!1)};FighterWorld.prototype.free=function(){this.statue=null;Application.instance.canvas.removeChild(this.m_spCanvas);this.m_spCanvas.free();this.m_spCanvas=null;World.prototype.free.call(this)};
function WorldBaseLayer(a,b,c){this.m_layerData=b;this.m_type=this.m_parallaxYFactor=this.m_parallaxXFactor=this.m_y=this.m_x=0;this.m_world=a;this.m_canvas=null;this.m_name=b.name;this.m_width=b.width;this.m_height=b.height;this.m_offsetX=0;b.offsetX&&(this.m_offsetX=b.offsetX);this.m_offsetY=0;b.offsetY&&(this.m_offsetY=b.offsetY);Application.log(" Layer: "+this.m_name+" w:"+this.m_width+" h:"+this.m_height+" ox:"+this.m_offsetX+" oy:"+this.m_offsetY);this.m_canvas=Application.instance.addDisplayContainer();
a.canvas.addChild(this.m_canvas);this.m_type=0}WorldBaseLayer.TYPE_COLLISIONS=1;WorldBaseLayer.TYPE_TILES=2;WorldBaseLayer.TYPE_SPRITES=3;WorldBaseLayer.TYPE_OBJECTS=4;WorldBaseLayer.TYPE_MARKERS=5;WorldBaseLayer.TYPE_BOX2D=6;WorldBaseLayer.ID_PLAYER="player";WorldBaseLayer.ID_COLLISIONS="collision";WorldBaseLayer.ID_TILES="cell";WorldBaseLayer.ID_SPRITES="sprites";WorldBaseLayer.ID_OBJECTS="objects";WorldBaseLayer.ID_MARKERS="markers";WorldBaseLayer.ID_BOX2D="b2d";
WorldBaseLayer.prototype.free=function(){this.m_layerData=this.m_world=null;null!=this.m_canvas.parent&&this.m_canvas.parent.removeChild(this.m_canvas);this.m_canvas.free();this.m_canvas=null};WorldBaseLayer.prototype.layerData=function(){return this.m_layerData};WorldBaseLayer.prototype.getX=function(){return this.m_x};WorldBaseLayer.prototype.getY=function(){return this.m_y};WorldBaseLayer.prototype.width=function(){return this.m_width};WorldBaseLayer.prototype.height=function(){return this.m_height};
WorldBaseLayer.prototype.visible=function(){return!0};WorldBaseLayer.prototype.name=function(){return this.m_name};WorldBaseLayer.prototype.setX=function(a){this.m_x=a};WorldBaseLayer.prototype.setY=function(a){this.m_y=a};WorldBaseLayer.prototype.refresh=function(){};WorldBaseLayer.prototype.setXParallax=function(a){this.m_parallaxXFactor=(this.m_width-this.m_world.cameraWidth())/(a-this.m_world.cameraWidth())};
WorldBaseLayer.prototype.setYParallax=function(a){this.m_parallaxYFactor=(this.m_height-this.m_world.cameraHeight())/(a-this.m_world.cameraHeight())};WorldBaseLayer.prototype.init=function(){this.m_world.camera().parallaxX&&this.setXParallax(this.m_world.width());this.m_world.camera().parallaxY&&this.setYParallax(this.m_world.height())};
WorldBaseLayer.prototype.render=function(a){this.m_world.camera().parallaxX&&(this.m_canvas.x=-this.parallaxX());this.m_world.camera().parallaxY&&(this.m_canvas.y=-this.parallaxY())};WorldBaseLayer.prototype.parallaxX=function(){return~~(this.m_world.camera().getX()*this.m_parallaxXFactor)-this.m_offsetX};WorldBaseLayer.prototype.parallaxY=function(){return~~(this.m_world.camera().getY()*this.m_parallaxYFactor)-this.m_offsetY};WorldBaseLayer.prototype.canvas=function(){return this.m_canvas};
function WorldTileLayer(a,b,c){WorldBaseLayer.call(this,a,b,c);this.m_maxY=this.m_maxX=this.m_minY=this.m_minX=0;this.m_buffer=[];this.m_bufferY=this.m_bufferX=this.m_bufferHeight=this.m_bufferWidth=0;this.m_type=WorldBaseLayer.TYPE_TILES;this.m_tileHeight=this.m_tileWidth=this.m_rows=this.m_columns=this.m_tempRow=this.m_tempCol=0;this.m_tiles=[];this.m_matrix=[];this.m_tilePrefix="";this.matrixBackup=[];this.initLayerData(b)}Application.subclass(WorldTileLayer,WorldBaseLayer);
WorldTileLayer.TILE_SCALE=1.02;WorldTileLayer.prototype.free=function(){for(var a=0;a<this.m_bufferWidth;){for(var b=0;b<this.m_bufferHeight;){var c=this.m_buffer[a+b*this.m_bufferWidth];null!=c&&(null!=c.parent&&c.parent.removeChild(c),c.free());++b}++a}for(a=this.matrixBackup.length-1;0<=a;a--)this.matrixBackup[a]=null;this.m_tiles=this.m_matrix=this.m_buffer=this.matrixBackup=null;WorldBaseLayer.prototype.free.call(this)};
WorldTileLayer.prototype.concatMatrix=function(a){var b=this.m_rows;this.m_rows+=a.rows;this.m_height=this.m_rows*this.m_tileHeight;for(var c,d,e,f,g,h=0;h<a.matrix.length;h++){if("undefined"===typeof this.m_matrix[h]||null===this.m_matrix[h]){c=[];for(e=0;e<b;e++)c.push(0);this.m_matrix[h]=c.slice();this.matrixBackup[h]=c.slice()}if(a.matrix[h]){e=a.matrix[h].slice();for(c=a.rows-1;0<=c;c--)if("string"===typeof e[c])if(d=e.splice(c,1),f=d[0].split("x"),2!=f.length)Application.fatal("Invalid row: "+
e);else if(g=parseInt(f[0],10),f=parseInt(f[1],10),3<f)for(d=0;d<f;d++)e.splice(c,0,g);else Application.fatal("Invalid cells: "+d);this.m_matrix[h]=this.m_matrix[h].concat(e);this.matrixBackup[h]=this.matrixBackup[h].concat(e)}else{c=[];for(e=0;e<a.rows;e++)c.push(0);this.m_matrix[h]=this.m_matrix[h].concat(c.slice());this.matrixBackup[h]=this.matrixBackup[h].concat(c.slice())}}};WorldTileLayer.prototype.setTilePrefix=function(a){this.m_tilePrefix=a};WorldTileLayer.prototype.tilePrefix=function(){return this.m_tilePrefix};
WorldTileLayer.prototype.initLayerData=function(a){this.m_layerData=JSON.parse(JSON.stringify(a));this.m_columns=this.m_layerData.cols;this.m_rows=this.m_layerData.rows;this.m_tileWidth=this.m_layerData.tileW;this.m_tileHeight=this.m_layerData.tileH;this.m_tiles=this.m_layerData.image;this.m_tilePrefix=this.m_layerData.prefix;this.m_name=this.m_layerData.name;this.m_width=this.m_layerData.width;this.m_height=this.m_layerData.height;this.m_layerData.offsetX&&(this.m_offsetX=this.m_layerData.offsetX);
this.m_layerData.offsetY&&(this.m_offsetY=this.m_layerData.offsetY);this.m_matrix=[];if(this.m_layerData.matrix){for(a=0;a<this.m_layerData.matrix.length;a++)if(this.m_matrix.push([]),this.m_layerData.matrix[a])for(var b=0;b<this.m_layerData.matrix[a].length;b++)this.m_matrix[a]=this.m_layerData.matrix[a].slice();else this.m_matrix[a]=null;for(a=0;a<this.m_columns;a++)if(this.m_matrix[a]&&this.m_matrix[a].length<this.m_rows){var c=this.m_matrix[a];for(b=this.m_rows-1;0<=b;b--)if("string"===typeof c[b]){var d=
c.splice(b,1);var e=d[0].split("x");if(2!=e.length)Application.fatal("Invalid row: "+c);else{var f=parseInt(e[0],10);e=parseInt(e[1],10);if(3<e)for(d=0;d<e;d++)c.splice(b,0,f);else Application.fatal("Invalid cells: "+d)}}}for(a=0;a<this.m_matrix.length;a++)if(this.matrixBackup.push([]),this.m_layerData.matrix[a])for(b=0;b<this.m_matrix[a].length;b++)this.matrixBackup[a]=this.m_matrix[a].slice();else this.matrixBackup[a]=null}};
WorldTileLayer.prototype.getTileName=function(a){return 0<=a&&a<this.m_tiles.length?(a=this.m_tiles[a],0==a.indexOf("?")?this.m_tilePrefix+a.substr(1):a):""};WorldTileLayer.prototype.getBufferCell=function(a,b){return this.m_buffer[(a+this.m_bufferX)%this.m_bufferWidth+(b+this.m_bufferY)%this.m_bufferHeight*this.m_bufferWidth]};WorldTileLayer.prototype.setBufferCell=function(a,b,c){this.m_buffer[(a+this.m_bufferX)%this.m_bufferWidth+(b+this.m_bufferY)%this.m_bufferHeight*this.m_bufferWidth]=c};
WorldTileLayer.prototype.initCell=function(a,b){var c=this.getCell(a+this.m_minX,b+this.m_minY);0<c&&(c=Application.instance.getClip(this.getTileName(c-1)),this.m_canvas.addChild(c),"undefined"!==typeof c.setPosition&&c.setPosition((a+this.m_minX)*this.m_tileWidth,(b+this.m_minY)*this.m_tileHeight),"undefined"!==typeof c.setScale&&c.setScale(WorldTileLayer.TILE_SCALE*Application.DPI),this.setBufferCell(a,b,c))};
WorldTileLayer.prototype.refresh=function(){WorldBaseLayer.prototype.refresh.call(this);this.m_bufferWidth=Math.ceil(this.m_world.camera().width()/this.m_tileWidth+1);this.m_bufferHeight=Math.ceil(this.m_world.camera().height()/this.m_tileHeight+1);for(var a=this.m_bufferY=this.m_bufferX=0,b,c;a<this.m_bufferWidth;){for(b=0;b<this.m_bufferHeight;)c=this.m_buffer[a+b*this.m_bufferWidth],null!=c&&(this.m_canvas.removeChild(c),c.free(),this.m_buffer[a+b*this.m_bufferWidth]=null),this.initCell(a,b),++b;
++a}};
WorldTileLayer.prototype.init=function(){if(0<this.m_buffer.length)Application.error("WorldTileLayer::init() - The layer has already been initialized.");else{WorldBaseLayer.prototype.init.call(this);this.m_bufferWidth=Math.ceil(this.m_world.camera().width()/this.m_tileWidth+1);this.m_bufferHeight=Math.ceil(this.m_world.camera().height()/this.m_tileHeight+1);this.m_bufferY=this.m_bufferX=0;this.m_minX=~~(this.m_world.camera().getX()/this.m_tileWidth);0>this.m_minX&&(this.m_minX=0);this.m_maxX=this.m_minX+
this.m_bufferWidth;this.m_minY=~~(this.m_world.camera().getY()/this.m_tileHeight);0>this.m_minY&&(this.m_minY=0);this.m_maxY=this.m_minY+this.m_bufferHeight;for(var a=0;a<this.m_bufferWidth;){for(var b=0;b<this.m_bufferHeight;)this.initCell(a,b),++b;++a}}};
WorldTileLayer.prototype.getCellInPosition=function(a,b){this.m_tempCol=~~(a/this.m_tileWidth);this.m_tempRow=~~(b/this.m_tileHeight);return 0<=this.m_tempCol&&0<=this.m_tempRow&&this.m_tempCol<this.m_columns&&this.m_tempRow<this.m_rows&&null!==this.m_matrix[this.m_tempCol]&&null!==this.m_matrix[this.m_tempCol][this.m_tempRow]&&"undefined"!==typeof this.m_matrix[this.m_tempCol][this.m_tempRow]?this.m_matrix[this.m_tempCol][this.m_tempRow]:0};
WorldTileLayer.prototype.getCell=function(a,b){return 0<=a&&0<=b&&a<this.m_columns&&b<this.m_rows&&this.m_matrix[a]&&this.m_matrix[a][b]&&this.m_matrix[a]?this.m_matrix[a][b]:0};WorldTileLayer.prototype.setCell=function(a,b,c){0<=a&&0<=b&&a<this.m_columns&&b<this.m_rows&&(this.m_matrix[a]||(this.m_matrix[a]=Common.createArraySize(this.m_rows,0)),this.m_matrix[a][b]=c);return 0};
WorldTileLayer.prototype.addTileCell=function(a,b,c,d){var e=this.getCell(a,b);0<e&&(e=Application.instance.getClip(this.getTileName(e-1)),this.m_canvas.addChild(e),e.parent=this.m_canvas,"undefined"!==typeof e.setPosition&&e.setPosition(a*this.m_tileWidth,b*this.m_tileHeight),"undefined"!==typeof e.setScale&&e.setScale(WorldTileLayer.TILE_SCALE*Application.DPI),this.setBufferCell(c,d,e))};
WorldTileLayer.prototype.render=function(a){a=!1;var b,c,d;if(this.m_world.camera().parallaxX){var e=this.parallaxX();var f=~~(e/this.m_tileWidth);var g=f-this.m_minX;if(g<=-this.m_bufferWidth||g>=this.m_bufferWidth)a=!0;else if(f>this.m_minX){for(c=0;c<g;){for(d=0;d<this.m_bufferHeight;){if(b=this.getBufferCell(c,d))"undefined"!==typeof b&&(this.m_canvas.removeChild(b),b.free()),this.setBufferCell(c,d,null);this.addTileCell(c+this.m_maxX,d+this.m_minY,c,d);++d}++c}this.m_bufferX=(this.m_bufferX+
g)%this.m_bufferWidth}else if(f<this.m_minX){for(c=1;c<=-g;){for(d=0;d<this.m_bufferHeight;){if(b=this.getBufferCell(this.m_bufferWidth-c,d))"undefined"!==typeof b&&(this.m_canvas.removeChild(b),b.free()),this.setBufferCell(this.m_bufferWidth-c,d,null);this.addTileCell(this.m_minX-c,d+this.m_minY,this.m_bufferWidth-c,d);++d}++c}this.m_bufferX=(this.m_bufferWidth+this.m_bufferX+g)%this.m_bufferWidth}0!=g&&(this.m_minX=f,this.m_maxX=this.m_minX+this.m_bufferWidth);this.m_canvas.position.x=-Math.floor(e)}if(this.m_world.camera().parallaxY){e=
this.parallaxY();f=~~(e/this.m_tileHeight);g=f-this.m_minY;if(g<=-this.m_bufferHeight||g>=this.m_bufferHeight)a=!0;else if(f>this.m_minY){for(d=0;d<g;){for(c=0;c<this.m_bufferWidth;)b=this.getBufferCell(c,d),null!=b&&(this.m_canvas.removeChild(b),b.free(),this.setBufferCell(c,d,null)),this.addTileCell(c+this.m_minX,d+this.m_maxY,c,d),++c;++d}this.m_bufferY=(this.m_bufferY+g)%this.m_bufferHeight}else if(f<this.m_minY){for(d=1;d<=-g;){for(c=0;c<this.m_bufferWidth;)b=this.getBufferCell(c,this.m_bufferHeight-
d),null!=b&&(this.m_canvas.removeChild(b),b.free(),this.setBufferCell(c,this.m_bufferHeight-d,null)),this.addTileCell(c+this.m_minX,this.m_minY-d,c,this.m_bufferHeight-d),++c;++d}this.m_bufferY=(this.m_bufferHeight+this.m_bufferY+g)%this.m_bufferHeight}0!=g&&(this.m_minY=f,this.m_maxY=this.m_minY+this.m_bufferHeight);this.m_canvas.position.y=-Math.floor(e)}a&&this.refresh()};WorldTileLayer.prototype.matrix=function(){return this.m_matrix};
WorldTileLayer.prototype.resetMatrix=function(){this.m_matrix=[]};WorldTileLayer.prototype.resetTiles=function(){this.m_tiles=[]};WorldTileLayer.prototype.setTiles=function(a){this.m_tiles=a};WorldTileLayer.prototype.setTileW=function(a){this.m_tileWidth=a};WorldTileLayer.prototype.setTileH=function(a){this.m_tileHeight=a};WorldTileLayer.prototype.setMatrix=function(a){this.m_matrix=a};WorldTileLayer.prototype.tiles=function(){return this.m_tiles};WorldTileLayer.prototype.columns=function(){return this.m_columns};
WorldTileLayer.prototype.rows=function(){return this.m_rows};WorldTileLayer.prototype.tileHeight=function(){return this.m_tileHeight};WorldTileLayer.prototype.tileWidth=function(){return this.m_tileWidth};
function WorldCollisionLayer(a,b){WorldTileLayer.call(this,a,b);this.m_sw0=this.m_dy=this.m_dx=this.m_number=this.m_tileY=this.m_tileX=0;this.m_frames=[];this.m_type=WorldBaseLayer.TYPE_COLLISIONS;for(a=WorldCollisionLayer.CELL_EMPTY;a<=WorldCollisionLayer.CELL_HALF_HORIZONTAL;)this.m_frames.push(WorldCollisionLayer.COLLISION_SET+a),++a;this.setVisible(!1)}Application.subclass(WorldCollisionLayer,WorldTileLayer);WorldCollisionLayer.prototype.free=function(){this.m_frames=null;WorldTileLayer.prototype.free.call(this)};
WorldCollisionLayer.CELL_EMPTY=0;WorldCollisionLayer.CELL_FULL=1;WorldCollisionLayer.CELL_DIAG_UP_LEFT=2;WorldCollisionLayer.CELL_DIAG_UP_RIGHT=3;WorldCollisionLayer.CELL_DIAG_DOWN_RIGHT=4;WorldCollisionLayer.CELL_DIAG_DOWN_LEFT=5;WorldCollisionLayer.CELL_PLATFORM=6;WorldCollisionLayer.CELL_FULL_ICE=7;WorldCollisionLayer.CELL_FULL_WATER=8;WorldCollisionLayer.CELL_FULL_SAND=9;WorldCollisionLayer.CELL_MD_UP_LEFT=10;WorldCollisionLayer.CELL_MD_UP_RIGHT=11;WorldCollisionLayer.CELL_HMD_UP_LEFT=12;
WorldCollisionLayer.CELL_HMD_UP_RIGHT=13;WorldCollisionLayer.CELL_HALF_HORIZONTAL=14;WorldCollisionLayer.CELL_SOFT_DELETED=21;WorldCollisionLayer.COLLISION_SET="coll_";WorldCollisionLayer.MIN_VY_FRICTION=-2;WorldCollisionLayer.MAX_VY_SPEED_PLATFORM=-2;
WorldCollisionLayer.prototype.addTileCell=function(a,b,c,d){if(this.m_world.showCollisions()){var e=this.getCell(a,b);e>WorldCollisionLayer.CELL_EMPTY&&(e=Application.instance.getSprite(this.m_frames[e]),this.setBufferCell(c,d,e),this.m_canvas.addChild(e),e.setPosition(a*this.m_tileWidth,b*this.m_tileHeight),e.scale.x=1.07*Application.DPI*this.m_tileWidth/32,e.scale.y=1.07*Application.DPI*this.m_tileHeight/32)}};
WorldCollisionLayer.prototype.initCell=function(a,b){if(this.m_world.showCollisions()){var c=this.getCell(a+this.m_minX,b+this.m_minY);c>WorldCollisionLayer.CELL_EMPTY&&(c=Application.instance.getSprite(this.m_frames[c]),this.m_canvas.addChild(c),c.setPosition((a+this.m_minX)*this.m_tileWidth,(b+this.m_minY)*this.m_tileHeight),c.scale.x=1.07*Application.DPI*this.m_tileWidth/32,c.scale.y=1.07*Application.DPI*this.m_tileHeight/32,this.setBufferCell(a,b,c))}};
WorldCollisionLayer.prototype.parallaxX=function(){return this.m_world.camera().getX()};WorldCollisionLayer.prototype.parallaxY=function(){return this.m_world.camera().getY()};WorldCollisionLayer.prototype.tileHeight=function(){return this.m_tileHeight};WorldCollisionLayer.prototype.tileWidth=function(){return this.m_tileWidth};WorldCollisionLayer.prototype.setVisible=function(a){a?this.m_world.canvas.addChild(this.m_canvas):this.m_world.canvas.removeChild(this.m_canvas)};
WorldCollisionLayer.prototype.getMaxRightLeftRange=function(a,b,c){b=~~(b/this.m_tileHeight);for(var d=~~(a/this.m_tileWidth),e=d-1;this.getCell(e,b-1)===WorldCollisionLayer.CELL_EMPTY&&!(a- --e*this.m_tileWidth>=c););var f=(e+1)*this.m_tileWidth;for(e=d+1;this.getCell(e,b-1)===WorldCollisionLayer.CELL_EMPTY&&!(++e*this.m_tileWidth-a>=c););return new Rectangle(f,b*this.m_tileHeight,e*this.m_tileWidth-f)};
WorldCollisionLayer.prototype.getMaxFloorRange=function(a,b,c){for(var d=~~(b/this.m_tileHeight),e=~~(a/this.m_tileWidth);d<this.m_height;){if(this.getCell(e,d)!==WorldCollisionLayer.CELL_EMPTY){for(b=e-1;this.getCell(b,d)!==WorldCollisionLayer.CELL_EMPTY&&this.getCell(b,d-1)===WorldCollisionLayer.CELL_EMPTY&&!(a- --b*this.m_tileWidth>=c););var f=(b+1)*this.m_tileWidth;for(b=e+1;this.getCell(b,d)!==WorldCollisionLayer.CELL_EMPTY&&this.getCell(b,d-1)===WorldCollisionLayer.CELL_EMPTY&&!(++b*this.m_tileWidth-
a>=c););return new Rectangle(f,d*this.m_tileHeight,b*this.m_tileWidth-f)}++d}Application.warn("getMaxFloorRange: no floor found at x:"+a+" y:"+b);return new Rectangle(a,b,0)};
WorldCollisionLayer.prototype.getMaxFloorRangeElevations=function(a,b,c){for(var d=~~(b/this.m_tileHeight),e=~~(a/this.m_tileWidth);d<this.m_height;){var f=this.getCell(e,d);if(f!==WorldCollisionLayer.CELL_EMPTY){b=~~((a-c)/this.m_tileWidth);var g=!0,h=e,k=d;do{switch(f){case WorldCollisionLayer.CELL_FULL:case WorldCollisionLayer.CELL_PLATFORM:switch(this.getCell(h-1,k)){case WorldCollisionLayer.CELL_EMPTY:g=!1;break;default:switch(this.getCell(h-1,k-1)){case WorldCollisionLayer.CELL_FULL:g=!1;break;
case WorldCollisionLayer.CELL_DIAG_UP_RIGHT:--k}}break;case WorldCollisionLayer.CELL_DIAG_UP_LEFT:switch(this.getCell(h-1,k+1)){case WorldCollisionLayer.CELL_EMPTY:g=!1;break;default:++k}break;case WorldCollisionLayer.CELL_DIAG_UP_RIGHT:switch(this.getCell(h-1,k-1)){case WorldCollisionLayer.CELL_EMPTY:this.getCell(h-1,k)===WorldCollisionLayer.CELL_EMPTY&&(g=!1);break;case WorldCollisionLayer.CELL_FULL:g=!1;break;case WorldCollisionLayer.CELL_DIAG_UP_RIGHT:--k}break;case WorldCollisionLayer.CELL_EMPTY:g=
!1}f=this.getCell(--h,k)}while(g&&h>=b);var m=(h+1)*this.m_tileWidth,l=k*this.m_tileHeight;g=!0;b=~~((a+c)/this.m_tileWidth);++b;h=e;k=d;f=this.getCell(e,d);do{switch(f){case WorldCollisionLayer.CELL_FULL:case WorldCollisionLayer.CELL_PLATFORM:switch(this.getCell(h+1,k)){case WorldCollisionLayer.CELL_EMPTY:g=!1;break;default:switch(this.getCell(h+1,k-1)){case WorldCollisionLayer.CELL_FULL:g=!1;break;case WorldCollisionLayer.CELL_DIAG_UP_LEFT:--k}}break;case WorldCollisionLayer.CELL_DIAG_UP_LEFT:switch(this.getCell(h+
1,k-1)){case WorldCollisionLayer.CELL_EMPTY:this.getCell(h+1,k)===WorldCollisionLayer.CELL_EMPTY&&(g=!1);break;case WorldCollisionLayer.CELL_FULL:g=!1;break;case WorldCollisionLayer.CELL_DIAG_UP_LEFT:--k}break;case WorldCollisionLayer.CELL_DIAG_UP_RIGHT:switch(this.getCell(h+1,k+1)){case WorldCollisionLayer.CELL_EMPTY:g=!1;break;default:++k}break;case WorldCollisionLayer.CELL_EMPTY:g=!1}f=this.getCell(++h,k)}while(g&&h<=b);return new Rectangle(m,l,h*this.m_tileWidth-m,k*this.m_tileHeight-l)}++d}Application.warn("getMaxFloorRange: no floor found at x:"+
a+" y:"+b);return new Rectangle(a,b,0)};
WorldCollisionLayer.prototype.getFloorCollision=function(a,b){for(var c=~~(b/this.m_tileHeight),d=~~(a/this.m_tileWidth);c<this.m_height;){var e=this.getCell(d,c);if(e!==WorldCollisionLayer.CELL_EMPTY){switch(e){case WorldCollisionLayer.CELL_DIAG_UP_LEFT:case WorldCollisionLayer.CELL_DIAG_UP_RIGHT:switch(e){case WorldCollisionLayer.CELL_DIAG_UP_LEFT:return new Vector2D(a,c*this.m_tileHeight+(d+1)*this.m_tileWidth-a)}return new Vector2D(a,c*this.m_tileHeight+a-d*this.m_tileWidth)}return new Vector2D(a,
c*this.m_tileHeight)}++c}Application.warn("getFloorCollision: no floor found");return new Vector2D(a,b)};WorldCollisionLayer.prototype.getTilePosition=function(a,b){return new Point(~~(a/this.m_tileWidth),~~(b/this.m_tileHeight))};WorldCollisionLayer.prototype.getTileBelow=function(a,b,c){var d=0;for(a=~~(a/this.m_tileWidth);d<=c;){var e=this.getCell(a,~~(b/this.m_tileHeight));if(e!==WorldCollisionLayer.CELL_EMPTY)return e;b+=this.m_tileHeight;d+=this.m_tileHeight}return WorldCollisionLayer.CELL_EMPTY};
WorldCollisionLayer.prototype.getRayCollision=function(a,b,c,d){b=~~(b/this.m_tileHeight);for(c=~~(a/this.m_tileWidth);b<this.m_height;){if(this.getCell(c,b)!==WorldCollisionLayer.CELL_EMPTY)return new Vector2D(a,b*this.m_tileHeight);++b}return null};WorldCollisionLayer.prototype.render=function(a){this.m_world.showCollisions()&&WorldTileLayer.prototype.render.call(this,a)};
function PhysicZone(a,b,c,d,e,f){Rectangle.call(this,b-d/2,c-e/2,d,e);this.type=0;this.active=!1;this.params=Common.getParams(f);switch(a){case PhysicZone.ID_CLIMB:this.type=PhysicZone.CLIMB;break;case PhysicZone.ID_CAMERA:this.type=PhysicZone.CAMERA;break;case PhysicZone.ID_FLUID:this.type=PhysicZone.FLUID;break;case PhysicZone.ID_FORCE:this.type=PhysicZone.FORCE;break;case PhysicZone.ID_FRICTION:this.type=PhysicZone.FRICTION;break;default:Application.error("Invalid physic zone")}}
Application.subclass(PhysicZone,Rectangle);PhysicZone.CLIMB=1;PhysicZone.FLUID=2;PhysicZone.FORCE=3;PhysicZone.FRICTION=4;PhysicZone.CAMERA=5;PhysicZone.ID_CLIMB="climb";PhysicZone.ID_FLUID="fluid";PhysicZone.ID_FORCE="force";PhysicZone.ID_CAMERA="camera";PhysicZone.ID_FRICTION="friction";
function WorldSpriteLayer(a,b){WorldBaseLayer.call(this,a,b);this.m_type=WorldBaseLayer.TYPE_SPRITES;this.m_actors=[];this.m_cameraRect=new Rectangle(0,0,a.camera().width(),a.camera().height());this.m_quadtree=null;this.m_world.height()<=this.m_world.cameraHeight()?this.m_parallaxYFactor=1:this.m_parallaxYFactor=(b.height-this.m_world.cameraHeight())/(this.m_world.height()-this.m_world.cameraHeight());this.m_world.width()<=this.m_world.cameraWidth()?this.m_parallaxXFactor=1:this.m_parallaxXFactor=
(b.width-this.m_world.cameraWidth())/(this.m_world.width()-this.m_world.cameraWidth());this.initLayerData(b)}Application.subclass(WorldSpriteLayer,WorldBaseLayer);WorldSpriteLayer.X_INDEX=0;WorldSpriteLayer.Y_INDEX=1;WorldSpriteLayer.CLIP_WIDTH_INDEX=2;WorldSpriteLayer.CLIP_HEIGHT_INDEX=3;WorldSpriteLayer.CLIPNAME_INDEX=4;
WorldSpriteLayer.prototype.initLayerData=function(a){this.m_layerData=JSON.parse(JSON.stringify(a));var b=a.offsetX,c=a.offsetY,d=new Rectangle(a.left-2,a.top-2,a.right-a.left+4,a.bottom-a.top+4);null!==this.m_quadtree&&this.m_quadtree.free();this.m_quadtree=new QuadTree(d,0,this.m_parallaxXFactor,this.m_parallaxYFactor,b,c);d=a.image;for(var e=a.palette,f=d.length,g=0;g<f;)this.readSprite(this.m_world,d[g],this.m_parallaxXFactor,this.m_parallaxYFactor,b,c,e,a.name),++g};
WorldSpriteLayer.prototype.setXParallax=function(a){};WorldSpriteLayer.prototype.setYParallax=function(a){};
WorldSpriteLayer.prototype.readSprite=function(a,b,c,d,e,f,g,h){var k=b.d,m=k[WorldSpriteLayer.X_INDEX];var l=k[WorldSpriteLayer.Y_INDEX];a=new SpriteActor(this.m_canvas,a,m,l,c,d,e,f);a.m_clip=Application.instance.getClip(g[k[WorldSpriteLayer.CLIPNAME_INDEX]]);a.m_clip.setPosition(this.m_x-this.m_world.camera().getX(),this.m_y-this.m_world.camera().getY());switch(b.blend){case 2:a.m_clip.blendMode=PIXI.BLEND_MODES.ADD;break;case 3:a.m_clip.blendMode=PIXI.BLEND_MODES.MULTIPLY}c="undefined"!==typeof b.sx?
b.sx:1;e="undefined"!==typeof b.sy?b.sy:1;a.m_clip.setScale(c,e);d="undefined"!==typeof b.rot?b.rot:0;a.m_clip.rotation=d;this.m_actors.push(a);this.m_canvas.addChild(a.m_clip);c=Math.abs(k[WorldSpriteLayer.CLIP_WIDTH_INDEX]*c);var n=Math.abs(k[WorldSpriteLayer.CLIP_HEIGHT_INDEX]*e);if(0===d)l=new NamedRectangle(a,m-c/2,l-n/2,c,n);else{b=Math.cos(d);d=Math.sin(d);f=c/2;var p=-n/2,q=c/2,r=n/2,t=-c/2,u=n/2;e=-c/2;n=-n/2;c=m+f*b-p*d;f=l+f*d+p*b;p=m+q*b-r*d;q=l+q*d+r*b;r=m+t*b-u*d;t=l+t*d+u*b;m=m+e*b-
n*d;l=l+e*d+n*b;b=Math.min(c,p,r,m);d=Math.min(f,q,t,l);l=new NamedRectangle(a,b,d,Math.max(c,p,r,m)-b,Math.max(f,q,t,l)-d)}this.m_quadtree.insert(l,a.isAlwaysVisible())?a.setQuadtreeRect(l):Application.log("Sprite "+g[k[WorldSpriteLayer.CLIPNAME_INDEX]]+" not inserted in layer "+h+"("+l.x+", "+l.y+", "+l.w+", "+l.h+")")};
WorldSpriteLayer.prototype.render=function(a){var b=this.m_world.camera().getX(),c=this.m_world.camera().getY();this.m_cameraRect.setLeft(b);this.m_cameraRect.setTop(c);this.m_cameraRect.setRight(b+this.m_world.camera().width());this.m_cameraRect.setBottom(c+this.m_world.camera().height());b=this.m_quadtree.query(this.m_cameraRect);for(c=this.m_actors.length-1;0<=c;c--){var d=this.m_actors[c];if(d.isAwaitingDelete())this.m_quadtree.remove(d.getQuadtreeRect()),d.free(),this.m_actors.splice(c,1);else if(this.isVisible(b,
d)){if(d.isIdle())d.onIdle(!1);d.update(a)}else if(!d.isIdle())d.onIdle(!0)}};WorldSpriteLayer.prototype.isVisible=function(a,b){if(b.isAlwaysVisible())return!0;for(var c=a.length,d=0;d<c;d++)if(a[d].getObject()===b)return a.splice(d,1),!0;return!1};WorldSpriteLayer.prototype.free=function(){this.m_quadtree.free();this.m_cameraRect=this.m_quadtree=null;for(var a=this.m_actors.length,b=0;b<a;b++)this.m_actors[b].free(),this.m_actors[b]=null;this.m_actors=null;WorldBaseLayer.prototype.free.call(this)};
WorldSpriteLayer.prototype.onDebugDraw=function(a){this.m_quadtree.onDebugDraw(a)};function FighterInput(a){this.m_world=a;this.m_p1Keys={};this.m_p2Keys={};FighterInput.loadKeyConfig();this.setKeys()}FighterInput.KEY_P1UP=Common.KEY_W;FighterInput.KEY_P1FWD=Common.KEY_D;FighterInput.KEY_P1BCK=Common.KEY_A;FighterInput.KEY_P1DOWN=Common.KEY_S;FighterInput.KEY_P1TAP=-1E3;FighterInput.KEY_P1DTAP=Common.KEY_SPACE;FighterInput.KEY_P2UP=Common.KEY_UP;FighterInput.KEY_P2FWD=Common.KEY_LEFT;
FighterInput.KEY_P2BCK=Common.KEY_RIGHT;FighterInput.KEY_P2DOWN=Common.KEY_DOWN;FighterInput.KEY_P2TAP=-1001;FighterInput.KEY_P2DTAP=Common.KEY_ENTER;FighterInput.KEY_UP=100;FighterInput.KEY_DOWN=101;FighterInput.KEY_BACK=102;FighterInput.KEY_FWD=103;FighterInput.KEY_SPEC=104;FighterInput.KEY_RECOV=105;
FighterInput.loadKeyConfig=function(){var a=Application.config.settings;FighterInput.KEY_P1UP=a.P1_UP;FighterInput.KEY_P1FWD=a.P1_FORWARD;FighterInput.KEY_P1DOWN=a.P1_DOWN;FighterInput.KEY_P1BCK=a.P1_BACK;FighterInput.KEY_P1DTAP=a.P1_SPECIAL;FighterInput.KEY_P2UP=a.P2_UP;FighterInput.KEY_P2FWD=a.P2_FORWARD;FighterInput.KEY_P2DOWN=a.P2_DOWN;FighterInput.KEY_P2BCK=a.P2_BACK;FighterInput.KEY_P2DTAP=a.P2_SPECIAL};
FighterInput.prototype.setKeys=function(){this.m_p1Keys[""+FighterInput.KEY_P1UP]=FighterInput.KEY_UP;this.m_p1Keys[""+FighterInput.KEY_P1DOWN]=FighterInput.KEY_DOWN;this.m_p1Keys[""+FighterInput.KEY_P1TAP]=FighterInput.KEY_RECOV;this.m_p1Keys[""+FighterInput.KEY_P1DTAP]=FighterInput.KEY_SPEC;this.m_p2Keys[""+FighterInput.KEY_P2UP]=FighterInput.KEY_UP;this.m_p2Keys[""+FighterInput.KEY_P2DOWN]=FighterInput.KEY_DOWN;this.m_p2Keys[""+FighterInput.KEY_P2TAP]=FighterInput.KEY_RECOV;this.m_p2Keys[""+FighterInput.KEY_P2DTAP]=
FighterInput.KEY_SPEC;this.m_p1Keys[""+FighterInput.KEY_P1FWD]=FighterInput.KEY_FWD;this.m_p1Keys[""+FighterInput.KEY_P1BCK]=FighterInput.KEY_BACK;this.m_p2Keys[""+FighterInput.KEY_P2FWD]=FighterInput.KEY_FWD;this.m_p2Keys[""+FighterInput.KEY_P2BCK]=FighterInput.KEY_BACK};
FighterInput.prototype.onKeyDown=function(a){var b=this.m_world.player1(),c=this.m_world.player2();this.m_p1Keys.hasOwnProperty(""+a)?b.keyDown(this.m_p1Keys[""+a]):this.m_p2Keys.hasOwnProperty(""+a)&&Global.aiMode===AICore.MODE_NONE&&c.keyDown(this.m_p2Keys[""+a])};FighterInput.prototype.onKeyUp=function(a){var b=this.m_world.player1(),c=this.m_world.player2();this.m_p1Keys.hasOwnProperty(""+a)?b.keyUp(this.m_p1Keys[""+a]):this.m_p2Keys.hasOwnProperty(""+a)&&c.keyUp(this.m_p2Keys[""+a])};
function FighterHUD(a,b,c){SScreen.call(this,a,b,c);FighterHUD.instance=this;this.m_hpBarsFill=[];this.m_hpBarsPerc=[1,1];this.m_hpBarsFillFx=[];this.m_mpBars=[];this.m_mpBarFxs=[];this.m_mpNanoFxs=[];this.m_roundCounters=[];this.m_portraits=[];this.m_letterBox=this.getControl("mcGuiCinematicBars");this.m_roundTimer=null;this.m_bgBlack=Application.instance.getAnimation("gui_hud_black_screen");this.m_bgBlack.visible=!1;this.canvas.addChild(this.m_bgBlack);this.m_flashTimer=[0,0];this.m_roundTimerWarning=
null;this.m_guiNumRounds=0;this.m_pauseEnabled=!0;this.m_multitouchMap={};this.initControls();this.initControlPositions("mcGuiHpBarFill01 mcGuiHpBarFillHit01 mcGuiHpBarBase01 mcGuiHpBarMask01 mcGuiHpBarFill02 mcGuiHpBarFillHit02 mcGuiHpBarBase02 mcGuiHpBarMask02 mcGuiMpBarFill01 mcGuiMpBarBase01 mcGuiMpBarMark01 mcGuiMpBarFill02 mcGuiMpBarBase02 mcGuiMpBarMark02 mcGuiRounds01 mcGuiRounds02 mcGuiPlayer01 mcGuiPlayer02 mcGuiBtnEffect01 mcGuiBtnEffect02 mcGuiBtnEffect03 mcGuiBtnEffect04 mcGuiMpbar01Full mcGuiMpbar02Full mcGuiMpbar01HalfFull mcGuiMpbar02HalfFull mcGuiHitCount01 mcGuiHitCount02".split(" "));
this.canvas.hitArea=null;this.m_magnetizeManager=new HudMagnetizedManager(this.canvas);this.firstHitDone=!1}Application.subclass(FighterHUD,SScreen);FighterHUD.instance=null;FighterHUD.HPBAR_FLASH_TIME=150;FighterHUD.HPBAR_SPEED=.002;
FighterHUD.prototype.initControls=function(){this.m_hpBarsFill.push(this.getControl("mcGuiHpBarFill01"));this.m_hpBarsFill.push(this.getControl("mcGuiHpBarFill02"));this.m_hpBarsFill[1].clip.x+=this.m_hpBarsFill[1].getWidth();this.m_hpBarsFillFx.push(this.getControl("mcGuiHpBarFillHit01"));this.m_hpBarsFillFx.push(this.getControl("mcGuiHpBarFillHit02"));this.m_hpBarsFillFx[1].clip.x+=this.m_hpBarsFillFx[1].getWidth();this.m_mpBars.push(this.getControl("mcGuiMpBarFill01"));this.m_mpBars.push(this.getControl("mcGuiMpBarFill02"));
this.m_mpBars[1].clip.x+=this.m_mpBars[1].getWidth();this.m_mpBarFxs.push(this.getControl("mcGuiMpbar01HalfFull"));this.m_mpBarFxs.push(this.getControl("mcGuiMpbar02HalfFull"));this.m_mpBarFxs.push(this.getControl("mcGuiMpbar01Full"));this.m_mpBarFxs.push(this.getControl("mcGuiMpbar02Full"));this.m_guiNumRounds=this.getControl("mcGuiRounds01").clip.totalFrames;this.m_roundCounters.push(this.getControl("mcGuiRounds01"));this.m_roundCounters.push(this.getControl("mcGuiRounds02"));this.m_portraits.push(this.getControl("mcGuiPlayer01"));
this.m_portraits.push(this.getControl("mcGuiPlayer02"));this.m_roundTimer=this.getControl("mcGuiTimer");this.m_roundTimerWarning=this.getControl("mcGuiTimerWarning");this.m_roundCounters[0].clip.gotoAndStop(1);this.m_roundCounters[1].clip.gotoAndStop(1);this.m_letterBox.setVisible(!1);this.resetHUD()};
FighterHUD.prototype.resetHUD=function(a){this.m_hpBarsPerc=[1,1];this.m_hpBarsFill.forEach(function(a){a.clip.gotoAndStop(1);a.clip.scale.x=1});this.m_hpBarsFill[1].clip.setScale(-1);this.m_hpBarsFillFx.forEach(function(a){a.clip.gotoAndStop(1);a.clip.scale.x=1;a.setVisible(!1)});this.m_hpBarsFillFx[1].clip.setScale(-1);this.m_mpBars.forEach(function(a){a.clip.gotoAndStop(1);a.clip.scale.x=0});this.m_mpBarFxs.forEach(function(a){a.setVisible(!1)})};
FighterHUD.prototype.free=function(){FighterHUD.instance=null;this.m_magnetizeManager&&(this.m_magnetizeManager.free(),this.m_magnetizeManager=null);this.canvas.removeChild(this.m_letterBox.clip);this.canvas.removeChild(this.m_bgBlack);this.m_bgBlack.free();this.clearSpEffects(0);this.clearSpEffects(1);SScreen.prototype.free.call(this)};FighterHUD.prototype.onDebugDraw=function(a){};
FighterHUD.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.updateHpFlash(0,a);this.updateHpFlash(1,a);for(var b=0;b<this.m_hpBarsPerc.length;b++){var c=this.m_hpBarsFill[b].clip.scale.x,d=this.m_hpBarsPerc[b]*(0===b?1:-1),e=Math.sign(d-c);0!==e&&(c=e*a*FighterHUD.HPBAR_SPEED+c,Math.sign(d-c)!==e?(this.m_hpBarsFill[b].clip.scale.x=d,this.m_hpBarsFillFx[b].clip.scale.x=d):(this.m_hpBarsFill[b].clip.scale.x=c,this.m_hpBarsFillFx[b].clip.scale.x=c))}this.m_magnetizeManager&&this.m_magnetizeManager.update(a)};
FighterHUD.prototype.onUIPress=function(a,b){if(GuiGame.instance)switch(Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnPause":this.m_pauseEnabled&&GuiGame.instance.addPopup(new GuiPopupPause("mcGuiPopupPause"));break;case "mcGuiBtnJump01":this.onFButtonPress(b,FighterInput.KEY_P1UP);break;case "mcGuiBtnKick01":this.onFButtonPress(b,FighterInput.KEY_P1FWD);break;case "mcGuiBtnJump02":this.onFButtonPress(b,FighterInput.KEY_P2UP);break;case "mcGuiBtnKick02":this.onFButtonPress(b,
FighterInput.KEY_P2FWD)}};FighterHUD.prototype.onUIRelease=function(a,b){switch(a.name){case "mcGuiBtnJump01":this.onFButtonRelease(b,FighterInput.KEY_P1UP);break;case "mcGuiBtnKick01":this.onFButtonRelease(b,FighterInput.KEY_P1FWD);break;case "mcGuiBtnJump02":this.onFButtonRelease(b,FighterInput.KEY_P2UP);break;case "mcGuiBtnKick02":this.onFButtonRelease(b,FighterInput.KEY_P2FWD)}};
FighterHUD.prototype.onFButtonPress=function(a,b){"undefined"===typeof this.m_multitouchMap[""+b]&&(this.m_multitouchMap[""+b]=null);null===this.m_multitouchMap[""+b]&&(this.m_multitouchMap[""+b]=this.getIdentifier(a),FighterGame.instance.onKeyDown(b))};FighterHUD.prototype.onFButtonRelease=function(a,b){var c=this.m_multitouchMap[""+b];this.getIdentifier(a)===c&&(this.m_multitouchMap[""+b]=null,FighterGame.instance.onKeyUp(b))};
FighterHUD.prototype.onPointerRelease=function(a){a=this.getIdentifier(a);for(var b in this.m_multitouchMap)this.m_multitouchMap[b]===a&&(this.m_multitouchMap[b]=null,FighterGame.instance.onKeyUp(parseInt(b,10)))};FighterHUD.prototype.getIdentifier=function(a){return"undefined"!==typeof a.data.identifier?a.data.identifier:a.data.originalEvent.which};
FighterHUD.prototype.setHP=function(a,b,c){b=0<a?-b:b;Math.abs(this.m_hpBarsFill[a].clip.scale.x)>Math.abs(b)&&this.m_hpBarsFill[a].clip.visible&&(this.m_flashTimer[a]=FighterHUD.HPBAR_FLASH_TIME,this.m_hpBarsFillFx[a].clip.visible=!0);this.m_hpBarsPerc[a]=Math.abs(b);"undefined"===typeof c||c||(this.m_hpBarsFill[a].clip.scale.x=b,this.m_hpBarsFillFx[a].clip.scale.x=b)};
FighterHUD.prototype.setMP=function(a,b,c){var d=Math.abs(this.m_mpBars[a].clip.scale.x);this.m_mpBars[a].clip.scale.x=0<a?-b:b;.5<=b?(b=0===Math.floor(b),1===a&&Global.aiMode!==AICore.MODE_NONE&&(c=!0),b&&.5>d?(this.createSpEffects(a,b),c||Application.instance.playSound("SND_SPECIAL_HALFWAY")):!b&&1>d&&(this.clearSpEffects(a),this.createSpEffects(a,b),c||Application.instance.playSound("SND_SPECIAL_FULL"))):this.clearSpEffects(a)};
FighterHUD.prototype.updateHpFlash=function(a,b){0<this.m_flashTimer[a]&&(this.m_flashTimer[a]-=b,0>=this.m_flashTimer[a]&&(this.m_hpBarsFillFx[a].clip.visible=!1))};FighterHUD.prototype.updateRounds=function(a,b){this.m_roundCounters[0].clip.gotoAndStop(Math.min(this.m_guiNumRounds,a+1));this.m_roundCounters[1].clip.gotoAndStop(Math.min(this.m_guiNumRounds,b+1))};
FighterHUD.prototype.updateTimer=function(a){a=0>a?0:a;var b=Math.ceil(a);9>=a?(this.m_roundTimerWarning.setText("0"+b.toString()),this.m_roundTimer.setTextEmpty()):(this.m_roundTimerWarning.setTextEmpty(),this.m_roundTimer.setTextNumeric(b))};FighterHUD.prototype.disableTimer=function(){this.m_roundTimerWarning.setTextEmpty();this.m_roundTimer.setText("00")};
FighterHUD.prototype.updatePortraits=function(a,b){this.m_portraits[0].clip.gotoAndStop(DataHero.toGUIIndex(a)+1);this.m_portraits[1].clip.gotoAndStop(DataHero.toGUIIndex(b)+1)};
FighterHUD.prototype.hideRightSide=function(){this.m_portraits[1].setVisible(!1);this.m_hpBarsFill[1].setVisible(!1);this.m_hpBarsFillFx[1].setVisible(!1);this.m_mpBars[1].setVisible(!1);this.m_mpBarFxs[1].setVisible(!1);this.m_roundCounters[1].setVisible(!1);this.getControl("mcGuiHpBarBase02").setVisible(!1);this.getControl("mcGuiMpBarBase02").setVisible(!1);this.getControl("mcGuiHpBarMask02").setVisible(!1)};
FighterHUD.prototype.showLetterBox=function(a,b){var c="undefined"!==typeof b;b=c?b||0:1;a?(this.canvas.removeChild(this.m_letterBox.clip),this.canvas.addChild(this.m_letterBox.clip),this.m_letterBox.setVisible(a),c?this.m_letterBox.clip.gotoAndStop(b):this.m_letterBox.clip.gotoAndPlay(b)):(c&&this.m_letterBox.clip.gotoAndPlay(b),this.m_letterBox.clip.resume(),this.m_letterBox.clip.onEndAnimation(this,function(){this.m_letterBox.setVisible(!1)}))};FighterHUD.prototype.letterBoxVisible=function(){return this.m_letterBox.isVisible()};
FighterHUD.prototype.enablePause=function(a){this.m_pauseEnabled=a;this.getControl("mcGuiBtnPause").setEnabled(a)};FighterHUD.prototype.darkenScreen=function(a){return this.m_bgBlack.visible=a};
FighterHUD.prototype.createSpEffects=function(a,b){if(!this.m_mpNanoFxs[a]){var c=Application.instance.effectManager,d=b?"aniFxEnergyBarHalfShine":"aniFxEnergyBarFullShine";var e=new Vector2D(this.m_mpBars[a].getX(),this.m_mpBars[a].getY());var f=this.m_mpBarFxs[0].getWidth()+60;1===a&&(e.x+=f,e.y+=7);var g=0===a?1:-1;b?(b=e.x+f/4*g,e=e.y):(b=e.x+f/2*g,e=e.y-5);this.m_mpNanoFxs[a]=c.createEffect(d,b,e,this.canvas,0)}};
FighterHUD.prototype.getHPBarCenter=function(a){var b=new Vector2D(this.m_hpBarsFill[a].getX(),this.m_hpBarsFill[a].getY()),c=this.getControl("mcGuiHpBarBase01").getWidth();1===a&&(b.x+=c,b.y+=7);return new Vector2D(b.x+c/2*(0===a?1:-1),b.y-5)};FighterHUD.prototype.clearSpEffects=function(a){this.m_mpNanoFxs[a]&&(this.m_mpNanoFxs[a].setAwaitingDelete(!0),this.m_mpNanoFxs[a]=null)};FighterHUD.prototype.getHPBarPos=function(a){return new Vector2D(this.m_hpBarsFill[a].getX(),this.m_hpBarsFill[a].getY())};
FighterHUD.prototype.magnetizeManager=function(){return this.m_magnetizeManager};FighterHUD.prototype.createMagnetizedNano=function(a,b,c,d,e,f,g,h){return this.m_magnetizeManager?this.m_magnetizeManager.createMagnetizedNano(a,b,c,d,e,f,g,h):null};FighterHUD.prototype.createMagnetizedClip=function(a,b,c,d,e,f,g,h){return this.m_magnetizeManager?this.m_magnetizeManager.createMagnetizedClip(a,b,c,d,e,f,g,h):null};
function ChallManager(a,b){ChallManager.instance=this;this.m_id=b;this.m_world=a;this.m_p1=a.player1();this.m_p2=a.player2();this.m_specialFinish=!1;this.m_data=Application.config.challValues}ChallManager.instance=null;ChallManager.ID_NONE=0;ChallManager.ID_HALF_BAR=1;ChallManager.ID_BASIC_MODE=2;ChallManager.ID_SPECIAL_WIN=3;ChallManager.ID_RUSH_HOUR=4;ChallManager.ID_CCCOMBO=5;ChallManager.ID_TOUGHIE=6;ChallManager.ID_STAMPEDE=7;ChallManager.ID_BITE_DUST=8;ChallManager.ID_ENDURE=9;
ChallManager.ID_ENMY_REGEN=10;ChallManager.ID_JMP_DMG=11;ChallManager.ID_SPEC_SPAM=12;ChallManager.ID_LAVA_FLOOR=13;ChallManager.ID_GIANT_BILL=14;ChallManager.ID_SPEC_FINISH=15;ChallManager.NUM_CHALLENGES=16;ChallManager.ENEMY_REGEN=.05;ChallManager.GROUND_DIVE_DMG=2;ChallManager.JUMP_PERC_DMG=.02;ChallManager.NUM_COMBO=5;ChallManager.prototype.update=function(a){if(!this.m_world.fightStopped())switch(this.m_id){case ChallManager.ID_LAVA_FLOOR:this.floorDamage();break;case ChallManager.ID_ENMY_REGEN:this.m_p2.addHP(this.m_data.enemyRegen)}};
ChallManager.prototype.floorDamage=function(){this.m_p1.isOnFloor()&&(this.m_p1.addHP(-this.m_data.lavaDamage),0===this.m_p1.getHP()&&this.m_p1.forceDefeat())};ChallManager.prototype.playerJump=function(a){var b=a.id()===this.m_p1.id();switch(this.m_id){case ChallManager.ID_JMP_DMG:b&&(a.addHP(-a.maxHp*ChallManager.JUMP_PERC_DMG),0===this.m_p1.getHP()&&this.m_p1.forceDefeat())}};
ChallManager.prototype.onGroundDive=function(a){var b=a.id()===this.m_p1.id();if(!this.m_world.fightStopped())switch(this.m_id){case ChallManager.ID_BITE_DUST:b&&(a.addHP(-ChallManager.GROUND_DIVE_DMG),0===this.m_p1.getHP()&&this.m_p1.forceDefeat())}};
ChallManager.prototype.onLoadPlayers=function(){this.m_p1=this.m_world.player1();this.m_p2=this.m_world.player2();switch(this.m_id){case ChallManager.ID_SPEC_SPAM:this.m_p1.diveBar=100;this.m_p2.diveBar=100;break;case ChallManager.ID_SPECIAL_WIN:this.m_p1.perfectRound=!1;this.m_p2.perfectRound=!1;this.m_world.players().forEach(function(a){a.dmgMultiplier=0});break;case ChallManager.ID_HALF_BAR:this.m_p1.addHP(-this.m_p1.getHP()/2);break;case ChallManager.ID_RUSH_HOUR:this.m_world.setRoundTimer(2E4);
this.m_world.setRoundsToWin(1);break;case ChallManager.ID_BASIC_MODE:this.m_p1.perfectRound=!1;this.m_p2.perfectRound=!1;this.m_world.players().forEach(function(a){a.dmgMultiplier=1E3;a.diveBar=0});break;case ChallManager.ID_TOUGHIE:this.m_world.setRoundsToWin(1);this.m_p2.dmgMultiplier=2;break;case ChallManager.ID_STAMPEDE:case ChallManager.ID_CCCOMBO:this.m_p1.perfectRound=!1;this.m_p2.perfectRound=!1;this.m_world.setRoundsToWin(1);this.m_world.players().forEach(function(a){a.dmgMultiplier=0});
break;case ChallManager.ID_ENDURE:this.m_p1.perfectRound=!1;this.m_p2.perfectRound=!1;this.m_world.setRoundsToWin(1);this.m_world.setRoundTimer(3E4);this.m_p1.dmgMultiplier=0;this.m_p2.dmgMultiplier=1E3;break;case ChallManager.ID_GIANT_BILL:this.m_world.setRoundsToWin(1);this.m_p2.setScale(1.6);break;case ChallManager.ID_JMP_DMG:this.m_world.setRoundsToWin(1);break;case ChallManager.ID_LAVA_FLOOR:case ChallManager.ID_ENMY_REGEN:case ChallManager.ID_BITE_DUST:case ChallManager.ID_SPEC_FINISH:this.m_world.setRoundsToWin(1)}};
ChallManager.prototype.onStartRound=function(){};ChallManager.prototype.onModifierEmpty=function(){switch(this.m_id){case ChallManager.ID_STAMPEDE:this.m_world.fightStopped()||(this.m_world.forceRoundFinish(),this.m_world.triggerEndSequence(1))}};ChallManager.prototype.onSpecialFinish=function(){this.m_specialFinish=!0};ChallManager.prototype.wrongWinCondition=function(){return this.m_id===ChallManager.ID_SPEC_FINISH&&!this.m_specialFinish};
ChallManager.prototype.timeoutWin=function(){switch(this.m_id){case ChallManager.ID_ENDURE:return!0;case ChallManager.ID_RUSH_HOUR:case ChallManager.ID_CCCOMBO:case ChallManager.ID_STAMPEDE:case ChallManager.ID_SPEC_FINISH:return!1;default:return null}};ChallManager.prototype.onComboCount=function(a){this.m_id===ChallManager.ID_CCCOMBO&&(a>=ChallManager.NUM_COMBO-1?this.m_world.player1().dmgMultiplier=1E3:this.m_world.player1().dmgMultiplier=0)};
ChallManager.prototype.superDamage=function(){return this.m_id===ChallManager.ID_SPECIAL_WIN?1E5:0};ChallManager.prototype.getModDamage=function(){return this.m_id===ChallManager.ID_STAMPEDE?1E5:0};ChallManager.prototype.getMPLimit=function(){return this.m_id===ChallManager.ID_SPEC_SPAM?50:1E3};
ChallManager.prototype.completeChallenge=function(){this.m_id!==ChallManager.ID_NONE&&(SavedData.instance.setBoolValue(SavedData.REG_CHALLENGES,ChallManager.NUM_CHALLENGES,this.m_id,!0),this.m_id===ChallManager.ID_SPEC_FINISH&&TrophyManager.instance.unlockCostume(DataHero.ID_GRAMMA,1))};ChallManager.allChallengesComplete=function(){for(var a=SavedData.instance.getBoolArray(SavedData.REG_CHALLENGES,ChallManager.NUM_CHALLENGES),b=1;b<a.length;b++)if(!a[b])return!1;return!0};
ChallManager.prototype.checkUnlockables=function(){for(var a=SavedData.instance.getBoolArray(SavedData.REG_CHALLENGES,ChallManager.NUM_CHALLENGES),b=0,c=1;c<a.length;c++)a[c]&&b++;b>=ChallManager.NUM_CHALLENGES&&TrophyManager.instance.trophyObtained(TrophyManager.ID_ALL_COMPLETE,TrophyManager.GOLD);10<=b&&TrophyManager.instance.unlockCostume(DataHero.ID_BILL,1);1<=b&&TrophyManager.instance.unlockCostume(DataHero.ID_REMY,1)};ChallManager.prototype.getId=function(){return this.m_id};
function TrophyManager(){TrophyManager.instance=this;this.m_trophyStates=[];this.updateStates()}TrophyManager.instance=null;TrophyManager.GOLD=3;TrophyManager.SILVER=2;TrophyManager.BRONZE=1;TrophyManager.NONE=0;TrophyManager.ID_FULL_SPECIAL=0;TrophyManager.ID_DEF_CHICKEN=1;TrophyManager.ID_TRUE_GREEN=2;TrophyManager.ID_UNTOUCHABLE=3;TrophyManager.ID_ALL_COMPLETE=4;TrophyManager.NUM_TROPHIES=5;
TrophyManager.prototype.updateStates=function(){var a,b=SavedData.instance.getBoolArray(SavedData.REG_TROPHIES,3*TrophyManager.NUM_TROPHIES);for(a=0;a<TrophyManager.NUM_TROPHIES;a++)this.m_trophyStates[a]=0;for(a=0;a<3*TrophyManager.NUM_TROPHIES;a++)this.m_trophyStates[Math.floor(a/3)]+=b[a]?1:0};TrophyManager.prototype.isOwned=function(a){return 0<this.m_trophyStates[a]};TrophyManager.prototype.getQualityOwned=function(a){return this.m_trophyStates[a]};
TrophyManager.prototype.trophyObtained=function(a,b){"undefined"===typeof b&&(b=(b=StoryManager.instance)?b.getDifficulty()+1:Global.aiMode+1);if(!(this.m_trophyStates[a]>=b||GuiGame.instance&&Global.fightSettings.isChallenge()&&a!==TrophyManager.ID_ALL_COMPLETE)){this.m_trophyStates[a]=b;for(var c=0;c<b;c++)SavedData.instance.setBoolValue(SavedData.REG_TROPHIES,3*TrophyManager.NUM_TROPHIES,3*a+c,!0);SavedData.instance.saveData();if(GuiGame.instance)GuiGame.instance.onNewTrophy("STR_REP_NEW_TROPHY_TITLE0"+
(a+1),"STR_REP_NEW_TROPHY_DESCRIPTION0"+(a+1),a);else a=new GuiMsgInfo("STR_REP_NEW_TROPHY_TITLE0"+(a+1),"STR_REP_NEW_TROPHY_DESCRIPTION0"+(a+1),a,0),this.createTrophyPopup(a)}};TrophyManager.prototype.checkAllTrophies=function(){for(var a=TrophyManager.GOLD,b=0;b<this.m_trophyStates.length-1;b++)a=Math.min(this.m_trophyStates[b],a);0<a&&this.trophyObtained(TrophyManager.ID_ALL_COMPLETE,a)};
TrophyManager.prototype.createTrophyPopup=function(a){var b=GuiManager.instance.currentScreen,c=new GuiPopupTrophy(0,0,b,a.itemId),d=c.getControl("mcGuiTxtDescription"),e=c.getControl("mcGuiTxtTitle");d.setTextLocalized(a.desc);e.setTextLocalized(a.title);b.addPopup(c)};
TrophyManager.prototype.unlockCostume=function(a,b){var c=SavedData.instance.getCostumes(a);GuiGame.instance&&!c[b]&&(SavedData.instance.unlockCostume(a,b),GuiGame.instance.onNewSkin("STR_REP_NEW_SKIN_TITLE","STR_REP_NEW_SKIN_DESCRIPTION",a))};TrophyManager.prototype.unlockChara=function(a){SavedData.instance.charaUnlocked(a)||(SavedData.instance.unlockCharacter(a),GuiGame.instance.onNewCharacter("STR_REP_NEW_CHARACTER_TITLE","STR_REP_NEW_CHARACTER_DESCRIPTION",a))};
function FighterGame(a,b,c,d){SGame.call(this,a);this.m_isPaused=!1;this.idPlayerWin=0;this.m_aiDebugText=null;this.m_aiMode=d;this.challengeMan=this.m_storyDiag=null;this.actManager=new ActionManager;FighterGame.instance=this;this.m_collisionVisible=this.finish=this.reset=!1;this.m_dataWorld=c;this.m_shaker=this.m_fightWorld=null;this.m_touchCtrlP1=new TouchControl;this.m_touchCtrlP2=new TouchControl;this.m_touchCtrlP1.callerObject=this;this.m_touchCtrlP2.callerObject=this;this.m_touchCtrlP1.onSwipeListener=
this.onSwipe;this.m_touchCtrlP2.onSwipeListener=this.onSwipe;this.m_touchCtrlP1.onTapListener=this.onTap;this.m_touchCtrlP2.onTapListener=this.onTap;this.m_touchCtrlP1.onDTapListener=this.onDoubleTap;this.m_touchCtrlP2.onDTapListener=this.onDoubleTap;this.onReset();this.m_inputHandler=new FighterInput(this.m_fightWorld);this.m_invertKeys=!1;this.modifier=this.m_tutorialPopup=this.m_effect=null}Application.subclass(FighterGame,SGame);FighterGame.MAX_DELTA=50;FighterGame.instance=null;
FighterGame.prototype.init=function(){Application.log("FighterGame");this.m_hud=new FighterHUD("mcGuiHUD")};FighterGame.prototype.hud=function(){return this.m_hud};
FighterGame.prototype.free=function(){Application.externalTrack("Game End");this.m_dataWorld="";this.world()&&(this.world().free(),this.m_world=null);this.m_effect&&(this.m_effect.free(),this.m_effect=null);this.modifier&&(this.modifier.free(),this.modifier=null);this.m_aiDebugText&&(this.canvas.removeChild(this.m_aiDebugText),this.m_aiDebugText.free(),this.m_aiDebugText=null);FighterGame.instance=null;SGame.prototype.free.call(this)};
FighterGame.prototype.onGameEnd=function(a){this.finish=!0;this.idPlayerWin=a};
FighterGame.prototype.onReset=function(){this.world()&&(this.world().free(),this.m_world=this.m_fightWorld=null);this.m_world=this.m_fightWorld=Global.fightSettings.tutorialMode?new TutorialWorld(this.canvas,this):new FighterWorld(this.canvas,this);this.challengeMan=new ChallManager(this.m_fightWorld,Global.fightSettings.challengeId);Global.battleSettings&&Global.overrideBConfig&&(this.m_fightWorld.fData=Global.battleSettings);this.world().loadData(this.m_dataWorld);this.m_shaker=new Shaker(this.canvas);
if(GuiGame.instance.isFirstFight())this.onStandardIntro();else GuiGame.instance.createCountdownFx(!1);this.m_aiMode!==AICore.MODE_NONE&&(this.fightWorld().ai=new AICore(1,this.fightWorld(),this.m_aiMode));this.reset=!1};
FighterGame.prototype.update=function(a){if(this.reset)this.onReset();else this.finish?GuiGame.instance&&(GuiEndGame.idPlayerWin=this.idPlayerWin,GuiGame.instance.gameFinished(this.idPlayerWin)):(null!==this.m_shaker&&this.m_shaker.update(a),this.m_effect&&this.m_effect.update(a),a>FighterGame.MAX_DELTA&&(a=FighterGame.MAX_DELTA),this.actManager.update(a),SGame.prototype.update.call(this,a),this.m_isPaused||(this.m_touchCtrlP1.update(a),this.m_touchCtrlP2.update(a),this.m_world.update(a),this.challengeMan.update(a)),
this.modifier&&this.modifier.update(a))};FighterGame.prototype.onShake=function(a,b,c){this.m_shaker&&(this.m_shaker.shake(a,b,c),this.m_shaker.start())};FighterGame.prototype.stopShake=function(){this.m_shaker&&this.m_shaker.stop()};FighterGame.prototype.onStart=function(){this.fightWorld().startRound();this.m_world.camera().doFollowTarget();if(this.modifier)this.modifier.onGameStart()};
FighterGame.prototype.onStandardIntro=function(){var a=GuiGame.instance;FighterHUD.instance.enablePause(!1);var b=[],c=[],d=this.fightWorld().player1(),e=this.fightWorld().player2(),f=this.fightWorld().getFloorY()-600;d.setY(f);d.setX(d.getX()-600);c.push(new CallbackAction(d,d.forceDive,800,[1.2,1.2]));if(!Global.fightSettings.bonusStage){e.setY(f);e.setX(e.getX()+600);c.push(new CallbackAction(e,e.forceDive,800,[-1.2,1.2]));var g=this.world().createEffect("aniFxIntroSpark",(d.getX()+e.getX())/2,
this.m_fightWorld.getFloorY()-50);g.setPaused(!0);g.setVisible(!1)}Global.fightSettings.tutorialMode||c.push(new CallbackAction(this,function(){FighterHUD.instance.showLetterBox(!0)},1200));c.push(new ObserverAction(d,d.isOnFloor));b.push(new ParallelAction(c));Global.fightSettings.bonusStage||Global.fightSettings.tutorialMode||!g?b.push(new CallbackAction(this,function(){},500)):(b.push(new CallbackAction(this.m_fightWorld,function(){this.player1().gotoState(FighterActor.ANIM_ST_STAND_ANG,!0);this.player2().gotoState(FighterActor.ANIM_ST_STAND_ANG,
!0);this.player1().playTaunt()},150)),b.push(new CallbackAction(g,function(a){this.setPaused(!1);a.adjustIntroSpark(this);this.setVisible(!0)},1200,[this])),b.push(new ObserverAction(this.m_fightWorld,function(){return!this.player1().voHandler().isPlayingLastVO()})),b.push(new CallbackAction(this.m_fightWorld.player2(),this.m_fightWorld.player2().playTaunt,300)),b.push(new ObserverAction(g,g.isAwaitingDelete)));Global.fightSettings.storyMode&&!Global.fightSettings.tutorialMode&&(b.push(new CallbackAction(this,
this.onInitDialog,500)),b.push(new ObserverAction(this,this.dialoguesOver)));Global.fightSettings.tutorialMode||b.push(new CallbackAction(this,function(){FighterHUD.instance.showLetterBox(!1)},700));b.push(new CallbackAction(this.m_fightWorld,function(){this.player1().meanLookEnabled=!1;this.player2().meanLookEnabled=!1;FighterHUD.instance.enablePause(!0)}));b.push(new ObserverAction(FighterHUD.instance,function(){return!this.letterBoxVisible()}));Global.aiMode!==AICore.MODE_NONE||!Global.firstMatch||
Global.fightSettings.bonusStage||Global.fightSettings.tutorialMode||(Global.firstMatch=!1,b.push(new CallbackAction(this,function(){this.m_tutorialPopup=new GuiPopupTutorial;FighterHUD.instance.canvas.addChildAt(this.m_tutorialPopup.canvas,0);FighterHUD.instance.addPopup(this.m_tutorialPopup)})),b.push(new ObserverAction(this,function(){return this.m_tutorialPopup.isFinished()?(this.m_tutorialPopup=null,!0):!1})));b.push(new CallbackAction(a,a.createCountdownFx,500,[!0]));this.actManager.addSequence(b)};
FighterGame.prototype.onInitDialog=function(){var a=Global.fightSettings.bonusStage?"STATUE":this.m_fightWorld.player2().data.id;a="STORY_DIAG_"+this.m_fightWorld.player1().data.id+"_"+a;DialogueNode.exists(a)&&(this.m_storyDiag=new GuiDialogue("mcGuiPopupDialogue"),this.m_storyDiag.onComplete(this,this.onDialogueEnd),this.m_hud.addPopup(this.m_storyDiag),this.m_storyDiag.initDialogue(a))};
FighterGame.prototype.initStatueDialogue=function(){var a=this.fightWorld().statue&&this.fightWorld().statue.isDead()?"STORY_POST_FIGHT_STAT_":"STORY_POST_FIGHT_STAT2_";a+=this.fightWorld().player1().data.id;DialogueNode.exists(a)&&(this.m_storyDiag=new GuiDialogue("mcGuiPopupDialogue"),this.m_storyDiag.onComplete(this,this.onDialogueEnd),this.m_hud.addPopup(this.m_storyDiag),this.m_storyDiag.initDialogue(a))};
FighterGame.prototype.initBossDialogue=function(){var a="STORY_DIAG_BOSS_"+this.fightWorld().player1().data.id;DialogueNode.exists(a)&&(this.m_storyDiag=new GuiDialogue("mcGuiPopupDialogue"),this.m_storyDiag.onComplete(this,this.onDialogueEnd),this.m_hud.addPopup(this.m_storyDiag),this.m_storyDiag.initDialogue(a))};FighterGame.prototype.setDialogue=function(a){this.m_storyDiag=a;this.m_hud.addPopup(this.m_storyDiag)};FighterGame.prototype.nextDialogue=function(){this.m_storyDiag&&this.m_storyDiag.next()};
FighterGame.prototype.adjustIntroSpark=function(a){var b=this.m_fightWorld.player1(),c=this.m_fightWorld.player2(),d=b.getMainCollision().h-c.getMainCollision().h;a.clip.rotation+=Math.atan2(d,c.getX()-b.getX());a.clip.y=this.m_fightWorld.getFloorY()-(b.getMainCollision().h+c.getMainCollision().h)/2+35};FighterGame.prototype.onDialogueEnd=function(){this.m_storyDiag=null};FighterGame.prototype.dialoguesOver=function(){return null===this.m_storyDiag};FighterGame.prototype.fightWorld=function(){return this.m_fightWorld};
FighterGame.prototype.createModifier=function(){if(Global.fightSettings.modEnabled)switch(Global.fightSettings.modifierId){case Modifier.ID_RACCOON:this.modifier=new RaccoonsMod(this.m_world);break;case Modifier.ID_COFFEE:this.modifier=new CoffeeMod(this.m_world);break;case Modifier.ID_MANHOLE:this.modifier=new SewerMod(this.m_world);break;case Modifier.ID_PIDGEONS:this.modifier=new PidgeonsMod(this.m_world);break;case Modifier.ID_GOATS:this.modifier=new FarmMod(this.m_world);break;case Modifier.ID_ROBOT:this.modifier=
new RobotMod(this.m_world)}};FighterGame.prototype.togglePause=function(){this.m_isPaused=!this.m_isPaused};FighterGame.prototype.killPlayer=function(a){a=this.fightWorld().players()[a];a.setInvulnerable(!1);a.onFightHit2(a.getX(),1E4)};FighterGame.prototype.isSinglePlayer=function(){return null!==this.fightWorld().ai||Global.fightSettings.storyMode};
FighterGame.prototype.onKeyDown=function(a){SGame.prototype.onKeyDown.call(this,a);this.m_inputHandler.onKeyDown(a);if(null!==this.m_storyDiag)this.m_storyDiag.onKeyDown(a);if(this.m_tutorialPopup)this.m_tutorialPopup.onKeyDown(a)};FighterGame.prototype.onKeyUp=function(a){SGame.prototype.onKeyUp.call(this,a);this.m_inputHandler.onKeyUp(a)};
FighterGame.prototype.onPointerPress=function(a,b){SGame.prototype.onPointerPress.call(this,a,b);if(a.data.global.x<=Application.APP_WIDTH/2||this.isSinglePlayer())this.m_touchCtrlP1.onPointerPress(a);else this.m_touchCtrlP2.onPointerPress(a)};FighterGame.prototype.onPointerRelease=function(a,b){SGame.prototype.onPointerRelease.call(this,a,b);this.m_touchCtrlP1.onPointerRelease(a);this.m_touchCtrlP2.onPointerRelease(a)};
FighterGame.prototype.onPointerMove=function(a,b){SGame.prototype.onPointerMove.call(this,a,b);this.m_touchCtrlP1.onPointerMove(a);this.m_touchCtrlP2.onPointerMove(a)};FighterGame.prototype.onTap=function(a){a.x<Application.APP_WIDTH/2||this.isSinglePlayer()?(this.m_inputHandler.onKeyDown(FighterInput.KEY_P1TAP),this.m_inputHandler.onKeyUp(FighterInput.KEY_P1TAP)):(this.m_inputHandler.onKeyDown(FighterInput.KEY_P2TAP),this.m_inputHandler.onKeyUp(FighterInput.KEY_P2TAP))};
FighterGame.prototype.onSwipe=function(a){if(a.x<Application.APP_WIDTH/2||this.isSinglePlayer())switch(a.direction){case TouchControl.DIR_UP:this.m_inputHandler.onKeyDown(FighterInput.KEY_P1UP);this.m_inputHandler.onKeyUp(FighterInput.KEY_P1UP);break;case TouchControl.DIR_RIGHT:this.m_inputHandler.onKeyDown(FighterInput.KEY_P1FWD);this.m_inputHandler.onKeyUp(FighterInput.KEY_P1FWD);break;case TouchControl.DIR_LEFT:this.m_inputHandler.onKeyDown(FighterInput.KEY_P1BCK);this.m_inputHandler.onKeyUp(FighterInput.KEY_P1BCK);
break;case TouchControl.DIR_DOWN:this.m_inputHandler.onKeyDown(FighterInput.KEY_P1DOWN),this.m_inputHandler.onKeyUp(FighterInput.KEY_P1DOWN)}else switch(a.direction){case TouchControl.DIR_UP:this.m_inputHandler.onKeyDown(FighterInput.KEY_P2UP);this.m_inputHandler.onKeyUp(FighterInput.KEY_P2UP);break;case TouchControl.DIR_LEFT:this.m_inputHandler.onKeyDown(FighterInput.KEY_P2FWD);this.m_inputHandler.onKeyUp(FighterInput.KEY_P2FWD);break;case TouchControl.DIR_RIGHT:this.m_inputHandler.onKeyDown(FighterInput.KEY_P2BCK);
this.m_inputHandler.onKeyUp(FighterInput.KEY_P2BCK);break;case TouchControl.DIR_DOWN:this.m_inputHandler.onKeyDown(FighterInput.KEY_P2DOWN),this.m_inputHandler.onKeyUp(FighterInput.KEY_P2DOWN)}};FighterGame.prototype.onDoubleTap=function(a){a.x<Application.APP_WIDTH/2||null!==this.fightWorld().ai?(this.m_inputHandler.onKeyDown(FighterInput.KEY_P1DTAP),this.m_inputHandler.onKeyUp(FighterInput.KEY_P1DTAP)):(this.m_inputHandler.onKeyDown(FighterInput.KEY_P2DTAP),this.m_inputHandler.onKeyUp(FighterInput.KEY_P2DTAP))};
FighterGame.prototype.toggleDebugCollision=function(){SGame.prototype.toggleDebugCollision.call(this);this.m_collisionVisible=!this.m_collisionVisible;this.world().showCollision(this.m_collisionVisible)};FighterGame.prototype.onDebugDraw=function(a){SGame.prototype.onDebugDraw.call(this,a);if(this.showDebugCollision)this.world().onDebugDraw(a)};
FighterGame.prototype.rebindPlayerParams=function(){Application.sandbox.clearGameSettings();Application.sandbox.addP1Config(this.m_fightWorld.player1(),"m_damage",0,10,1);Application.sandbox.addP1Config(this.m_fightWorld.player1(),"gravity",0,10);Application.sandbox.addP1Config(this.m_fightWorld.player1(),"maxVy",0,10);Application.sandbox.addP1Config(this.m_fightWorld.player1(),"jumpImpulse",0,5);Application.sandbox.addP1Config(this.m_fightWorld.player1(),"djumpImpulse",0,5);Application.sandbox.addP1Config(this.m_fightWorld.player1(),
"backFriction",0,10);Application.sandbox.addP1Config(this.m_fightWorld.player1(),"backSpeed",0,5);Application.sandbox.addP1Config(this.m_fightWorld.player1(),"diveSpeed",0,5);Application.sandbox.addP1Config(this.m_fightWorld.player1(),"diveAngle",0,90);Application.sandbox.addP1Config(this.m_fightWorld.player1(),"diveBar",0,50);Application.sandbox.addP1Config(this.m_fightWorld.player1(),"maxHp",0,10,1);Application.sandbox.addP2Config(this.m_fightWorld.player2(),"m_damage",0,10,1);Application.sandbox.addP2Config(this.m_fightWorld.player2(),
"gravity",0,10);Application.sandbox.addP2Config(this.m_fightWorld.player2(),"maxVy",0,10);Application.sandbox.addP2Config(this.m_fightWorld.player2(),"jumpImpulse",0,5);Application.sandbox.addP2Config(this.m_fightWorld.player2(),"djumpImpulse",0,5);Application.sandbox.addP2Config(this.m_fightWorld.player2(),"backFriction",0,10);Application.sandbox.addP2Config(this.m_fightWorld.player2(),"backSpeed",0,5);Application.sandbox.addP2Config(this.m_fightWorld.player2(),"diveSpeed",0,5);Application.sandbox.addP2Config(this.m_fightWorld.player2(),
"diveAngle",0,90);Application.sandbox.addP2Config(this.m_fightWorld.player2(),"diveBar",0,50);Application.sandbox.addP2Config(this.m_fightWorld.player2(),"maxHp",0,10,1)};FighterGame.prototype.addAIDebug=function(){this.m_aiDebugText=new window.PIXI.Text("",{fontSize:16,fontFamily:"Arial",fill:"#FF0000"});this.canvas.addChild(this.m_aiDebugText);this.m_aiDebugText.position.x=Application.APP_WIDTH;this.m_aiDebugText.position.y=150};
FighterGame.prototype.updateAIDebug=function(){var a=this.fightWorld().ai;if(null!==a){var b=""+("Difficulty:"+this.fightWorld().ai.idConfig+"\n");b+="State:"+a.getState()+"\n";b+="PrevState:"+a.getPrevState()+"\n";b=b+"Actions:\n"+a.getActionLog();this.m_aiDebugText&&(this.m_aiDebugText.text=b)}};
function TutSign(a,b,c,d,e){this.m_id=d;this.canvas=e;this.m_world=c;this.guiItem=this.clip=null;this.offset=new Vector2D(0,0);this.position=new Vector2D(a,b);this.ignoreCamera=!1;Application.instance.isMobileDevice?this.initMobile():this.initPC()}TutSign.ID_UP="b_up";TutSign.ID_DBL_UP="b_dup";TutSign.ID_DOWN="b_down";TutSign.ID_LEFT="b_left";TutSign.ID_RIGHT="b_right";TutSign.ID_SPECIAL="b_spec";TutSign.ID_SP_BAR="b_sp_bar";TutSign.ID_RECOVER="b_rec";
TutSign.prototype.initMobile=function(){var a="";switch(this.m_id){case TutSign.ID_DBL_UP:case TutSign.ID_UP:a="mcGuiTutorialsSlideUp";break;case TutSign.ID_DOWN:a="mcGuiTutorialsSlideDown";break;case TutSign.ID_LEFT:a="mcGuiTutorialsSlideLeft";break;case TutSign.ID_RIGHT:a="mcGuiTutorialsSlideRight";break;case TutSign.ID_SPECIAL:a="mcGuiTutorialsDoubletap";break;case TutSign.ID_RECOVER:a="mcGuiTutorialsRecoverTap";break;case TutSign.ID_SP_BAR:a="mcGuiTutorialArrowMp",this.ignoreCamera=!0}this.clip=
Application.instance.getAnimation(a);this.canvas.addChild(this.clip);this.updatePosition()};
TutSign.prototype.initPC=function(){var a=!1,b=null;switch(this.m_id){case TutSign.ID_SPECIAL:this.clip=Application.instance.getAnimation("gui_tutorial_key_spacebar");this.offset.x=40;this.offset.y=-40;a=!0;break;case TutSign.ID_UP:this.guiItem=new SGuiControls("mcGuiTutorialButton");b="STR_REP_TUTORIAL_BTN_JUMP_P1";break;case TutSign.ID_DBL_UP:this.guiItem=new SGuiControls("mcGuiTutorialButtonDoubleJump");b="STR_REP_TUTORIAL_BTN_JUMP_P1";break;case TutSign.ID_RECOVER:case TutSign.ID_DOWN:this.guiItem=
new SGuiControls("mcGuiTutorialButton");b="STR_REP_TUTORIAL_BTN_DIVE_P1";break;case TutSign.ID_LEFT:this.guiItem=new SGuiControls("mcGuiTutorialButton");b="STR_REP_TUTORIAL_BTN_BACK_P1";break;case TutSign.ID_RIGHT:this.guiItem=new SGuiControls("mcGuiTutorialButton");b="STR_REP_TUTORIAL_BTN_FWD_P1";break;case TutSign.ID_SP_BAR:this.clip=Application.instance.getAnimation("mcGuiTutorialArrowMp"),this.ignoreCamera=a=!0}a||(this.guiItem.parseControls(),this.guiItem.setControlText("mcGuiTxtA",b),this.guiItem.setControlText("mcGuiTxtW",
b),this.clip=this.guiItem.clip);this.canvas.addChild(this.clip);this.updatePosition()};TutSign.prototype.update=function(a){this.clip.update(a);if(this.guiItem)for(var b in this.guiItem.controls)this.guiItem.controls[b].update(a);this.updatePosition()};TutSign.prototype.updatePosition=function(){var a=this.ignoreCamera?0:1;this.clip.x=this.position.x+this.offset.x-this.m_world.camera().getX()*a;this.clip.y=this.position.y+this.offset.y-this.m_world.camera().getY()*a};
TutSign.prototype.free=function(){this.canvas.removeChild(this.clip);this.guiItem?this.guiItem.free():this.clip.free();this.canvas=this.clip=this.guiItem=null};function TutorialWorld(a,b,c){FighterWorld.call(this,a,b,c);this.fData.iniDistance=300;this.m_tutorialMan=null;this.m_ignoreTimer=!0;FighterHUD.instance.disableTimer()}Application.subclass(TutorialWorld,FighterWorld);TutorialWorld.prototype.loadData=function(a){FighterWorld.prototype.loadData.call(this,a);this.m_tutorialMan=new TutManager(this)};
TutorialWorld.prototype.update=function(a){FighterWorld.prototype.update.call(this,a);this.m_tutorialMan&&this.m_tutorialMan.update(a)};TutorialWorld.prototype.startRound=function(){this.m_started=!0;this.m_tutorialMan.start()};
TutorialWorld.prototype.triggerEndSequence=function(a){var b=[];if(null!==a){this.m_roundsLeft[a]--;var c=this.players()[a],d=this.players()[(a+1)%2];c=new ObserverAction({w:c,l:d},function(){return this.w.isOnFloor()&&0===this.w.speed().x&&(!this.l.isDefeated()||this.l.clip().m_stopped)});b.push(c)}c=new CallbackAction(this,function(){this.m_fadeFx=Application.instance.effectManager.createEffect("gui_hud_fade_in",0,0,Application.instance.canvas);this.m_fadeFx.onComplete(this,function(){Application.instance.effectManager.createEffect("gui_hud_fade_out",
0,0,Application.instance.canvas).setPaused(!0);this.m_fadeFx=null})},300);b.push(c);b.push(new ObserverAction(this,function(){return null===this.m_fadeFx}));c=new CallbackAction(this,this.updateRoundsHUD,250,[a]);b.push(c);a=new CallbackAction(this,this.roundRestart,100,[null===a]);b.push(a);this.actionManager.addSequence(b)};
TutorialWorld.prototype.resetPositions=function(a,b){var c=[];this.players().forEach(function(a){a.addHP(a.maxHp);a.addMP(-100)});var d=new CallbackAction(this,function(){this.m_fadeFx=Application.instance.effectManager.createEffect("gui_hud_fade_in",0,0,Application.instance.canvas);this.m_fadeFx.onComplete(this,function(){this.m_fadeFx=Application.instance.effectManager.createEffect("gui_hud_fade_out",0,0,Application.instance.canvas);this.player1().setPosition(.5*this.width()-this.fData.iniDistance/
2,this.getFloorY());this.player2().setPosition(.5*this.width()+this.fData.iniDistance/2,this.getFloorY());this.m_fadeFx.onComplete(this,function(){this.m_fadeFx=null})})},250);c.push(d);c.push(new ObserverAction(this,this.transitionsOver));a&&b&&c.push(new CallbackAction(a,b,250));this.actionManager.addSequence(c)};TutorialWorld.prototype.transitionsOver=function(){return null===this.m_fadeFx};
function TutManager(a){TutManager.instance=this;this.m_world=a;this.m_phase=null;this.m_currPhaseIndex=0;this.m_phOrder=[TutManager.PH_SJUMP,TutManager.PH_DJUMP,TutManager.PH_EVADE,TutManager.PH_SPECIAL];this.toNextPhase()}TutManager.instance=null;TutManager.PH_SJUMP="ph_sjump";TutManager.PH_DJUMP="ph_djump";TutManager.PH_EVADE="ph_evade";TutManager.PH_SPECIAL="ph_special";
TutManager.getTutorialPhase=function(a,b){switch(a){case TutManager.PH_SJUMP:return new TutPhaseSJump(b);case TutManager.PH_DJUMP:return new TutPhaseDJump(b);case TutManager.PH_EVADE:return new TutPhaseGround(b);case TutManager.PH_SPECIAL:return new TutPhaseSpecial(b);default:return new TutPhase(b)}};TutManager.prototype.start=function(){this.m_phase&&this.m_phase.start()};
TutManager.prototype.update=function(a){null!==this.m_phase&&this.m_world.transitionsOver()&&(this.m_phase.update(a),this.m_phase.isFinished()&&this.toNextPhase(!0))};
TutManager.prototype.toNextPhase=function(a){this.m_currPhaseIndex>=this.m_phOrder.length?(this.m_world.setRoundsToWin(1),this.m_world.triggerEndSequence(0),SavedData.instance.completeTutorial(),this.m_phase=null):(this.m_phase=TutManager.getTutorialPhase(this.m_phOrder[this.m_currPhaseIndex],this.m_world),a&&this.m_world.resetPositions(this,this.start),this.m_currPhaseIndex++)};
function TutPhase(a){this.m_world=a;this.m_p1=a.player1();this.m_p2=a.player2();this.m_state=TutPhase.ST_ZERO;this.m_dialogue=null;this.m_unlockIds=[];this.m_currLock=0;this.started=!1;this.sign=null}TutPhase.ST_ZERO="st_zero";TutPhase.ST_DIAL_BLOCK="st_dblock";TutPhase.ST_FINISHED="st_finished";
TutPhase.prototype.start=function(){this.started=!0;this.m_p1.blockAllKeys(!0);this.m_p2.blockAllKeys(!0);this.m_p1.setEnabled(!0);this.m_dialogue=new GuiDialogue("mcGuiPopupDialogue");this.m_dialogue.onComplete(this,this.onDialogueComplete);FighterGame.instance.setDialogue(this.m_dialogue)};TutPhase.prototype.update=function(a){this.sign&&this.sign.update(a)};TutPhase.prototype.advanceCondition=function(){switch(this.m_state){case TutPhase.ST_DIAL_BLOCK:return this.dialogueUnlock();default:return!1}};
TutPhase.prototype.dialogueUnlock=function(){return null===this.m_dialogue||null===this.m_dialogue.dialogue||this.m_unlockIds.length<=this.m_currLock?!1:this.m_unlockIds[this.m_currLock]===this.m_dialogue.dialogue.idDialogue};TutPhase.prototype.onDialogueComplete=function(){this.m_dialogue=null};TutPhase.prototype.initDialogue=function(a){this.m_dialogue.initDialogue(a+(Application.instance.isMobileDevice?"":"_PC"))};
TutPhase.prototype.end=function(){this.m_world.players().forEach(function(a){a.setEnabled(!1)});this.clearSign()};TutPhase.prototype.isFinished=function(){return this.m_state===TutPhase.ST_FINISHED};TutPhase.prototype.createSign=function(a,b,c,d){d="undefined"===typeof d?this.m_world.objectCanvas():d;this.clearSign();this.sign=new TutSign(a,b,this.m_world,c,d)};TutPhase.prototype.clearSign=function(){this.sign&&(this.sign.free(),this.sign=null)};
function TutPhaseSJump(a){TutPhase.call(this,a);a.fData.iniDistance*=.9;this.m_state=TutPhase.ST_DIAL_BLOCK;this.m_unlockIds=[2]}Application.subclass(TutPhaseSJump,TutPhase);TutPhaseSJump.ST_JUMP="st_waitjump";TutPhaseSJump.ST_DIVE="st_waitDive";TutPhaseSJump.ST_HIT="st_waitHit";TutPhaseSJump.prototype.start=function(){TutPhase.prototype.start.call(this);this.initDialogue("TUTO_DIALOG_1")};
TutPhaseSJump.prototype.update=function(a){TutPhase.prototype.update.call(this,a);this.m_p1.isJumping()&&this.m_p1.blockKeys([FighterActor.KEY_JMP],!0);if(this.advanceCondition()&&this.started)switch(this.m_state){case TutPhase.ST_DIAL_BLOCK:this.m_p1.blockKeys([FighterActor.KEY_JMP],!1);this.m_state=TutPhaseSJump.ST_JUMP;this.createSign(this.m_p1.getX()+150,this.m_world.getFloorY()-200,TutSign.ID_UP);this.m_currLock++;break;case TutPhaseSJump.ST_JUMP:this.m_p1.blockAllKeys(!0);this.m_p1.blockKeys([FighterActor.KEY_ATK],
!1);this.m_world.actorManager().freezeActors(!0);this.m_dialogue.next();this.m_state=TutPhaseSJump.ST_DIVE;this.createSign(this.m_p1.getX()+150,this.m_p1.getY(),TutSign.ID_DOWN);break;case TutPhaseSJump.ST_DIVE:this.m_world.actorManager().freezeActors(!1);this.m_state=TutPhaseSJump.ST_HIT;this.clearSign();break;case TutPhaseSJump.ST_HIT:this.m_dialogue.next(),this.m_world.players().forEach(function(a){a.setEnabled(!1)}),this.m_state=TutPhase.ST_DIAL_BLOCK,this.m_world.actionManager.addCallback(this,
function(){this.m_dialogue.next()},1750)}};TutPhaseSJump.prototype.advanceCondition=function(){var a=TutPhase.prototype.advanceCondition.call(this);switch(this.m_state){case TutPhaseSJump.ST_JUMP:return a||this.m_p1.getY()<this.m_world.getFloorY()-300;case TutPhaseSJump.ST_DIVE:return a||this.m_p1.getMState()===FighterActor.ST_DIVE;case TutPhaseSJump.ST_HIT:return a||this.m_p1.isOnFloor();default:return a||!1}};
TutPhaseSJump.prototype.onDialogueComplete=function(){TutPhase.prototype.onDialogueComplete.call(this);this.end();this.m_state=TutPhase.ST_FINISHED};function TutPhaseDJump(a){TutPhase.call(this,a);this.m_state=TutPhase.ST_DIAL_BLOCK;this.m_unlockIds=[2];this.m_dive=this.m_doubleJump=!1;a.fData.iniDistance=500}Application.subclass(TutPhaseDJump,TutPhase);TutPhaseDJump.ST_JUMP="st_waitjump";TutPhaseDJump.ST_DIVE="st_waitDive";TutPhaseDJump.ST_SPECIAL="st_waitSpec";TutPhaseDJump.ST_HIT="st_waitHit";
TutPhaseDJump.prototype.start=function(){TutPhase.prototype.start.call(this);this.initDialogue("TUTO_DIALOG_2")};
TutPhaseDJump.prototype.update=function(a){TutPhase.prototype.update.call(this,a);switch(this.m_state){case TutPhaseDJump.ST_JUMP:this.m_p1.onDoubleJump()&&(this.m_doubleJump=!0);break;case TutPhaseDJump.ST_DIVE:this.m_p1.getMState()===FighterActor.ST_DIVE&&(this.m_dive=!0)}if(this.advanceCondition())switch(this.m_state){case TutPhase.ST_DIAL_BLOCK:this.m_p1.blockKeys([FighterActor.KEY_JMP],!1);this.m_state=TutPhaseDJump.ST_JUMP;this.m_currLock++;this.createSign(this.m_p1.getX()+150,this.m_world.getFloorY()-
200,TutSign.ID_DBL_UP);break;case TutPhaseDJump.ST_JUMP:this.m_p1.blockKeys([FighterActor.KEY_ATK],!1);this.m_dialogue.next();this.m_state=TutPhaseDJump.ST_DIVE;this.clearSign();break;case TutPhaseDJump.ST_DIVE:this.m_p1.blockAllKeys(!0);this.m_p2.getHP()<this.m_p2.maxHp?(this.m_dialogue.toIndex(this.m_dialogue.dialogue.idDialogue+2),this.m_state=TutPhaseDJump.ST_SPECIAL,a=FighterHUD.instance.getHPBarPos(0),this.createSign(a.x+10,a.y+98,TutSign.ID_SP_BAR,FighterHUD.instance.canvas),this.m_world.actionManager.addCallback(this,
function(){this.m_dialogue.next()},3250)):(this.m_dialogue.next(),this.m_dive=!1,a=new CallbackAction(this,function(){this.m_world.resetPositions(this,function(){this.m_p1.blockKeys([FighterActor.KEY_ATK,FighterActor.KEY_JMP],!1);this.m_dialogue.toIndex(this.m_dialogue.dialogue.idDialogue-1)})},1500),this.m_world.actionManager.addAction(a));break;case TutPhaseDJump.ST_SPECIAL:this.m_dialogue.next(),this.clearSign(),this.m_world.players().forEach(function(a){a.setEnabled(!1)}),this.m_state=TutPhase.ST_DIAL_BLOCK}};
TutPhaseDJump.prototype.advanceCondition=function(){var a=TutPhase.prototype.advanceCondition.call(this);switch(this.m_state){case TutPhaseDJump.ST_JUMP:return a||this.m_p1.isOnFloor()&&this.m_doubleJump;case TutPhaseDJump.ST_DIVE:return a||this.m_p1.isOnFloor()&&this.m_dive;default:return a||!1}};TutPhaseDJump.prototype.onDialogueComplete=function(){TutPhase.prototype.onDialogueComplete.call(this);this.end();this.m_state=TutPhase.ST_FINISHED};
function TutPhaseGround(a){TutPhase.call(this,a);this.m_state=TutPhaseGround.ST_MOCK_EVADE;this.m_unlockIds=[];this.m_p1Backdash=!1;a.fData.iniDistance=210}Application.subclass(TutPhaseGround,TutPhase);TutPhaseGround.ST_MOCK_EVADE="st_mock_evd";TutPhaseGround.ST_JUMP="st_waitjump";TutPhaseGround.ST_AWAIT_ATK="st_waitDive";TutPhaseGround.ST_PRE_EVADE="st_pre_evade";TutPhaseGround.ST_POS_EVADE="st_pos_evade";TutPhaseGround.ST_HIT="st_waitHit";
TutPhaseGround.prototype.start=function(){TutPhase.prototype.start.call(this);this.initDialogue("TUTO_DIALOG_3");FighterGame.instance.fightWorld().ai&&FighterGame.instance.fightWorld().ai.disable(!0);this.m_p1.blockKeys([FighterActor.KEY_EVD],!1);this.createSign(this.m_p1.getX(),this.m_world.getFloorY()-200,TutSign.ID_LEFT)};
TutPhaseGround.prototype.update=function(a){TutPhase.prototype.update.call(this,a);switch(this.m_state){case TutPhaseGround.ST_MOCK_EVADE:this.m_p1.getMState()!==FighterActor.ST_BDASH||this.m_p1Backdash||(this.m_p1Backdash=!0,this.m_p1.blockAllKeys(!0))}if(this.advanceCondition())switch(this.m_state){case TutPhaseGround.ST_MOCK_EVADE:this.m_p2.blockKeys([FighterActor.KEY_JMP,FighterActor.KEY_ATK],!1);this.triggerAIAttack();this.m_p1.blockKeys([FighterActor.KEY_EVD],!0);this.m_state=TutPhaseGround.ST_AWAIT_ATK;
this.m_dialogue.next();this.clearSign();break;case TutPhaseGround.ST_AWAIT_ATK:this.m_p1.blockKeys([FighterActor.KEY_EVD],!1);this.m_state=TutPhaseGround.ST_PRE_EVADE;this.m_world.actorManager().freezeActors(!0);this.createSign(this.m_p1.getX()+75,this.m_world.getFloorY()-200,TutSign.ID_LEFT);break;case TutPhaseGround.ST_PRE_EVADE:this.m_world.actorManager().freezeActors(!1);this.m_state=TutPhaseGround.ST_POS_EVADE;this.clearSign();break;case TutPhaseGround.ST_POS_EVADE:this.m_p1.getHP()<this.m_p1.maxHp?
(this.m_world.fData.iniDistance=400,this.m_state=TutPhase.ST_ZERO,this.m_p1.blockAllKeys(!0),this.m_dialogue.next(),a=new CallbackAction(this,function(){this.m_world.resetPositions(this,function(){this.m_dialogue.toIndex(this.m_dialogue.dialogue.idDialogue-1);this.m_state=TutPhaseGround.ST_AWAIT_ATK;this.triggerAIAttack()})},1500),this.m_world.actionManager.addAction(a)):(this.m_p1.blockAllKeys(!0),this.m_p2.blockAllKeys(!0),this.m_dialogue.toIndex(this.m_dialogue.dialogue.idDialogue+2),this.m_state=
TutPhaseGround.ST_HIT,this.m_p1.blockKeys([FighterActor.KEY_PUNCH],!1),this.createSign(this.m_p1.getX()+75,this.m_world.getFloorY()-200,TutSign.ID_RIGHT));break;case TutPhaseGround.ST_HIT:this.m_dialogue.next(),this.m_p1.blockAllKeys(!0),this.clearSign()}};
TutPhaseGround.prototype.advanceCondition=function(){var a=TutPhase.prototype.advanceCondition.call(this);switch(this.m_state){case TutPhaseGround.ST_MOCK_EVADE:return a||0===this.m_p1.speed().x&&this.m_p1Backdash;case TutPhaseGround.ST_AWAIT_ATK:return a||200>this.m_p2.getX()-this.m_p1.getX();case TutPhaseGround.ST_PRE_EVADE:return a||this.m_p1.getMState()===FighterActor.ST_BDASH;case TutPhaseGround.ST_POS_EVADE:return a||this.m_p2.isOnFloor();case TutPhaseGround.ST_HIT:return a||this.m_p2.getHP()<
this.m_p2.maxHp&&0===this.m_p1.speed().x;default:return a}};TutPhaseGround.prototype.onDialogueComplete=function(){TutPhase.prototype.onDialogueComplete.call(this);this.end();this.m_state=TutPhase.ST_FINISHED};
TutPhaseGround.prototype.triggerAIAttack=function(){var a=new CallbackAction(this.m_p2,this.m_p2.onJump,2E3),b=new CallbackAction(this.m_p2,this.m_p2.onJump,350),c=new CallbackAction(this,function(){},150),d=new ObserverAction(this.m_p2,function(){return 0<=this.speed().y}),e=new CallbackAction(this.m_p2,this.m_p2.onDive);this.m_world.actionManager.addSequence([a,b,c,d,e])};
function TutPhaseSpecial(a){TutPhase.call(this,a);this.m_state=TutPhaseSpecial.ST_THROW_SP;this.m_unlockIds=[3,5];a.fData.iniDistance=600}Application.subclass(TutPhaseSpecial,TutPhase);TutPhaseSpecial.ST_THROW_SP="st_thr_sp";TutPhaseSpecial.ST_RECEIVE_SP="st_rec_sp";TutPhaseSpecial.ST_RECOVER="st_recover";
TutPhaseSpecial.prototype.start=function(){TutPhase.prototype.start.call(this);this.initDialogue("TUTO_DIALOG_4");FighterGame.instance.fightWorld().ai&&FighterGame.instance.fightWorld().ai.disable(!0);this.m_p1.blockKeys([FighterActor.KEY_BOTH],!1);this.m_p1.addMP(50);this.m_p2.addMP(100);this.createSign(this.m_p1.getX()+160,this.m_world.getFloorY()-150,TutSign.ID_SPECIAL)};
TutPhaseSpecial.prototype.update=function(a){TutPhase.prototype.update.call(this,a);if(this.advanceCondition())switch(this.m_state){case TutPhase.ST_DIAL_BLOCK:0===this.m_currLock&&(this.m_p2.blockKeys([FighterActor.KEY_BOTH],!1),this.m_world.actionManager.addCallback(this.m_p2,this.m_p2.onSuper,2E3),this.m_state=TutPhaseSpecial.ST_RECEIVE_SP);break;case TutPhaseSpecial.ST_THROW_SP:this.m_p1.blockAllKeys(!0);this.m_state=TutPhase.ST_DIAL_BLOCK;this.m_dialogue.next();this.clearSign();break;case TutPhaseSpecial.ST_RECEIVE_SP:this.m_p1.blockAllKeys(!1);
this.m_state=TutPhaseSpecial.ST_RECOVER;this.m_dialogue.next();this.createSign(this.m_p1.getX()+160,this.m_world.getFloorY()-150,TutSign.ID_RECOVER);break;case TutPhaseSpecial.ST_RECOVER:this.m_p1.blockAllKeys(!0),this.m_dialogue.next(),this.m_state=TutPhase.ST_DIAL_BLOCK,this.clearSign(),this.m_world.actionManager.addCallback(this,function(){this.m_dialogue.next()},2700)}};
TutPhaseSpecial.prototype.advanceCondition=function(){var a=TutPhase.prototype.advanceCondition.call(this);switch(this.m_state){case TutPhaseSpecial.ST_THROW_SP:return a||this.m_p2.getHP()<this.m_p2.maxHp&&this.m_p2.isOnFloor();case TutPhaseSpecial.ST_RECEIVE_SP:return a||this.m_p1.getMState()===FighterActor.ST_DOWN;case TutPhaseSpecial.ST_RECOVER:return a||this.m_p1.getMState()===FighterActor.ST_NORMAL;default:return a}};
TutPhaseSpecial.prototype.onDialogueComplete=function(){TutPhase.prototype.onDialogueComplete.call(this);this.end();this.m_state=TutPhase.ST_FINISHED};
function DialogueCharacter(a){this.m_posXIn=this.m_posXOut=this.m_posYOut=this.m_posY=this.state=this.side=0;this.m_nameClipToChange=this.m_nameClip="";this.clip=this.m_animation=null;this.side=a;this.state=DialogueCharacter.ST_NONE;this.m_posY=655;this.m_posYOut=635;this.m_posXOut=this.side===DialogueContent.SIDE_LEFT?0-DialogueCharacter.OFFSET_OUT:DialogueCharacter.SCREEN_WIDTH+DialogueCharacter.OFFSET_OUT;this.m_posXIn=this.side===DialogueContent.SIDE_LEFT?0+DialogueCharacter.OFFSET_IN:DialogueCharacter.SCREEN_WIDTH-
DialogueCharacter.OFFSET_IN;this.clip=Application.instance.addDisplayContainer();this.clip.x=this.side===DialogueContent.SIDE_LEFT?this.m_posXIn:this.m_posXOut;this.clip.y=this.side===DialogueContent.SIDE_LEFT?this.m_posY:this.m_posYOut}DialogueCharacter.ST_NONE=0;DialogueCharacter.ST_INTRO=1;DialogueCharacter.ST_WAIT=2;DialogueCharacter.ST_OUTRO=3;DialogueCharacter.ST_HIDE=4;DialogueCharacter.ST_SHOW=5;DialogueCharacter.OFFSET_OUT=-300;DialogueCharacter.OFFSET_IN=220;DialogueCharacter.SPEED=.65;
DialogueCharacter.ALPHA_SPEED=.01;DialogueCharacter.SCREEN_WIDTH=1024;DialogueCharacter.prototype.setClip=function(a){this.m_nameClip!==a&&(""===this.m_nameClip?(this.m_nameClip=a,this.changeClip(this.m_nameClip),this.intro()):this.m_nameClip!==a&&(this.m_nameClipToChange=a,this.outro()))};DialogueCharacter.prototype.changeClip=function(a){this.m_animation&&(this.clip.removeChild(this.m_animation),this.m_animation.free(),this.m_animation=null);this.m_animation=Application.instance.getClip(a);this.clip.addChild(this.m_animation)};
DialogueCharacter.prototype.intro=function(){this.m_animation.visible=!0;this.state=DialogueCharacter.ST_INTRO};DialogueCharacter.prototype.outro=function(){this.m_animation&&(this.m_animation.visible=!1);this.state=DialogueCharacter.ST_OUTRO};
DialogueCharacter.prototype.update=function(a){switch(this.state){case DialogueCharacter.ST_HIDE:this.clip.alpha-=DialogueCharacter.ALPHA_SPEED*a;0>=this.clip.alpha&&(this.clip.alpha=0,this.state=DialogueCharacter.ST_WAIT);break;case DialogueCharacter.ST_SHOW:this.clip.alpha+=DialogueCharacter.ALPHA_SPEED*a,1<=this.clip.alpha&&(this.clip.alpha=1,this.state=DialogueCharacter.ST_WAIT)}};DialogueCharacter.prototype.hide=function(){""!==this.m_nameClip&&(this.state=DialogueCharacter.ST_HIDE)};
DialogueCharacter.prototype.show=function(){""!==this.m_nameClip&&(this.state=DialogueCharacter.ST_SHOW)};DialogueCharacter.prototype.free=function(){null!==this.m_animation&&(this.clip.removeChild(this.m_animation),this.m_animation.free(),this.m_animation=null);this.clip=null};
function DialogueContent(a){this.clip=this.guiParent=this.currentNode=null;this.idDialogue=1;this.m_characterRight=this.m_characterLeft=null;this.m_lastSide=0;this.m_dialogueNodes=null;this.m_currNode=-1;this.m_maxDialog=0;this.clip=Application.instance.addDisplayContainer();this.guiParent=a;this.m_dialogueNodes=this.guiParent.dialogueNodes;this.m_maxDialog=this.m_dialogueNodes.length;this.m_characterLeft=new DialogueCharacter(DialogueContent.SIDE_LEFT);this.m_characterRight=new DialogueCharacter(DialogueContent.SIDE_RIGHT);
this.clip.addChild(this.m_characterLeft.clip);this.clip.addChild(this.m_characterRight.clip)}DialogueContent.SIDE_LEFT=1;DialogueContent.SIDE_RIGHT=2;DialogueContent.prototype.update=function(a){this.m_characterLeft.update(a);this.m_characterRight.update(a)};DialogueContent.prototype.skip=function(){this.m_characterLeft.outro();this.guiParent.showNameLeft("");this.m_characterRight.outro();this.guiParent.showNameRight("");this.guiParent.clearInfo();this.guiParent.onResumeScreen()};
DialogueContent.prototype.goToIndex=function(a){a--;0>a||a>this.m_dialogueNodes.length||(this.m_currNode=a,this.m_dialogueNodes.length<=this.m_currNode?(this.m_characterLeft.outro(),this.guiParent.showNameLeft(""),this.m_characterRight.outro(),this.guiParent.showNameRight(""),this.guiParent.clearInfo(),this.guiParent.onResumeScreen()):(this.currentNode=this.m_dialogueNodes[this.m_currNode],this.idDialogue=this.m_currNode+1,this.currentNode.side==DialogueContent.SIDE_LEFT?(this.m_characterLeft.clip.alpha=
"-"===this.currentNode.clip?0:1,"-"!==this.currentNode.clip&&(this.m_characterLeft.setClip(this.currentNode.clip),this.m_characterLeft.show()),this.m_characterRight.hide(),this.guiParent.showNameLeft(this.currentNode.strTitle,this.m_lastSide!=this.currentNode.side),this.guiParent.showNameRight("")):(this.m_characterRight.clip.alpha="-"===this.currentNode.clip?0:1,"-"!==this.currentNode.clip&&(this.m_characterRight.setClip(this.currentNode.clip),this.m_characterRight.show()),this.m_characterLeft.hide(),
this.guiParent.showNameLeft(""),this.guiParent.showNameRight(this.currentNode.strTitle,this.m_lastSide!=this.currentNode.side)),this.m_lastSide=this.currentNode.side,this.guiParent.setInfo(this.currentNode.str,this.currentNode.side)))};DialogueContent.prototype.next=function(){this.goToIndex(this.m_currNode+2)};DialogueContent.prototype.free=function(){this.m_characterLeft.free();this.m_characterLeft=null;this.m_characterRight.free();this.m_dialogueNodes=this.m_characterRight=null};
function DialogueNode(){this.clip=this.strTitle=this.str="";this.side=0;this.pressButton=!1}DialogueNode.ALIGN_LEFT=1;DialogueNode.ALIGN_RIGTH=2;DialogueNode.getDialogueNodes=function(a){var b=[],c=window.dialogues.content,d;for(d in c)if(c[d].id.toUpperCase()==a.toUpperCase()){var e=new DialogueNode;e.str=c[d].string.toUpperCase();e.strTitle=c[d].title.toUpperCase();e.clip=c[d].clip.toLowerCase();e.side=parseInt(c[d].side,10);e.pressButton=!!parseInt(c[d].pressButton,10);b.push(e)}return b};
DialogueNode.exists=function(a){var b=window.dialogues.content,c;for(c in b)if(b[c].id.toUpperCase()==a.toUpperCase())return!0;return!1};
function GuiDialogue(a,b,c,d){SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.dialogueNodes=this.dialogue=null;this.delayNext=99999;this.sideDialogue=0;this.m_callback=this.m_caller=this.callbackClose=this.m_currentNode=null;this.getControl("mcGuiTxtName01").setTextEmpty();this.getControl("mcGuiTxtName02").setTextEmpty();this.getControl("mcGuiBtnNext").setVisible(!1);GuiDialogue.instance=this;this.canvas.hitArea=null}Application.subclass(GuiDialogue,SScreen);GuiDialogue.FRAME_STOP_TITLE=3;
GuiDialogue.DELAY_TIME_NEXT=400;GuiDialogue.SPEED_APPEAR_INFO=.0015;GuiDialogue.instance=null;GuiDialogue.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);switch(a.name){case "mcGuiBtnCancel":this.delayNext=99999;this.dialogue.skip();break;case "mcGuiBtnNext":0>=this.delayNext&&(this.delayNext=GuiDialogue.DELAY_TIME_NEXT,this.next(),this.getControl("mcGuiBtnNext").setVisible(!1))}};GuiDialogue.prototype.next=function(){this.dialogue.next();this.m_currentNode=this.dialogue.currentNode};
GuiDialogue.prototype.toIndex=function(a){this.dialogue.goToIndex(a);this.m_currentNode=this.dialogue.currentNode};GuiDialogue.prototype.initDialogue=function(a){a.split("_");this.dialogueNodes=DialogueNode.getDialogueNodes(a);this.clearInfo()};GuiDialogue.prototype.onComplete=function(a,b){this.m_caller=a;this.m_callback=b};
GuiDialogue.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.delayNext=GuiDialogue.DELAY_TIME_NEXT;this.dialogue=new DialogueContent(this);this.getControl("mcGuiCharacters").canvas.addChild(this.dialogue.clip);this.next();this.activePressBar()};GuiDialogue.prototype.onKeyDown=function(a){SScreen.prototype.onKeyDown.call(this,a)};
GuiDialogue.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);this.m_caller&&this.m_callback&&this.m_callback.call(this.m_caller);this.screenParent&&(this.delayNext=99999,this.screenParent.dropPopup())};GuiDialogue.prototype.onPressSpaceBar=function(){0>=this.delayNext&&this.dialogue.currentNode.pressButton&&(SScreen.prototype.onPressSpaceBar.call(this),this.delayNext=GuiDialogue.DELAY_TIME_NEXT,this.next(),this.getControl("mcGuiBtnNext").setVisible(!1))};
GuiDialogue.prototype.setInfo=function(a,b){this.clearInfo();this.sideDialogue=b;this.getControl("mcGuiTxtInfo01").setTextLocalized(a);this.getControl("mcGuiTxtInfo01").textfield.alpha=0;this.getControl("mcGuiTxtInfo02").setTextLocalized(a);this.getControl("mcGuiTxtInfo02").textfield.alpha=0};GuiDialogue.prototype.clearInfo=function(){this.getControl("mcGuiTxtInfo02").setTextEmpty();this.getControl("mcGuiTxtInfo01").setTextEmpty()};
GuiDialogue.prototype.showNameLeft=function(a,b){b="undefined"!==typeof b?b:!1;""===a?1<this.getControl("mcGuiTextNameBase01").clip.currentFrame&&(this.getControl("mcGuiTextNameBase01").clip.gotoAndPlay(GuiDialogue.FRAME_STOP_TITLE+1),this.getControl("mcGuiTxtName01").setTextEmpty()):(this.getControl("mcGuiTextNameBase01").setClip("gui_popup_name_base_dialogue"),"-"===a?this.getControl("mcGuiTxtName01").setTextEmpty():(this.getControl("mcGuiTxtName01").setTextLocalized(a),b?this.getControl("mcGuiTextNameBase01").clip.gotoAndPlay(2):
this.getControl("mcGuiTextNameBase01").clip.gotoAndStop(GuiDialogue.FRAME_STOP_TITLE)))};
GuiDialogue.prototype.showNameRight=function(a,b){b="undefined"!==typeof b?b:!1;""===a?1<this.getControl("mcGuiTextNameBase02").clip.currentFrame&&(this.getControl("mcGuiTextNameBase02").clip.gotoAndPlay(GuiDialogue.FRAME_STOP_TITLE+1),this.getControl("mcGuiTxtName02").setTextEmpty()):(this.getControl("mcGuiTextNameBase02").setClip("gui_popup_name_base_dialogue"),"-"===a?this.getControl("mcGuiTxtName02").setTextEmpty():(this.getControl("mcGuiTxtName02").setTextLocalized(a),b?this.getControl("mcGuiTextNameBase02").clip.gotoAndPlay(2):
this.getControl("mcGuiTextNameBase02").clip.gotoAndStop(GuiDialogue.FRAME_STOP_TITLE)))};
GuiDialogue.prototype.update=function(a){this.dialogue&&this.dialogue.update(a);null!==this.m_currentNode&&0<this.delayNext&&this.m_currentNode.pressButton&&(this.delayNext-=a,0>=this.delayNext&&(this.activePressBar(),this.getControl("mcGuiBtnNext").setVisible(this.m_currentNode.pressButton)));switch(this.sideDialogue){case DialogueContent.SIDE_RIGHT:this.getControl("mcGuiTxtInfo01").textfield.alpha+=GuiDialogue.SPEED_APPEAR_INFO*a;break;case DialogueContent.SIDE_LEFT:this.getControl("mcGuiTxtInfo02").textfield.alpha+=
GuiDialogue.SPEED_APPEAR_INFO*a}SScreen.prototype.update.call(this,a)};GuiDialogue.prototype.free=function(){GuiDialogue.instance=null;SScreen.prototype.free.call(this)};function Lagger(){this.m_enabled=!1;this.m_skippedUpdates=this.m_dtCount=this.m_averageDt=this.m_dt=0;this.m_updatesToSkip=1;Application.USE_CHEATS||(this.m_enabled=!1)}Lagger.prototype.free=function(){};
Lagger.prototype.update=function(a){this.m_averageDt+=a;this.m_dtCount++;this.m_enabled?(this.m_dt+=a,this.m_skippedUpdates<this.m_updatesToSkip?this.m_skippedUpdates++:this.m_skippedUpdates=0):this.m_dt=a};Lagger.prototype.setUpdatesToSkip=function(a){this.m_updatesToSkip=a};Lagger.prototype.setEnable=function(a){this.m_enabled=a};Lagger.prototype.averageDt=function(){return~~(this.m_averageDt/this.m_dtCount)};
Lagger.prototype.skipUpdate=function(){return this.m_enabled&&0!==this.m_skippedUpdates?!0:!1};Lagger.prototype.dt=function(){return this.m_dt};
function ComboCounter(a){this.fromLeft=a<Application.APP_WIDTH;this.canvas=FighterHUD.instance.getControl(this.fromLeft?"mcGuiHitCount01":"mcGuiHitCount02").canvas;this.gui=new SScreen(this.fromLeft?"mcGuiMessageHit01":"mcGuiMessageHit02",0,0);this.gui.clip.visible=!1;this.canvas.addChild(this.gui.clip);this.state=this.combo=this.time=0;this.timeDelay=Application.config.challValues.comboHitStandTime;this.timeCooldown=Application.config.challValues.comboHitVanishTime;this.guiFirst=new SScreen(this.fromLeft?
"mcGuiMessageFirtsHit01":"mcGuiMessageFirtsHit02",0,0);this.guiFirst.clip.visible=!1;this.canvas.addChild(this.guiFirst.clip)}ComboCounter.TIME_DELAY=1E3;ComboCounter.TIME_COOLDOWN=2500;ComboCounter.ST_NONE=0;ComboCounter.ST_DELAY=1;ComboCounter.ST_COOLDOWN=2;
ComboCounter.prototype.count=function(){if(!Global.fightSettings.bonusStage)if(this.combo++,this.gui.clip.visible=!1,2>this.combo)FighterHUD.instance.firstHitDone||(FighterHUD.instance.firstHitDone=!0,this.guiFirst.clip.visible=!0,this.guiFirst.clip.gotoAndPlay(1));else if(this.guiFirst.clip.visible=!1,this.gui.clip.visible=!0,this.gui.getControl("mcGuiTextMessage111").setTextReplace("STR_MESSAGE_HIT_NUMBER","#",this.combo),this.gui.getControl("mcGuiTextMessage11").setTextReplace("STR_MESSAGE_HIT_NUMBER",
"#",this.combo),this.gui.getControl("mcGuiTextMessage_S1").setTextReplace("STR_MESSAGE_HIT_NUMBER_S","#",this.combo),this.gui.clip.gotoAndPlay(1),this.state=ComboCounter.ST_DELAY,this.time=this.timeDelay,this.fromLeft)ChallManager.instance.onComboCount(this.combo)};
ComboCounter.prototype.update=function(a){this.guiFirst.clip.visible&&(this.guiFirst.update(a),this.guiFirst.clip.currentFrame===this.guiFirst.clip.totalFrames-1&&(this.guiFirst.clip.visible=!1));if(this.state!==ComboCounter.ST_NONE)switch(this.gui.clip.visible&&this.gui.update(a),this.time-=a,this.state){case ComboCounter.ST_DELAY:0>=this.time&&(this.state=ComboCounter.ST_COOLDOWN,this.time=this.timeCooldown,this.gui.clip.gotoAndPlay(20));break;case ComboCounter.ST_COOLDOWN:0>=this.time&&this.reset()}};
ComboCounter.prototype.reset=function(){this.combo=this.time=0;this.state=ComboCounter.ST_NONE;this.gui.clip.visible=!1;if(this.fromLeft)ChallManager.instance.onComboCount(this.combo)};ComboCounter.prototype.free=function(){null!==this.gui&&(this.gui.free(),this.gui=null);null!==this.guiFirst&&(this.guiFirst.free(),this.guiFirst=null);this.canvas=null};
function HudMagnetizedClip(a,b,c,d,e,f,g,h,k){this.isAlive=!0;this.m_x=a;this.m_y=b;this.goalX=c;this.goalY=d;this.speed="undefined"!==typeof g?g:10;this.m_canvas=f;this.caller="undefined"!==typeof h?h:null;this.callback="undefined"!==typeof k?k:null;this.clip=Application.instance.getAnimation(e);this.control=null;this.clip.position.x=this.m_x;this.clip.position.y=this.m_y;this.m_trailFx=null;this.m_nameFxEnd="";Application.isLowDevice||(this.m_trailFx=Application.instance.effectManager.createEffect("aniFxHpTrail",
this.clip.position.x,this.clip.position.y,f));this.m_canvas.addChild(this.clip)}HudMagnetizedClip.prototype.free=function(){this.control=this.m_canvas=this.caller=this.callback=null;this.m_trailFx&&(this.m_trailFx.setAwaitingDelete(!0),this.m_trailFx=null);this.clip&&(this.clip.free(),this.clip=null)};
HudMagnetizedClip.prototype.update=function(a){this.control&&(this.clip.visible=this.control.isVisible());this.isAlive&&(1<=SMath.abs(this.m_x-this.goalX)||1<=SMath.abs(this.m_y-this.goalY)?(this.clip.position.x=this.m_x,this.clip.update(a),this.clip.position.y=this.m_y,this.m_x+=SMath.lerp(this.m_x,this.goalX,this.speed,a),this.m_y+=SMath.lerp(this.m_y,this.goalY,this.speed,a),this.m_trailFx&&(this.m_trailFx.x=this.clip.position.x,this.m_trailFx.y=this.clip.position.y)):(this.m_trailFx&&(this.m_trailFx.setAwaitingDelete(!0),
this.m_trailFx=null,""!==this.m_nameFxEnd&&Application.instance.effectManager.createEffect(this.m_nameFxEnd,this.clip.position.x,this.clip.position.y,this.m_canvas)),this.isAlive=!1,this.m_canvas.removeChild(this.clip),this.callback&&this.callback.call(this.caller,this)))};
function HudMagnetizedNano(a,b,c,d,e,f,g,h,k){this.isAlive=!0;this.m_x=a;this.m_y=b;this.goalX=c;this.goalY=d;this.speed="undefined"!==typeof g?g:10;this.control=null;this.m_canvas=f;this.caller="undefined"!==typeof h?h:null;this.callback="undefined"!==typeof k?k:null;this.nanoEffect=new SEffectNano(e,this.m_x,this.m_y,f);this.nanoEffect.x=this.m_x;this.nanoEffect.y=this.m_y}
HudMagnetizedNano.prototype.free=function(){this.nanoEffect&&(this.nanoEffect.free(),this.nanoEffect=null);this.m_canvas=this.caller=this.callback=this.control=null};
HudMagnetizedNano.prototype.update=function(a){this.isAlive&&(1<=SMath.abs(this.m_x-this.goalX)||1<=SMath.abs(this.m_y-this.goalY)?(this.nanoEffect.x=this.m_x,this.nanoEffect.y=this.m_y,this.nanoEffect.update(a),this.m_x+=SMath.lerp(this.m_x,this.goalX,this.speed,a),this.m_y+=SMath.lerp(this.m_y,this.goalY,this.speed,a)):(this.isAlive=!1,this.callback&&this.callback.call(this.caller)));this.control&&this.nanoEffect&&this.nanoEffect.setVisible(this.control.isVisible())};
function HudMagnetizedManager(a){this.m_canvas=a;this.m_magnetizedClips=[];this.m_magnetizedNanos=[]}HudMagnetizedManager.prototype.free=function(){for(var a=this.m_magnetizedClips.length-1;0<=a;a--)this.m_magnetizedClips.splice(a,1)[0].free();for(a=this.m_magnetizedNanos.length-1;0<=a;a--)this.m_magnetizedNanos.splice(a,1)[0].free();this.m_canvas=this.m_magnetizedClips=this.m_magnetizedNanos=null};HudMagnetizedManager.DEFAULT_SPEED=10;
HudMagnetizedManager.prototype.createMagnetizedClip=function(a,b,c,d,e,f,g,h){h="undefined"!==typeof h?h:HudMagnetizedManager.DEFAULT_SPEED;a*=Global.baseScale;b*=Global.baseScale;Application.WIDE_SCREEN&&(a-=Layout.left/Layout.scale,b-=Layout.top/Layout.scale);a=new HudMagnetizedClip(a,b,c,d,e,this.m_canvas,h,f,g);this.m_magnetizedClips.push(a);return a};
HudMagnetizedManager.prototype.createMagnetizedNano=function(a,b,c,d,e,f,g,h){h="undefined"!==typeof h?h:HudMagnetizedManager.DEFAULT_SPEED;a=new HudMagnetizedNano(a,b,c,d,e,this.m_canvas,h,f,g);this.m_magnetizedNanos.push(a);return a};
HudMagnetizedManager.prototype.update=function(a){for(var b=this.m_magnetizedClips.length-1;0<=b;b--)this.m_magnetizedClips[b].isAlive?this.m_magnetizedClips[b].update(a):this.m_magnetizedClips.splice(b,1)[0].free();for(b=this.m_magnetizedNanos.length-1;0<=b;b--)this.m_magnetizedNanos[b].isAlive?this.m_magnetizedNanos[b].update(a):this.m_magnetizedNanos.splice(b,1)[0].free()};
function Modifier(a){this.world=a;this.elements=[];this.timeInterval=0;this.interval=null;this.isGameReady=this.fromLeft=!1;this.virtualCounter=-1}Modifier.ID_RACCOON=0;Modifier.ID_COFFEE=1;Modifier.ID_MANHOLE=2;Modifier.ID_PIDGEONS=3;Modifier.ID_GOATS=4;Modifier.ID_ROBOT=5;
Modifier.prototype.getSidePositionsX=function(a){a*=1.2;var b=this.world.camera().unscaleLimits[0]+a,c=this.world.camera().unscaleLimits[1]-a;b-a<this.world.limitLeft&&(b=this.world.limitLeft+a);c+a>this.world.limitRight&&(c=this.world.limitRight-a);return[new Vector2D(b,this.world.getFloorY()),new Vector2D(c,this.world.getFloorY())]};Modifier.prototype.onGamePreStart=function(){};Modifier.prototype.onGameStart=function(){};
Modifier.prototype.start=function(){this.interval&&(this.interval.free(),this.interval=null);this.interval=new SInterval(this,"onEndInterval",this.timeInterval)};Modifier.prototype.stop=function(){this.interval&&(this.interval.free(),this.interval=null);for(var a=0;a<this.elements.length;a++)this.elements[a]&&!this.elements[a].isAwaitingDelete()&&this.elements[a].deactivate()};Modifier.prototype.onEndInterval=function(){this.interval.free();this.interval=null};
Modifier.prototype.update=function(a){this.interval&&this.interval.update(a);if(this.isVirtuallyDone())ChallManager.instance.onModifierEmpty()};Modifier.prototype.onElementDone=function(a){this.start()};Modifier.prototype.isVirtuallyDone=function(){return 0===this.virtualCounter};Modifier.prototype.free=function(){this.elements=null;this.interval&&(this.interval.free(),this.interval=null)};
function ModifierElement(a,b,c,d,e,f){f=!0===f?b.objectFrontCanvas():b.objectCanvas();SimpleWorldActor.call(this,f,b,c,d);this.m_speed=new Vector2D;this.modifier=a;this.timeInterval=0;this.interval=null;this.type=0;this.fromLeft=!(c>this.m_world.camera().getX()+.5*this.m_world.camera().width());this.boostDash=this.boostDive=this.boostJump=0;this.extraData={};this.index=e;this.aiType=AICore.PU_TYPE_NONE}Application.subclass(ModifierElement,SimpleWorldActor);ModifierElement.TYPE_RACCOON=1;
ModifierElement.TYPE_COFFEE_CUP=2;ModifierElement.TYPE_MANHOLE=3;ModifierElement.TYPE_PIDGEON=4;ModifierElement.TYPE_FARM_ANIMAL=5;ModifierElement.TYPE_FARM_FENCE=6;ModifierElement.TYPE_ROBOT=7;ModifierElement.TYPE_ROBOT_HP=8;ModifierElement.ST_HIDDEN="hidden";ModifierElement.ST_CLOSED="closed";ModifierElement.ST_APPEAR="appear";ModifierElement.ST_OPENING="opening";ModifierElement.ST_OPENING_2="opening_2";ModifierElement.ST_STAND="stand";ModifierElement.ST_STAND_2="stand_2";
ModifierElement.ST_OPEN="open";ModifierElement.ST_HIT="hit";ModifierElement.ST_DISAPPEAR="disappear";ModifierElement.ST_CLOSING="closing";ModifierElement.ST_CLOSING_2="closing_2";ModifierElement.ST_CLOSING_WATER_1="closing_water_1";ModifierElement.ST_CLOSING_WATER_2="closing_water_2";ModifierElement.ST_DESTROYED="destroyed";ModifierElement.prototype.onEndInterval=function(){this.interval.free();this.interval=null};
ModifierElement.prototype.activate=function(){this.interval=new SInterval(this,"onEndInterval",this.timeInterval)};ModifierElement.prototype.deactivate=function(){this.interval&&(this.interval.free(),this.interval=null)};ModifierElement.prototype.checkCollisionWithPlayers=function(a,b){for(var c=this.m_world.getPlayersRef(),d=0;d<c.length;d++)this.hitTestWithActorByBounds(c[d],a,b)&&(c[d].onCollisionWithModElement(this),this.onCollideWithPlayer(c[d]))};
ModifierElement.prototype.onCollideWithPlayer=function(a){};ModifierElement.prototype.update=function(a){SimpleWorldActor.prototype.update.call(this,a);this.interval&&this.interval.update(a)};ModifierElement.prototype.isActive=function(){return!this.isAwaitingDelete()&&this.state()!==ModifierElement.ST_HIDDEN&&this.state()!==ModifierElement.ST_DISAPPEAR};
ModifierElement.prototype.free=function(){SimpleWorldActor.prototype.free.call(this);this.modifier=null;this.interval&&(this.interval.free(),this.interval=null)};
function Raccoon(a,b,c,d,e){ModifierElement.call(this,a,b,c,d,e);this.brother=null;this.enableNotify=!0;this.type=ModifierElement.TYPE_RACCOON;this.timeInterval=Application.config.modifiers.raccoonStandTime;-1===this.timeInterval&&(this.timeInterval=6E5);this.m_damage=0;this.m_character=new Character(c,d,this.m_canvas);this.m_character.onEndAnimation(this,this.onEndAnimation);this.m_character.addState(ModifierElement.ST_HIDDEN,"Scn_obj_modifier_02_stand");this.m_character.addState(ModifierElement.ST_APPEAR,
"Scn_obj_modifier_02_raccoon_appear");this.m_character.addState(ModifierElement.ST_STAND,"Scn_obj_modifier_02_raccoon_stand");this.m_character.addState(ModifierElement.ST_HIT,"Scn_obj_modifier_02_raccoon_hit");this.m_character.addState(ModifierElement.ST_DISAPPEAR,"Scn_obj_modifier_02_raccoon_disappear");this.gotoState(ModifierElement.ST_HIDDEN);this.setFlipX(!this.fromLeft);this.setScale(this.m_world.fData.scale);this.boostInterval=null;this.boostTime=Application.config.modifiers.raccoonInvencibilityTime;
this.readyToResetBoost=!1;this.aiType=AICore.PU_TYPE_HIT}Application.subclass(Raccoon,ModifierElement);Raccoon.HALF_WIDTH=160;Raccoon.prototype.onEndAnimation=function(a){switch(a){case ModifierElement.ST_APPEAR:this.gotoState(ModifierElement.ST_STAND);break;case ModifierElement.ST_DISAPPEAR:this.gotoState(ModifierElement.ST_HIDDEN);if(this.enableNotify)this.modifier.onElementDone(this);break;case ModifierElement.ST_HIT:this.gotoState(ModifierElement.ST_DISAPPEAR)}};
Raccoon.prototype.onEndInterval=function(){ModifierElement.prototype.onEndInterval.call(this);this.gotoState(ModifierElement.ST_DISAPPEAR)};Raccoon.prototype.activate=function(){this.enableNotify=!0;this.gotoState(ModifierElement.ST_APPEAR)};
Raccoon.prototype.deactivate=function(){ModifierElement.prototype.deactivate.call(this);if(this.m_state!==ModifierElement.ST_HIDDEN){this.gotoState(ModifierElement.ST_DISAPPEAR);this.boostInterval&&(this.boostInterval.free(),this.boostInterval=null);var a=this.extraData.targetPlayer;a&&(a.setInvencibility(!1),this.extraData.targetPlayer=null)}};
Raccoon.prototype.update=function(a){ModifierElement.prototype.update.call(this,a);this.m_state===ModifierElement.ST_STAND&&this.checkCollisionWithPlayers("mcCollision","mcAttack");this.boostInterval&&this.boostInterval.update(a);this.extraData&&this.extraData.targetPlayer&&(a=this.extraData.targetPlayer,this.readyToResetBoost&&a.isOnFloor()&&(this.readyToResetBoost=!1,a.deactivateShield(),Application.log("INVENCIBILITY OFF!!!"),this.extraData.targetPlayer=null))};
Raccoon.prototype.checkCollisionWithPlayers=function(a,b){for(var c=this.m_world.getPlayersRef(),d=0;d<c.length;d++)c[d].getMState()===FighterActor.ST_DIVE&&this.hitTestWithActorByBounds(c[d],a,b)&&(c[d].onCollisionWithModElement(this),this.onCollideWithPlayer(c[d]))};
Raccoon.prototype.onCollideWithPlayer=function(a){this.interval&&(this.interval.free(),this.interval=null);this.gotoState(ModifierElement.ST_HIT);var b=this.clip().getInstance("tomatoPos");a.createHitEffect(this);Application.instance.playSound("SND_HEALTH_PICK");var c=FighterHUD.instance.getHPBarCenter(a.id());c.y+=15;var d=Math.sign(this.clip().scale.x);FighterHUD.instance.createMagnetizedClip(this.clip().x+b.x*d,this.clip().y+b.y,c.x,c.y,"Scn_obj_modifier_02_tomato",this,this.onEndMagnetized,7).clip.setScale(this.clip().scale.x,
this.clip().scale.y);this.extraData.targetPlayer=null;this.extraData.targetPlayer=a;Application.instance.playSound("SND_INVULNERABILITY_ITEM");this.boostInterval=new SInterval(this,"onEndBoostInterval",this.boostTime);this.brother.enableNotify=!1;this.brother.gotoState(ModifierElement.ST_DISAPPEAR)};
Raccoon.prototype.onEndMagnetized=function(a){var b=Application.instance.effectManager;a=b.createEffect("fx_shield_start",a.goalX,a.goalY,FighterHUD.instance.canvas);a.clip.setScale(1.1);a.onComplete(b,function(a){var b=this.createEffect("fx_shield_loop",a.x,a.y,FighterHUD.instance.canvas);b.clip.setScale(1.1);b.onComplete(this,function(){this.createEffect("fx_shield_end",a.x,a.y,FighterHUD.instance.canvas).clip.setScale(1.1)})})};
Raccoon.prototype.onEndBoostInterval=function(){this.boostInterval&&(this.boostInterval.free(),this.boostInterval=null);this.readyToResetBoost=!0};Raccoon.prototype.free=function(){ModifierElement.prototype.free.call(this);this.boostInterval&&(this.boostInterval.free(),this.boostInterval=null);this.brother=null};
function RaccoonsMod(a){Modifier.call(this,a);a=this.getSidePositionsX(Raccoon.HALF_WIDTH);for(var b=0;2>b;b++){var c=new Raccoon(this,this.world,a[b].x,a[b].y-15,b);this.world.actorManager().add(c);this.elements.push(c)}this.elements[0].brother=this.elements[1];this.elements[1].brother=this.elements[0];this.timeInterval=Application.config.modifiers.raccoonsIntervalTime}Application.subclass(RaccoonsMod,Modifier);
RaccoonsMod.prototype.onEndInterval=function(){Modifier.prototype.onEndInterval.call(this);this.elements[0].activate();this.elements[1].activate()};RaccoonsMod.prototype.onGameStart=function(){this.start()};
function FarmMod(a){Modifier.call(this,a);this.numAnimals=Application.config.modifiers.animalsFarmTotal;this.distanceBtwn=Application.config.modifiers.animalsFarmDistanceBtwn;a=this.getSidePositionsX(FenceFarm.HALF_WIDTH);for(var b=0;2>b;b++){var c=new FenceFarm(this,this.world,a[b].x,a[b].y-15,b);this.world.actorManager().add(c);this.elements.push(c)}this.virtualCounter=2;this.doneCounter=0;this.checkElementsCounter("creation")}Application.subclass(FarmMod,Modifier);
FarmMod.prototype.onGameStart=function(){this.isGameReady=!0};
FarmMod.prototype.onGamePreStart=function(){if(!this.elements[0]&&!this.elements[1])for(var a=this.getSidePositionsX(FenceFarm.HALF_WIDTH),b=0;2>b;b++){var c=new FenceFarm(this,this.world,a[b].x,a[b].y-15,b);this.world.actorManager().add(c);this.elements.push(c)}this.virtualCounter=2;this.isGameReady=!1;this.elements[0].clip().visible=!0;this.elements[1].clip().visible=!0;this.elements[0].gotoState(ModifierElement.ST_STAND);this.elements[1].gotoState(ModifierElement.ST_STAND);this.elements[0].extraData=
{};this.elements[1].extraData={};this.checkElementsCounter("before start")};FarmMod.prototype.stop=function(){Modifier.prototype.stop.call(this);for(var a=0;a<this.elements.length;a++)this.elements[a]&&this.elements[a].setAwaitingDelete(!0);this.elements=null;this.elements=[];this.checkElementsCounter("stop modifier")};
FarmMod.prototype.onElementDone=function(a){switch(a.type){case ModifierElement.TYPE_FARM_FENCE:this.virtualCounter--;this.checkElementsCounter("hit fence");for(var b=a.fromLeft?this.world.camera().unscaleLimits[0]-150:this.world.camera().unscaleLimits[1]+150,c=a.fromLeft?-this.distanceBtwn:this.distanceBtwn,d=0;d<this.numAnimals;d++){var e=new AnimalFarm(this,this.world,b+c*d,this.world.getFloorY()-15,d);e.extraData.safePlayer=a.extraData.safePlayer;this.world.actorManager().add(e);this.elements.push(e);
e.index=this.elements.length-1;this.virtualCounter++;this.checkElementsCounter("goat creation")}Application.instance.playSound("SND_HAZARD_DOGS");break;case ModifierElement.TYPE_FARM_ANIMAL:this.virtualCounter--,this.doneCounter++,this.elements[a.index]=null,this.checkElementsCounter("goat out screen"),this.doneCounter<this.numAnimals||(this.doneCounter=0,Application.instance.stopSound("SND_HAZARD_DOGS"))}};
FarmMod.prototype.checkElementsCounter=function(a){for(var b=a=0;b<this.elements.length;b++)this.elements[b]&&a++};
function FenceFarm(a,b,c,d,e){ModifierElement.call(this,a,b,c,d,e);this.type=ModifierElement.TYPE_FARM_FENCE;this.m_character=new Character(c,d,this.m_canvas);this.m_character.onEndAnimation(this,this.onEndAnimation);this.m_character.addState(ModifierElement.ST_STAND,"Scn_obj_modifier_01_stand");this.m_character.addState(ModifierElement.ST_HIT,"Scn_obj_modifier_01_hit");this.m_character.addState(ModifierElement.ST_DESTROYED,"Scn_obj_modifier_01_destroyed");this.gotoState(ModifierElement.ST_STAND);
this.setScale(this.m_world.fData.scale);this.warningClip=null;this.timeInterval=Application.config.modifiers.animalsFarmWarningTime}Application.subclass(FenceFarm,ModifierElement);FenceFarm.HALF_WIDTH=90;FenceFarm.WARNING_Y=400;FenceFarm.prototype.onEndAnimation=function(a){switch(a){case ModifierElement.ST_DESTROYED:this.m_isAwaitingDelete=!0,this.modifier.elements[this.index]=null}};
FenceFarm.prototype.update=function(a){ModifierElement.prototype.update.call(this,a);if(this.modifier.isGameReady){var b=this.m_world.getPlayersRef()[0],c=this.m_world.getPlayersRef()[1];if(!b.isDefeated()&&!c.isDefeated()&&(this.m_state===ModifierElement.ST_STAND?this.checkCollisionWithPlayers("mcCollision","mcAttack"):this.warningClip&&this.warningClip.update(a),this.m_state===ModifierElement.ST_HIT))for(a=2;a<this.modifier.elements.length;a++)this.modifier.elements[a]&&(b=this.modifier.elements[a].getX(),
b>this.m_x-50&&b<this.m_x+50&&(this.gotoState(ModifierElement.ST_DESTROYED),this.m_clip.loop=!1))}};FenceFarm.prototype.checkCollisionWithPlayers=function(a,b){for(var c=this.m_world.getPlayersRef(),d=0;d<c.length;d++)if(c[d].getMState()===FighterActor.ST_DIVE){var e=c[d].getDiveSpeed().x;if((this.fromLeft&&0>e||!this.fromLeft&&0<e)&&this.hitTestWithActorByBounds(c[d],a,b))this.onCollideWithPlayer(c[d])}};
FenceFarm.prototype.onCollideWithPlayer=function(a){this.gotoState(ModifierElement.ST_HIT);this.m_clip.loop=!1;this.extraData.safePlayer=a;a.createHitEffect(this);a=this.fromLeft?-Layout.left/Layout.scale+100:Application.APP_WIDTH+Layout.left/Layout.scale-100;this.warningClip=Application.instance.getAnimation("gui_hud_alert");this.warningClip.setPosition(a,FenceFarm.WARNING_Y);FighterHUD.instance.canvas.addChild(this.warningClip);Application.instance.playSound("SND_WARNING");this.activate()};
FenceFarm.prototype.onEndInterval=function(){ModifierElement.prototype.onEndInterval.call(this);this.modifier.onElementDone(this);this.warningClip&&(FighterHUD.instance.canvas.removeChild(this.warningClip),this.warningClip.free(),this.warningClip=null,Application.instance.stopSound("SND_WARNING"))};
FenceFarm.prototype.deactivate=function(){ModifierElement.prototype.deactivate.call(this);this.warningClip&&(FighterHUD.instance.canvas.removeChild(this.warningClip),this.warningClip.free(),this.warningClip=null,Application.instance.stopSound("SND_WARNING"))};FenceFarm.prototype.free=function(){ModifierElement.prototype.free.call(this);this.warningClip&&(FighterHUD.instance.canvas.removeChild(this.warningClip),this.warningClip.free(),this.warningClip=null,Application.instance.stopSound("SND_WARNING"))};
function AnimalFarm(a,b,c,d,e){ModifierElement.call(this,a,b,c,d,e,!0);this.type=ModifierElement.TYPE_FARM_ANIMAL;this.m_character=new Character(c,d,this.m_canvas);this.m_character.onEndAnimation(this,this.onEndAnimation);this.m_character.addState(ModifierElement.ST_STAND,"Scn_obj_modifier_01_activated"+(0===e?"":"_b"));this.gotoState(ModifierElement.ST_STAND);this.setFlipX(!this.fromLeft);this.m_clip.gotoAndPlay(Common.random(1,9));this.setScale(this.m_world.fData.scale);this.m_speed.x=Application.config.modifiers.animalsFarmSpeed;
this.m_damage=Application.config.modifiers.animalsFarmDamage;this.mov=new LinearMovement(c,d,this.m_speed.x);this.mov.setCallbacks(this,this.onEndMovement,null);this.mov.gotoPosition(c+this.m_world.width()*(this.fromLeft?1:-1),d)}Application.subclass(AnimalFarm,ModifierElement);AnimalFarm.prototype.onEndMovement=function(a){this.mov.free();this.mov=null;this.modifier.onElementDone(this);this.m_isAwaitingDelete=!0};
AnimalFarm.prototype.update=function(a){ModifierElement.prototype.update.call(this,a);this.mov&&(this.m_x=this.mov.getX(),this.m_y=this.mov.getY(),this.m_speed.x=this.mov.getLinearVelocityX(),this.mov.update(a));a=this.m_world.getPlayersRef()[0];var b=this.m_world.getPlayersRef()[1];a.isDefeated()||b.isDefeated()||!this.extraData.safePlayer||(this.checkCollisionWithPlayers("mcCollision","mcCollision"),this.extraData.safePlayer&&this.checkCollisionWithPlayers("mcCollision","mcAttack"))};
AnimalFarm.prototype.checkCollisionWithPlayers=function(a,b){for(var c=this.m_world.getPlayersRef(),d=0;d<c.length;d++)if(c[d].id()!==this.extraData.safePlayer.id()&&this.hitTestWithActorByBounds(c[d],a,b)){c[d].onCollisionWithModElement(this);this.onCollideWithPlayer(c[d]);this.extraData.safePlayer=null;break}};
function CoffeeCup(a,b,c,d,e){ModifierElement.call(this,a,b,c,d,e);this.type=ModifierElement.TYPE_COFFEE_CUP;this.timeInterval=Application.config.modifiers.coffeeStandTime;this.boostInterval=null;this.boostTime=Application.config.modifiers.coffeeBoostTime;-1===this.timeInterval&&(this.timeInterval=6E5);this.readyToResetBoost=!1;this.boostJump=Application.config.modifiers.coffeeBoostJump;this.boostDive=Application.config.modifiers.coffeeBoostDive;this.boostDash=Application.config.modifiers.coffeeBoostDash;
this.m_character=new Character(c,d,this.m_canvas);this.m_character.onEndAnimation(this,this.onEndAnimation);this.m_character.addState(ModifierElement.ST_APPEAR,"Scn_obj_modifier_03_appear");this.m_character.addState(ModifierElement.ST_STAND,"Scn_obj_modifier_03_stand");this.m_character.addState(ModifierElement.ST_HIDDEN,"Scn_obj_modifier_03_stand");this.m_character.addState(ModifierElement.ST_DISAPPEAR,"Scn_obj_modifier_03_disappear");this.gotoState(ModifierElement.ST_HIDDEN);this.setScale(this.m_world.fData.scale);
this.fx=null;a=this.m_x-this.m_world.camera().getX()-Layout.left/Layout.scale;b=this.m_y-this.m_world.camera().getY()-Layout.top/Layout.scale;this.fx=Application.instance.effectManager.createEffect("aniFxSmoothieAura",a,b,this.m_world.bgCanvas,0);this.fx.setVisible(!1);this.aiType=AICore.PU_TYPE_PICK}Application.subclass(CoffeeCup,ModifierElement);
CoffeeCup.prototype.gotoState=function(a){ModifierElement.prototype.gotoState.call(this,a);a===ModifierElement.ST_STAND?this.fx&&this.fx.setVisible(!0):this.fx&&this.fx.setVisible(!1);this.m_clip.visible=a!==ModifierElement.ST_HIDDEN};CoffeeCup.prototype.onEndAnimation=function(a){switch(a){case ModifierElement.ST_APPEAR:this.gotoState(ModifierElement.ST_STAND);break;case ModifierElement.ST_DISAPPEAR:this.gotoState(ModifierElement.ST_HIDDEN),this.modifier.onElementDone(this)}};
CoffeeCup.prototype.onEndInterval=function(){ModifierElement.prototype.onEndInterval.call(this);this.gotoState(ModifierElement.ST_DISAPPEAR)};CoffeeCup.prototype.activate=function(){0<this.timeInterval&&ModifierElement.prototype.activate.call(this);this.gotoState(ModifierElement.ST_APPEAR);Application.instance.playSound("SND_HEALTH_APPEAR")};
CoffeeCup.prototype.deactivate=function(){ModifierElement.prototype.deactivate.call(this);if(this.m_state!==ModifierElement.ST_HIDDEN){this.gotoState(ModifierElement.ST_DISAPPEAR);this.boostInterval&&(this.boostInterval.free(),this.boostInterval=null);this.readyToResetBoost=!1;var a=this.extraData.targetPlayer;a&&(a.resetJumpAndDive(),this.extraData.targetPlayer=null);this.fx&&this.fx.setVisible(!1)}};
CoffeeCup.prototype.update=function(a){ModifierElement.prototype.update.call(this,a);this.m_state===ModifierElement.ST_STAND&&this.checkCollisionWithPlayers("mcCollision","mcCollision");this.boostInterval&&this.boostInterval.update(a);this.extraData&&this.extraData.targetPlayer&&(a=this.extraData.targetPlayer,this.readyToResetBoost&&a.isOnFloor()&&(this.readyToResetBoost=!1,a.resetJumpAndDive(),this.extraData.targetPlayer=null))};
CoffeeCup.prototype.onCollideWithPlayer=function(a){this.interval&&(this.interval.free(),this.interval=null);this.gotoState(ModifierElement.ST_DISAPPEAR);this.extraData.targetPlayer=null;this.extraData.targetPlayer=a;this.boostInterval&&(this.boostInterval.free(),this.boostInterval=null);this.readyToResetBoost=!1;this.boostInterval=new SInterval(this,"onEndBoostInterval",this.boostTime);Application.instance.playSound("SND_HEALTH_PICK")};
CoffeeCup.prototype.onEndBoostInterval=function(){this.boostInterval&&(this.boostInterval.free(),this.boostInterval=null);this.readyToResetBoost=!0};CoffeeCup.prototype.free=function(){ModifierElement.prototype.free.call(this);this.boostInterval&&(this.boostInterval.free(),this.boostInterval=null);this.fx&&(this.fx.setAwaitingDelete(!0),this.fx=null)};
function CoffeeMod(a){Modifier.call(this,a);a=.5*this.world.width();a=new CoffeeCup(this,this.world,a,this.world.getFloorY(),0);this.world.actorManager().add(a);this.elements.push(a);this.timeInterval=Application.config.modifiers.coffeeIntervalTime}Application.subclass(CoffeeMod,Modifier);CoffeeMod.prototype.onEndInterval=function(){Modifier.prototype.onEndInterval.call(this);this.elements[0].activate()};CoffeeMod.prototype.onGameStart=function(){this.start()};
function Manhole(a,b,c,d,e){ModifierElement.call(this,a,b,c,d,e);this.type=ModifierElement.TYPE_MANHOLE;this.m_character=new Character(c,d,this.m_canvas);this.m_character.onEndAnimation(this,this.onEndAnimation);this.m_character.addState(ModifierElement.ST_OPENING,"Scn_obj_modifier_04_locked",[{frame:19,callback:this.playLidSound}]);this.m_character.addState(ModifierElement.ST_OPENING_2,"Scn_obj_modifier_04_opening");this.m_character.addState(ModifierElement.ST_OPEN,"Scn_obj_modifier_04_stand");this.m_character.addState(ModifierElement.ST_CLOSED,
"Scn_obj_modifier_04_loop");this.m_character.addState(ModifierElement.ST_CLOSING,"Scn_obj_modifier_04_closing",[{frame:1,callback:this.playLidSound}]);this.m_character.addState(ModifierElement.ST_CLOSING_2,"Scn_obj_modifier_04_unlocked");this.gotoState(ModifierElement.ST_CLOSED);this.setFlipX(!this.fromLeft)}Application.subclass(Manhole,ModifierElement);Manhole.HALF_WIDTH=90;
Manhole.prototype.gotoState=function(a){ModifierElement.prototype.gotoState.call(this,a);switch(a){case ModifierElement.ST_OPENING:case ModifierElement.ST_OPENING_2:case ModifierElement.ST_CLOSED:this.m_world.changeLimits(this.fromLeft,this.m_x+(this.fromLeft?100:-100));break;default:this.m_world.setInitialLimits(this.fromLeft)}a===ModifierElement.ST_CLOSING_2&&Application.instance.playSound("SND_SEWER_WATER");Application.instance.stopSound("SND_SEWER_WATER_LOOP")};
Manhole.prototype.playLidSound=function(){Application.instance.playSound("SND_SEWER_LID")};
Manhole.prototype.onEndAnimation=function(a){switch(a){case ModifierElement.ST_OPENING:this.gotoState(ModifierElement.ST_OPENING_2);break;case ModifierElement.ST_OPENING_2:this.gotoState(ModifierElement.ST_OPEN);this.modifier.onElementDone(this);break;case ModifierElement.ST_CLOSING:this.gotoState(ModifierElement.ST_CLOSING_2);this.modifier.onElementDone(this);break;case ModifierElement.ST_CLOSING_2:this.gotoState(ModifierElement.ST_CLOSED),this.modifier.onElementDone(this)}};
Manhole.prototype.update=function(a){ModifierElement.prototype.update.call(this,a);a=this.m_world.getPlayersRef()[0];var b=this.m_world.getPlayersRef()[1];if(!a.isDefeated()&&!b.isDefeated()&&!this.m_world.fightStopped()){var c=this.modifier;switch(this.m_state){case ModifierElement.ST_OPEN:this.checkCollisionWithPlayers("mcCollision","mcCollision");break;case ModifierElement.ST_CLOSING:case ModifierElement.ST_CLOSING_2:if(!c.targetPlayer)if(this.fromLeft){if(a.getX()<this.m_x+100)a.onCollisionWithModElement(this);
if(b.getX()<this.m_x+100)b.onCollisionWithModElement(this)}else{if(a.getX()>this.m_x-100)a.onCollisionWithModElement(this);if(b.getX()>this.m_x-100)b.onCollisionWithModElement(this)}else if(c.targetPlayer===a)if(this.fromLeft){if(b.getX()<this.m_x+100)b.onCollisionWithModElement(this)}else{if(b.getX()>this.m_x-100)b.onCollisionWithModElement(this)}else if(c.targetPlayer===b)if(this.fromLeft){if(a.getX()<this.m_x+100)a.onCollisionWithModElement(this)}else if(a.getX()>this.m_x-100)a.onCollisionWithModElement(this)}}};
Manhole.prototype.checkCollisionWithPlayers=function(a,b){if(this.modifier.teleState===SewerMod.TELEPORT_OPEN){var c=this.m_world.getPlayersRef()[0],d=this.m_world.getPlayersRef()[1],e=!1,f=!1;this.hitTestWithActorByBounds(c,a,b)&&(e=!0);this.hitTestWithActorByBounds(d,a,b)&&(f=!0);e&&!f?(c.onCollisionWithModElement(this),this.onCollideWithPlayer(c)):!e&&f?(d.onCollisionWithModElement(this),this.onCollideWithPlayer(d)):e&&f&&(a=Math.abs(c.getX()-this.m_x),b=Math.abs(d.getX()-this.m_x),a<=b?(c.onCollisionWithModElement(this),
this.onCollideWithPlayer(c)):(d.onCollisionWithModElement(this),this.onCollideWithPlayer(d)))}};Manhole.prototype.onCollideWithPlayer=function(a){this.extraData.targetPlayer=a;this.modifier.onElementDone(this)};Manhole.prototype.deactivate=function(){ModifierElement.prototype.deactivate.call(this);this.gotoState(ModifierElement.ST_CLOSED)};
function SewerMod(a){Modifier.call(this,a);a=this.getSidePositionsX(Manhole.HALF_WIDTH);for(var b=0;2>b;b++){var c=new Manhole(this,this.world,a[b].x,a[b].y,b);this.world.actorManager().add(c);this.elements.push(c)}this.timeInterval=Application.config.modifiers.manholesIntervalTime;this.teleState=SewerMod.TELEPORT_CLOSED;this.targetPlayer=this.portalOut=this.portalIn=null;this.doneCounter=0;Application.instance.playSound("SND_SEWER_WATER_LOOP")}Application.subclass(SewerMod,Modifier);
SewerMod.TELEPORT_CLOSED=0;SewerMod.TELEPORT_OPENING=1;SewerMod.TELEPORT_OPEN=2;SewerMod.TELEPORT_CLOSING=3;SewerMod.TELEPORT_IN=4;SewerMod.TELEPORT_WAIT=5;SewerMod.TELEPORT_OUT=6;SewerMod.prototype.onGameStart=function(){this.timeInterval=Application.config.modifiers.manholesIntervalTime;this.start()};
SewerMod.prototype.onEndInterval=function(){Modifier.prototype.onEndInterval.call(this);switch(this.teleState){case SewerMod.TELEPORT_CLOSED:this.teleState=SewerMod.TELEPORT_OPENING;this.elements[0].gotoState(ModifierElement.ST_OPENING);this.elements[1].gotoState(ModifierElement.ST_OPENING);break;case SewerMod.TELEPORT_OPEN:this.teleState=SewerMod.TELEPORT_CLOSING;this.elements[0].gotoState(ModifierElement.ST_CLOSING);this.elements[1].gotoState(ModifierElement.ST_CLOSING);break;case SewerMod.TELEPORT_IN:this.portalIn.gotoState(ModifierElement.ST_CLOSING);
this.portalOut.gotoState(ModifierElement.ST_CLOSING);break;case SewerMod.TELEPORT_OUT:this.timeInterval=Application.config.modifiers.manholesIntervalTime,this.start(),this.teleState=SewerMod.TELEPORT_CLOSED,this.portalOut=this.portalIn=null,this.targetPlayer.teleportUnlock()}};
SewerMod.prototype.onElementDone=function(a){switch(this.teleState){case SewerMod.TELEPORT_OPENING:this.doneCounter++;if(2>this.doneCounter)break;this.doneCounter=0;this.teleState=SewerMod.TELEPORT_OPEN;this.timeInterval=Application.config.modifiers.manholeStandTime;-1===this.timeInterval&&(this.timeInterval=6E5);this.start();break;case SewerMod.TELEPORT_CLOSING:this.doneCounter++;if(2>this.doneCounter)break;this.doneCounter=0;this.teleState=SewerMod.TELEPORT_CLOSED;this.timeInterval=Application.config.modifiers.manholesIntervalTime;
this.start();break;case SewerMod.TELEPORT_OPEN:this.interval&&(this.interval.free(),this.interval=null);this.timeInterval=10;this.start();this.teleState=SewerMod.TELEPORT_IN;this.portalOut=this.portalIn=null;a.fromLeft?(this.portalIn=this.elements[0],this.portalOut=this.elements[1]):(this.portalIn=this.elements[1],this.portalOut=this.elements[0]);this.targetPlayer=null;this.targetPlayer=a.extraData.targetPlayer;break;case SewerMod.TELEPORT_IN:this.doneCounter++;if(2>this.doneCounter)break;this.doneCounter=
0;this.teleState=SewerMod.TELEPORT_OUT;this.timeInterval=250;this.start();this.targetPlayer.teleport(this.portalOut.getX());break;case SewerMod.TELEPORT_CLOSED:this.targetPlayer=null,Application.instance.playSound("SND_SEWER_WATER_LOOP")}};SewerMod.prototype.free=function(){Modifier.prototype.free.call(this);this.targetPlayer=this.portalOut=this.portalIn=null;Application.instance.stopSound("SND_SEWER_WATER_LOOP")};
SewerMod.prototype.stop=function(){Modifier.prototype.stop.call(this);var a=this.elements[0],b=this.elements[1];this.elements=null;this.elements=[];this.elements.push(a);this.elements.push(b);this.teleState=SewerMod.TELEPORT_CLOSED;this.targetPlayer=null;this.doneCounter=0;this.timeInterval=Application.config.modifiers.manholesIntervalTime;Application.instance.stopSound("SND_SEWER_WATER_LOOP");Application.instance.playSound("SND_SEWER_WATER_LOOP")};
function Seeds(a,b,c,d,e){ModifierElement.call(this,a,b,c,d,e);this.type=ModifierElement.TYPE_PIDGEON;this.m_damage=Application.config.modifiers.pidgeonsHPDamage;this.initScale=1.5;this.finalScale=2;this.currentScale=this.initScale;this.m_character=new Character(c,d,this.m_canvas);this.m_character.addState(ModifierElement.ST_APPEAR,"Scn_obj_modifier_06_girl_food_appear");this.m_character.addState(ModifierElement.ST_STAND,"Scn_obj_modifier_06_girl_food_stand");this.gotoState(ModifierElement.ST_APPEAR);
this.setScale(this.currentScale);this.initXY=new Vector2D(c,d);this.finalXY=new Vector2D(.5*this.m_world.width(),this.m_world.getFloorY());this.totalDistance=this.initXY.distanceTo(this.finalXY.x,this.finalXY.y);this.mov=new ParametricParabolicMovement(this.initXY.x,this.initXY.y,this.finalXY.x,this.finalXY.y);this.mov.target=this;this.mov.setEndCallback("onEndMovement");this.playersToHit=this.m_world.getPlayersRef()}Application.subclass(Seeds,ModifierElement);
Seeds.prototype.onEndMovement=function(a){this.mov.free();this.mov=null;this.m_x=this.finalXY.x;this.m_y=this.finalXY.y;this.currentScale=this.finalScale;this.modifier.onElementDone(this);this.gotoState(ModifierElement.ST_STAND)};
Seeds.prototype.update=function(a){ModifierElement.prototype.update.call(this,a);if(this.mov){this.m_x=this.mov.getX();this.m_y=this.mov.getY();var b=(new Vector2D(this.m_x,this.m_y)).distanceTo(this.finalXY.x,this.finalXY.y);this.currentScale=this.initScale+(this.totalDistance-b)/this.totalDistance*(this.finalScale-this.initScale);this.mov.update(a);this.setScale(this.currentScale)}else a=this.m_world.getPlayersRef()[0],b=this.m_world.getPlayersRef()[1],a.isDefeated()||b.isDefeated()||this.modifier.feedState===
PidgeonsMod.FEED_PIDGEONS_EATING&&this.checkCollisionWithPlayers("mcCollision","mcCollision")};Seeds.prototype.checkCollisionWithPlayers=function(a,b){for(var c=0;c<this.playersToHit.length;c++)if(this.hitTestWithActorByBounds(this.playersToHit[c],a,b)){this.playersToHit[c].onCollisionWithModElement(this);this.onCollideWithPlayer(this.playersToHit[c]);this.playersToHit[c]=null;this.playersToHit.splice(c--,1);break}};
Seeds.prototype.deactivate=function(){ModifierElement.prototype.deactivate.call(this);this.m_isAwaitingDelete=!0};Seeds.prototype.free=function(){ModifierElement.prototype.free.call(this);this.playersToHit=null};
function Pidgeon(a,b,c,d,e){ModifierElement.call(this,a,b,c,d,e,!0);this.initX=c;this.initY=d;this.speedVal=Application.config.modifiers.pidgeonsSpeed;a=Common.randomInt(1,3);this.m_character=new Character(c,d,this.m_canvas);this.m_character.addState(ModifierElement.ST_APPEAR,"Scn_obj_modifier_06_pidgeon0"+a+"_fly");this.m_character.addState(ModifierElement.ST_STAND,"Scn_obj_modifier_06_pidgeon0"+a+"_eat");this.gotoState(ModifierElement.ST_APPEAR);this.mov=new LinearMovement(c,d,this.speedVal);this.mov.setCallbacks(this,
this.onEndMovement,null);this.mov.gotoPosition(.5*this.m_world.width()+75*Math.random()*Math.pow(-1,Common.randomInt(0,1)),this.m_world.getFloorY());this.playersToHit=this.m_world.getPlayersRef()}Application.subclass(Pidgeon,ModifierElement);Pidgeon.prototype.onEndMovement=function(a){this.mov.free();this.mov=null;this.modifier.onElementDone(this);this.gotoState(ModifierElement.ST_STAND);this.setFlipX(!this.fromLeft)};
Pidgeon.prototype.goOut=function(){this.mov=new LinearMovement(this.m_x,this.m_y,this.speedVal);this.mov.setCallbacks(this,this.onEndMovement,null);this.mov.gotoPosition(this.initX,this.initY);this.gotoState(ModifierElement.ST_APPEAR);this.setFlipX(!1)};Pidgeon.prototype.update=function(a){ModifierElement.prototype.update.call(this,a);this.mov&&(this.m_x=this.mov.getX(),this.m_y=this.mov.getY(),this.m_clip.rotation=this.mov.getAngle(),this.mov.update(a))};Pidgeon.prototype.free=function(){ModifierElement.prototype.free.call(this)};
Pidgeon.prototype.deactivate=function(){ModifierElement.prototype.deactivate.call(this);this.m_isAwaitingDelete=!0};
function ParkGuy(a,b,c,d,e){ModifierElement.call(this,a,b,c,d,e);this.m_character=new Character(c,d,this.m_canvas);this.m_character.onEndAnimation(this,this.onEndAnimation);this.m_character.addState(ModifierElement.ST_STAND,"Scn_obj_modifier_06_girl_stand");this.m_character.addState(ModifierElement.ST_STAND_2,"Scn_obj_modifier_06_girl_idle");this.m_character.addState(ModifierElement.ST_HIT,"Scn_obj_modifier_06_girl_feed",[{caller:this,callback:this.feedBirds,frame:26}]);this.gotoState(ModifierElement.ST_STAND);
this.setFlipX(!0)}Application.subclass(ParkGuy,ModifierElement);ParkGuy.prototype.feedBirds=function(){this.modifier.onElementDone(this)};ParkGuy.prototype.onEndAnimation=function(a){switch(a){case ModifierElement.ST_HIT:case ModifierElement.ST_STAND_2:this.gotoState(ModifierElement.ST_STAND);break;case ModifierElement.ST_STAND:0===Common.randomInt(0,1)&&this.gotoState(ModifierElement.ST_STAND_2)}};ParkGuy.prototype.deactivate=function(){ModifierElement.prototype.deactivate.call(this);this.gotoState(ModifierElement.ST_STAND)};
function PidgeonsMod(a){Modifier.call(this,a);a=new ParkGuy(this,this.world,.5*this.world.width()+100,1225,0);this.world.actorManager().add(a);this.elements.push(a);this.timeInterval=Application.config.modifiers.pidgeonsIntervalTime;this.feedState=PidgeonsMod.FEED_WAIT;this.doneCounter=0;this.totalPidgeons=10;a=new Vector2D(this.world.camera().getX(),this.world.camera().getY());var b=new Vector2D(this.world.camera().getX()+this.world.camera().width(),this.world.camera().getY());this.pidPositions=
[new Vector2D(a.x,a.y),new Vector2D(a.x-75,a.y),new Vector2D(a.x-150,a.y),new Vector2D(a.x,a.y-75),new Vector2D(a.x,a.y-150),new Vector2D(b.x,b.y),new Vector2D(b.x+75,b.y),new Vector2D(b.x+150,b.y),new Vector2D(b.x,b.y-75),new Vector2D(b.x,b.y-150)]}Application.subclass(PidgeonsMod,Modifier);PidgeonsMod.FEED_WAIT=0;PidgeonsMod.FEED_THROW=1;PidgeonsMod.FEED_PIDGEONS_IN=2;PidgeonsMod.FEED_PIDGEONS_EATING=3;PidgeonsMod.FEED_PIDGEONS_OUT=4;PidgeonsMod.prototype.onGameStart=function(){this.start()};
PidgeonsMod.prototype.onEndInterval=function(){Modifier.prototype.onEndInterval.call(this);switch(this.feedState){case PidgeonsMod.FEED_WAIT:this.elements[0].gotoState(ModifierElement.ST_HIT);break;case PidgeonsMod.FEED_PIDGEONS_EATING:this.elements[1].setAwaitingDelete(!0),this.elements[1]=null,this.goOutPidgeons(),this.feedState=PidgeonsMod.FEED_PIDGEONS_OUT}};
PidgeonsMod.prototype.onElementDone=function(a){switch(this.feedState){case PidgeonsMod.FEED_WAIT:this.throwSeeds();this.feedState=PidgeonsMod.FEED_THROW;break;case PidgeonsMod.FEED_THROW:this.goInPidgeons();this.feedState=PidgeonsMod.FEED_PIDGEONS_IN;break;case PidgeonsMod.FEED_PIDGEONS_IN:this.doneCounter++;if(this.doneCounter<this.totalPidgeons)break;this.doneCounter=0;this.timeInterval=Application.config.modifiers.pidgeonsStandTime;this.start();this.feedState=PidgeonsMod.FEED_PIDGEONS_EATING;
a=.5*this.world.width();var b=this.world.getFloorY();this.world.createEffect("Scn_obj_modifier_06_pidgeons_dust",a,b);Application.instance.playSound("SND_BIRDS_COOING");break;case PidgeonsMod.FEED_PIDGEONS_OUT:if(this.doneCounter++,!(this.doneCounter<this.totalPidgeons)){for(a=this.doneCounter=0;a<this.totalPidgeons;a++)this.elements[a+2].setAwaitingDelete(!0),this.elements[a+2]=null;this.timeInterval=Application.config.modifiers.pidgeonsIntervalTime;this.start();this.feedState=PidgeonsMod.FEED_WAIT;
Application.instance.stopSound("SND_BIRDS_COOING")}}};PidgeonsMod.prototype.throwSeeds=function(){var a=new Seeds(this,this.world,this.elements[0].getX()-90,this.elements[0].getY()-90,1);this.world.actorManager().add(a);this.elements[1]=null;this.elements[1]=a};
PidgeonsMod.prototype.goInPidgeons=function(){for(var a=0;a<this.totalPidgeons;a++){var b=new Pidgeon(this,this.world,this.pidPositions[a].x+25*Math.random()*Math.pow(-1,Common.randomInt(0,1)),this.pidPositions[a].y+25*Math.random()*Math.pow(-1,Common.randomInt(0,1)),a);this.world.actorManager().add(b);this.elements[a+2]=null;this.elements[a+2]=b}Application.instance.playSound("SND_BIRDS_FLY_IN")};
PidgeonsMod.prototype.goOutPidgeons=function(){var a=.5*this.world.width(),b=this.world.getFloorY();this.world.createEffect("Scn_obj_modifier_06_pidgeons_dust",a,b);for(a=0;a<this.totalPidgeons;a++)this.elements[a+2].goOut();Application.instance.playSound("SND_BIRDS_FLY_OUT")};
PidgeonsMod.prototype.stop=function(){Modifier.prototype.stop.call(this);var a=this.elements[0];this.elements=null;this.elements=[];this.elements.push(a);this.feedState=PidgeonsMod.FEED_WAIT;this.timeInterval=Application.config.modifiers.pidgeonsIntervalTime;this.doneCounter=0};
function Robot(a,b,c,d,e,f){ModifierElement.call(this,a,b,c,d,e);this.type=ModifierElement.TYPE_ROBOT;this.finalX=f;this.m_character=new Character(c,d,this.m_canvas);this.m_character.onEndAnimation(this,this.onEndAnimation);this.m_character.addState(ModifierElement.ST_STAND,"Scn_obj_modifier_05_activated");this.m_character.addState(ModifierElement.ST_HIT,"Scn_obj_modifier_05_hit");this.m_character.addState(ModifierElement.ST_DISAPPEAR,"Scn_obj_modifier_05_out");this.gotoState(ModifierElement.ST_STAND);
this.setScale(this.m_world.fData.scale);this.mov=null;this.movSpeed=Application.config.modifiers.robotSpeed}Application.subclass(Robot,ModifierElement);Robot.HALF_WIDTH=90;Robot.prototype.onEndAnimation=function(a){switch(a){case ModifierElement.ST_HIT:this.gotoState(ModifierElement.ST_DISAPPEAR),this.startMoving(ModifierElement.ST_DISAPPEAR)}};
Robot.prototype.startMoving=function(a){this.mov&&(this.mov.free(),this.mov=null,Application.instance.stopSound("SND_GOAT_PASS_BY"));this.gotoState(a);a===ModifierElement.ST_DISAPPEAR?(this.mov=new LinearMovement(this.m_x,this.m_y,2*this.movSpeed),this.mov.setCallbacks(this,this.onEndMovement,null),this.mov.extraData={},this.mov.extraData.id="afterHit"):this.mov=new LinearMovement(this.m_x,this.m_y,this.movSpeed,!0,!0);this.mov.gotoPosition(this.finalX,this.m_y);Application.instance.playSound("SND_GOAT_PASS_BY")};
Robot.prototype.onEndMovement=function(a){this.mov&&this.mov.extraData&&"afterHit"===this.mov.extraData.id&&(this.modifier.onElementDone(this),this.deactivate())};
Robot.prototype.update=function(a){ModifierElement.prototype.update.call(this,a);if(this.mov&&(this.m_x=this.mov.getX(),this.m_y=this.mov.getY(),this.setFlipX(0<this.mov.getLinearVelocityX()),this.mov.update(a),this.m_state===ModifierElement.ST_STAND)){a=this.m_world.getPlayersRef()[0];var b=this.m_world.getPlayersRef()[1];a.isDefeated()||b.isDefeated()||this.checkCollisionWithPlayers("mcCollision","mcAttack")}};
Robot.prototype.checkCollisionWithPlayers=function(a,b){for(var c=this.m_world.getPlayersRef(),d=0;d<c.length;d++)if(c[d].getMState()===FighterActor.ST_DIVE&&this.hitTestWithActorByBounds(c[d],a,b))this.onCollideWithPlayer(c[d])};
Robot.prototype.onCollideWithPlayer=function(a){a.createHitEffect(this);this.gotoState(ModifierElement.ST_HIT);this.extraData.playerVel=a.getDiveSpeed().x;this.modifier.onElementDone(this);this.mov&&(this.mov.free(),this.mov=null,Application.instance.stopSound("SND_GOAT_PASS_BY"));Application.instance.playSound("SND_GOAT_CRASHED")};
Robot.prototype.deactivate=function(){ModifierElement.prototype.deactivate.call(this);this.mov&&(this.mov.free(),this.mov=null,Application.instance.stopSound("SND_GOAT_PASS_BY"));var a=this.modifier.getSidePositionsX(Robot.HALF_WIDTH),b=Common.randomInt(0,1);this.m_x=a[b].x-RobotMod.OFFSET_X*Math.pow(-1,b);this.finalX=a[0===b?1:0].x+RobotMod.OFFSET_X*Math.pow(-1,b)};
function RobotBonus(a,b,c,d,e,f){ModifierElement.call(this,a,b,c,d,e);this.type=ModifierElement.TYPE_ROBOT_HP;this.m_damage=-Application.config.modifiers.robotHPbonus;this.m_character=new Character(c,d,this.m_canvas);this.m_character.onEndAnimation(this,this.onEndAnimation);this.m_character.addState(ModifierElement.ST_STAND,"Scn_obj_modifier_05_pack");this.m_character.addState(ModifierElement.ST_OPENING,"Scn_obj_modifier_05_pack_open");this.m_character.addState(ModifierElement.ST_OPEN,"Scn_obj_modifier_05_pack_stand");
this.m_character.addState(ModifierElement.ST_DISAPPEAR,"Scn_obj_modifier_05_pack_disappear");this.gotoState(ModifierElement.ST_STAND);this.setScale(this.m_world.fData.scale);this.initXY=new Vector2D(c,d);this.finalXY=new Vector2D(f,this.m_world.getFloorY());this.fx=null;this.mov=new ParametricParabolicMovement(this.initXY.x,this.initXY.y,this.finalXY.x,this.finalXY.y,.75*ParametricParabolicMovement.STD_GRAVITY,.75*ParametricParabolicMovement.STD_SPEED);this.mov.target=this;this.mov.setEndCallback("onEndMovement");
this.playerToBonus=null;this.aiType=AICore.PU_TYPE_PICK;Application.instance.playSound("SND_HEALTH_APPEAR")}Application.subclass(RobotBonus,ModifierElement);
RobotBonus.prototype.onEndAnimation=function(a){switch(a){case ModifierElement.ST_OPENING:this.gotoState(ModifierElement.ST_OPEN);a=this.m_x-this.m_world.camera().getX()-Layout.left/Layout.scale;var b=this.m_y-this.m_world.camera().getY()-Layout.top/Layout.scale;this.fx=Application.instance.effectManager.createEffect("fxMeatAura",a,b,this.m_world.bgCanvas,0)}};
RobotBonus.prototype.onEndMovement=function(a){this.mov.free();this.mov=null;this.m_x=this.finalXY.x;this.m_x+50>this.m_world.limitRight?this.m_x=this.m_world.limitRight-50:this.m_x-50<this.m_world.limitLeft&&(this.m_x=this.m_world.limitLeft+50);this.m_y=this.finalXY.y;this.gotoState(ModifierElement.ST_OPENING)};
RobotBonus.prototype.update=function(a){ModifierElement.prototype.update.call(this,a);this.m_isAwaitingDelete||this.m_state===ModifierElement.ST_DISAPPEAR||(this.mov?(this.m_x=this.mov.getX(),this.m_x+50>this.m_world.limitRight?this.m_x=this.m_world.limitRight-50:this.m_x-50<this.m_world.limitLeft&&(this.m_x=this.m_world.limitLeft+50),this.m_y=this.mov.getY(),this.mov.update(a)):this.checkCollisionWithPlayers("mcCollision","mcCollision"))};
RobotBonus.prototype.checkCollisionWithPlayers=function(a,b){for(var c=this.m_world.getPlayersRef(),d=0;d<c.length;d++)if(this.hitTestWithActorByBounds(c[d],a,b)){this.playerToBonus=c[d];a=FighterHUD.instance.getControl("mcGuiHpBarFill0"+(this.playerToBonus.id()+1));FighterHUD.instance.createMagnetizedClip(this.m_clip.position.x,this.m_clip.position.y,a.canvas.position.x,a.canvas.position.y,"Scn_obj_modifier_05_pack_stand",this,this.onEndMagnetized);this.fx&&(this.fx.setAwaitingDelete(!0),this.fx=
null);this.onCollideWithPlayer(c[d]);break}};RobotBonus.prototype.onCollideWithPlayer=function(a){this.gotoState(ModifierElement.ST_DISAPPEAR);this.m_clip.loop=!1;this.mov&&(this.mov.free(),this.mov=null);Application.instance.playSound("SND_LIFE_BAR_REFILL")};RobotBonus.prototype.onEndMagnetized=function(){this.playerToBonus.onCollisionWithModElement(this);this.m_isAwaitingDelete=!0;this.fx&&(this.fx.setAwaitingDelete(!0),this.fx=null)};
RobotBonus.prototype.deactivate=function(){ModifierElement.prototype.deactivate.call(this);this.m_isAwaitingDelete=!0;this.fx&&(this.fx.setAwaitingDelete(!0),this.fx=null)};
function RobotMod(a){Modifier.call(this,a);a=this.getSidePositionsX(Robot.HALF_WIDTH);var b=Common.randomInt(0,1);a=new Robot(this,this.world,a[b].x-RobotMod.OFFSET_X*Math.pow(-1,b),this.world.getFloorY(),0,a[0===b?1:0].x+RobotMod.OFFSET_X*Math.pow(-1,b));this.world.actorManager().add(a);this.elements.push(a);this.timeInterval=Application.config.modifiers.robotIntervalTime}Application.subclass(RobotMod,Modifier);RobotMod.OFFSET_X=250;RobotMod.prototype.onGameStart=function(){this.start()};
RobotMod.prototype.onEndInterval=function(){Modifier.prototype.onEndInterval.call(this);this.elements[0].startMoving(ModifierElement.ST_STAND)};
RobotMod.prototype.onElementDone=function(a){switch(a.type){case ModifierElement.TYPE_ROBOT:switch(a.state()){case ModifierElement.ST_HIT:a=new RobotBonus(this,this.world,a.getX(),this.world.getFloorY(),this.elements.length,0<a.extraData.playerVel?a.getX()+RobotMod.OFFSET_X:a.getX()-RobotMod.OFFSET_X);this.world.actorManager().add(a);this.elements.push(a);break;case ModifierElement.ST_DISAPPEAR:this.start()}}};
RobotMod.prototype.stop=function(){Modifier.prototype.stop.call(this);var a=this.elements[0];this.elements=null;this.elements=[];this.elements.push(a);this.timeInterval=Application.config.modifiers.robotIntervalTime};PIXI.Container.prototype.countChildren=function(){if(!this.children)return 1;for(var a=this.children.length,b=0,c=this.children.length;b<c;b++)this.children[b].countChildren&&(a+=this.children[b].countChildren());return a};
window.abcdm.abc.com.GameApis.onSuspended=function(){Application.info("GameApis on Suspend(ed/ing)");Application.onWrapperSuspended();Application.onWrapperSuspending()};window.abcdm.abc.com.GameApis.onActivated=function(){Application.info("GameApis on onActivated");Application.onWrapperActivated()};Application.warn("SwitJS[1352] Fri May 11 14:26:20 2018 (PC-BG-028) <v20170806>");
